use File::stat;
use MIME::Base64 qw( decode_base64 );
my $folder = '/C/1C/Ddd/zhu/zup/';#укажите каталог обрабатываемой базы
my $html_head = '<html><head><title>Licenses report</title></head><body><canvas id="chartjs" class="chartjs" width="undefined" height="undefined"></canvas><script>';
my $script_base64 = 'LyohDQogKiBDaGFydC5qcw0KICogaHR0cDovL2NoYXJ0anMub3JnLw0KICogVmVyc2lvbjogMi43LjENCiAqDQogKiBDb3B5cmlnaHQgMjAxNyBOaWNrIERvd25pZQ0KICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlDQogKiBodHRwczovL2dpdGh1Yi5jb20vY2hhcnRqcy9DaGFydC5qcy9ibG9iL21hc3Rlci9MSUNFTlNFLm1kDQogKi8NCihmdW5jdGlvbihmKXtpZih0eXBlb2YgZXhwb3J0cz09PSJvYmplY3QiJiZ0eXBlb2YgbW9kdWxlIT09InVuZGVmaW5lZCIpe21vZHVsZS5leHBvcnRzPWYoKX1lbHNlIGlmKHR5cGVvZiBkZWZpbmU9PT0iZnVuY3Rpb24iJiZkZWZpbmUuYW1kKXtkZWZpbmUoW10sZil9ZWxzZXt2YXIgZztpZih0eXBlb2Ygd2luZG93IT09InVuZGVmaW5lZCIpe2c9d2luZG93fWVsc2UgaWYodHlwZW9mIGdsb2JhbCE9PSJ1bmRlZmluZWQiKXtnPWdsb2JhbH1lbHNlIGlmKHR5cGVvZiBzZWxmIT09InVuZGVmaW5lZCIpe2c9c2VsZn1lbHNle2c9dGhpc31nLkNoYXJ0ID0gZigpfX0pKGZ1bmN0aW9uKCl7dmFyIGRlZmluZSxtb2R1bGUsZXhwb3J0cztyZXR1cm4gKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT0iZnVuY3Rpb24iJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKCJDYW5ub3QgZmluZCBtb2R1bGUgJyIrbysiJyIpO3Rocm93IGYuY29kZT0iTU9EVUxFX05PVF9GT1VORCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT0iZnVuY3Rpb24iJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSh7MTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7DQovKiBNSVQgbGljZW5zZSAqLw0KdmFyIGNvbG9yTmFtZXMgPSByZXF1aXJlKDUpOw0KDQptb2R1bGUuZXhwb3J0cyA9IHsNCiAgIGdldFJnYmE6IGdldFJnYmEsDQogICBnZXRIc2xhOiBnZXRIc2xhLA0KICAgZ2V0UmdiOiBnZXRSZ2IsDQogICBnZXRIc2w6IGdldEhzbCwNCiAgIGdldEh3YjogZ2V0SHdiLA0KICAgZ2V0QWxwaGE6IGdldEFscGhhLA0KDQogICBoZXhTdHJpbmc6IGhleFN0cmluZywNCiAgIHJnYlN0cmluZzogcmdiU3RyaW5nLA0KICAgcmdiYVN0cmluZzogcmdiYVN0cmluZywNCiAgIHBlcmNlbnRTdHJpbmc6IHBlcmNlbnRTdHJpbmcsDQogICBwZXJjZW50YVN0cmluZzogcGVyY2VudGFTdHJpbmcsDQogICBoc2xTdHJpbmc6IGhzbFN0cmluZywNCiAgIGhzbGFTdHJpbmc6IGhzbGFTdHJpbmcsDQogICBod2JTdHJpbmc6IGh3YlN0cmluZywNCiAgIGtleXdvcmQ6IGtleXdvcmQNCn0NCg0KZnVuY3Rpb24gZ2V0UmdiYShzdHJpbmcpIHsNCiAgIGlmICghc3RyaW5nKSB7DQogICAgICByZXR1cm47DQogICB9DQogICB2YXIgYWJiciA9ICAvXiMoW2EtZkEtRjAtOV17M30pJC9pLA0KICAgICAgIGhleCA9ICAvXiMoW2EtZkEtRjAtOV17Nn0pJC9pLA0KICAgICAgIHJnYmEgPSAvXnJnYmE/XChccyooWystXT9cZCspXHMqLFxzKihbKy1dP1xkKylccyosXHMqKFsrLV0/XGQrKVxzKig/OixccyooWystXT9bXGRcLl0rKVxzKik/XCkkL2ksDQogICAgICAgcGVyID0gL15yZ2JhP1woXHMqKFsrLV0/W1xkXC5dKylcJVxzKixccyooWystXT9bXGRcLl0rKVwlXHMqLFxzKihbKy1dP1tcZFwuXSspXCVccyooPzosXHMqKFsrLV0/W1xkXC5dKylccyopP1wpJC9pLA0KICAgICAgIGtleXdvcmQgPSAvKFx3KykvOw0KDQogICB2YXIgcmdiID0gWzAsIDAsIDBdLA0KICAgICAgIGEgPSAxLA0KICAgICAgIG1hdGNoID0gc3RyaW5nLm1hdGNoKGFiYnIpOw0KICAgaWYgKG1hdGNoKSB7DQogICAgICBtYXRjaCA9IG1hdGNoWzFdOw0KICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCByZ2IubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgIHJnYltpXSA9IHBhcnNlSW50KG1hdGNoW2ldICsgbWF0Y2hbaV0sIDE2KTsNCiAgICAgIH0NCiAgIH0NCiAgIGVsc2UgaWYgKG1hdGNoID0gc3RyaW5nLm1hdGNoKGhleCkpIHsNCiAgICAgIG1hdGNoID0gbWF0Y2hbMV07DQogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJnYi5sZW5ndGg7IGkrKykgew0KICAgICAgICAgcmdiW2ldID0gcGFyc2VJbnQobWF0Y2guc2xpY2UoaSAqIDIsIGkgKiAyICsgMiksIDE2KTsNCiAgICAgIH0NCiAgIH0NCiAgIGVsc2UgaWYgKG1hdGNoID0gc3RyaW5nLm1hdGNoKHJnYmEpKSB7DQogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJnYi5sZW5ndGg7IGkrKykgew0KICAgICAgICAgcmdiW2ldID0gcGFyc2VJbnQobWF0Y2hbaSArIDFdKTsNCiAgICAgIH0NCiAgICAgIGEgPSBwYXJzZUZsb2F0KG1hdGNoWzRdKTsNCiAgIH0NCiAgIGVsc2UgaWYgKG1hdGNoID0gc3RyaW5nLm1hdGNoKHBlcikpIHsNCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmdiLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICByZ2JbaV0gPSBNYXRoLnJvdW5kKHBhcnNlRmxvYXQobWF0Y2hbaSArIDFdKSAqIDIuNTUpOw0KICAgICAgfQ0KICAgICAgYSA9IHBhcnNlRmxvYXQobWF0Y2hbNF0pOw0KICAgfQ0KICAgZWxzZSBpZiAobWF0Y2ggPSBzdHJpbmcubWF0Y2goa2V5d29yZCkpIHsNCiAgICAgIGlmIChtYXRjaFsxXSA9PSAidHJhbnNwYXJlbnQiKSB7DQogICAgICAgICByZXR1cm4gWzAsIDAsIDAsIDBdOw0KICAgICAgfQ0KICAgICAgcmdiID0gY29sb3JOYW1lc1ttYXRjaFsxXV07DQogICAgICBpZiAoIXJnYikgew0KICAgICAgICAgcmV0dXJuOw0KICAgICAgfQ0KICAgfQ0KDQogICBmb3IgKHZhciBpID0gMDsgaSA8IHJnYi5sZW5ndGg7IGkrKykgew0KICAgICAgcmdiW2ldID0gc2NhbGUocmdiW2ldLCAwLCAyNTUpOw0KICAgfQ0KICAgaWYgKCFhICYmIGEgIT0gMCkgew0KICAgICAgYSA9IDE7DQogICB9DQogICBlbHNlIHsNCiAgICAgIGEgPSBzY2FsZShhLCAwLCAxKTsNCiAgIH0NCiAgIHJnYlszXSA9IGE7DQogICByZXR1cm4gcmdiOw0KfQ0KDQpmdW5jdGlvbiBnZXRIc2xhKHN0cmluZykgew0KICAgaWYgKCFzdHJpbmcpIHsNCiAgICAgIHJldHVybjsNCiAgIH0NCiAgIHZhciBoc2wgPSAvXmhzbGE/XChccyooWystXT9cZCspKD86ZGVnKT9ccyosXHMqKFsrLV0/W1xkXC5dKyklXHMqLFxzKihbKy1dP1tcZFwuXSspJVxzKig/OixccyooWystXT9bXGRcLl0rKVxzKik/XCkvOw0KICAgdmFyIG1hdGNoID0gc3RyaW5nLm1hdGNoKGhzbCk7DQogICBpZiAobWF0Y2gpIHsNCiAgICAgIHZhciBhbHBoYSA9IHBhcnNlRmxvYXQobWF0Y2hbNF0pOw0KICAgICAgdmFyIGggPSBzY2FsZShwYXJzZUludChtYXRjaFsxXSksIDAsIDM2MCksDQogICAgICAgICAgcyA9IHNjYWxlKHBhcnNlRmxvYXQobWF0Y2hbMl0pLCAwLCAxMDApLA0KICAgICAgICAgIGwgPSBzY2FsZShwYXJzZUZsb2F0KG1hdGNoWzNdKSwgMCwgMTAwKSwNCiAgICAgICAgICBhID0gc2NhbGUoaXNOYU4oYWxwaGEpID8gMSA6IGFscGhhLCAwLCAxKTsNCiAgICAgIHJldHVybiBbaCwgcywgbCwgYV07DQogICB9DQp9DQoNCmZ1bmN0aW9uIGdldEh3YihzdHJpbmcpIHsNCiAgIGlmICghc3RyaW5nKSB7DQogICAgICByZXR1cm47DQogICB9DQogICB2YXIgaHdiID0gL15od2JcKFxzKihbKy1dP1xkKykoPzpkZWcpP1xzKixccyooWystXT9bXGRcLl0rKSVccyosXHMqKFsrLV0/W1xkXC5dKyklXHMqKD86LFxzKihbKy1dP1tcZFwuXSspXHMqKT9cKS87DQogICB2YXIgbWF0Y2ggPSBzdHJpbmcubWF0Y2goaHdiKTsNCiAgIGlmIChtYXRjaCkgew0KICAgIHZhciBhbHBoYSA9IHBhcnNlRmxvYXQobWF0Y2hbNF0pOw0KICAgICAgdmFyIGggPSBzY2FsZShwYXJzZUludChtYXRjaFsxXSksIDAsIDM2MCksDQogICAgICAgICAgdyA9IHNjYWxlKHBhcnNlRmxvYXQobWF0Y2hbMl0pLCAwLCAxMDApLA0KICAgICAgICAgIGIgPSBzY2FsZShwYXJzZUZsb2F0KG1hdGNoWzNdKSwgMCwgMTAwKSwNCiAgICAgICAgICBhID0gc2NhbGUoaXNOYU4oYWxwaGEpID8gMSA6IGFscGhhLCAwLCAxKTsNCiAgICAgIHJldHVybiBbaCwgdywgYiwgYV07DQogICB9DQp9DQoNCmZ1bmN0aW9uIGdldFJnYihzdHJpbmcpIHsNCiAgIHZhciByZ2JhID0gZ2V0UmdiYShzdHJpbmcpOw0KICAgcmV0dXJuIHJnYmEgJiYgcmdiYS5zbGljZSgwLCAzKTsNCn0NCg0KZnVuY3Rpb24gZ2V0SHNsKHN0cmluZykgew0KICB2YXIgaHNsYSA9IGdldEhzbGEoc3RyaW5nKTsNCiAgcmV0dXJuIGhzbGEgJiYgaHNsYS5zbGljZSgwLCAzKTsNCn0NCg0KZnVuY3Rpb24gZ2V0QWxwaGEoc3RyaW5nKSB7DQogICB2YXIgdmFscyA9IGdldFJnYmEoc3RyaW5nKTsNCiAgIGlmICh2YWxzKSB7DQogICAgICByZXR1cm4gdmFsc1szXTsNCiAgIH0NCiAgIGVsc2UgaWYgKHZhbHMgPSBnZXRIc2xhKHN0cmluZykpIHsNCiAgICAgIHJldHVybiB2YWxzWzNdOw0KICAgfQ0KICAgZWxzZSBpZiAodmFscyA9IGdldEh3YihzdHJpbmcpKSB7DQogICAgICByZXR1cm4gdmFsc1szXTsNCiAgIH0NCn0NCg0KLy8gZ2VuZXJhdG9ycw0KZnVuY3Rpb24gaGV4U3RyaW5nKHJnYikgew0KICAgcmV0dXJuICIjIiArIGhleERvdWJsZShyZ2JbMF0pICsgaGV4RG91YmxlKHJnYlsxXSkNCiAgICAgICAgICAgICAgKyBoZXhEb3VibGUocmdiWzJdKTsNCn0NCg0KZnVuY3Rpb24gcmdiU3RyaW5nKHJnYmEsIGFscGhhKSB7DQogICBpZiAoYWxwaGEgPCAxIHx8IChyZ2JhWzNdICYmIHJnYmFbM10gPCAxKSkgew0KICAgICAgcmV0dXJuIHJnYmFTdHJpbmcocmdiYSwgYWxwaGEpOw0KICAgfQ0KICAgcmV0dXJuICJyZ2IoIiArIHJnYmFbMF0gKyAiLCAiICsgcmdiYVsxXSArICIsICIgKyByZ2JhWzJdICsgIikiOw0KfQ0KDQpmdW5jdGlvbiByZ2JhU3RyaW5nKHJnYmEsIGFscGhhKSB7DQogICBpZiAoYWxwaGEgPT09IHVuZGVmaW5lZCkgew0KICAgICAgYWxwaGEgPSAocmdiYVszXSAhPT0gdW5kZWZpbmVkID8gcmdiYVszXSA6IDEpOw0KICAgfQ0KICAgcmV0dXJuICJyZ2JhKCIgKyByZ2JhWzBdICsgIiwgIiArIHJnYmFbMV0gKyAiLCAiICsgcmdiYVsyXQ0KICAgICAgICAgICArICIsICIgKyBhbHBoYSArICIpIjsNCn0NCg0KZnVuY3Rpb24gcGVyY2VudFN0cmluZyhyZ2JhLCBhbHBoYSkgew0KICAgaWYgKGFscGhhIDwgMSB8fCAocmdiYVszXSAmJiByZ2JhWzNdIDwgMSkpIHsNCiAgICAgIHJldHVybiBwZXJjZW50YVN0cmluZyhyZ2JhLCBhbHBoYSk7DQogICB9DQogICB2YXIgciA9IE1hdGgucm91bmQocmdiYVswXS8yNTUgKiAxMDApLA0KICAgICAgIGcgPSBNYXRoLnJvdW5kKHJnYmFbMV0vMjU1ICogMTAwKSwNCiAgICAgICBiID0gTWF0aC5yb3VuZChyZ2JhWzJdLzI1NSAqIDEwMCk7DQoNCiAgIHJldHVybiAicmdiKCIgKyByICsgIiUsICIgKyBnICsgIiUsICIgKyBiICsgIiUpIjsNCn0NCg0KZnVuY3Rpb24gcGVyY2VudGFTdHJpbmcocmdiYSwgYWxwaGEpIHsNCiAgIHZhciByID0gTWF0aC5yb3VuZChyZ2JhWzBdLzI1NSAqIDEwMCksDQogICAgICAgZyA9IE1hdGgucm91bmQocmdiYVsxXS8yNTUgKiAxMDApLA0KICAgICAgIGIgPSBNYXRoLnJvdW5kKHJnYmFbMl0vMjU1ICogMTAwKTsNCiAgIHJldHVybiAicmdiYSgiICsgciArICIlLCAiICsgZyArICIlLCAiICsgYiArICIlLCAiICsgKGFscGhhIHx8IHJnYmFbM10gfHwgMSkgKyAiKSI7DQp9DQoNCmZ1bmN0aW9uIGhzbFN0cmluZyhoc2xhLCBhbHBoYSkgew0KICAgaWYgKGFscGhhIDwgMSB8fCAoaHNsYVszXSAmJiBoc2xhWzNdIDwgMSkpIHsNCiAgICAgIHJldHVybiBoc2xhU3RyaW5nKGhzbGEsIGFscGhhKTsNCiAgIH0NCiAgIHJldHVybiAiaHNsKCIgKyBoc2xhWzBdICsgIiwgIiArIGhzbGFbMV0gKyAiJSwgIiArIGhzbGFbMl0gKyAiJSkiOw0KfQ0KDQpmdW5jdGlvbiBoc2xhU3RyaW5nKGhzbGEsIGFscGhhKSB7DQogICBpZiAoYWxwaGEgPT09IHVuZGVmaW5lZCkgew0KICAgICAgYWxwaGEgPSAoaHNsYVszXSAhPT0gdW5kZWZpbmVkID8gaHNsYVszXSA6IDEpOw0KICAgfQ0KICAgcmV0dXJuICJoc2xhKCIgKyBoc2xhWzBdICsgIiwgIiArIGhzbGFbMV0gKyAiJSwgIiArIGhzbGFbMl0gKyAiJSwgIg0KICAgICAgICAgICArIGFscGhhICsgIikiOw0KfQ0KDQovLyBod2IgaXMgYSBiaXQgZGlmZmVyZW50IHRoYW4gcmdiKGEpICYgaHNsKGEpIHNpbmNlIHRoZXJlIGlzIG5vIGFscGhhIHNwZWNpZmljIHN5bnRheA0KLy8gKGh3YiBoYXZlIGFscGhhIG9wdGlvbmFsICYgMSBpcyBkZWZhdWx0IHZhbHVlKQ0KZnVuY3Rpb24gaHdiU3RyaW5nKGh3YiwgYWxwaGEpIHsNCiAgIGlmIChhbHBoYSA9PT0gdW5kZWZpbmVkKSB7DQogICAgICBhbHBoYSA9IChod2JbM10gIT09IHVuZGVmaW5lZCA/IGh3YlszXSA6IDEpOw0KICAgfQ0KICAgcmV0dXJuICJod2IoIiArIGh3YlswXSArICIsICIgKyBod2JbMV0gKyAiJSwgIiArIGh3YlsyXSArICIlIg0KICAgICAgICAgICArIChhbHBoYSAhPT0gdW5kZWZpbmVkICYmIGFscGhhICE9PSAxID8gIiwgIiArIGFscGhhIDogIiIpICsgIikiOw0KfQ0KDQpmdW5jdGlvbiBrZXl3b3JkKHJnYikgew0KICByZXR1cm4gcmV2ZXJzZU5hbWVzW3JnYi5zbGljZSgwLCAzKV07DQp9DQoNCi8vIGhlbHBlcnMNCmZ1bmN0aW9uIHNjYWxlKG51bSwgbWluLCBtYXgpIHsNCiAgIHJldHVybiBNYXRoLm1pbihNYXRoLm1heChtaW4sIG51bSksIG1heCk7DQp9DQoNCmZ1bmN0aW9uIGhleERvdWJsZShudW0pIHsNCiAgdmFyIHN0ciA9IG51bS50b1N0cmluZygxNikudG9VcHBlckNhc2UoKTsNCiAgcmV0dXJuIChzdHIubGVuZ3RoIDwgMikgPyAiMCIgKyBzdHIgOiBzdHI7DQp9DQoNCg0KLy9jcmVhdGUgYSBsaXN0IG9mIHJldmVyc2UgY29sb3IgbmFtZXMNCnZhciByZXZlcnNlTmFtZXMgPSB7fTsNCmZvciAodmFyIG5hbWUgaW4gY29sb3JOYW1lcykgew0KICAgcmV2ZXJzZU5hbWVzW2NvbG9yTmFtZXNbbmFtZV1dID0gbmFtZTsNCn0NCg0KfSx7IjUiOjV9XSwyOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsNCi8qIE1JVCBsaWNlbnNlICovDQp2YXIgY29udmVydCA9IHJlcXVpcmUoNCk7DQp2YXIgc3RyaW5nID0gcmVxdWlyZSgxKTsNCg0KdmFyIENvbG9yID0gZnVuY3Rpb24gKG9iaikgew0KCWlmIChvYmogaW5zdGFuY2VvZiBDb2xvcikgew0KCQlyZXR1cm4gb2JqOw0KCX0NCglpZiAoISh0aGlzIGluc3RhbmNlb2YgQ29sb3IpKSB7DQoJCXJldHVybiBuZXcgQ29sb3Iob2JqKTsNCgl9DQoNCgl0aGlzLnZhbGlkID0gZmFsc2U7DQoJdGhpcy52YWx1ZXMgPSB7DQoJCXJnYjogWzAsIDAsIDBdLA0KCQloc2w6IFswLCAwLCAwXSwNCgkJaHN2OiBbMCwgMCwgMF0sDQoJCWh3YjogWzAsIDAsIDBdLA0KCQljbXlrOiBbMCwgMCwgMCwgMF0sDQoJCWFscGhhOiAxDQoJfTsNCg0KCS8vIHBhcnNlIENvbG9yKCkgYXJndW1lbnQNCgl2YXIgdmFsczsNCglpZiAodHlwZW9mIG9iaiA9PT0gJ3N0cmluZycpIHsNCgkJdmFscyA9IHN0cmluZy5nZXRSZ2JhKG9iaik7DQoJCWlmICh2YWxzKSB7DQoJCQl0aGlzLnNldFZhbHVlcygncmdiJywgdmFscyk7DQoJCX0gZWxzZSBpZiAodmFscyA9IHN0cmluZy5nZXRIc2xhKG9iaikpIHsNCgkJCXRoaXMuc2V0VmFsdWVzKCdoc2wnLCB2YWxzKTsNCgkJfSBlbHNlIGlmICh2YWxzID0gc3RyaW5nLmdldEh3YihvYmopKSB7DQoJCQl0aGlzLnNldFZhbHVlcygnaHdiJywgdmFscyk7DQoJCX0NCgl9IGVsc2UgaWYgKHR5cGVvZiBvYmogPT09ICdvYmplY3QnKSB7DQoJCXZhbHMgPSBvYmo7DQoJCWlmICh2YWxzLnIgIT09IHVuZGVmaW5lZCB8fCB2YWxzLnJlZCAhPT0gdW5kZWZpbmVkKSB7DQoJCQl0aGlzLnNldFZhbHVlcygncmdiJywgdmFscyk7DQoJCX0gZWxzZSBpZiAodmFscy5sICE9PSB1bmRlZmluZWQgfHwgdmFscy5saWdodG5lc3MgIT09IHVuZGVmaW5lZCkgew0KCQkJdGhpcy5zZXRWYWx1ZXMoJ2hzbCcsIHZhbHMpOw0KCQl9IGVsc2UgaWYgKHZhbHMudiAhPT0gdW5kZWZpbmVkIHx8IHZhbHMudmFsdWUgIT09IHVuZGVmaW5lZCkgew0KCQkJdGhpcy5zZXRWYWx1ZXMoJ2hzdicsIHZhbHMpOw0KCQl9IGVsc2UgaWYgKHZhbHMudyAhPT0gdW5kZWZpbmVkIHx8IHZhbHMud2hpdGVuZXNzICE9PSB1bmRlZmluZWQpIHsNCgkJCXRoaXMuc2V0VmFsdWVzKCdod2InLCB2YWxzKTsNCgkJfSBlbHNlIGlmICh2YWxzLmMgIT09IHVuZGVmaW5lZCB8fCB2YWxzLmN5YW4gIT09IHVuZGVmaW5lZCkgew0KCQkJdGhpcy5zZXRWYWx1ZXMoJ2NteWsnLCB2YWxzKTsNCgkJfQ0KCX0NCn07DQoNCkNvbG9yLnByb3RvdHlwZSA9IHsNCglpc1ZhbGlkOiBmdW5jdGlvbiAoKSB7DQoJCXJldHVybiB0aGlzLnZhbGlkOw0KCX0sDQoJcmdiOiBmdW5jdGlvbiAoKSB7DQoJCXJldHVybiB0aGlzLnNldFNwYWNlKCdyZ2InLCBhcmd1bWVudHMpOw0KCX0sDQoJaHNsOiBmdW5jdGlvbiAoKSB7DQoJCXJldHVybiB0aGlzLnNldFNwYWNlKCdoc2wnLCBhcmd1bWVudHMpOw0KCX0sDQoJaHN2OiBmdW5jdGlvbiAoKSB7DQoJCXJldHVybiB0aGlzLnNldFNwYWNlKCdoc3YnLCBhcmd1bWVudHMpOw0KCX0sDQoJaHdiOiBmdW5jdGlvbiAoKSB7DQoJCXJldHVybiB0aGlzLnNldFNwYWNlKCdod2InLCBhcmd1bWVudHMpOw0KCX0sDQoJY215azogZnVuY3Rpb24gKCkgew0KCQlyZXR1cm4gdGhpcy5zZXRTcGFjZSgnY215aycsIGFyZ3VtZW50cyk7DQoJfSwNCg0KCXJnYkFycmF5OiBmdW5jdGlvbiAoKSB7DQoJCXJldHVybiB0aGlzLnZhbHVlcy5yZ2I7DQoJfSwNCgloc2xBcnJheTogZnVuY3Rpb24gKCkgew0KCQlyZXR1cm4gdGhpcy52YWx1ZXMuaHNsOw0KCX0sDQoJaHN2QXJyYXk6IGZ1bmN0aW9uICgpIHsNCgkJcmV0dXJuIHRoaXMudmFsdWVzLmhzdjsNCgl9LA0KCWh3YkFycmF5OiBmdW5jdGlvbiAoKSB7DQoJCXZhciB2YWx1ZXMgPSB0aGlzLnZhbHVlczsNCgkJaWYgKHZhbHVlcy5hbHBoYSAhPT0gMSkgew0KCQkJcmV0dXJuIHZhbHVlcy5od2IuY29uY2F0KFt2YWx1ZXMuYWxwaGFdKTsNCgkJfQ0KCQlyZXR1cm4gdmFsdWVzLmh3YjsNCgl9LA0KCWNteWtBcnJheTogZnVuY3Rpb24gKCkgew0KCQlyZXR1cm4gdGhpcy52YWx1ZXMuY215azsNCgl9LA0KCXJnYmFBcnJheTogZnVuY3Rpb24gKCkgew0KCQl2YXIgdmFsdWVzID0gdGhpcy52YWx1ZXM7DQoJCXJldHVybiB2YWx1ZXMucmdiLmNvbmNhdChbdmFsdWVzLmFscGhhXSk7DQoJfSwNCgloc2xhQXJyYXk6IGZ1bmN0aW9uICgpIHsNCgkJdmFyIHZhbHVlcyA9IHRoaXMudmFsdWVzOw0KCQlyZXR1cm4gdmFsdWVzLmhzbC5jb25jYXQoW3ZhbHVlcy5hbHBoYV0pOw0KCX0sDQoJYWxwaGE6IGZ1bmN0aW9uICh2YWwpIHsNCgkJaWYgKHZhbCA9PT0gdW5kZWZpbmVkKSB7DQoJCQlyZXR1cm4gdGhpcy52YWx1ZXMuYWxwaGE7DQoJCX0NCgkJdGhpcy5zZXRWYWx1ZXMoJ2FscGhhJywgdmFsKTsNCgkJcmV0dXJuIHRoaXM7DQoJfSwNCg0KCXJlZDogZnVuY3Rpb24gKHZhbCkgew0KCQlyZXR1cm4gdGhpcy5zZXRDaGFubmVsKCdyZ2InLCAwLCB2YWwpOw0KCX0sDQoJZ3JlZW46IGZ1bmN0aW9uICh2YWwpIHsNCgkJcmV0dXJuIHRoaXMuc2V0Q2hhbm5lbCgncmdiJywgMSwgdmFsKTsNCgl9LA0KCWJsdWU6IGZ1bmN0aW9uICh2YWwpIHsNCgkJcmV0dXJuIHRoaXMuc2V0Q2hhbm5lbCgncmdiJywgMiwgdmFsKTsNCgl9LA0KCWh1ZTogZnVuY3Rpb24gKHZhbCkgew0KCQlpZiAodmFsKSB7DQoJCQl2YWwgJT0gMzYwOw0KCQkJdmFsID0gdmFsIDwgMCA/IDM2MCArIHZhbCA6IHZhbDsNCgkJfQ0KCQlyZXR1cm4gdGhpcy5zZXRDaGFubmVsKCdoc2wnLCAwLCB2YWwpOw0KCX0sDQoJc2F0dXJhdGlvbjogZnVuY3Rpb24gKHZhbCkgew0KCQlyZXR1cm4gdGhpcy5zZXRDaGFubmVsKCdoc2wnLCAxLCB2YWwpOw0KCX0sDQoJbGlnaHRuZXNzOiBmdW5jdGlvbiAodmFsKSB7DQoJCXJldHVybiB0aGlzLnNldENoYW5uZWwoJ2hzbCcsIDIsIHZhbCk7DQoJfSwNCglzYXR1cmF0aW9udjogZnVuY3Rpb24gKHZhbCkgew0KCQlyZXR1cm4gdGhpcy5zZXRDaGFubmVsKCdoc3YnLCAxLCB2YWwpOw0KCX0sDQoJd2hpdGVuZXNzOiBmdW5jdGlvbiAodmFsKSB7DQoJCXJldHVybiB0aGlzLnNldENoYW5uZWwoJ2h3YicsIDEsIHZhbCk7DQoJfSwNCglibGFja25lc3M6IGZ1bmN0aW9uICh2YWwpIHsNCgkJcmV0dXJuIHRoaXMuc2V0Q2hhbm5lbCgnaHdiJywgMiwgdmFsKTsNCgl9LA0KCXZhbHVlOiBmdW5jdGlvbiAodmFsKSB7DQoJCXJldHVybiB0aGlzLnNldENoYW5uZWwoJ2hzdicsIDIsIHZhbCk7DQoJfSwNCgljeWFuOiBmdW5jdGlvbiAodmFsKSB7DQoJCXJldHVybiB0aGlzLnNldENoYW5uZWwoJ2NteWsnLCAwLCB2YWwpOw0KCX0sDQoJbWFnZW50YTogZnVuY3Rpb24gKHZhbCkgew0KCQlyZXR1cm4gdGhpcy5zZXRDaGFubmVsKCdjbXlrJywgMSwgdmFsKTsNCgl9LA0KCXllbGxvdzogZnVuY3Rpb24gKHZhbCkgew0KCQlyZXR1cm4gdGhpcy5zZXRDaGFubmVsKCdjbXlrJywgMiwgdmFsKTsNCgl9LA0KCWJsYWNrOiBmdW5jdGlvbiAodmFsKSB7DQoJCXJldHVybiB0aGlzLnNldENoYW5uZWwoJ2NteWsnLCAzLCB2YWwpOw0KCX0sDQoNCgloZXhTdHJpbmc6IGZ1bmN0aW9uICgpIHsNCgkJcmV0dXJuIHN0cmluZy5oZXhTdHJpbmcodGhpcy52YWx1ZXMucmdiKTsNCgl9LA0KCXJnYlN0cmluZzogZnVuY3Rpb24gKCkgew0KCQlyZXR1cm4gc3RyaW5nLnJnYlN0cmluZyh0aGlzLnZhbHVlcy5yZ2IsIHRoaXMudmFsdWVzLmFscGhhKTsNCgl9LA0KCXJnYmFTdHJpbmc6IGZ1bmN0aW9uICgpIHsNCgkJcmV0dXJuIHN0cmluZy5yZ2JhU3RyaW5nKHRoaXMudmFsdWVzLnJnYiwgdGhpcy52YWx1ZXMuYWxwaGEpOw0KCX0sDQoJcGVyY2VudFN0cmluZzogZnVuY3Rpb24gKCkgew0KCQlyZXR1cm4gc3RyaW5nLnBlcmNlbnRTdHJpbmcodGhpcy52YWx1ZXMucmdiLCB0aGlzLnZhbHVlcy5hbHBoYSk7DQoJfSwNCgloc2xTdHJpbmc6IGZ1bmN0aW9uICgpIHsNCgkJcmV0dXJuIHN0cmluZy5oc2xTdHJpbmcodGhpcy52YWx1ZXMuaHNsLCB0aGlzLnZhbHVlcy5hbHBoYSk7DQoJfSwNCgloc2xhU3RyaW5nOiBmdW5jdGlvbiAoKSB7DQoJCXJldHVybiBzdHJpbmcuaHNsYVN0cmluZyh0aGlzLnZhbHVlcy5oc2wsIHRoaXMudmFsdWVzLmFscGhhKTsNCgl9LA0KCWh3YlN0cmluZzogZnVuY3Rpb24gKCkgew0KCQlyZXR1cm4gc3RyaW5nLmh3YlN0cmluZyh0aGlzLnZhbHVlcy5od2IsIHRoaXMudmFsdWVzLmFscGhhKTsNCgl9LA0KCWtleXdvcmQ6IGZ1bmN0aW9uICgpIHsNCgkJcmV0dXJuIHN0cmluZy5rZXl3b3JkKHRoaXMudmFsdWVzLnJnYiwgdGhpcy52YWx1ZXMuYWxwaGEpOw0KCX0sDQoNCglyZ2JOdW1iZXI6IGZ1bmN0aW9uICgpIHsNCgkJdmFyIHJnYiA9IHRoaXMudmFsdWVzLnJnYjsNCgkJcmV0dXJuIChyZ2JbMF0gPDwgMTYpIHwgKHJnYlsxXSA8PCA4KSB8IHJnYlsyXTsNCgl9LA0KDQoJbHVtaW5vc2l0eTogZnVuY3Rpb24gKCkgew0KCQkvLyBodHRwOi8vd3d3LnczLm9yZy9UUi9XQ0FHMjAvI3JlbGF0aXZlbHVtaW5hbmNlZGVmDQoJCXZhciByZ2IgPSB0aGlzLnZhbHVlcy5yZ2I7DQoJCXZhciBsdW0gPSBbXTsNCgkJZm9yICh2YXIgaSA9IDA7IGkgPCByZ2IubGVuZ3RoOyBpKyspIHsNCgkJCXZhciBjaGFuID0gcmdiW2ldIC8gMjU1Ow0KCQkJbHVtW2ldID0gKGNoYW4gPD0gMC4wMzkyOCkgPyBjaGFuIC8gMTIuOTIgOiBNYXRoLnBvdygoKGNoYW4gKyAwLjA1NSkgLyAxLjA1NSksIDIuNCk7DQoJCX0NCgkJcmV0dXJuIDAuMjEyNiAqIGx1bVswXSArIDAuNzE1MiAqIGx1bVsxXSArIDAuMDcyMiAqIGx1bVsyXTsNCgl9LA0KDQoJY29udHJhc3Q6IGZ1bmN0aW9uIChjb2xvcjIpIHsNCgkJLy8gaHR0cDovL3d3dy53My5vcmcvVFIvV0NBRzIwLyNjb250cmFzdC1yYXRpb2RlZg0KCQl2YXIgbHVtMSA9IHRoaXMubHVtaW5vc2l0eSgpOw0KCQl2YXIgbHVtMiA9IGNvbG9yMi5sdW1pbm9zaXR5KCk7DQoJCWlmIChsdW0xID4gbHVtMikgew0KCQkJcmV0dXJuIChsdW0xICsgMC4wNSkgLyAobHVtMiArIDAuMDUpOw0KCQl9DQoJCXJldHVybiAobHVtMiArIDAuMDUpIC8gKGx1bTEgKyAwLjA1KTsNCgl9LA0KDQoJbGV2ZWw6IGZ1bmN0aW9uIChjb2xvcjIpIHsNCgkJdmFyIGNvbnRyYXN0UmF0aW8gPSB0aGlzLmNvbnRyYXN0KGNvbG9yMik7DQoJCWlmIChjb250cmFzdFJhdGlvID49IDcuMSkgew0KCQkJcmV0dXJuICdBQUEnOw0KCQl9DQoNCgkJcmV0dXJuIChjb250cmFzdFJhdGlvID49IDQuNSkgPyAnQUEnIDogJyc7DQoJfSwNCg0KCWRhcms6IGZ1bmN0aW9uICgpIHsNCgkJLy8gWUlRIGVxdWF0aW9uIGZyb20gaHR0cDovLzI0d2F5cy5vcmcvMjAxMC9jYWxjdWxhdGluZy1jb2xvci1jb250cmFzdA0KCQl2YXIgcmdiID0gdGhpcy52YWx1ZXMucmdiOw0KCQl2YXIgeWlxID0gKHJnYlswXSAqIDI5OSArIHJnYlsxXSAqIDU4NyArIHJnYlsyXSAqIDExNCkgLyAxMDAwOw0KCQlyZXR1cm4geWlxIDwgMTI4Ow0KCX0sDQoNCglsaWdodDogZnVuY3Rpb24gKCkgew0KCQlyZXR1cm4gIXRoaXMuZGFyaygpOw0KCX0sDQoNCgluZWdhdGU6IGZ1bmN0aW9uICgpIHsNCgkJdmFyIHJnYiA9IFtdOw0KCQlmb3IgKHZhciBpID0gMDsgaSA8IDM7IGkrKykgew0KCQkJcmdiW2ldID0gMjU1IC0gdGhpcy52YWx1ZXMucmdiW2ldOw0KCQl9DQoJCXRoaXMuc2V0VmFsdWVzKCdyZ2InLCByZ2IpOw0KCQlyZXR1cm4gdGhpczsNCgl9LA0KDQoJbGlnaHRlbjogZnVuY3Rpb24gKHJhdGlvKSB7DQoJCXZhciBoc2wgPSB0aGlzLnZhbHVlcy5oc2w7DQoJCWhzbFsyXSArPSBoc2xbMl0gKiByYXRpbzsNCgkJdGhpcy5zZXRWYWx1ZXMoJ2hzbCcsIGhzbCk7DQoJCXJldHVybiB0aGlzOw0KCX0sDQoNCglkYXJrZW46IGZ1bmN0aW9uIChyYXRpbykgew0KCQl2YXIgaHNsID0gdGhpcy52YWx1ZXMuaHNsOw0KCQloc2xbMl0gLT0gaHNsWzJdICogcmF0aW87DQoJCXRoaXMuc2V0VmFsdWVzKCdoc2wnLCBoc2wpOw0KCQlyZXR1cm4gdGhpczsNCgl9LA0KDQoJc2F0dXJhdGU6IGZ1bmN0aW9uIChyYXRpbykgew0KCQl2YXIgaHNsID0gdGhpcy52YWx1ZXMuaHNsOw0KCQloc2xbMV0gKz0gaHNsWzFdICogcmF0aW87DQoJCXRoaXMuc2V0VmFsdWVzKCdoc2wnLCBoc2wpOw0KCQlyZXR1cm4gdGhpczsNCgl9LA0KDQoJZGVzYXR1cmF0ZTogZnVuY3Rpb24gKHJhdGlvKSB7DQoJCXZhciBoc2wgPSB0aGlzLnZhbHVlcy5oc2w7DQoJCWhzbFsxXSAtPSBoc2xbMV0gKiByYXRpbzsNCgkJdGhpcy5zZXRWYWx1ZXMoJ2hzbCcsIGhzbCk7DQoJCXJldHVybiB0aGlzOw0KCX0sDQoNCgl3aGl0ZW46IGZ1bmN0aW9uIChyYXRpbykgew0KCQl2YXIgaHdiID0gdGhpcy52YWx1ZXMuaHdiOw0KCQlod2JbMV0gKz0gaHdiWzFdICogcmF0aW87DQoJCXRoaXMuc2V0VmFsdWVzKCdod2InLCBod2IpOw0KCQlyZXR1cm4gdGhpczsNCgl9LA0KDQoJYmxhY2tlbjogZnVuY3Rpb24gKHJhdGlvKSB7DQoJCXZhciBod2IgPSB0aGlzLnZhbHVlcy5od2I7DQoJCWh3YlsyXSArPSBod2JbMl0gKiByYXRpbzsNCgkJdGhpcy5zZXRWYWx1ZXMoJ2h3YicsIGh3Yik7DQoJCXJldHVybiB0aGlzOw0KCX0sDQoNCglncmV5c2NhbGU6IGZ1bmN0aW9uICgpIHsNCgkJdmFyIHJnYiA9IHRoaXMudmFsdWVzLnJnYjsNCgkJLy8gaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9HcmF5c2NhbGUjQ29udmVydGluZ19jb2xvcl90b19ncmF5c2NhbGUNCgkJdmFyIHZhbCA9IHJnYlswXSAqIDAuMyArIHJnYlsxXSAqIDAuNTkgKyByZ2JbMl0gKiAwLjExOw0KCQl0aGlzLnNldFZhbHVlcygncmdiJywgW3ZhbCwgdmFsLCB2YWxdKTsNCgkJcmV0dXJuIHRoaXM7DQoJfSwNCg0KCWNsZWFyZXI6IGZ1bmN0aW9uIChyYXRpbykgew0KCQl2YXIgYWxwaGEgPSB0aGlzLnZhbHVlcy5hbHBoYTsNCgkJdGhpcy5zZXRWYWx1ZXMoJ2FscGhhJywgYWxwaGEgLSAoYWxwaGEgKiByYXRpbykpOw0KCQlyZXR1cm4gdGhpczsNCgl9LA0KDQoJb3BhcXVlcjogZnVuY3Rpb24gKHJhdGlvKSB7DQoJCXZhciBhbHBoYSA9IHRoaXMudmFsdWVzLmFscGhhOw0KCQl0aGlzLnNldFZhbHVlcygnYWxwaGEnLCBhbHBoYSArIChhbHBoYSAqIHJhdGlvKSk7DQoJCXJldHVybiB0aGlzOw0KCX0sDQoNCglyb3RhdGU6IGZ1bmN0aW9uIChkZWdyZWVzKSB7DQoJCXZhciBoc2wgPSB0aGlzLnZhbHVlcy5oc2w7DQoJCXZhciBodWUgPSAoaHNsWzBdICsgZGVncmVlcykgJSAzNjA7DQoJCWhzbFswXSA9IGh1ZSA8IDAgPyAzNjAgKyBodWUgOiBodWU7DQoJCXRoaXMuc2V0VmFsdWVzKCdoc2wnLCBoc2wpOw0KCQlyZXR1cm4gdGhpczsNCgl9LA0KDQoJLyoqDQoJICogUG9ydGVkIGZyb20gc2FzcyBpbXBsZW1lbnRhdGlvbiBpbiBDDQoJICogaHR0cHM6Ly9naXRodWIuY29tL3Nhc3MvbGlic2Fzcy9ibG9iLzBlNmI0YTI4NTAwOTIzNTZhYTNlY2UwN2M2YjI0OWYwMjIxY2FjZWQvZnVuY3Rpb25zLmNwcCNMMjA5DQoJICovDQoJbWl4OiBmdW5jdGlvbiAobWl4aW5Db2xvciwgd2VpZ2h0KSB7DQoJCXZhciBjb2xvcjEgPSB0aGlzOw0KCQl2YXIgY29sb3IyID0gbWl4aW5Db2xvcjsNCgkJdmFyIHAgPSB3ZWlnaHQgPT09IHVuZGVmaW5lZCA/IDAuNSA6IHdlaWdodDsNCg0KCQl2YXIgdyA9IDIgKiBwIC0gMTsNCgkJdmFyIGEgPSBjb2xvcjEuYWxwaGEoKSAtIGNvbG9yMi5hbHBoYSgpOw0KDQoJCXZhciB3MSA9ICgoKHcgKiBhID09PSAtMSkgPyB3IDogKHcgKyBhKSAvICgxICsgdyAqIGEpKSArIDEpIC8gMi4wOw0KCQl2YXIgdzIgPSAxIC0gdzE7DQoNCgkJcmV0dXJuIHRoaXMNCgkJCS5yZ2IoDQoJCQkJdzEgKiBjb2xvcjEucmVkKCkgKyB3MiAqIGNvbG9yMi5yZWQoKSwNCgkJCQl3MSAqIGNvbG9yMS5ncmVlbigpICsgdzIgKiBjb2xvcjIuZ3JlZW4oKSwNCgkJCQl3MSAqIGNvbG9yMS5ibHVlKCkgKyB3MiAqIGNvbG9yMi5ibHVlKCkNCgkJCSkNCgkJCS5hbHBoYShjb2xvcjEuYWxwaGEoKSAqIHAgKyBjb2xvcjIuYWxwaGEoKSAqICgxIC0gcCkpOw0KCX0sDQoNCgl0b0pTT046IGZ1bmN0aW9uICgpIHsNCgkJcmV0dXJuIHRoaXMucmdiKCk7DQoJfSwNCg0KCWNsb25lOiBmdW5jdGlvbiAoKSB7DQoJCS8vIE5PVEUoU0IpOiB1c2luZyBub2RlLWNsb25lIGNyZWF0ZXMgYSBkZXBlbmRlbmN5IHRvIEJ1ZmZlciB3aGVuIHVzaW5nIGJyb3dzZXJpZnksDQoJCS8vIG1ha2luZyB0aGUgZmluYWwgYnVpbGQgd2F5IHRvIGJpZyB0byBlbWJlZCBpbiBDaGFydC5qcy4gU28gbGV0J3MgZG8gaXQgbWFudWFsbHksDQoJCS8vIGFzc3VtaW5nIHRoYXQgdmFsdWVzIHRvIGNsb25lIGFyZSAxIGRpbWVuc2lvbiBhcnJheXMgY29udGFpbmluZyBvbmx5IG51bWJlcnMsDQoJCS8vIGV4Y2VwdCAnYWxwaGEnIHdoaWNoIGlzIGEgbnVtYmVyLg0KCQl2YXIgcmVzdWx0ID0gbmV3IENvbG9yKCk7DQoJCXZhciBzb3VyY2UgPSB0aGlzLnZhbHVlczsNCgkJdmFyIHRhcmdldCA9IHJlc3VsdC52YWx1ZXM7DQoJCXZhciB2YWx1ZSwgdHlwZTsNCg0KCQlmb3IgKHZhciBwcm9wIGluIHNvdXJjZSkgew0KCQkJaWYgKHNvdXJjZS5oYXNPd25Qcm9wZXJ0eShwcm9wKSkgew0KCQkJCXZhbHVlID0gc291cmNlW3Byb3BdOw0KCQkJCXR5cGUgPSAoe30pLnRvU3RyaW5nLmNhbGwodmFsdWUpOw0KCQkJCWlmICh0eXBlID09PSAnW29iamVjdCBBcnJheV0nKSB7DQoJCQkJCXRhcmdldFtwcm9wXSA9IHZhbHVlLnNsaWNlKDApOw0KCQkJCX0gZWxzZSBpZiAodHlwZSA9PT0gJ1tvYmplY3QgTnVtYmVyXScpIHsNCgkJCQkJdGFyZ2V0W3Byb3BdID0gdmFsdWU7DQoJCQkJfSBlbHNlIHsNCgkJCQkJY29uc29sZS5lcnJvcigndW5leHBlY3RlZCBjb2xvciB2YWx1ZTonLCB2YWx1ZSk7DQoJCQkJfQ0KCQkJfQ0KCQl9DQoNCgkJcmV0dXJuIHJlc3VsdDsNCgl9DQp9Ow0KDQpDb2xvci5wcm90b3R5cGUuc3BhY2VzID0gew0KCXJnYjogWydyZWQnLCAnZ3JlZW4nLCAnYmx1ZSddLA0KCWhzbDogWydodWUnLCAnc2F0dXJhdGlvbicsICdsaWdodG5lc3MnXSwNCgloc3Y6IFsnaHVlJywgJ3NhdHVyYXRpb24nLCAndmFsdWUnXSwNCglod2I6IFsnaHVlJywgJ3doaXRlbmVzcycsICdibGFja25lc3MnXSwNCgljbXlrOiBbJ2N5YW4nLCAnbWFnZW50YScsICd5ZWxsb3cnLCAnYmxhY2snXQ0KfTsNCg0KQ29sb3IucHJvdG90eXBlLm1heGVzID0gew0KCXJnYjogWzI1NSwgMjU1LCAyNTVdLA0KCWhzbDogWzM2MCwgMTAwLCAxMDBdLA0KCWhzdjogWzM2MCwgMTAwLCAxMDBdLA0KCWh3YjogWzM2MCwgMTAwLCAxMDBdLA0KCWNteWs6IFsxMDAsIDEwMCwgMTAwLCAxMDBdDQp9Ow0KDQpDb2xvci5wcm90b3R5cGUuZ2V0VmFsdWVzID0gZnVuY3Rpb24gKHNwYWNlKSB7DQoJdmFyIHZhbHVlcyA9IHRoaXMudmFsdWVzOw0KCXZhciB2YWxzID0ge307DQoNCglmb3IgKHZhciBpID0gMDsgaSA8IHNwYWNlLmxlbmd0aDsgaSsrKSB7DQoJCXZhbHNbc3BhY2UuY2hhckF0KGkpXSA9IHZhbHVlc1tzcGFjZV1baV07DQoJfQ0KDQoJaWYgKHZhbHVlcy5hbHBoYSAhPT0gMSkgew0KCQl2YWxzLmEgPSB2YWx1ZXMuYWxwaGE7DQoJfQ0KDQoJLy8ge3I6IDI1NSwgZzogMjU1LCBiOiAyNTUsIGE6IDAuNH0NCglyZXR1cm4gdmFsczsNCn07DQoNCkNvbG9yLnByb3RvdHlwZS5zZXRWYWx1ZXMgPSBmdW5jdGlvbiAoc3BhY2UsIHZhbHMpIHsNCgl2YXIgdmFsdWVzID0gdGhpcy52YWx1ZXM7DQoJdmFyIHNwYWNlcyA9IHRoaXMuc3BhY2VzOw0KCXZhciBtYXhlcyA9IHRoaXMubWF4ZXM7DQoJdmFyIGFscGhhID0gMTsNCgl2YXIgaTsNCg0KCXRoaXMudmFsaWQgPSB0cnVlOw0KDQoJaWYgKHNwYWNlID09PSAnYWxwaGEnKSB7DQoJCWFscGhhID0gdmFsczsNCgl9IGVsc2UgaWYgKHZhbHMubGVuZ3RoKSB7DQoJCS8vIFsxMCwgMTAsIDEwXQ0KCQl2YWx1ZXNbc3BhY2VdID0gdmFscy5zbGljZSgwLCBzcGFjZS5sZW5ndGgpOw0KCQlhbHBoYSA9IHZhbHNbc3BhY2UubGVuZ3RoXTsNCgl9IGVsc2UgaWYgKHZhbHNbc3BhY2UuY2hhckF0KDApXSAhPT0gdW5kZWZpbmVkKSB7DQoJCS8vIHtyOiAxMCwgZzogMTAsIGI6IDEwfQ0KCQlmb3IgKGkgPSAwOyBpIDwgc3BhY2UubGVuZ3RoOyBpKyspIHsNCgkJCXZhbHVlc1tzcGFjZV1baV0gPSB2YWxzW3NwYWNlLmNoYXJBdChpKV07DQoJCX0NCg0KCQlhbHBoYSA9IHZhbHMuYTsNCgl9IGVsc2UgaWYgKHZhbHNbc3BhY2VzW3NwYWNlXVswXV0gIT09IHVuZGVmaW5lZCkgew0KCQkvLyB7cmVkOiAxMCwgZ3JlZW46IDEwLCBibHVlOiAxMH0NCgkJdmFyIGNoYW5zID0gc3BhY2VzW3NwYWNlXTsNCg0KCQlmb3IgKGkgPSAwOyBpIDwgc3BhY2UubGVuZ3RoOyBpKyspIHsNCgkJCXZhbHVlc1tzcGFjZV1baV0gPSB2YWxzW2NoYW5zW2ldXTsNCgkJfQ0KDQoJCWFscGhhID0gdmFscy5hbHBoYTsNCgl9DQoNCgl2YWx1ZXMuYWxwaGEgPSBNYXRoLm1heCgwLCBNYXRoLm1pbigxLCAoYWxwaGEgPT09IHVuZGVmaW5lZCA/IHZhbHVlcy5hbHBoYSA6IGFscGhhKSkpOw0KDQoJaWYgKHNwYWNlID09PSAnYWxwaGEnKSB7DQoJCXJldHVybiBmYWxzZTsNCgl9DQoNCgl2YXIgY2FwcGVkOw0KDQoJLy8gY2FwIHZhbHVlcyBvZiB0aGUgc3BhY2UgcHJpb3IgY29udmVydGluZyBhbGwgdmFsdWVzDQoJZm9yIChpID0gMDsgaSA8IHNwYWNlLmxlbmd0aDsgaSsrKSB7DQoJCWNhcHBlZCA9IE1hdGgubWF4KDAsIE1hdGgubWluKG1heGVzW3NwYWNlXVtpXSwgdmFsdWVzW3NwYWNlXVtpXSkpOw0KCQl2YWx1ZXNbc3BhY2VdW2ldID0gTWF0aC5yb3VuZChjYXBwZWQpOw0KCX0NCg0KCS8vIGNvbnZlcnQgdG8gYWxsIHRoZSBvdGhlciBjb2xvciBzcGFjZXMNCglmb3IgKHZhciBzbmFtZSBpbiBzcGFjZXMpIHsNCgkJaWYgKHNuYW1lICE9PSBzcGFjZSkgew0KCQkJdmFsdWVzW3NuYW1lXSA9IGNvbnZlcnRbc3BhY2VdW3NuYW1lXSh2YWx1ZXNbc3BhY2VdKTsNCgkJfQ0KCX0NCg0KCXJldHVybiB0cnVlOw0KfTsNCg0KQ29sb3IucHJvdG90eXBlLnNldFNwYWNlID0gZnVuY3Rpb24gKHNwYWNlLCBhcmdzKSB7DQoJdmFyIHZhbHMgPSBhcmdzWzBdOw0KDQoJaWYgKHZhbHMgPT09IHVuZGVmaW5lZCkgew0KCQkvLyBjb2xvci5yZ2IoKQ0KCQlyZXR1cm4gdGhpcy5nZXRWYWx1ZXMoc3BhY2UpOw0KCX0NCg0KCS8vIGNvbG9yLnJnYigxMCwgMTAsIDEwKQ0KCWlmICh0eXBlb2YgdmFscyA9PT0gJ251bWJlcicpIHsNCgkJdmFscyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3MpOw0KCX0NCg0KCXRoaXMuc2V0VmFsdWVzKHNwYWNlLCB2YWxzKTsNCglyZXR1cm4gdGhpczsNCn07DQoNCkNvbG9yLnByb3RvdHlwZS5zZXRDaGFubmVsID0gZnVuY3Rpb24gKHNwYWNlLCBpbmRleCwgdmFsKSB7DQoJdmFyIHN2YWx1ZXMgPSB0aGlzLnZhbHVlc1tzcGFjZV07DQoJaWYgKHZhbCA9PT0gdW5kZWZpbmVkKSB7DQoJCS8vIGNvbG9yLnJlZCgpDQoJCXJldHVybiBzdmFsdWVzW2luZGV4XTsNCgl9IGVsc2UgaWYgKHZhbCA9PT0gc3ZhbHVlc1tpbmRleF0pIHsNCgkJLy8gY29sb3IucmVkKGNvbG9yLnJlZCgpKQ0KCQlyZXR1cm4gdGhpczsNCgl9DQoNCgkvLyBjb2xvci5yZWQoMTAwKQ0KCXN2YWx1ZXNbaW5kZXhdID0gdmFsOw0KCXRoaXMuc2V0VmFsdWVzKHNwYWNlLCBzdmFsdWVzKTsNCg0KCXJldHVybiB0aGlzOw0KfTsNCg0KaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7DQoJd2luZG93LkNvbG9yID0gQ29sb3I7DQp9DQoNCm1vZHVsZS5leHBvcnRzID0gQ29sb3I7DQoNCn0seyIxIjoxLCI0Ijo0fV0sMzpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7DQovKiBNSVQgbGljZW5zZSAqLw0KDQptb2R1bGUuZXhwb3J0cyA9IHsNCiAgcmdiMmhzbDogcmdiMmhzbCwNCiAgcmdiMmhzdjogcmdiMmhzdiwNCiAgcmdiMmh3YjogcmdiMmh3YiwNCiAgcmdiMmNteWs6IHJnYjJjbXlrLA0KICByZ2Iya2V5d29yZDogcmdiMmtleXdvcmQsDQogIHJnYjJ4eXo6IHJnYjJ4eXosDQogIHJnYjJsYWI6IHJnYjJsYWIsDQogIHJnYjJsY2g6IHJnYjJsY2gsDQoNCiAgaHNsMnJnYjogaHNsMnJnYiwNCiAgaHNsMmhzdjogaHNsMmhzdiwNCiAgaHNsMmh3YjogaHNsMmh3YiwNCiAgaHNsMmNteWs6IGhzbDJjbXlrLA0KICBoc2wya2V5d29yZDogaHNsMmtleXdvcmQsDQoNCiAgaHN2MnJnYjogaHN2MnJnYiwNCiAgaHN2MmhzbDogaHN2MmhzbCwNCiAgaHN2Mmh3YjogaHN2Mmh3YiwNCiAgaHN2MmNteWs6IGhzdjJjbXlrLA0KICBoc3Yya2V5d29yZDogaHN2MmtleXdvcmQsDQoNCiAgaHdiMnJnYjogaHdiMnJnYiwNCiAgaHdiMmhzbDogaHdiMmhzbCwNCiAgaHdiMmhzdjogaHdiMmhzdiwNCiAgaHdiMmNteWs6IGh3YjJjbXlrLA0KICBod2Iya2V5d29yZDogaHdiMmtleXdvcmQsDQoNCiAgY215azJyZ2I6IGNteWsycmdiLA0KICBjbXlrMmhzbDogY215azJoc2wsDQogIGNteWsyaHN2OiBjbXlrMmhzdiwNCiAgY215azJod2I6IGNteWsyaHdiLA0KICBjbXlrMmtleXdvcmQ6IGNteWsya2V5d29yZCwNCg0KICBrZXl3b3JkMnJnYjoga2V5d29yZDJyZ2IsDQogIGtleXdvcmQyaHNsOiBrZXl3b3JkMmhzbCwNCiAga2V5d29yZDJoc3Y6IGtleXdvcmQyaHN2LA0KICBrZXl3b3JkMmh3Yjoga2V5d29yZDJod2IsDQogIGtleXdvcmQyY215azoga2V5d29yZDJjbXlrLA0KICBrZXl3b3JkMmxhYjoga2V5d29yZDJsYWIsDQogIGtleXdvcmQyeHl6OiBrZXl3b3JkMnh5eiwNCg0KICB4eXoycmdiOiB4eXoycmdiLA0KICB4eXoybGFiOiB4eXoybGFiLA0KICB4eXoybGNoOiB4eXoybGNoLA0KDQogIGxhYjJ4eXo6IGxhYjJ4eXosDQogIGxhYjJyZ2I6IGxhYjJyZ2IsDQogIGxhYjJsY2g6IGxhYjJsY2gsDQoNCiAgbGNoMmxhYjogbGNoMmxhYiwNCiAgbGNoMnh5ejogbGNoMnh5eiwNCiAgbGNoMnJnYjogbGNoMnJnYg0KfQ0KDQoNCmZ1bmN0aW9uIHJnYjJoc2wocmdiKSB7DQogIHZhciByID0gcmdiWzBdLzI1NSwNCiAgICAgIGcgPSByZ2JbMV0vMjU1LA0KICAgICAgYiA9IHJnYlsyXS8yNTUsDQogICAgICBtaW4gPSBNYXRoLm1pbihyLCBnLCBiKSwNCiAgICAgIG1heCA9IE1hdGgubWF4KHIsIGcsIGIpLA0KICAgICAgZGVsdGEgPSBtYXggLSBtaW4sDQogICAgICBoLCBzLCBsOw0KDQogIGlmIChtYXggPT0gbWluKQ0KICAgIGggPSAwOw0KICBlbHNlIGlmIChyID09IG1heCkNCiAgICBoID0gKGcgLSBiKSAvIGRlbHRhOw0KICBlbHNlIGlmIChnID09IG1heCkNCiAgICBoID0gMiArIChiIC0gcikgLyBkZWx0YTsNCiAgZWxzZSBpZiAoYiA9PSBtYXgpDQogICAgaCA9IDQgKyAociAtIGcpLyBkZWx0YTsNCg0KICBoID0gTWF0aC5taW4oaCAqIDYwLCAzNjApOw0KDQogIGlmIChoIDwgMCkNCiAgICBoICs9IDM2MDsNCg0KICBsID0gKG1pbiArIG1heCkgLyAyOw0KDQogIGlmIChtYXggPT0gbWluKQ0KICAgIHMgPSAwOw0KICBlbHNlIGlmIChsIDw9IDAuNSkNCiAgICBzID0gZGVsdGEgLyAobWF4ICsgbWluKTsNCiAgZWxzZQ0KICAgIHMgPSBkZWx0YSAvICgyIC0gbWF4IC0gbWluKTsNCg0KICByZXR1cm4gW2gsIHMgKiAxMDAsIGwgKiAxMDBdOw0KfQ0KDQpmdW5jdGlvbiByZ2IyaHN2KHJnYikgew0KICB2YXIgciA9IHJnYlswXSwNCiAgICAgIGcgPSByZ2JbMV0sDQogICAgICBiID0gcmdiWzJdLA0KICAgICAgbWluID0gTWF0aC5taW4ociwgZywgYiksDQogICAgICBtYXggPSBNYXRoLm1heChyLCBnLCBiKSwNCiAgICAgIGRlbHRhID0gbWF4IC0gbWluLA0KICAgICAgaCwgcywgdjsNCg0KICBpZiAobWF4ID09IDApDQogICAgcyA9IDA7DQogIGVsc2UNCiAgICBzID0gKGRlbHRhL21heCAqIDEwMDApLzEwOw0KDQogIGlmIChtYXggPT0gbWluKQ0KICAgIGggPSAwOw0KICBlbHNlIGlmIChyID09IG1heCkNCiAgICBoID0gKGcgLSBiKSAvIGRlbHRhOw0KICBlbHNlIGlmIChnID09IG1heCkNCiAgICBoID0gMiArIChiIC0gcikgLyBkZWx0YTsNCiAgZWxzZSBpZiAoYiA9PSBtYXgpDQogICAgaCA9IDQgKyAociAtIGcpIC8gZGVsdGE7DQoNCiAgaCA9IE1hdGgubWluKGggKiA2MCwgMzYwKTsNCg0KICBpZiAoaCA8IDApDQogICAgaCArPSAzNjA7DQoNCiAgdiA9ICgobWF4IC8gMjU1KSAqIDEwMDApIC8gMTA7DQoNCiAgcmV0dXJuIFtoLCBzLCB2XTsNCn0NCg0KZnVuY3Rpb24gcmdiMmh3YihyZ2IpIHsNCiAgdmFyIHIgPSByZ2JbMF0sDQogICAgICBnID0gcmdiWzFdLA0KICAgICAgYiA9IHJnYlsyXSwNCiAgICAgIGggPSByZ2IyaHNsKHJnYilbMF0sDQogICAgICB3ID0gMS8yNTUgKiBNYXRoLm1pbihyLCBNYXRoLm1pbihnLCBiKSksDQogICAgICBiID0gMSAtIDEvMjU1ICogTWF0aC5tYXgociwgTWF0aC5tYXgoZywgYikpOw0KDQogIHJldHVybiBbaCwgdyAqIDEwMCwgYiAqIDEwMF07DQp9DQoNCmZ1bmN0aW9uIHJnYjJjbXlrKHJnYikgew0KICB2YXIgciA9IHJnYlswXSAvIDI1NSwNCiAgICAgIGcgPSByZ2JbMV0gLyAyNTUsDQogICAgICBiID0gcmdiWzJdIC8gMjU1LA0KICAgICAgYywgbSwgeSwgazsNCg0KICBrID0gTWF0aC5taW4oMSAtIHIsIDEgLSBnLCAxIC0gYik7DQogIGMgPSAoMSAtIHIgLSBrKSAvICgxIC0gaykgfHwgMDsNCiAgbSA9ICgxIC0gZyAtIGspIC8gKDEgLSBrKSB8fCAwOw0KICB5ID0gKDEgLSBiIC0gaykgLyAoMSAtIGspIHx8IDA7DQogIHJldHVybiBbYyAqIDEwMCwgbSAqIDEwMCwgeSAqIDEwMCwgayAqIDEwMF07DQp9DQoNCmZ1bmN0aW9uIHJnYjJrZXl3b3JkKHJnYikgew0KICByZXR1cm4gcmV2ZXJzZUtleXdvcmRzW0pTT04uc3RyaW5naWZ5KHJnYildOw0KfQ0KDQpmdW5jdGlvbiByZ2IyeHl6KHJnYikgew0KICB2YXIgciA9IHJnYlswXSAvIDI1NSwNCiAgICAgIGcgPSByZ2JbMV0gLyAyNTUsDQogICAgICBiID0gcmdiWzJdIC8gMjU1Ow0KDQogIC8vIGFzc3VtZSBzUkdCDQogIHIgPSByID4gMC4wNDA0NSA/IE1hdGgucG93KCgociArIDAuMDU1KSAvIDEuMDU1KSwgMi40KSA6IChyIC8gMTIuOTIpOw0KICBnID0gZyA+IDAuMDQwNDUgPyBNYXRoLnBvdygoKGcgKyAwLjA1NSkgLyAxLjA1NSksIDIuNCkgOiAoZyAvIDEyLjkyKTsNCiAgYiA9IGIgPiAwLjA0MDQ1ID8gTWF0aC5wb3coKChiICsgMC4wNTUpIC8gMS4wNTUpLCAyLjQpIDogKGIgLyAxMi45Mik7DQoNCiAgdmFyIHggPSAociAqIDAuNDEyNCkgKyAoZyAqIDAuMzU3NikgKyAoYiAqIDAuMTgwNSk7DQogIHZhciB5ID0gKHIgKiAwLjIxMjYpICsgKGcgKiAwLjcxNTIpICsgKGIgKiAwLjA3MjIpOw0KICB2YXIgeiA9IChyICogMC4wMTkzKSArIChnICogMC4xMTkyKSArIChiICogMC45NTA1KTsNCg0KICByZXR1cm4gW3ggKiAxMDAsIHkgKjEwMCwgeiAqIDEwMF07DQp9DQoNCmZ1bmN0aW9uIHJnYjJsYWIocmdiKSB7DQogIHZhciB4eXogPSByZ2IyeHl6KHJnYiksDQogICAgICAgIHggPSB4eXpbMF0sDQogICAgICAgIHkgPSB4eXpbMV0sDQogICAgICAgIHogPSB4eXpbMl0sDQogICAgICAgIGwsIGEsIGI7DQoNCiAgeCAvPSA5NS4wNDc7DQogIHkgLz0gMTAwOw0KICB6IC89IDEwOC44ODM7DQoNCiAgeCA9IHggPiAwLjAwODg1NiA/IE1hdGgucG93KHgsIDEvMykgOiAoNy43ODcgKiB4KSArICgxNiAvIDExNik7DQogIHkgPSB5ID4gMC4wMDg4NTYgPyBNYXRoLnBvdyh5LCAxLzMpIDogKDcuNzg3ICogeSkgKyAoMTYgLyAxMTYpOw0KICB6ID0geiA+IDAuMDA4ODU2ID8gTWF0aC5wb3coeiwgMS8zKSA6ICg3Ljc4NyAqIHopICsgKDE2IC8gMTE2KTsNCg0KICBsID0gKDExNiAqIHkpIC0gMTY7DQogIGEgPSA1MDAgKiAoeCAtIHkpOw0KICBiID0gMjAwICogKHkgLSB6KTsNCg0KICByZXR1cm4gW2wsIGEsIGJdOw0KfQ0KDQpmdW5jdGlvbiByZ2IybGNoKGFyZ3MpIHsNCiAgcmV0dXJuIGxhYjJsY2gocmdiMmxhYihhcmdzKSk7DQp9DQoNCmZ1bmN0aW9uIGhzbDJyZ2IoaHNsKSB7DQogIHZhciBoID0gaHNsWzBdIC8gMzYwLA0KICAgICAgcyA9IGhzbFsxXSAvIDEwMCwNCiAgICAgIGwgPSBoc2xbMl0gLyAxMDAsDQogICAgICB0MSwgdDIsIHQzLCByZ2IsIHZhbDsNCg0KICBpZiAocyA9PSAwKSB7DQogICAgdmFsID0gbCAqIDI1NTsNCiAgICByZXR1cm4gW3ZhbCwgdmFsLCB2YWxdOw0KICB9DQoNCiAgaWYgKGwgPCAwLjUpDQogICAgdDIgPSBsICogKDEgKyBzKTsNCiAgZWxzZQ0KICAgIHQyID0gbCArIHMgLSBsICogczsNCiAgdDEgPSAyICogbCAtIHQyOw0KDQogIHJnYiA9IFswLCAwLCAwXTsNCiAgZm9yICh2YXIgaSA9IDA7IGkgPCAzOyBpKyspIHsNCiAgICB0MyA9IGggKyAxIC8gMyAqIC0gKGkgLSAxKTsNCiAgICB0MyA8IDAgJiYgdDMrKzsNCiAgICB0MyA+IDEgJiYgdDMtLTsNCg0KICAgIGlmICg2ICogdDMgPCAxKQ0KICAgICAgdmFsID0gdDEgKyAodDIgLSB0MSkgKiA2ICogdDM7DQogICAgZWxzZSBpZiAoMiAqIHQzIDwgMSkNCiAgICAgIHZhbCA9IHQyOw0KICAgIGVsc2UgaWYgKDMgKiB0MyA8IDIpDQogICAgICB2YWwgPSB0MSArICh0MiAtIHQxKSAqICgyIC8gMyAtIHQzKSAqIDY7DQogICAgZWxzZQ0KICAgICAgdmFsID0gdDE7DQoNCiAgICByZ2JbaV0gPSB2YWwgKiAyNTU7DQogIH0NCg0KICByZXR1cm4gcmdiOw0KfQ0KDQpmdW5jdGlvbiBoc2wyaHN2KGhzbCkgew0KICB2YXIgaCA9IGhzbFswXSwNCiAgICAgIHMgPSBoc2xbMV0gLyAxMDAsDQogICAgICBsID0gaHNsWzJdIC8gMTAwLA0KICAgICAgc3YsIHY7DQoNCiAgaWYobCA9PT0gMCkgew0KICAgICAgLy8gbm8gbmVlZCB0byBkbyBjYWxjIG9uIGJsYWNrDQogICAgICAvLyBhbHNvIGF2b2lkcyBkaXZpZGUgYnkgMCBlcnJvcg0KICAgICAgcmV0dXJuIFswLCAwLCAwXTsNCiAgfQ0KDQogIGwgKj0gMjsNCiAgcyAqPSAobCA8PSAxKSA/IGwgOiAyIC0gbDsNCiAgdiA9IChsICsgcykgLyAyOw0KICBzdiA9ICgyICogcykgLyAobCArIHMpOw0KICByZXR1cm4gW2gsIHN2ICogMTAwLCB2ICogMTAwXTsNCn0NCg0KZnVuY3Rpb24gaHNsMmh3YihhcmdzKSB7DQogIHJldHVybiByZ2IyaHdiKGhzbDJyZ2IoYXJncykpOw0KfQ0KDQpmdW5jdGlvbiBoc2wyY215ayhhcmdzKSB7DQogIHJldHVybiByZ2IyY215ayhoc2wycmdiKGFyZ3MpKTsNCn0NCg0KZnVuY3Rpb24gaHNsMmtleXdvcmQoYXJncykgew0KICByZXR1cm4gcmdiMmtleXdvcmQoaHNsMnJnYihhcmdzKSk7DQp9DQoNCg0KZnVuY3Rpb24gaHN2MnJnYihoc3YpIHsNCiAgdmFyIGggPSBoc3ZbMF0gLyA2MCwNCiAgICAgIHMgPSBoc3ZbMV0gLyAxMDAsDQogICAgICB2ID0gaHN2WzJdIC8gMTAwLA0KICAgICAgaGkgPSBNYXRoLmZsb29yKGgpICUgNjsNCg0KICB2YXIgZiA9IGggLSBNYXRoLmZsb29yKGgpLA0KICAgICAgcCA9IDI1NSAqIHYgKiAoMSAtIHMpLA0KICAgICAgcSA9IDI1NSAqIHYgKiAoMSAtIChzICogZikpLA0KICAgICAgdCA9IDI1NSAqIHYgKiAoMSAtIChzICogKDEgLSBmKSkpLA0KICAgICAgdiA9IDI1NSAqIHY7DQoNCiAgc3dpdGNoKGhpKSB7DQogICAgY2FzZSAwOg0KICAgICAgcmV0dXJuIFt2LCB0LCBwXTsNCiAgICBjYXNlIDE6DQogICAgICByZXR1cm4gW3EsIHYsIHBdOw0KICAgIGNhc2UgMjoNCiAgICAgIHJldHVybiBbcCwgdiwgdF07DQogICAgY2FzZSAzOg0KICAgICAgcmV0dXJuIFtwLCBxLCB2XTsNCiAgICBjYXNlIDQ6DQogICAgICByZXR1cm4gW3QsIHAsIHZdOw0KICAgIGNhc2UgNToNCiAgICAgIHJldHVybiBbdiwgcCwgcV07DQogIH0NCn0NCg0KZnVuY3Rpb24gaHN2MmhzbChoc3YpIHsNCiAgdmFyIGggPSBoc3ZbMF0sDQogICAgICBzID0gaHN2WzFdIC8gMTAwLA0KICAgICAgdiA9IGhzdlsyXSAvIDEwMCwNCiAgICAgIHNsLCBsOw0KDQogIGwgPSAoMiAtIHMpICogdjsNCiAgc2wgPSBzICogdjsNCiAgc2wgLz0gKGwgPD0gMSkgPyBsIDogMiAtIGw7DQogIHNsID0gc2wgfHwgMDsNCiAgbCAvPSAyOw0KICByZXR1cm4gW2gsIHNsICogMTAwLCBsICogMTAwXTsNCn0NCg0KZnVuY3Rpb24gaHN2Mmh3YihhcmdzKSB7DQogIHJldHVybiByZ2IyaHdiKGhzdjJyZ2IoYXJncykpDQp9DQoNCmZ1bmN0aW9uIGhzdjJjbXlrKGFyZ3MpIHsNCiAgcmV0dXJuIHJnYjJjbXlrKGhzdjJyZ2IoYXJncykpOw0KfQ0KDQpmdW5jdGlvbiBoc3Yya2V5d29yZChhcmdzKSB7DQogIHJldHVybiByZ2Iya2V5d29yZChoc3YycmdiKGFyZ3MpKTsNCn0NCg0KLy8gaHR0cDovL2Rldi53My5vcmcvY3Nzd2cvY3NzLWNvbG9yLyNod2ItdG8tcmdiDQpmdW5jdGlvbiBod2IycmdiKGh3Yikgew0KICB2YXIgaCA9IGh3YlswXSAvIDM2MCwNCiAgICAgIHdoID0gaHdiWzFdIC8gMTAwLA0KICAgICAgYmwgPSBod2JbMl0gLyAxMDAsDQogICAgICByYXRpbyA9IHdoICsgYmwsDQogICAgICBpLCB2LCBmLCBuOw0KDQogIC8vIHdoICsgYmwgY2FudCBiZSA+IDENCiAgaWYgKHJhdGlvID4gMSkgew0KICAgIHdoIC89IHJhdGlvOw0KICAgIGJsIC89IHJhdGlvOw0KICB9DQoNCiAgaSA9IE1hdGguZmxvb3IoNiAqIGgpOw0KICB2ID0gMSAtIGJsOw0KICBmID0gNiAqIGggLSBpOw0KICBpZiAoKGkgJiAweDAxKSAhPSAwKSB7DQogICAgZiA9IDEgLSBmOw0KICB9DQogIG4gPSB3aCArIGYgKiAodiAtIHdoKTsgIC8vIGxpbmVhciBpbnRlcnBvbGF0aW9uDQoNCiAgc3dpdGNoIChpKSB7DQogICAgZGVmYXVsdDoNCiAgICBjYXNlIDY6DQogICAgY2FzZSAwOiByID0gdjsgZyA9IG47IGIgPSB3aDsgYnJlYWs7DQogICAgY2FzZSAxOiByID0gbjsgZyA9IHY7IGIgPSB3aDsgYnJlYWs7DQogICAgY2FzZSAyOiByID0gd2g7IGcgPSB2OyBiID0gbjsgYnJlYWs7DQogICAgY2FzZSAzOiByID0gd2g7IGcgPSBuOyBiID0gdjsgYnJlYWs7DQogICAgY2FzZSA0OiByID0gbjsgZyA9IHdoOyBiID0gdjsgYnJlYWs7DQogICAgY2FzZSA1OiByID0gdjsgZyA9IHdoOyBiID0gbjsgYnJlYWs7DQogIH0NCg0KICByZXR1cm4gW3IgKiAyNTUsIGcgKiAyNTUsIGIgKiAyNTVdOw0KfQ0KDQpmdW5jdGlvbiBod2IyaHNsKGFyZ3MpIHsNCiAgcmV0dXJuIHJnYjJoc2woaHdiMnJnYihhcmdzKSk7DQp9DQoNCmZ1bmN0aW9uIGh3YjJoc3YoYXJncykgew0KICByZXR1cm4gcmdiMmhzdihod2IycmdiKGFyZ3MpKTsNCn0NCg0KZnVuY3Rpb24gaHdiMmNteWsoYXJncykgew0KICByZXR1cm4gcmdiMmNteWsoaHdiMnJnYihhcmdzKSk7DQp9DQoNCmZ1bmN0aW9uIGh3YjJrZXl3b3JkKGFyZ3MpIHsNCiAgcmV0dXJuIHJnYjJrZXl3b3JkKGh3YjJyZ2IoYXJncykpOw0KfQ0KDQpmdW5jdGlvbiBjbXlrMnJnYihjbXlrKSB7DQogIHZhciBjID0gY215a1swXSAvIDEwMCwNCiAgICAgIG0gPSBjbXlrWzFdIC8gMTAwLA0KICAgICAgeSA9IGNteWtbMl0gLyAxMDAsDQogICAgICBrID0gY215a1szXSAvIDEwMCwNCiAgICAgIHIsIGcsIGI7DQoNCiAgciA9IDEgLSBNYXRoLm1pbigxLCBjICogKDEgLSBrKSArIGspOw0KICBnID0gMSAtIE1hdGgubWluKDEsIG0gKiAoMSAtIGspICsgayk7DQogIGIgPSAxIC0gTWF0aC5taW4oMSwgeSAqICgxIC0gaykgKyBrKTsNCiAgcmV0dXJuIFtyICogMjU1LCBnICogMjU1LCBiICogMjU1XTsNCn0NCg0KZnVuY3Rpb24gY215azJoc2woYXJncykgew0KICByZXR1cm4gcmdiMmhzbChjbXlrMnJnYihhcmdzKSk7DQp9DQoNCmZ1bmN0aW9uIGNteWsyaHN2KGFyZ3MpIHsNCiAgcmV0dXJuIHJnYjJoc3YoY215azJyZ2IoYXJncykpOw0KfQ0KDQpmdW5jdGlvbiBjbXlrMmh3YihhcmdzKSB7DQogIHJldHVybiByZ2IyaHdiKGNteWsycmdiKGFyZ3MpKTsNCn0NCg0KZnVuY3Rpb24gY215azJrZXl3b3JkKGFyZ3MpIHsNCiAgcmV0dXJuIHJnYjJrZXl3b3JkKGNteWsycmdiKGFyZ3MpKTsNCn0NCg0KDQpmdW5jdGlvbiB4eXoycmdiKHh5eikgew0KICB2YXIgeCA9IHh5elswXSAvIDEwMCwNCiAgICAgIHkgPSB4eXpbMV0gLyAxMDAsDQogICAgICB6ID0geHl6WzJdIC8gMTAwLA0KICAgICAgciwgZywgYjsNCg0KICByID0gKHggKiAzLjI0MDYpICsgKHkgKiAtMS41MzcyKSArICh6ICogLTAuNDk4Nik7DQogIGcgPSAoeCAqIC0wLjk2ODkpICsgKHkgKiAxLjg3NTgpICsgKHogKiAwLjA0MTUpOw0KICBiID0gKHggKiAwLjA1NTcpICsgKHkgKiAtMC4yMDQwKSArICh6ICogMS4wNTcwKTsNCg0KICAvLyBhc3N1bWUgc1JHQg0KICByID0gciA+IDAuMDAzMTMwOCA/ICgoMS4wNTUgKiBNYXRoLnBvdyhyLCAxLjAgLyAyLjQpKSAtIDAuMDU1KQ0KICAgIDogciA9IChyICogMTIuOTIpOw0KDQogIGcgPSBnID4gMC4wMDMxMzA4ID8gKCgxLjA1NSAqIE1hdGgucG93KGcsIDEuMCAvIDIuNCkpIC0gMC4wNTUpDQogICAgOiBnID0gKGcgKiAxMi45Mik7DQoNCiAgYiA9IGIgPiAwLjAwMzEzMDggPyAoKDEuMDU1ICogTWF0aC5wb3coYiwgMS4wIC8gMi40KSkgLSAwLjA1NSkNCiAgICA6IGIgPSAoYiAqIDEyLjkyKTsNCg0KICByID0gTWF0aC5taW4oTWF0aC5tYXgoMCwgciksIDEpOw0KICBnID0gTWF0aC5taW4oTWF0aC5tYXgoMCwgZyksIDEpOw0KICBiID0gTWF0aC5taW4oTWF0aC5tYXgoMCwgYiksIDEpOw0KDQogIHJldHVybiBbciAqIDI1NSwgZyAqIDI1NSwgYiAqIDI1NV07DQp9DQoNCmZ1bmN0aW9uIHh5ejJsYWIoeHl6KSB7DQogIHZhciB4ID0geHl6WzBdLA0KICAgICAgeSA9IHh5elsxXSwNCiAgICAgIHogPSB4eXpbMl0sDQogICAgICBsLCBhLCBiOw0KDQogIHggLz0gOTUuMDQ3Ow0KICB5IC89IDEwMDsNCiAgeiAvPSAxMDguODgzOw0KDQogIHggPSB4ID4gMC4wMDg4NTYgPyBNYXRoLnBvdyh4LCAxLzMpIDogKDcuNzg3ICogeCkgKyAoMTYgLyAxMTYpOw0KICB5ID0geSA+IDAuMDA4ODU2ID8gTWF0aC5wb3coeSwgMS8zKSA6ICg3Ljc4NyAqIHkpICsgKDE2IC8gMTE2KTsNCiAgeiA9IHogPiAwLjAwODg1NiA/IE1hdGgucG93KHosIDEvMykgOiAoNy43ODcgKiB6KSArICgxNiAvIDExNik7DQoNCiAgbCA9ICgxMTYgKiB5KSAtIDE2Ow0KICBhID0gNTAwICogKHggLSB5KTsNCiAgYiA9IDIwMCAqICh5IC0geik7DQoNCiAgcmV0dXJuIFtsLCBhLCBiXTsNCn0NCg0KZnVuY3Rpb24geHl6MmxjaChhcmdzKSB7DQogIHJldHVybiBsYWIybGNoKHh5ejJsYWIoYXJncykpOw0KfQ0KDQpmdW5jdGlvbiBsYWIyeHl6KGxhYikgew0KICB2YXIgbCA9IGxhYlswXSwNCiAgICAgIGEgPSBsYWJbMV0sDQogICAgICBiID0gbGFiWzJdLA0KICAgICAgeCwgeSwgeiwgeTI7DQoNCiAgaWYgKGwgPD0gOCkgew0KICAgIHkgPSAobCAqIDEwMCkgLyA5MDMuMzsNCiAgICB5MiA9ICg3Ljc4NyAqICh5IC8gMTAwKSkgKyAoMTYgLyAxMTYpOw0KICB9IGVsc2Ugew0KICAgIHkgPSAxMDAgKiBNYXRoLnBvdygobCArIDE2KSAvIDExNiwgMyk7DQogICAgeTIgPSBNYXRoLnBvdyh5IC8gMTAwLCAxLzMpOw0KICB9DQoNCiAgeCA9IHggLyA5NS4wNDcgPD0gMC4wMDg4NTYgPyB4ID0gKDk1LjA0NyAqICgoYSAvIDUwMCkgKyB5MiAtICgxNiAvIDExNikpKSAvIDcuNzg3IDogOTUuMDQ3ICogTWF0aC5wb3coKGEgLyA1MDApICsgeTIsIDMpOw0KDQogIHogPSB6IC8gMTA4Ljg4MyA8PSAwLjAwODg1OSA/IHogPSAoMTA4Ljg4MyAqICh5MiAtIChiIC8gMjAwKSAtICgxNiAvIDExNikpKSAvIDcuNzg3IDogMTA4Ljg4MyAqIE1hdGgucG93KHkyIC0gKGIgLyAyMDApLCAzKTsNCg0KICByZXR1cm4gW3gsIHksIHpdOw0KfQ0KDQpmdW5jdGlvbiBsYWIybGNoKGxhYikgew0KICB2YXIgbCA9IGxhYlswXSwNCiAgICAgIGEgPSBsYWJbMV0sDQogICAgICBiID0gbGFiWzJdLA0KICAgICAgaHIsIGgsIGM7DQoNCiAgaHIgPSBNYXRoLmF0YW4yKGIsIGEpOw0KICBoID0gaHIgKiAzNjAgLyAyIC8gTWF0aC5QSTsNCiAgaWYgKGggPCAwKSB7DQogICAgaCArPSAzNjA7DQogIH0NCiAgYyA9IE1hdGguc3FydChhICogYSArIGIgKiBiKTsNCiAgcmV0dXJuIFtsLCBjLCBoXTsNCn0NCg0KZnVuY3Rpb24gbGFiMnJnYihhcmdzKSB7DQogIHJldHVybiB4eXoycmdiKGxhYjJ4eXooYXJncykpOw0KfQ0KDQpmdW5jdGlvbiBsY2gybGFiKGxjaCkgew0KICB2YXIgbCA9IGxjaFswXSwNCiAgICAgIGMgPSBsY2hbMV0sDQogICAgICBoID0gbGNoWzJdLA0KICAgICAgYSwgYiwgaHI7DQoNCiAgaHIgPSBoIC8gMzYwICogMiAqIE1hdGguUEk7DQogIGEgPSBjICogTWF0aC5jb3MoaHIpOw0KICBiID0gYyAqIE1hdGguc2luKGhyKTsNCiAgcmV0dXJuIFtsLCBhLCBiXTsNCn0NCg0KZnVuY3Rpb24gbGNoMnh5eihhcmdzKSB7DQogIHJldHVybiBsYWIyeHl6KGxjaDJsYWIoYXJncykpOw0KfQ0KDQpmdW5jdGlvbiBsY2gycmdiKGFyZ3MpIHsNCiAgcmV0dXJuIGxhYjJyZ2IobGNoMmxhYihhcmdzKSk7DQp9DQoNCmZ1bmN0aW9uIGtleXdvcmQycmdiKGtleXdvcmQpIHsNCiAgcmV0dXJuIGNzc0tleXdvcmRzW2tleXdvcmRdOw0KfQ0KDQpmdW5jdGlvbiBrZXl3b3JkMmhzbChhcmdzKSB7DQogIHJldHVybiByZ2IyaHNsKGtleXdvcmQycmdiKGFyZ3MpKTsNCn0NCg0KZnVuY3Rpb24ga2V5d29yZDJoc3YoYXJncykgew0KICByZXR1cm4gcmdiMmhzdihrZXl3b3JkMnJnYihhcmdzKSk7DQp9DQoNCmZ1bmN0aW9uIGtleXdvcmQyaHdiKGFyZ3MpIHsNCiAgcmV0dXJuIHJnYjJod2Ioa2V5d29yZDJyZ2IoYXJncykpOw0KfQ0KDQpmdW5jdGlvbiBrZXl3b3JkMmNteWsoYXJncykgew0KICByZXR1cm4gcmdiMmNteWsoa2V5d29yZDJyZ2IoYXJncykpOw0KfQ0KDQpmdW5jdGlvbiBrZXl3b3JkMmxhYihhcmdzKSB7DQogIHJldHVybiByZ2IybGFiKGtleXdvcmQycmdiKGFyZ3MpKTsNCn0NCg0KZnVuY3Rpb24ga2V5d29yZDJ4eXooYXJncykgew0KICByZXR1cm4gcmdiMnh5eihrZXl3b3JkMnJnYihhcmdzKSk7DQp9DQoNCnZhciBjc3NLZXl3b3JkcyA9IHsNCiAgYWxpY2VibHVlOiAgWzI0MCwyNDgsMjU1XSwNCiAgYW50aXF1ZXdoaXRlOiBbMjUwLDIzNSwyMTVdLA0KICBhcXVhOiBbMCwyNTUsMjU1XSwNCiAgYXF1YW1hcmluZTogWzEyNywyNTUsMjEyXSwNCiAgYXp1cmU6ICBbMjQwLDI1NSwyNTVdLA0KICBiZWlnZTogIFsyNDUsMjQ1LDIyMF0sDQogIGJpc3F1ZTogWzI1NSwyMjgsMTk2XSwNCiAgYmxhY2s6ICBbMCwwLDBdLA0KICBibGFuY2hlZGFsbW9uZDogWzI1NSwyMzUsMjA1XSwNCiAgYmx1ZTogWzAsMCwyNTVdLA0KICBibHVldmlvbGV0OiBbMTM4LDQzLDIyNl0sDQogIGJyb3duOiAgWzE2NSw0Miw0Ml0sDQogIGJ1cmx5d29vZDogIFsyMjIsMTg0LDEzNV0sDQogIGNhZGV0Ymx1ZTogIFs5NSwxNTgsMTYwXSwNCiAgY2hhcnRyZXVzZTogWzEyNywyNTUsMF0sDQogIGNob2NvbGF0ZTogIFsyMTAsMTA1LDMwXSwNCiAgY29yYWw6ICBbMjU1LDEyNyw4MF0sDQogIGNvcm5mbG93ZXJibHVlOiBbMTAwLDE0OSwyMzddLA0KICBjb3Juc2lsazogWzI1NSwyNDgsMjIwXSwNCiAgY3JpbXNvbjogIFsyMjAsMjAsNjBdLA0KICBjeWFuOiBbMCwyNTUsMjU1XSwNCiAgZGFya2JsdWU6IFswLDAsMTM5XSwNCiAgZGFya2N5YW46IFswLDEzOSwxMzldLA0KICBkYXJrZ29sZGVucm9kOiAgWzE4NCwxMzQsMTFdLA0KICBkYXJrZ3JheTogWzE2OSwxNjksMTY5XSwNCiAgZGFya2dyZWVuOiAgWzAsMTAwLDBdLA0KICBkYXJrZ3JleTogWzE2OSwxNjksMTY5XSwNCiAgZGFya2toYWtpOiAgWzE4OSwxODMsMTA3XSwNCiAgZGFya21hZ2VudGE6ICBbMTM5LDAsMTM5XSwNCiAgZGFya29saXZlZ3JlZW46IFs4NSwxMDcsNDddLA0KICBkYXJrb3JhbmdlOiBbMjU1LDE0MCwwXSwNCiAgZGFya29yY2hpZDogWzE1Myw1MCwyMDRdLA0KICBkYXJrcmVkOiAgWzEzOSwwLDBdLA0KICBkYXJrc2FsbW9uOiBbMjMzLDE1MCwxMjJdLA0KICBkYXJrc2VhZ3JlZW46IFsxNDMsMTg4LDE0M10sDQogIGRhcmtzbGF0ZWJsdWU6ICBbNzIsNjEsMTM5XSwNCiAgZGFya3NsYXRlZ3JheTogIFs0Nyw3OSw3OV0sDQogIGRhcmtzbGF0ZWdyZXk6ICBbNDcsNzksNzldLA0KICBkYXJrdHVycXVvaXNlOiAgWzAsMjA2LDIwOV0sDQogIGRhcmt2aW9sZXQ6IFsxNDgsMCwyMTFdLA0KICBkZWVwcGluazogWzI1NSwyMCwxNDddLA0KICBkZWVwc2t5Ymx1ZTogIFswLDE5MSwyNTVdLA0KICBkaW1ncmF5OiAgWzEwNSwxMDUsMTA1XSwNCiAgZGltZ3JleTogIFsxMDUsMTA1LDEwNV0sDQogIGRvZGdlcmJsdWU6IFszMCwxNDQsMjU1XSwNCiAgZmlyZWJyaWNrOiAgWzE3OCwzNCwzNF0sDQogIGZsb3JhbHdoaXRlOiAgWzI1NSwyNTAsMjQwXSwNCiAgZm9yZXN0Z3JlZW46ICBbMzQsMTM5LDM0XSwNCiAgZnVjaHNpYTogIFsyNTUsMCwyNTVdLA0KICBnYWluc2Jvcm86ICBbMjIwLDIyMCwyMjBdLA0KICBnaG9zdHdoaXRlOiBbMjQ4LDI0OCwyNTVdLA0KICBnb2xkOiBbMjU1LDIxNSwwXSwNCiAgZ29sZGVucm9kOiAgWzIxOCwxNjUsMzJdLA0KICBncmF5OiBbMTI4LDEyOCwxMjhdLA0KICBncmVlbjogIFswLDEyOCwwXSwNCiAgZ3JlZW55ZWxsb3c6ICBbMTczLDI1NSw0N10sDQogIGdyZXk6IFsxMjgsMTI4LDEyOF0sDQogIGhvbmV5ZGV3OiBbMjQwLDI1NSwyNDBdLA0KICBob3RwaW5rOiAgWzI1NSwxMDUsMTgwXSwNCiAgaW5kaWFucmVkOiAgWzIwNSw5Miw5Ml0sDQogIGluZGlnbzogWzc1LDAsMTMwXSwNCiAgaXZvcnk6ICBbMjU1LDI1NSwyNDBdLA0KICBraGFraTogIFsyNDAsMjMwLDE0MF0sDQogIGxhdmVuZGVyOiBbMjMwLDIzMCwyNTBdLA0KICBsYXZlbmRlcmJsdXNoOiAgWzI1NSwyNDAsMjQ1XSwNCiAgbGF3bmdyZWVuOiAgWzEyNCwyNTIsMF0sDQogIGxlbW9uY2hpZmZvbjogWzI1NSwyNTAsMjA1XSwNCiAgbGlnaHRibHVlOiAgWzE3MywyMTYsMjMwXSwNCiAgbGlnaHRjb3JhbDogWzI0MCwxMjgsMTI4XSwNCiAgbGlnaHRjeWFuOiAgWzIyNCwyNTUsMjU1XSwNCiAgbGlnaHRnb2xkZW5yb2R5ZWxsb3c6IFsyNTAsMjUwLDIxMF0sDQogIGxpZ2h0Z3JheTogIFsyMTEsMjExLDIxMV0sDQogIGxpZ2h0Z3JlZW46IFsxNDQsMjM4LDE0NF0sDQogIGxpZ2h0Z3JleTogIFsyMTEsMjExLDIxMV0sDQogIGxpZ2h0cGluazogIFsyNTUsMTgyLDE5M10sDQogIGxpZ2h0c2FsbW9uOiAgWzI1NSwxNjAsMTIyXSwNCiAgbGlnaHRzZWFncmVlbjogIFszMiwxNzgsMTcwXSwNCiAgbGlnaHRza3libHVlOiBbMTM1LDIwNiwyNTBdLA0KICBsaWdodHNsYXRlZ3JheTogWzExOSwxMzYsMTUzXSwNCiAgbGlnaHRzbGF0ZWdyZXk6IFsxMTksMTM2LDE1M10sDQogIGxpZ2h0c3RlZWxibHVlOiBbMTc2LDE5NiwyMjJdLA0KICBsaWdodHllbGxvdzogIFsyNTUsMjU1LDIyNF0sDQogIGxpbWU6IFswLDI1NSwwXSwNCiAgbGltZWdyZWVuOiAgWzUwLDIwNSw1MF0sDQogIGxpbmVuOiAgWzI1MCwyNDAsMjMwXSwNCiAgbWFnZW50YTogIFsyNTUsMCwyNTVdLA0KICBtYXJvb246IFsxMjgsMCwwXSwNCiAgbWVkaXVtYXF1YW1hcmluZTogWzEwMiwyMDUsMTcwXSwNCiAgbWVkaXVtYmx1ZTogWzAsMCwyMDVdLA0KICBtZWRpdW1vcmNoaWQ6IFsxODYsODUsMjExXSwNCiAgbWVkaXVtcHVycGxlOiBbMTQ3LDExMiwyMTldLA0KICBtZWRpdW1zZWFncmVlbjogWzYwLDE3OSwxMTNdLA0KICBtZWRpdW1zbGF0ZWJsdWU6ICBbMTIzLDEwNCwyMzhdLA0KICBtZWRpdW1zcHJpbmdncmVlbjogIFswLDI1MCwxNTRdLA0KICBtZWRpdW10dXJxdW9pc2U6ICBbNzIsMjA5LDIwNF0sDQogIG1lZGl1bXZpb2xldHJlZDogIFsxOTksMjEsMTMzXSwNCiAgbWlkbmlnaHRibHVlOiBbMjUsMjUsMTEyXSwNCiAgbWludGNyZWFtOiAgWzI0NSwyNTUsMjUwXSwNCiAgbWlzdHlyb3NlOiAgWzI1NSwyMjgsMjI1XSwNCiAgbW9jY2FzaW46IFsyNTUsMjI4LDE4MV0sDQogIG5hdmFqb3doaXRlOiAgWzI1NSwyMjIsMTczXSwNCiAgbmF2eTogWzAsMCwxMjhdLA0KICBvbGRsYWNlOiAgWzI1MywyNDUsMjMwXSwNCiAgb2xpdmU6ICBbMTI4LDEyOCwwXSwNCiAgb2xpdmVkcmFiOiAgWzEwNywxNDIsMzVdLA0KICBvcmFuZ2U6IFsyNTUsMTY1LDBdLA0KICBvcmFuZ2VyZWQ6ICBbMjU1LDY5LDBdLA0KICBvcmNoaWQ6IFsyMTgsMTEyLDIxNF0sDQogIHBhbGVnb2xkZW5yb2Q6ICBbMjM4LDIzMiwxNzBdLA0KICBwYWxlZ3JlZW46ICBbMTUyLDI1MSwxNTJdLA0KICBwYWxldHVycXVvaXNlOiAgWzE3NSwyMzgsMjM4XSwNCiAgcGFsZXZpb2xldHJlZDogIFsyMTksMTEyLDE0N10sDQogIHBhcGF5YXdoaXA6IFsyNTUsMjM5LDIxM10sDQogIHBlYWNocHVmZjogIFsyNTUsMjE4LDE4NV0sDQogIHBlcnU6IFsyMDUsMTMzLDYzXSwNCiAgcGluazogWzI1NSwxOTIsMjAzXSwNCiAgcGx1bTogWzIyMSwxNjAsMjIxXSwNCiAgcG93ZGVyYmx1ZTogWzE3NiwyMjQsMjMwXSwNCiAgcHVycGxlOiBbMTI4LDAsMTI4XSwNCiAgcmViZWNjYXB1cnBsZTogWzEwMiwgNTEsIDE1M10sDQogIHJlZDogIFsyNTUsMCwwXSwNCiAgcm9zeWJyb3duOiAgWzE4OCwxNDMsMTQzXSwNCiAgcm95YWxibHVlOiAgWzY1LDEwNSwyMjVdLA0KICBzYWRkbGVicm93bjogIFsxMzksNjksMTldLA0KICBzYWxtb246IFsyNTAsMTI4LDExNF0sDQogIHNhbmR5YnJvd246IFsyNDQsMTY0LDk2XSwNCiAgc2VhZ3JlZW46IFs0NiwxMzksODddLA0KICBzZWFzaGVsbDogWzI1NSwyNDUsMjM4XSwNCiAgc2llbm5hOiBbMTYwLDgyLDQ1XSwNCiAgc2lsdmVyOiBbMTkyLDE5MiwxOTJdLA0KICBza3libHVlOiAgWzEzNSwyMDYsMjM1XSwNCiAgc2xhdGVibHVlOiAgWzEwNiw5MCwyMDVdLA0KICBzbGF0ZWdyYXk6ICBbMTEyLDEyOCwxNDRdLA0KICBzbGF0ZWdyZXk6ICBbMTEyLDEyOCwxNDRdLA0KICBzbm93OiBbMjU1LDI1MCwyNTBdLA0KICBzcHJpbmdncmVlbjogIFswLDI1NSwxMjddLA0KICBzdGVlbGJsdWU6ICBbNzAsMTMwLDE4MF0sDQogIHRhbjogIFsyMTAsMTgwLDE0MF0sDQogIHRlYWw6IFswLDEyOCwxMjhdLA0KICB0aGlzdGxlOiAgWzIxNiwxOTEsMjE2XSwNCiAgdG9tYXRvOiBbMjU1LDk5LDcxXSwNCiAgdHVycXVvaXNlOiAgWzY0LDIyNCwyMDhdLA0KICB2aW9sZXQ6IFsyMzgsMTMwLDIzOF0sDQogIHdoZWF0OiAgWzI0NSwyMjIsMTc5XSwNCiAgd2hpdGU6ICBbMjU1LDI1NSwyNTVdLA0KICB3aGl0ZXNtb2tlOiBbMjQ1LDI0NSwyNDVdLA0KICB5ZWxsb3c6IFsyNTUsMjU1LDBdLA0KICB5ZWxsb3dncmVlbjogIFsxNTQsMjA1LDUwXQ0KfTsNCg0KdmFyIHJldmVyc2VLZXl3b3JkcyA9IHt9Ow0KZm9yICh2YXIga2V5IGluIGNzc0tleXdvcmRzKSB7DQogIHJldmVyc2VLZXl3b3Jkc1tKU09OLnN0cmluZ2lmeShjc3NLZXl3b3Jkc1trZXldKV0gPSBrZXk7DQp9DQoNCn0se31dLDQ6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpew0KdmFyIGNvbnZlcnNpb25zID0gcmVxdWlyZSgzKTsNCg0KdmFyIGNvbnZlcnQgPSBmdW5jdGlvbigpIHsNCiAgIHJldHVybiBuZXcgQ29udmVydGVyKCk7DQp9DQoNCmZvciAodmFyIGZ1bmMgaW4gY29udmVyc2lvbnMpIHsNCiAgLy8gZXhwb3J0IFJhdyB2ZXJzaW9ucw0KICBjb252ZXJ0W2Z1bmMgKyAiUmF3Il0gPSAgKGZ1bmN0aW9uKGZ1bmMpIHsNCiAgICAvLyBhY2NlcHQgYXJyYXkgb3IgcGxhaW4gYXJncw0KICAgIHJldHVybiBmdW5jdGlvbihhcmcpIHsNCiAgICAgIGlmICh0eXBlb2YgYXJnID09ICJudW1iZXIiKQ0KICAgICAgICBhcmcgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpOw0KICAgICAgcmV0dXJuIGNvbnZlcnNpb25zW2Z1bmNdKGFyZyk7DQogICAgfQ0KICB9KShmdW5jKTsNCg0KICB2YXIgcGFpciA9IC8oXHcrKTIoXHcrKS8uZXhlYyhmdW5jKSwNCiAgICAgIGZyb20gPSBwYWlyWzFdLA0KICAgICAgdG8gPSBwYWlyWzJdOw0KDQogIC8vIGV4cG9ydCByZ2IyaHNsIGFuZCBbInJnYiJdWyJoc2wiXQ0KICBjb252ZXJ0W2Zyb21dID0gY29udmVydFtmcm9tXSB8fCB7fTsNCg0KICBjb252ZXJ0W2Zyb21dW3RvXSA9IGNvbnZlcnRbZnVuY10gPSAoZnVuY3Rpb24oZnVuYykgeyANCiAgICByZXR1cm4gZnVuY3Rpb24oYXJnKSB7DQogICAgICBpZiAodHlwZW9mIGFyZyA9PSAibnVtYmVyIikNCiAgICAgICAgYXJnID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKTsNCiAgICAgIA0KICAgICAgdmFyIHZhbCA9IGNvbnZlcnNpb25zW2Z1bmNdKGFyZyk7DQogICAgICBpZiAodHlwZW9mIHZhbCA9PSAic3RyaW5nIiB8fCB2YWwgPT09IHVuZGVmaW5lZCkNCiAgICAgICAgcmV0dXJuIHZhbDsgLy8ga2V5d29yZA0KDQogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZhbC5sZW5ndGg7IGkrKykNCiAgICAgICAgdmFsW2ldID0gTWF0aC5yb3VuZCh2YWxbaV0pOw0KICAgICAgcmV0dXJuIHZhbDsNCiAgICB9DQogIH0pKGZ1bmMpOw0KfQ0KDQoNCi8qIENvbnZlcnRlciBkb2VzIGxhenkgY29udmVyc2lvbiBhbmQgY2FjaGluZyAqLw0KdmFyIENvbnZlcnRlciA9IGZ1bmN0aW9uKCkgew0KICAgdGhpcy5jb252cyA9IHt9Ow0KfTsNCg0KLyogRWl0aGVyIGdldCB0aGUgdmFsdWVzIGZvciBhIHNwYWNlIG9yDQogIHNldCB0aGUgdmFsdWVzIGZvciBhIHNwYWNlLCBkZXBlbmRpbmcgb24gYXJncyAqLw0KQ29udmVydGVyLnByb3RvdHlwZS5yb3V0ZVNwYWNlID0gZnVuY3Rpb24oc3BhY2UsIGFyZ3MpIHsNCiAgIHZhciB2YWx1ZXMgPSBhcmdzWzBdOw0KICAgaWYgKHZhbHVlcyA9PT0gdW5kZWZpbmVkKSB7DQogICAgICAvLyBjb2xvci5yZ2IoKQ0KICAgICAgcmV0dXJuIHRoaXMuZ2V0VmFsdWVzKHNwYWNlKTsNCiAgIH0NCiAgIC8vIGNvbG9yLnJnYigxMCwgMTAsIDEwKQ0KICAgaWYgKHR5cGVvZiB2YWx1ZXMgPT0gIm51bWJlciIpIHsNCiAgICAgIHZhbHVlcyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3MpOyAgICAgICAgDQogICB9DQoNCiAgIHJldHVybiB0aGlzLnNldFZhbHVlcyhzcGFjZSwgdmFsdWVzKTsNCn07DQogIA0KLyogU2V0IHRoZSB2YWx1ZXMgZm9yIGEgc3BhY2UsIGludmFsaWRhdGluZyBjYWNoZSAqLw0KQ29udmVydGVyLnByb3RvdHlwZS5zZXRWYWx1ZXMgPSBmdW5jdGlvbihzcGFjZSwgdmFsdWVzKSB7DQogICB0aGlzLnNwYWNlID0gc3BhY2U7DQogICB0aGlzLmNvbnZzID0ge307DQogICB0aGlzLmNvbnZzW3NwYWNlXSA9IHZhbHVlczsNCiAgIHJldHVybiB0aGlzOw0KfTsNCg0KLyogR2V0IHRoZSB2YWx1ZXMgZm9yIGEgc3BhY2UuIElmIHRoZXJlJ3MgYWxyZWFkeQ0KICBhIGNvbnZlcnNpb24gZm9yIHRoZSBzcGFjZSwgZmV0Y2ggaXQsIG90aGVyd2lzZQ0KICBjb21wdXRlIGl0ICovDQpDb252ZXJ0ZXIucHJvdG90eXBlLmdldFZhbHVlcyA9IGZ1bmN0aW9uKHNwYWNlKSB7DQogICB2YXIgdmFscyA9IHRoaXMuY29udnNbc3BhY2VdOw0KICAgaWYgKCF2YWxzKSB7DQogICAgICB2YXIgZnNwYWNlID0gdGhpcy5zcGFjZSwNCiAgICAgICAgICBmcm9tID0gdGhpcy5jb252c1tmc3BhY2VdOw0KICAgICAgdmFscyA9IGNvbnZlcnRbZnNwYWNlXVtzcGFjZV0oZnJvbSk7DQoNCiAgICAgIHRoaXMuY29udnNbc3BhY2VdID0gdmFsczsNCiAgIH0NCiAgcmV0dXJuIHZhbHM7DQp9Ow0KDQpbInJnYiIsICJoc2wiLCAiaHN2IiwgImNteWsiLCAia2V5d29yZCJdLmZvckVhY2goZnVuY3Rpb24oc3BhY2UpIHsNCiAgIENvbnZlcnRlci5wcm90b3R5cGVbc3BhY2VdID0gZnVuY3Rpb24odmFscykgew0KICAgICAgcmV0dXJuIHRoaXMucm91dGVTcGFjZShzcGFjZSwgYXJndW1lbnRzKTsNCiAgIH0NCn0pOw0KDQptb2R1bGUuZXhwb3J0cyA9IGNvbnZlcnQ7DQp9LHsiMyI6M31dLDU6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpew0KJ3VzZSBzdHJpY3QnDQoNCm1vZHVsZS5leHBvcnRzID0gew0KCSJhbGljZWJsdWUiOiBbMjQwLCAyNDgsIDI1NV0sDQoJImFudGlxdWV3aGl0ZSI6IFsyNTAsIDIzNSwgMjE1XSwNCgkiYXF1YSI6IFswLCAyNTUsIDI1NV0sDQoJImFxdWFtYXJpbmUiOiBbMTI3LCAyNTUsIDIxMl0sDQoJImF6dXJlIjogWzI0MCwgMjU1LCAyNTVdLA0KCSJiZWlnZSI6IFsyNDUsIDI0NSwgMjIwXSwNCgkiYmlzcXVlIjogWzI1NSwgMjI4LCAxOTZdLA0KCSJibGFjayI6IFswLCAwLCAwXSwNCgkiYmxhbmNoZWRhbG1vbmQiOiBbMjU1LCAyMzUsIDIwNV0sDQoJImJsdWUiOiBbMCwgMCwgMjU1XSwNCgkiYmx1ZXZpb2xldCI6IFsxMzgsIDQzLCAyMjZdLA0KCSJicm93biI6IFsxNjUsIDQyLCA0Ml0sDQoJImJ1cmx5d29vZCI6IFsyMjIsIDE4NCwgMTM1XSwNCgkiY2FkZXRibHVlIjogWzk1LCAxNTgsIDE2MF0sDQoJImNoYXJ0cmV1c2UiOiBbMTI3LCAyNTUsIDBdLA0KCSJjaG9jb2xhdGUiOiBbMjEwLCAxMDUsIDMwXSwNCgkiY29yYWwiOiBbMjU1LCAxMjcsIDgwXSwNCgkiY29ybmZsb3dlcmJsdWUiOiBbMTAwLCAxNDksIDIzN10sDQoJImNvcm5zaWxrIjogWzI1NSwgMjQ4LCAyMjBdLA0KCSJjcmltc29uIjogWzIyMCwgMjAsIDYwXSwNCgkiY3lhbiI6IFswLCAyNTUsIDI1NV0sDQoJImRhcmtibHVlIjogWzAsIDAsIDEzOV0sDQoJImRhcmtjeWFuIjogWzAsIDEzOSwgMTM5XSwNCgkiZGFya2dvbGRlbnJvZCI6IFsxODQsIDEzNCwgMTFdLA0KCSJkYXJrZ3JheSI6IFsxNjksIDE2OSwgMTY5XSwNCgkiZGFya2dyZWVuIjogWzAsIDEwMCwgMF0sDQoJImRhcmtncmV5IjogWzE2OSwgMTY5LCAxNjldLA0KCSJkYXJra2hha2kiOiBbMTg5LCAxODMsIDEwN10sDQoJImRhcmttYWdlbnRhIjogWzEzOSwgMCwgMTM5XSwNCgkiZGFya29saXZlZ3JlZW4iOiBbODUsIDEwNywgNDddLA0KCSJkYXJrb3JhbmdlIjogWzI1NSwgMTQwLCAwXSwNCgkiZGFya29yY2hpZCI6IFsxNTMsIDUwLCAyMDRdLA0KCSJkYXJrcmVkIjogWzEzOSwgMCwgMF0sDQoJImRhcmtzYWxtb24iOiBbMjMzLCAxNTAsIDEyMl0sDQoJImRhcmtzZWFncmVlbiI6IFsxNDMsIDE4OCwgMTQzXSwNCgkiZGFya3NsYXRlYmx1ZSI6IFs3MiwgNjEsIDEzOV0sDQoJImRhcmtzbGF0ZWdyYXkiOiBbNDcsIDc5LCA3OV0sDQoJImRhcmtzbGF0ZWdyZXkiOiBbNDcsIDc5LCA3OV0sDQoJImRhcmt0dXJxdW9pc2UiOiBbMCwgMjA2LCAyMDldLA0KCSJkYXJrdmlvbGV0IjogWzE0OCwgMCwgMjExXSwNCgkiZGVlcHBpbmsiOiBbMjU1LCAyMCwgMTQ3XSwNCgkiZGVlcHNreWJsdWUiOiBbMCwgMTkxLCAyNTVdLA0KCSJkaW1ncmF5IjogWzEwNSwgMTA1LCAxMDVdLA0KCSJkaW1ncmV5IjogWzEwNSwgMTA1LCAxMDVdLA0KCSJkb2RnZXJibHVlIjogWzMwLCAxNDQsIDI1NV0sDQoJImZpcmVicmljayI6IFsxNzgsIDM0LCAzNF0sDQoJImZsb3JhbHdoaXRlIjogWzI1NSwgMjUwLCAyNDBdLA0KCSJmb3Jlc3RncmVlbiI6IFszNCwgMTM5LCAzNF0sDQoJImZ1Y2hzaWEiOiBbMjU1LCAwLCAyNTVdLA0KCSJnYWluc2Jvcm8iOiBbMjIwLCAyMjAsIDIyMF0sDQoJImdob3N0d2hpdGUiOiBbMjQ4LCAyNDgsIDI1NV0sDQoJImdvbGQiOiBbMjU1LCAyMTUsIDBdLA0KCSJnb2xkZW5yb2QiOiBbMjE4LCAxNjUsIDMyXSwNCgkiZ3JheSI6IFsxMjgsIDEyOCwgMTI4XSwNCgkiZ3JlZW4iOiBbMCwgMTI4LCAwXSwNCgkiZ3JlZW55ZWxsb3ciOiBbMTczLCAyNTUsIDQ3XSwNCgkiZ3JleSI6IFsxMjgsIDEyOCwgMTI4XSwNCgkiaG9uZXlkZXciOiBbMjQwLCAyNTUsIDI0MF0sDQoJImhvdHBpbmsiOiBbMjU1LCAxMDUsIDE4MF0sDQoJImluZGlhbnJlZCI6IFsyMDUsIDkyLCA5Ml0sDQoJImluZGlnbyI6IFs3NSwgMCwgMTMwXSwNCgkiaXZvcnkiOiBbMjU1LCAyNTUsIDI0MF0sDQoJImtoYWtpIjogWzI0MCwgMjMwLCAxNDBdLA0KCSJsYXZlbmRlciI6IFsyMzAsIDIzMCwgMjUwXSwNCgkibGF2ZW5kZXJibHVzaCI6IFsyNTUsIDI0MCwgMjQ1XSwNCgkibGF3bmdyZWVuIjogWzEyNCwgMjUyLCAwXSwNCgkibGVtb25jaGlmZm9uIjogWzI1NSwgMjUwLCAyMDVdLA0KCSJsaWdodGJsdWUiOiBbMTczLCAyMTYsIDIzMF0sDQoJImxpZ2h0Y29yYWwiOiBbMjQwLCAxMjgsIDEyOF0sDQoJImxpZ2h0Y3lhbiI6IFsyMjQsIDI1NSwgMjU1XSwNCgkibGlnaHRnb2xkZW5yb2R5ZWxsb3ciOiBbMjUwLCAyNTAsIDIxMF0sDQoJImxpZ2h0Z3JheSI6IFsyMTEsIDIxMSwgMjExXSwNCgkibGlnaHRncmVlbiI6IFsxNDQsIDIzOCwgMTQ0XSwNCgkibGlnaHRncmV5IjogWzIxMSwgMjExLCAyMTFdLA0KCSJsaWdodHBpbmsiOiBbMjU1LCAxODIsIDE5M10sDQoJImxpZ2h0c2FsbW9uIjogWzI1NSwgMTYwLCAxMjJdLA0KCSJsaWdodHNlYWdyZWVuIjogWzMyLCAxNzgsIDE3MF0sDQoJImxpZ2h0c2t5Ymx1ZSI6IFsxMzUsIDIwNiwgMjUwXSwNCgkibGlnaHRzbGF0ZWdyYXkiOiBbMTE5LCAxMzYsIDE1M10sDQoJImxpZ2h0c2xhdGVncmV5IjogWzExOSwgMTM2LCAxNTNdLA0KCSJsaWdodHN0ZWVsYmx1ZSI6IFsxNzYsIDE5NiwgMjIyXSwNCgkibGlnaHR5ZWxsb3ciOiBbMjU1LCAyNTUsIDIyNF0sDQoJImxpbWUiOiBbMCwgMjU1LCAwXSwNCgkibGltZWdyZWVuIjogWzUwLCAyMDUsIDUwXSwNCgkibGluZW4iOiBbMjUwLCAyNDAsIDIzMF0sDQoJIm1hZ2VudGEiOiBbMjU1LCAwLCAyNTVdLA0KCSJtYXJvb24iOiBbMTI4LCAwLCAwXSwNCgkibWVkaXVtYXF1YW1hcmluZSI6IFsxMDIsIDIwNSwgMTcwXSwNCgkibWVkaXVtYmx1ZSI6IFswLCAwLCAyMDVdLA0KCSJtZWRpdW1vcmNoaWQiOiBbMTg2LCA4NSwgMjExXSwNCgkibWVkaXVtcHVycGxlIjogWzE0NywgMTEyLCAyMTldLA0KCSJtZWRpdW1zZWFncmVlbiI6IFs2MCwgMTc5LCAxMTNdLA0KCSJtZWRpdW1zbGF0ZWJsdWUiOiBbMTIzLCAxMDQsIDIzOF0sDQoJIm1lZGl1bXNwcmluZ2dyZWVuIjogWzAsIDI1MCwgMTU0XSwNCgkibWVkaXVtdHVycXVvaXNlIjogWzcyLCAyMDksIDIwNF0sDQoJIm1lZGl1bXZpb2xldHJlZCI6IFsxOTksIDIxLCAxMzNdLA0KCSJtaWRuaWdodGJsdWUiOiBbMjUsIDI1LCAxMTJdLA0KCSJtaW50Y3JlYW0iOiBbMjQ1LCAyNTUsIDI1MF0sDQoJIm1pc3R5cm9zZSI6IFsyNTUsIDIyOCwgMjI1XSwNCgkibW9jY2FzaW4iOiBbMjU1LCAyMjgsIDE4MV0sDQoJIm5hdmFqb3doaXRlIjogWzI1NSwgMjIyLCAxNzNdLA0KCSJuYXZ5IjogWzAsIDAsIDEyOF0sDQoJIm9sZGxhY2UiOiBbMjUzLCAyNDUsIDIzMF0sDQoJIm9saXZlIjogWzEyOCwgMTI4LCAwXSwNCgkib2xpdmVkcmFiIjogWzEwNywgMTQyLCAzNV0sDQoJIm9yYW5nZSI6IFsyNTUsIDE2NSwgMF0sDQoJIm9yYW5nZXJlZCI6IFsyNTUsIDY5LCAwXSwNCgkib3JjaGlkIjogWzIxOCwgMTEyLCAyMTRdLA0KCSJwYWxlZ29sZGVucm9kIjogWzIzOCwgMjMyLCAxNzBdLA0KCSJwYWxlZ3JlZW4iOiBbMTUyLCAyNTEsIDE1Ml0sDQoJInBhbGV0dXJxdW9pc2UiOiBbMTc1LCAyMzgsIDIzOF0sDQoJInBhbGV2aW9sZXRyZWQiOiBbMjE5LCAxMTIsIDE0N10sDQoJInBhcGF5YXdoaXAiOiBbMjU1LCAyMzksIDIxM10sDQoJInBlYWNocHVmZiI6IFsyNTUsIDIxOCwgMTg1XSwNCgkicGVydSI6IFsyMDUsIDEzMywgNjNdLA0KCSJwaW5rIjogWzI1NSwgMTkyLCAyMDNdLA0KCSJwbHVtIjogWzIyMSwgMTYwLCAyMjFdLA0KCSJwb3dkZXJibHVlIjogWzE3NiwgMjI0LCAyMzBdLA0KCSJwdXJwbGUiOiBbMTI4LCAwLCAxMjhdLA0KCSJyZWJlY2NhcHVycGxlIjogWzEwMiwgNTEsIDE1M10sDQoJInJlZCI6IFsyNTUsIDAsIDBdLA0KCSJyb3N5YnJvd24iOiBbMTg4LCAxNDMsIDE0M10sDQoJInJveWFsYmx1ZSI6IFs2NSwgMTA1LCAyMjVdLA0KCSJzYWRkbGVicm93biI6IFsxMzksIDY5LCAxOV0sDQoJInNhbG1vbiI6IFsyNTAsIDEyOCwgMTE0XSwNCgkic2FuZHlicm93biI6IFsyNDQsIDE2NCwgOTZdLA0KCSJzZWFncmVlbiI6IFs0NiwgMTM5LCA4N10sDQoJInNlYXNoZWxsIjogWzI1NSwgMjQ1LCAyMzhdLA0KCSJzaWVubmEiOiBbMTYwLCA4MiwgNDVdLA0KCSJzaWx2ZXIiOiBbMTkyLCAxOTIsIDE5Ml0sDQoJInNreWJsdWUiOiBbMTM1LCAyMDYsIDIzNV0sDQoJInNsYXRlYmx1ZSI6IFsxMDYsIDkwLCAyMDVdLA0KCSJzbGF0ZWdyYXkiOiBbMTEyLCAxMjgsIDE0NF0sDQoJInNsYXRlZ3JleSI6IFsxMTIsIDEyOCwgMTQ0XSwNCgkic25vdyI6IFsyNTUsIDI1MCwgMjUwXSwNCgkic3ByaW5nZ3JlZW4iOiBbMCwgMjU1LCAxMjddLA0KCSJzdGVlbGJsdWUiOiBbNzAsIDEzMCwgMTgwXSwNCgkidGFuIjogWzIxMCwgMTgwLCAxNDBdLA0KCSJ0ZWFsIjogWzAsIDEyOCwgMTI4XSwNCgkidGhpc3RsZSI6IFsyMTYsIDE5MSwgMjE2XSwNCgkidG9tYXRvIjogWzI1NSwgOTksIDcxXSwNCgkidHVycXVvaXNlIjogWzY0LCAyMjQsIDIwOF0sDQoJInZpb2xldCI6IFsyMzgsIDEzMCwgMjM4XSwNCgkid2hlYXQiOiBbMjQ1LCAyMjIsIDE3OV0sDQoJIndoaXRlIjogWzI1NSwgMjU1LCAyNTVdLA0KCSJ3aGl0ZXNtb2tlIjogWzI0NSwgMjQ1LCAyNDVdLA0KCSJ5ZWxsb3ciOiBbMjU1LCAyNTUsIDBdLA0KCSJ5ZWxsb3dncmVlbiI6IFsxNTQsIDIwNSwgNTBdDQp9Ow0KDQp9LHt9XSw2OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsNCi8vISBtb21lbnQuanMNCi8vISB2ZXJzaW9uIDogMi4xOC4xDQovLyEgYXV0aG9ycyA6IFRpbSBXb29kLCBJc2tyZW4gQ2hlcm5ldiwgTW9tZW50LmpzIGNvbnRyaWJ1dG9ycw0KLy8hIGxpY2Vuc2UgOiBNSVQNCi8vISBtb21lbnRqcy5jb20NCg0KOyhmdW5jdGlvbiAoZ2xvYmFsLCBmYWN0b3J5KSB7DQogICAgdHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnICYmIHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnID8gbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCkgOg0KICAgIHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCA/IGRlZmluZShmYWN0b3J5KSA6DQogICAgZ2xvYmFsLm1vbWVudCA9IGZhY3RvcnkoKQ0KfSh0aGlzLCAoZnVuY3Rpb24gKCkgeyAndXNlIHN0cmljdCc7DQoNCnZhciBob29rQ2FsbGJhY2s7DQoNCmZ1bmN0aW9uIGhvb2tzICgpIHsNCiAgICByZXR1cm4gaG9va0NhbGxiYWNrLmFwcGx5KG51bGwsIGFyZ3VtZW50cyk7DQp9DQoNCi8vIFRoaXMgaXMgZG9uZSB0byByZWdpc3RlciB0aGUgbWV0aG9kIGNhbGxlZCB3aXRoIG1vbWVudCgpDQovLyB3aXRob3V0IGNyZWF0aW5nIGNpcmN1bGFyIGRlcGVuZGVuY2llcy4NCmZ1bmN0aW9uIHNldEhvb2tDYWxsYmFjayAoY2FsbGJhY2spIHsNCiAgICBob29rQ2FsbGJhY2sgPSBjYWxsYmFjazsNCn0NCg0KZnVuY3Rpb24gaXNBcnJheShpbnB1dCkgew0KICAgIHJldHVybiBpbnB1dCBpbnN0YW5jZW9mIEFycmF5IHx8IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChpbnB1dCkgPT09ICdbb2JqZWN0IEFycmF5XSc7DQp9DQoNCmZ1bmN0aW9uIGlzT2JqZWN0KGlucHV0KSB7DQogICAgLy8gSUU4IHdpbGwgdHJlYXQgdW5kZWZpbmVkIGFuZCBudWxsIGFzIG9iamVjdCBpZiBpdCB3YXNuJ3QgZm9yDQogICAgLy8gaW5wdXQgIT0gbnVsbA0KICAgIHJldHVybiBpbnB1dCAhPSBudWxsICYmIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChpbnB1dCkgPT09ICdbb2JqZWN0IE9iamVjdF0nOw0KfQ0KDQpmdW5jdGlvbiBpc09iamVjdEVtcHR5KG9iaikgew0KICAgIHZhciBrOw0KICAgIGZvciAoayBpbiBvYmopIHsNCiAgICAgICAgLy8gZXZlbiBpZiBpdHMgbm90IG93biBwcm9wZXJ0eSBJJ2Qgc3RpbGwgY2FsbCBpdCBub24tZW1wdHkNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCiAgICByZXR1cm4gdHJ1ZTsNCn0NCg0KZnVuY3Rpb24gaXNVbmRlZmluZWQoaW5wdXQpIHsNCiAgICByZXR1cm4gaW5wdXQgPT09IHZvaWQgMDsNCn0NCg0KZnVuY3Rpb24gaXNOdW1iZXIoaW5wdXQpIHsNCiAgICByZXR1cm4gdHlwZW9mIGlucHV0ID09PSAnbnVtYmVyJyB8fCBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoaW5wdXQpID09PSAnW29iamVjdCBOdW1iZXJdJzsNCn0NCg0KZnVuY3Rpb24gaXNEYXRlKGlucHV0KSB7DQogICAgcmV0dXJuIGlucHV0IGluc3RhbmNlb2YgRGF0ZSB8fCBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoaW5wdXQpID09PSAnW29iamVjdCBEYXRlXSc7DQp9DQoNCmZ1bmN0aW9uIG1hcChhcnIsIGZuKSB7DQogICAgdmFyIHJlcyA9IFtdLCBpOw0KICAgIGZvciAoaSA9IDA7IGkgPCBhcnIubGVuZ3RoOyArK2kpIHsNCiAgICAgICAgcmVzLnB1c2goZm4oYXJyW2ldLCBpKSk7DQogICAgfQ0KICAgIHJldHVybiByZXM7DQp9DQoNCmZ1bmN0aW9uIGhhc093blByb3AoYSwgYikgew0KICAgIHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoYSwgYik7DQp9DQoNCmZ1bmN0aW9uIGV4dGVuZChhLCBiKSB7DQogICAgZm9yICh2YXIgaSBpbiBiKSB7DQogICAgICAgIGlmIChoYXNPd25Qcm9wKGIsIGkpKSB7DQogICAgICAgICAgICBhW2ldID0gYltpXTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIGlmIChoYXNPd25Qcm9wKGIsICd0b1N0cmluZycpKSB7DQogICAgICAgIGEudG9TdHJpbmcgPSBiLnRvU3RyaW5nOw0KICAgIH0NCg0KICAgIGlmIChoYXNPd25Qcm9wKGIsICd2YWx1ZU9mJykpIHsNCiAgICAgICAgYS52YWx1ZU9mID0gYi52YWx1ZU9mOw0KICAgIH0NCg0KICAgIHJldHVybiBhOw0KfQ0KDQpmdW5jdGlvbiBjcmVhdGVVVEMgKGlucHV0LCBmb3JtYXQsIGxvY2FsZSwgc3RyaWN0KSB7DQogICAgcmV0dXJuIGNyZWF0ZUxvY2FsT3JVVEMoaW5wdXQsIGZvcm1hdCwgbG9jYWxlLCBzdHJpY3QsIHRydWUpLnV0YygpOw0KfQ0KDQpmdW5jdGlvbiBkZWZhdWx0UGFyc2luZ0ZsYWdzKCkgew0KICAgIC8vIFdlIG5lZWQgdG8gZGVlcCBjbG9uZSB0aGlzIG9iamVjdC4NCiAgICByZXR1cm4gew0KICAgICAgICBlbXB0eSAgICAgICAgICAgOiBmYWxzZSwNCiAgICAgICAgdW51c2VkVG9rZW5zICAgIDogW10sDQogICAgICAgIHVudXNlZElucHV0ICAgICA6IFtdLA0KICAgICAgICBvdmVyZmxvdyAgICAgICAgOiAtMiwNCiAgICAgICAgY2hhcnNMZWZ0T3ZlciAgIDogMCwNCiAgICAgICAgbnVsbElucHV0ICAgICAgIDogZmFsc2UsDQogICAgICAgIGludmFsaWRNb250aCAgICA6IG51bGwsDQogICAgICAgIGludmFsaWRGb3JtYXQgICA6IGZhbHNlLA0KICAgICAgICB1c2VySW52YWxpZGF0ZWQgOiBmYWxzZSwNCiAgICAgICAgaXNvICAgICAgICAgICAgIDogZmFsc2UsDQogICAgICAgIHBhcnNlZERhdGVQYXJ0cyA6IFtdLA0KICAgICAgICBtZXJpZGllbSAgICAgICAgOiBudWxsLA0KICAgICAgICByZmMyODIyICAgICAgICAgOiBmYWxzZSwNCiAgICAgICAgd2Vla2RheU1pc21hdGNoIDogZmFsc2UNCiAgICB9Ow0KfQ0KDQpmdW5jdGlvbiBnZXRQYXJzaW5nRmxhZ3MobSkgew0KICAgIGlmIChtLl9wZiA9PSBudWxsKSB7DQogICAgICAgIG0uX3BmID0gZGVmYXVsdFBhcnNpbmdGbGFncygpOw0KICAgIH0NCiAgICByZXR1cm4gbS5fcGY7DQp9DQoNCnZhciBzb21lOw0KaWYgKEFycmF5LnByb3RvdHlwZS5zb21lKSB7DQogICAgc29tZSA9IEFycmF5LnByb3RvdHlwZS5zb21lOw0KfSBlbHNlIHsNCiAgICBzb21lID0gZnVuY3Rpb24gKGZ1bikgew0KICAgICAgICB2YXIgdCA9IE9iamVjdCh0aGlzKTsNCiAgICAgICAgdmFyIGxlbiA9IHQubGVuZ3RoID4+PiAwOw0KDQogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyBpKyspIHsNCiAgICAgICAgICAgIGlmIChpIGluIHQgJiYgZnVuLmNhbGwodGhpcywgdFtpXSwgaSwgdCkpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9Ow0KfQ0KDQp2YXIgc29tZSQxID0gc29tZTsNCg0KZnVuY3Rpb24gaXNWYWxpZChtKSB7DQogICAgaWYgKG0uX2lzVmFsaWQgPT0gbnVsbCkgew0KICAgICAgICB2YXIgZmxhZ3MgPSBnZXRQYXJzaW5nRmxhZ3MobSk7DQogICAgICAgIHZhciBwYXJzZWRQYXJ0cyA9IHNvbWUkMS5jYWxsKGZsYWdzLnBhcnNlZERhdGVQYXJ0cywgZnVuY3Rpb24gKGkpIHsNCiAgICAgICAgICAgIHJldHVybiBpICE9IG51bGw7DQogICAgICAgIH0pOw0KICAgICAgICB2YXIgaXNOb3dWYWxpZCA9ICFpc05hTihtLl9kLmdldFRpbWUoKSkgJiYNCiAgICAgICAgICAgIGZsYWdzLm92ZXJmbG93IDwgMCAmJg0KICAgICAgICAgICAgIWZsYWdzLmVtcHR5ICYmDQogICAgICAgICAgICAhZmxhZ3MuaW52YWxpZE1vbnRoICYmDQogICAgICAgICAgICAhZmxhZ3MuaW52YWxpZFdlZWtkYXkgJiYNCiAgICAgICAgICAgICFmbGFncy5udWxsSW5wdXQgJiYNCiAgICAgICAgICAgICFmbGFncy5pbnZhbGlkRm9ybWF0ICYmDQogICAgICAgICAgICAhZmxhZ3MudXNlckludmFsaWRhdGVkICYmDQogICAgICAgICAgICAoIWZsYWdzLm1lcmlkaWVtIHx8IChmbGFncy5tZXJpZGllbSAmJiBwYXJzZWRQYXJ0cykpOw0KDQogICAgICAgIGlmIChtLl9zdHJpY3QpIHsNCiAgICAgICAgICAgIGlzTm93VmFsaWQgPSBpc05vd1ZhbGlkICYmDQogICAgICAgICAgICAgICAgZmxhZ3MuY2hhcnNMZWZ0T3ZlciA9PT0gMCAmJg0KICAgICAgICAgICAgICAgIGZsYWdzLnVudXNlZFRva2Vucy5sZW5ndGggPT09IDAgJiYNCiAgICAgICAgICAgICAgICBmbGFncy5iaWdIb3VyID09PSB1bmRlZmluZWQ7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoT2JqZWN0LmlzRnJvemVuID09IG51bGwgfHwgIU9iamVjdC5pc0Zyb3plbihtKSkgew0KICAgICAgICAgICAgbS5faXNWYWxpZCA9IGlzTm93VmFsaWQ7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gaXNOb3dWYWxpZDsNCiAgICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gbS5faXNWYWxpZDsNCn0NCg0KZnVuY3Rpb24gY3JlYXRlSW52YWxpZCAoZmxhZ3MpIHsNCiAgICB2YXIgbSA9IGNyZWF0ZVVUQyhOYU4pOw0KICAgIGlmIChmbGFncyAhPSBudWxsKSB7DQogICAgICAgIGV4dGVuZChnZXRQYXJzaW5nRmxhZ3MobSksIGZsYWdzKTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICAgIGdldFBhcnNpbmdGbGFncyhtKS51c2VySW52YWxpZGF0ZWQgPSB0cnVlOw0KICAgIH0NCg0KICAgIHJldHVybiBtOw0KfQ0KDQovLyBQbHVnaW5zIHRoYXQgYWRkIHByb3BlcnRpZXMgc2hvdWxkIGFsc28gYWRkIHRoZSBrZXkgaGVyZSAobnVsbCB2YWx1ZSksDQovLyBzbyB3ZSBjYW4gcHJvcGVybHkgY2xvbmUgb3Vyc2VsdmVzLg0KdmFyIG1vbWVudFByb3BlcnRpZXMgPSBob29rcy5tb21lbnRQcm9wZXJ0aWVzID0gW107DQoNCmZ1bmN0aW9uIGNvcHlDb25maWcodG8sIGZyb20pIHsNCiAgICB2YXIgaSwgcHJvcCwgdmFsOw0KDQogICAgaWYgKCFpc1VuZGVmaW5lZChmcm9tLl9pc0FNb21lbnRPYmplY3QpKSB7DQogICAgICAgIHRvLl9pc0FNb21lbnRPYmplY3QgPSBmcm9tLl9pc0FNb21lbnRPYmplY3Q7DQogICAgfQ0KICAgIGlmICghaXNVbmRlZmluZWQoZnJvbS5faSkpIHsNCiAgICAgICAgdG8uX2kgPSBmcm9tLl9pOw0KICAgIH0NCiAgICBpZiAoIWlzVW5kZWZpbmVkKGZyb20uX2YpKSB7DQogICAgICAgIHRvLl9mID0gZnJvbS5fZjsNCiAgICB9DQogICAgaWYgKCFpc1VuZGVmaW5lZChmcm9tLl9sKSkgew0KICAgICAgICB0by5fbCA9IGZyb20uX2w7DQogICAgfQ0KICAgIGlmICghaXNVbmRlZmluZWQoZnJvbS5fc3RyaWN0KSkgew0KICAgICAgICB0by5fc3RyaWN0ID0gZnJvbS5fc3RyaWN0Ow0KICAgIH0NCiAgICBpZiAoIWlzVW5kZWZpbmVkKGZyb20uX3R6bSkpIHsNCiAgICAgICAgdG8uX3R6bSA9IGZyb20uX3R6bTsNCiAgICB9DQogICAgaWYgKCFpc1VuZGVmaW5lZChmcm9tLl9pc1VUQykpIHsNCiAgICAgICAgdG8uX2lzVVRDID0gZnJvbS5faXNVVEM7DQogICAgfQ0KICAgIGlmICghaXNVbmRlZmluZWQoZnJvbS5fb2Zmc2V0KSkgew0KICAgICAgICB0by5fb2Zmc2V0ID0gZnJvbS5fb2Zmc2V0Ow0KICAgIH0NCiAgICBpZiAoIWlzVW5kZWZpbmVkKGZyb20uX3BmKSkgew0KICAgICAgICB0by5fcGYgPSBnZXRQYXJzaW5nRmxhZ3MoZnJvbSk7DQogICAgfQ0KICAgIGlmICghaXNVbmRlZmluZWQoZnJvbS5fbG9jYWxlKSkgew0KICAgICAgICB0by5fbG9jYWxlID0gZnJvbS5fbG9jYWxlOw0KICAgIH0NCg0KICAgIGlmIChtb21lbnRQcm9wZXJ0aWVzLmxlbmd0aCA+IDApIHsNCiAgICAgICAgZm9yIChpID0gMDsgaSA8IG1vbWVudFByb3BlcnRpZXMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIHByb3AgPSBtb21lbnRQcm9wZXJ0aWVzW2ldOw0KICAgICAgICAgICAgdmFsID0gZnJvbVtwcm9wXTsNCiAgICAgICAgICAgIGlmICghaXNVbmRlZmluZWQodmFsKSkgew0KICAgICAgICAgICAgICAgIHRvW3Byb3BdID0gdmFsOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KDQogICAgcmV0dXJuIHRvOw0KfQ0KDQp2YXIgdXBkYXRlSW5Qcm9ncmVzcyA9IGZhbHNlOw0KDQovLyBNb21lbnQgcHJvdG90eXBlIG9iamVjdA0KZnVuY3Rpb24gTW9tZW50KGNvbmZpZykgew0KICAgIGNvcHlDb25maWcodGhpcywgY29uZmlnKTsNCiAgICB0aGlzLl9kID0gbmV3IERhdGUoY29uZmlnLl9kICE9IG51bGwgPyBjb25maWcuX2QuZ2V0VGltZSgpIDogTmFOKTsNCiAgICBpZiAoIXRoaXMuaXNWYWxpZCgpKSB7DQogICAgICAgIHRoaXMuX2QgPSBuZXcgRGF0ZShOYU4pOw0KICAgIH0NCiAgICAvLyBQcmV2ZW50IGluZmluaXRlIGxvb3AgaW4gY2FzZSB1cGRhdGVPZmZzZXQgY3JlYXRlcyBuZXcgbW9tZW50DQogICAgLy8gb2JqZWN0cy4NCiAgICBpZiAodXBkYXRlSW5Qcm9ncmVzcyA9PT0gZmFsc2UpIHsNCiAgICAgICAgdXBkYXRlSW5Qcm9ncmVzcyA9IHRydWU7DQogICAgICAgIGhvb2tzLnVwZGF0ZU9mZnNldCh0aGlzKTsNCiAgICAgICAgdXBkYXRlSW5Qcm9ncmVzcyA9IGZhbHNlOw0KICAgIH0NCn0NCg0KZnVuY3Rpb24gaXNNb21lbnQgKG9iaikgew0KICAgIHJldHVybiBvYmogaW5zdGFuY2VvZiBNb21lbnQgfHwgKG9iaiAhPSBudWxsICYmIG9iai5faXNBTW9tZW50T2JqZWN0ICE9IG51bGwpOw0KfQ0KDQpmdW5jdGlvbiBhYnNGbG9vciAobnVtYmVyKSB7DQogICAgaWYgKG51bWJlciA8IDApIHsNCiAgICAgICAgLy8gLTAgLT4gMA0KICAgICAgICByZXR1cm4gTWF0aC5jZWlsKG51bWJlcikgfHwgMDsNCiAgICB9IGVsc2Ugew0KICAgICAgICByZXR1cm4gTWF0aC5mbG9vcihudW1iZXIpOw0KICAgIH0NCn0NCg0KZnVuY3Rpb24gdG9JbnQoYXJndW1lbnRGb3JDb2VyY2lvbikgew0KICAgIHZhciBjb2VyY2VkTnVtYmVyID0gK2FyZ3VtZW50Rm9yQ29lcmNpb24sDQogICAgICAgIHZhbHVlID0gMDsNCg0KICAgIGlmIChjb2VyY2VkTnVtYmVyICE9PSAwICYmIGlzRmluaXRlKGNvZXJjZWROdW1iZXIpKSB7DQogICAgICAgIHZhbHVlID0gYWJzRmxvb3IoY29lcmNlZE51bWJlcik7DQogICAgfQ0KDQogICAgcmV0dXJuIHZhbHVlOw0KfQ0KDQovLyBjb21wYXJlIHR3byBhcnJheXMsIHJldHVybiB0aGUgbnVtYmVyIG9mIGRpZmZlcmVuY2VzDQpmdW5jdGlvbiBjb21wYXJlQXJyYXlzKGFycmF5MSwgYXJyYXkyLCBkb250Q29udmVydCkgew0KICAgIHZhciBsZW4gPSBNYXRoLm1pbihhcnJheTEubGVuZ3RoLCBhcnJheTIubGVuZ3RoKSwNCiAgICAgICAgbGVuZ3RoRGlmZiA9IE1hdGguYWJzKGFycmF5MS5sZW5ndGggLSBhcnJheTIubGVuZ3RoKSwNCiAgICAgICAgZGlmZnMgPSAwLA0KICAgICAgICBpOw0KICAgIGZvciAoaSA9IDA7IGkgPCBsZW47IGkrKykgew0KICAgICAgICBpZiAoKGRvbnRDb252ZXJ0ICYmIGFycmF5MVtpXSAhPT0gYXJyYXkyW2ldKSB8fA0KICAgICAgICAgICAgKCFkb250Q29udmVydCAmJiB0b0ludChhcnJheTFbaV0pICE9PSB0b0ludChhcnJheTJbaV0pKSkgew0KICAgICAgICAgICAgZGlmZnMrKzsNCiAgICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gZGlmZnMgKyBsZW5ndGhEaWZmOw0KfQ0KDQpmdW5jdGlvbiB3YXJuKG1zZykgew0KICAgIGlmIChob29rcy5zdXBwcmVzc0RlcHJlY2F0aW9uV2FybmluZ3MgPT09IGZhbHNlICYmDQogICAgICAgICAgICAodHlwZW9mIGNvbnNvbGUgIT09ICAndW5kZWZpbmVkJykgJiYgY29uc29sZS53YXJuKSB7DQogICAgICAgIGNvbnNvbGUud2FybignRGVwcmVjYXRpb24gd2FybmluZzogJyArIG1zZyk7DQogICAgfQ0KfQ0KDQpmdW5jdGlvbiBkZXByZWNhdGUobXNnLCBmbikgew0KICAgIHZhciBmaXJzdFRpbWUgPSB0cnVlOw0KDQogICAgcmV0dXJuIGV4dGVuZChmdW5jdGlvbiAoKSB7DQogICAgICAgIGlmIChob29rcy5kZXByZWNhdGlvbkhhbmRsZXIgIT0gbnVsbCkgew0KICAgICAgICAgICAgaG9va3MuZGVwcmVjYXRpb25IYW5kbGVyKG51bGwsIG1zZyk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGZpcnN0VGltZSkgew0KICAgICAgICAgICAgdmFyIGFyZ3MgPSBbXTsNCiAgICAgICAgICAgIHZhciBhcmc7DQogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgICAgIGFyZyA9ICcnOw0KICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgYXJndW1lbnRzW2ldID09PSAnb2JqZWN0Jykgew0KICAgICAgICAgICAgICAgICAgICBhcmcgKz0gJ1xuWycgKyBpICsgJ10gJzsNCiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIga2V5IGluIGFyZ3VtZW50c1swXSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgYXJnICs9IGtleSArICc6ICcgKyBhcmd1bWVudHNbMF1ba2V5XSArICcsICc7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgYXJnID0gYXJnLnNsaWNlKDAsIC0yKTsgLy8gUmVtb3ZlIHRyYWlsaW5nIGNvbW1hIGFuZCBzcGFjZQ0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIGFyZyA9IGFyZ3VtZW50c1tpXTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgYXJncy5wdXNoKGFyZyk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICB3YXJuKG1zZyArICdcbkFyZ3VtZW50czogJyArIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3MpLmpvaW4oJycpICsgJ1xuJyArIChuZXcgRXJyb3IoKSkuc3RhY2spOw0KICAgICAgICAgICAgZmlyc3RUaW1lID0gZmFsc2U7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGZuLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7DQogICAgfSwgZm4pOw0KfQ0KDQp2YXIgZGVwcmVjYXRpb25zID0ge307DQoNCmZ1bmN0aW9uIGRlcHJlY2F0ZVNpbXBsZShuYW1lLCBtc2cpIHsNCiAgICBpZiAoaG9va3MuZGVwcmVjYXRpb25IYW5kbGVyICE9IG51bGwpIHsNCiAgICAgICAgaG9va3MuZGVwcmVjYXRpb25IYW5kbGVyKG5hbWUsIG1zZyk7DQogICAgfQ0KICAgIGlmICghZGVwcmVjYXRpb25zW25hbWVdKSB7DQogICAgICAgIHdhcm4obXNnKTsNCiAgICAgICAgZGVwcmVjYXRpb25zW25hbWVdID0gdHJ1ZTsNCiAgICB9DQp9DQoNCmhvb2tzLnN1cHByZXNzRGVwcmVjYXRpb25XYXJuaW5ncyA9IGZhbHNlOw0KaG9va3MuZGVwcmVjYXRpb25IYW5kbGVyID0gbnVsbDsNCg0KZnVuY3Rpb24gaXNGdW5jdGlvbihpbnB1dCkgew0KICAgIHJldHVybiBpbnB1dCBpbnN0YW5jZW9mIEZ1bmN0aW9uIHx8IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChpbnB1dCkgPT09ICdbb2JqZWN0IEZ1bmN0aW9uXSc7DQp9DQoNCmZ1bmN0aW9uIHNldCAoY29uZmlnKSB7DQogICAgdmFyIHByb3AsIGk7DQogICAgZm9yIChpIGluIGNvbmZpZykgew0KICAgICAgICBwcm9wID0gY29uZmlnW2ldOw0KICAgICAgICBpZiAoaXNGdW5jdGlvbihwcm9wKSkgew0KICAgICAgICAgICAgdGhpc1tpXSA9IHByb3A7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICB0aGlzWydfJyArIGldID0gcHJvcDsNCiAgICAgICAgfQ0KICAgIH0NCiAgICB0aGlzLl9jb25maWcgPSBjb25maWc7DQogICAgLy8gTGVuaWVudCBvcmRpbmFsIHBhcnNpbmcgYWNjZXB0cyBqdXN0IGEgbnVtYmVyIGluIGFkZGl0aW9uIHRvDQogICAgLy8gbnVtYmVyICsgKHBvc3NpYmx5KSBzdHVmZiBjb21pbmcgZnJvbSBfZGF5T2ZNb250aE9yZGluYWxQYXJzZS4NCiAgICAvLyBUT0RPOiBSZW1vdmUgIm9yZGluYWxQYXJzZSIgZmFsbGJhY2sgaW4gbmV4dCBtYWpvciByZWxlYXNlLg0KICAgIHRoaXMuX2RheU9mTW9udGhPcmRpbmFsUGFyc2VMZW5pZW50ID0gbmV3IFJlZ0V4cCgNCiAgICAgICAgKHRoaXMuX2RheU9mTW9udGhPcmRpbmFsUGFyc2Uuc291cmNlIHx8IHRoaXMuX29yZGluYWxQYXJzZS5zb3VyY2UpICsNCiAgICAgICAgICAgICd8JyArICgvXGR7MSwyfS8pLnNvdXJjZSk7DQp9DQoNCmZ1bmN0aW9uIG1lcmdlQ29uZmlncyhwYXJlbnRDb25maWcsIGNoaWxkQ29uZmlnKSB7DQogICAgdmFyIHJlcyA9IGV4dGVuZCh7fSwgcGFyZW50Q29uZmlnKSwgcHJvcDsNCiAgICBmb3IgKHByb3AgaW4gY2hpbGRDb25maWcpIHsNCiAgICAgICAgaWYgKGhhc093blByb3AoY2hpbGRDb25maWcsIHByb3ApKSB7DQogICAgICAgICAgICBpZiAoaXNPYmplY3QocGFyZW50Q29uZmlnW3Byb3BdKSAmJiBpc09iamVjdChjaGlsZENvbmZpZ1twcm9wXSkpIHsNCiAgICAgICAgICAgICAgICByZXNbcHJvcF0gPSB7fTsNCiAgICAgICAgICAgICAgICBleHRlbmQocmVzW3Byb3BdLCBwYXJlbnRDb25maWdbcHJvcF0pOw0KICAgICAgICAgICAgICAgIGV4dGVuZChyZXNbcHJvcF0sIGNoaWxkQ29uZmlnW3Byb3BdKTsNCiAgICAgICAgICAgIH0gZWxzZSBpZiAoY2hpbGRDb25maWdbcHJvcF0gIT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIHJlc1twcm9wXSA9IGNoaWxkQ29uZmlnW3Byb3BdOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBkZWxldGUgcmVzW3Byb3BdOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KICAgIGZvciAocHJvcCBpbiBwYXJlbnRDb25maWcpIHsNCiAgICAgICAgaWYgKGhhc093blByb3AocGFyZW50Q29uZmlnLCBwcm9wKSAmJg0KICAgICAgICAgICAgICAgICFoYXNPd25Qcm9wKGNoaWxkQ29uZmlnLCBwcm9wKSAmJg0KICAgICAgICAgICAgICAgIGlzT2JqZWN0KHBhcmVudENvbmZpZ1twcm9wXSkpIHsNCiAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSBjaGFuZ2VzIHRvIHByb3BlcnRpZXMgZG9uJ3QgbW9kaWZ5IHBhcmVudCBjb25maWcNCiAgICAgICAgICAgIHJlc1twcm9wXSA9IGV4dGVuZCh7fSwgcmVzW3Byb3BdKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gcmVzOw0KfQ0KDQpmdW5jdGlvbiBMb2NhbGUoY29uZmlnKSB7DQogICAgaWYgKGNvbmZpZyAhPSBudWxsKSB7DQogICAgICAgIHRoaXMuc2V0KGNvbmZpZyk7DQogICAgfQ0KfQ0KDQp2YXIga2V5czsNCg0KaWYgKE9iamVjdC5rZXlzKSB7DQogICAga2V5cyA9IE9iamVjdC5rZXlzOw0KfSBlbHNlIHsNCiAgICBrZXlzID0gZnVuY3Rpb24gKG9iaikgew0KICAgICAgICB2YXIgaSwgcmVzID0gW107DQogICAgICAgIGZvciAoaSBpbiBvYmopIHsNCiAgICAgICAgICAgIGlmIChoYXNPd25Qcm9wKG9iaiwgaSkpIHsNCiAgICAgICAgICAgICAgICByZXMucHVzaChpKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gcmVzOw0KICAgIH07DQp9DQoNCnZhciBrZXlzJDEgPSBrZXlzOw0KDQp2YXIgZGVmYXVsdENhbGVuZGFyID0gew0KICAgIHNhbWVEYXkgOiAnW1RvZGF5IGF0XSBMVCcsDQogICAgbmV4dERheSA6ICdbVG9tb3Jyb3cgYXRdIExUJywNCiAgICBuZXh0V2VlayA6ICdkZGRkIFthdF0gTFQnLA0KICAgIGxhc3REYXkgOiAnW1llc3RlcmRheSBhdF0gTFQnLA0KICAgIGxhc3RXZWVrIDogJ1tMYXN0XSBkZGRkIFthdF0gTFQnLA0KICAgIHNhbWVFbHNlIDogJ0wnDQp9Ow0KDQpmdW5jdGlvbiBjYWxlbmRhciAoa2V5LCBtb20sIG5vdykgew0KICAgIHZhciBvdXRwdXQgPSB0aGlzLl9jYWxlbmRhcltrZXldIHx8IHRoaXMuX2NhbGVuZGFyWydzYW1lRWxzZSddOw0KICAgIHJldHVybiBpc0Z1bmN0aW9uKG91dHB1dCkgPyBvdXRwdXQuY2FsbChtb20sIG5vdykgOiBvdXRwdXQ7DQp9DQoNCnZhciBkZWZhdWx0TG9uZ0RhdGVGb3JtYXQgPSB7DQogICAgTFRTICA6ICdoOm1tOnNzIEEnLA0KICAgIExUICAgOiAnaDptbSBBJywNCiAgICBMICAgIDogJ01NL0REL1lZWVknLA0KICAgIExMICAgOiAnTU1NTSBELCBZWVlZJywNCiAgICBMTEwgIDogJ01NTU0gRCwgWVlZWSBoOm1tIEEnLA0KICAgIExMTEwgOiAnZGRkZCwgTU1NTSBELCBZWVlZIGg6bW0gQScNCn07DQoNCmZ1bmN0aW9uIGxvbmdEYXRlRm9ybWF0IChrZXkpIHsNCiAgICB2YXIgZm9ybWF0ID0gdGhpcy5fbG9uZ0RhdGVGb3JtYXRba2V5XSwNCiAgICAgICAgZm9ybWF0VXBwZXIgPSB0aGlzLl9sb25nRGF0ZUZvcm1hdFtrZXkudG9VcHBlckNhc2UoKV07DQoNCiAgICBpZiAoZm9ybWF0IHx8ICFmb3JtYXRVcHBlcikgew0KICAgICAgICByZXR1cm4gZm9ybWF0Ow0KICAgIH0NCg0KICAgIHRoaXMuX2xvbmdEYXRlRm9ybWF0W2tleV0gPSBmb3JtYXRVcHBlci5yZXBsYWNlKC9NTU1NfE1NfEREfGRkZGQvZywgZnVuY3Rpb24gKHZhbCkgew0KICAgICAgICByZXR1cm4gdmFsLnNsaWNlKDEpOw0KICAgIH0pOw0KDQogICAgcmV0dXJuIHRoaXMuX2xvbmdEYXRlRm9ybWF0W2tleV07DQp9DQoNCnZhciBkZWZhdWx0SW52YWxpZERhdGUgPSAnSW52YWxpZCBkYXRlJzsNCg0KZnVuY3Rpb24gaW52YWxpZERhdGUgKCkgew0KICAgIHJldHVybiB0aGlzLl9pbnZhbGlkRGF0ZTsNCn0NCg0KdmFyIGRlZmF1bHRPcmRpbmFsID0gJyVkJzsNCnZhciBkZWZhdWx0RGF5T2ZNb250aE9yZGluYWxQYXJzZSA9IC9cZHsxLDJ9LzsNCg0KZnVuY3Rpb24gb3JkaW5hbCAobnVtYmVyKSB7DQogICAgcmV0dXJuIHRoaXMuX29yZGluYWwucmVwbGFjZSgnJWQnLCBudW1iZXIpOw0KfQ0KDQp2YXIgZGVmYXVsdFJlbGF0aXZlVGltZSA9IHsNCiAgICBmdXR1cmUgOiAnaW4gJXMnLA0KICAgIHBhc3QgICA6ICclcyBhZ28nLA0KICAgIHMgIDogJ2EgZmV3IHNlY29uZHMnLA0KICAgIHNzIDogJyVkIHNlY29uZHMnLA0KICAgIG0gIDogJ2EgbWludXRlJywNCiAgICBtbSA6ICclZCBtaW51dGVzJywNCiAgICBoICA6ICdhbiBob3VyJywNCiAgICBoaCA6ICclZCBob3VycycsDQogICAgZCAgOiAnYSBkYXknLA0KICAgIGRkIDogJyVkIGRheXMnLA0KICAgIE0gIDogJ2EgbW9udGgnLA0KICAgIE1NIDogJyVkIG1vbnRocycsDQogICAgeSAgOiAnYSB5ZWFyJywNCiAgICB5eSA6ICclZCB5ZWFycycNCn07DQoNCmZ1bmN0aW9uIHJlbGF0aXZlVGltZSAobnVtYmVyLCB3aXRob3V0U3VmZml4LCBzdHJpbmcsIGlzRnV0dXJlKSB7DQogICAgdmFyIG91dHB1dCA9IHRoaXMuX3JlbGF0aXZlVGltZVtzdHJpbmddOw0KICAgIHJldHVybiAoaXNGdW5jdGlvbihvdXRwdXQpKSA/DQogICAgICAgIG91dHB1dChudW1iZXIsIHdpdGhvdXRTdWZmaXgsIHN0cmluZywgaXNGdXR1cmUpIDoNCiAgICAgICAgb3V0cHV0LnJlcGxhY2UoLyVkL2ksIG51bWJlcik7DQp9DQoNCmZ1bmN0aW9uIHBhc3RGdXR1cmUgKGRpZmYsIG91dHB1dCkgew0KICAgIHZhciBmb3JtYXQgPSB0aGlzLl9yZWxhdGl2ZVRpbWVbZGlmZiA+IDAgPyAnZnV0dXJlJyA6ICdwYXN0J107DQogICAgcmV0dXJuIGlzRnVuY3Rpb24oZm9ybWF0KSA/IGZvcm1hdChvdXRwdXQpIDogZm9ybWF0LnJlcGxhY2UoLyVzL2ksIG91dHB1dCk7DQp9DQoNCnZhciBhbGlhc2VzID0ge307DQoNCmZ1bmN0aW9uIGFkZFVuaXRBbGlhcyAodW5pdCwgc2hvcnRoYW5kKSB7DQogICAgdmFyIGxvd2VyQ2FzZSA9IHVuaXQudG9Mb3dlckNhc2UoKTsNCiAgICBhbGlhc2VzW2xvd2VyQ2FzZV0gPSBhbGlhc2VzW2xvd2VyQ2FzZSArICdzJ10gPSBhbGlhc2VzW3Nob3J0aGFuZF0gPSB1bml0Ow0KfQ0KDQpmdW5jdGlvbiBub3JtYWxpemVVbml0cyh1bml0cykgew0KICAgIHJldHVybiB0eXBlb2YgdW5pdHMgPT09ICdzdHJpbmcnID8gYWxpYXNlc1t1bml0c10gfHwgYWxpYXNlc1t1bml0cy50b0xvd2VyQ2FzZSgpXSA6IHVuZGVmaW5lZDsNCn0NCg0KZnVuY3Rpb24gbm9ybWFsaXplT2JqZWN0VW5pdHMoaW5wdXRPYmplY3QpIHsNCiAgICB2YXIgbm9ybWFsaXplZElucHV0ID0ge30sDQogICAgICAgIG5vcm1hbGl6ZWRQcm9wLA0KICAgICAgICBwcm9wOw0KDQogICAgZm9yIChwcm9wIGluIGlucHV0T2JqZWN0KSB7DQogICAgICAgIGlmIChoYXNPd25Qcm9wKGlucHV0T2JqZWN0LCBwcm9wKSkgew0KICAgICAgICAgICAgbm9ybWFsaXplZFByb3AgPSBub3JtYWxpemVVbml0cyhwcm9wKTsNCiAgICAgICAgICAgIGlmIChub3JtYWxpemVkUHJvcCkgew0KICAgICAgICAgICAgICAgIG5vcm1hbGl6ZWRJbnB1dFtub3JtYWxpemVkUHJvcF0gPSBpbnB1dE9iamVjdFtwcm9wXTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHJldHVybiBub3JtYWxpemVkSW5wdXQ7DQp9DQoNCnZhciBwcmlvcml0aWVzID0ge307DQoNCmZ1bmN0aW9uIGFkZFVuaXRQcmlvcml0eSh1bml0LCBwcmlvcml0eSkgew0KICAgIHByaW9yaXRpZXNbdW5pdF0gPSBwcmlvcml0eTsNCn0NCg0KZnVuY3Rpb24gZ2V0UHJpb3JpdGl6ZWRVbml0cyh1bml0c09iaikgew0KICAgIHZhciB1bml0cyA9IFtdOw0KICAgIGZvciAodmFyIHUgaW4gdW5pdHNPYmopIHsNCiAgICAgICAgdW5pdHMucHVzaCh7dW5pdDogdSwgcHJpb3JpdHk6IHByaW9yaXRpZXNbdV19KTsNCiAgICB9DQogICAgdW5pdHMuc29ydChmdW5jdGlvbiAoYSwgYikgew0KICAgICAgICByZXR1cm4gYS5wcmlvcml0eSAtIGIucHJpb3JpdHk7DQogICAgfSk7DQogICAgcmV0dXJuIHVuaXRzOw0KfQ0KDQpmdW5jdGlvbiBtYWtlR2V0U2V0ICh1bml0LCBrZWVwVGltZSkgew0KICAgIHJldHVybiBmdW5jdGlvbiAodmFsdWUpIHsNCiAgICAgICAgaWYgKHZhbHVlICE9IG51bGwpIHsNCiAgICAgICAgICAgIHNldCQxKHRoaXMsIHVuaXQsIHZhbHVlKTsNCiAgICAgICAgICAgIGhvb2tzLnVwZGF0ZU9mZnNldCh0aGlzLCBrZWVwVGltZSk7DQogICAgICAgICAgICByZXR1cm4gdGhpczsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiBnZXQodGhpcywgdW5pdCk7DQogICAgICAgIH0NCiAgICB9Ow0KfQ0KDQpmdW5jdGlvbiBnZXQgKG1vbSwgdW5pdCkgew0KICAgIHJldHVybiBtb20uaXNWYWxpZCgpID8NCiAgICAgICAgbW9tLl9kWydnZXQnICsgKG1vbS5faXNVVEMgPyAnVVRDJyA6ICcnKSArIHVuaXRdKCkgOiBOYU47DQp9DQoNCmZ1bmN0aW9uIHNldCQxIChtb20sIHVuaXQsIHZhbHVlKSB7DQogICAgaWYgKG1vbS5pc1ZhbGlkKCkpIHsNCiAgICAgICAgbW9tLl9kWydzZXQnICsgKG1vbS5faXNVVEMgPyAnVVRDJyA6ICcnKSArIHVuaXRdKHZhbHVlKTsNCiAgICB9DQp9DQoNCi8vIE1PTUVOVFMNCg0KZnVuY3Rpb24gc3RyaW5nR2V0ICh1bml0cykgew0KICAgIHVuaXRzID0gbm9ybWFsaXplVW5pdHModW5pdHMpOw0KICAgIGlmIChpc0Z1bmN0aW9uKHRoaXNbdW5pdHNdKSkgew0KICAgICAgICByZXR1cm4gdGhpc1t1bml0c10oKTsNCiAgICB9DQogICAgcmV0dXJuIHRoaXM7DQp9DQoNCg0KZnVuY3Rpb24gc3RyaW5nU2V0ICh1bml0cywgdmFsdWUpIHsNCiAgICBpZiAodHlwZW9mIHVuaXRzID09PSAnb2JqZWN0Jykgew0KICAgICAgICB1bml0cyA9IG5vcm1hbGl6ZU9iamVjdFVuaXRzKHVuaXRzKTsNCiAgICAgICAgdmFyIHByaW9yaXRpemVkID0gZ2V0UHJpb3JpdGl6ZWRVbml0cyh1bml0cyk7DQogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcHJpb3JpdGl6ZWQubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIHRoaXNbcHJpb3JpdGl6ZWRbaV0udW5pdF0odW5pdHNbcHJpb3JpdGl6ZWRbaV0udW5pdF0pOw0KICAgICAgICB9DQogICAgfSBlbHNlIHsNCiAgICAgICAgdW5pdHMgPSBub3JtYWxpemVVbml0cyh1bml0cyk7DQogICAgICAgIGlmIChpc0Z1bmN0aW9uKHRoaXNbdW5pdHNdKSkgew0KICAgICAgICAgICAgcmV0dXJuIHRoaXNbdW5pdHNdKHZhbHVlKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gdGhpczsNCn0NCg0KZnVuY3Rpb24gemVyb0ZpbGwobnVtYmVyLCB0YXJnZXRMZW5ndGgsIGZvcmNlU2lnbikgew0KICAgIHZhciBhYnNOdW1iZXIgPSAnJyArIE1hdGguYWJzKG51bWJlciksDQogICAgICAgIHplcm9zVG9GaWxsID0gdGFyZ2V0TGVuZ3RoIC0gYWJzTnVtYmVyLmxlbmd0aCwNCiAgICAgICAgc2lnbiA9IG51bWJlciA+PSAwOw0KICAgIHJldHVybiAoc2lnbiA/IChmb3JjZVNpZ24gPyAnKycgOiAnJykgOiAnLScpICsNCiAgICAgICAgTWF0aC5wb3coMTAsIE1hdGgubWF4KDAsIHplcm9zVG9GaWxsKSkudG9TdHJpbmcoKS5zdWJzdHIoMSkgKyBhYnNOdW1iZXI7DQp9DQoNCnZhciBmb3JtYXR0aW5nVG9rZW5zID0gLyhcW1teXFtdKlxdKXwoXFwpPyhbSGhdbW0oc3MpP3xNb3xNTT9NP00/fERvfERERG98REQ/RD9EP3xkZGQ/ZD98ZG8/fHdbb3x3XT98V1tvfFddP3xRbz98WVlZWVlZfFlZWVlZfFlZWVl8WVl8Z2coZ2dnPyk/fEdHKEdHRz8pP3xlfEV8YXxBfGhoP3xISD98a2s/fG1tP3xzcz98U3sxLDl9fHh8WHx6ej98Wlo/fC4pL2c7DQoNCnZhciBsb2NhbEZvcm1hdHRpbmdUb2tlbnMgPSAvKFxbW15cW10qXF0pfChcXCk/KExUU3xMVHxMTD9MP0w/fGx7MSw0fSkvZzsNCg0KdmFyIGZvcm1hdEZ1bmN0aW9ucyA9IHt9Ow0KDQp2YXIgZm9ybWF0VG9rZW5GdW5jdGlvbnMgPSB7fTsNCg0KLy8gdG9rZW46ICAgICdNJw0KLy8gcGFkZGVkOiAgIFsnTU0nLCAyXQ0KLy8gb3JkaW5hbDogICdNbycNCi8vIGNhbGxiYWNrOiBmdW5jdGlvbiAoKSB7IHRoaXMubW9udGgoKSArIDEgfQ0KZnVuY3Rpb24gYWRkRm9ybWF0VG9rZW4gKHRva2VuLCBwYWRkZWQsIG9yZGluYWwsIGNhbGxiYWNrKSB7DQogICAgdmFyIGZ1bmMgPSBjYWxsYmFjazsNCiAgICBpZiAodHlwZW9mIGNhbGxiYWNrID09PSAnc3RyaW5nJykgew0KICAgICAgICBmdW5jID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgcmV0dXJuIHRoaXNbY2FsbGJhY2tdKCk7DQogICAgICAgIH07DQogICAgfQ0KICAgIGlmICh0b2tlbikgew0KICAgICAgICBmb3JtYXRUb2tlbkZ1bmN0aW9uc1t0b2tlbl0gPSBmdW5jOw0KICAgIH0NCiAgICBpZiAocGFkZGVkKSB7DQogICAgICAgIGZvcm1hdFRva2VuRnVuY3Rpb25zW3BhZGRlZFswXV0gPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICByZXR1cm4gemVyb0ZpbGwoZnVuYy5hcHBseSh0aGlzLCBhcmd1bWVudHMpLCBwYWRkZWRbMV0sIHBhZGRlZFsyXSk7DQogICAgICAgIH07DQogICAgfQ0KICAgIGlmIChvcmRpbmFsKSB7DQogICAgICAgIGZvcm1hdFRva2VuRnVuY3Rpb25zW29yZGluYWxdID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgcmV0dXJuIHRoaXMubG9jYWxlRGF0YSgpLm9yZGluYWwoZnVuYy5hcHBseSh0aGlzLCBhcmd1bWVudHMpLCB0b2tlbik7DQogICAgICAgIH07DQogICAgfQ0KfQ0KDQpmdW5jdGlvbiByZW1vdmVGb3JtYXR0aW5nVG9rZW5zKGlucHV0KSB7DQogICAgaWYgKGlucHV0Lm1hdGNoKC9cW1tcc1xTXS8pKSB7DQogICAgICAgIHJldHVybiBpbnB1dC5yZXBsYWNlKC9eXFt8XF0kL2csICcnKTsNCiAgICB9DQogICAgcmV0dXJuIGlucHV0LnJlcGxhY2UoL1xcL2csICcnKTsNCn0NCg0KZnVuY3Rpb24gbWFrZUZvcm1hdEZ1bmN0aW9uKGZvcm1hdCkgew0KICAgIHZhciBhcnJheSA9IGZvcm1hdC5tYXRjaChmb3JtYXR0aW5nVG9rZW5zKSwgaSwgbGVuZ3RoOw0KDQogICAgZm9yIChpID0gMCwgbGVuZ3RoID0gYXJyYXkubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHsNCiAgICAgICAgaWYgKGZvcm1hdFRva2VuRnVuY3Rpb25zW2FycmF5W2ldXSkgew0KICAgICAgICAgICAgYXJyYXlbaV0gPSBmb3JtYXRUb2tlbkZ1bmN0aW9uc1thcnJheVtpXV07DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBhcnJheVtpXSA9IHJlbW92ZUZvcm1hdHRpbmdUb2tlbnMoYXJyYXlbaV0pOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgcmV0dXJuIGZ1bmN0aW9uIChtb20pIHsNCiAgICAgICAgdmFyIG91dHB1dCA9ICcnLCBpOw0KICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIG91dHB1dCArPSBpc0Z1bmN0aW9uKGFycmF5W2ldKSA/IGFycmF5W2ldLmNhbGwobW9tLCBmb3JtYXQpIDogYXJyYXlbaV07DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIG91dHB1dDsNCiAgICB9Ow0KfQ0KDQovLyBmb3JtYXQgZGF0ZSB1c2luZyBuYXRpdmUgZGF0ZSBvYmplY3QNCmZ1bmN0aW9uIGZvcm1hdE1vbWVudChtLCBmb3JtYXQpIHsNCiAgICBpZiAoIW0uaXNWYWxpZCgpKSB7DQogICAgICAgIHJldHVybiBtLmxvY2FsZURhdGEoKS5pbnZhbGlkRGF0ZSgpOw0KICAgIH0NCg0KICAgIGZvcm1hdCA9IGV4cGFuZEZvcm1hdChmb3JtYXQsIG0ubG9jYWxlRGF0YSgpKTsNCiAgICBmb3JtYXRGdW5jdGlvbnNbZm9ybWF0XSA9IGZvcm1hdEZ1bmN0aW9uc1tmb3JtYXRdIHx8IG1ha2VGb3JtYXRGdW5jdGlvbihmb3JtYXQpOw0KDQogICAgcmV0dXJuIGZvcm1hdEZ1bmN0aW9uc1tmb3JtYXRdKG0pOw0KfQ0KDQpmdW5jdGlvbiBleHBhbmRGb3JtYXQoZm9ybWF0LCBsb2NhbGUpIHsNCiAgICB2YXIgaSA9IDU7DQoNCiAgICBmdW5jdGlvbiByZXBsYWNlTG9uZ0RhdGVGb3JtYXRUb2tlbnMoaW5wdXQpIHsNCiAgICAgICAgcmV0dXJuIGxvY2FsZS5sb25nRGF0ZUZvcm1hdChpbnB1dCkgfHwgaW5wdXQ7DQogICAgfQ0KDQogICAgbG9jYWxGb3JtYXR0aW5nVG9rZW5zLmxhc3RJbmRleCA9IDA7DQogICAgd2hpbGUgKGkgPj0gMCAmJiBsb2NhbEZvcm1hdHRpbmdUb2tlbnMudGVzdChmb3JtYXQpKSB7DQogICAgICAgIGZvcm1hdCA9IGZvcm1hdC5yZXBsYWNlKGxvY2FsRm9ybWF0dGluZ1Rva2VucywgcmVwbGFjZUxvbmdEYXRlRm9ybWF0VG9rZW5zKTsNCiAgICAgICAgbG9jYWxGb3JtYXR0aW5nVG9rZW5zLmxhc3RJbmRleCA9IDA7DQogICAgICAgIGkgLT0gMTsNCiAgICB9DQoNCiAgICByZXR1cm4gZm9ybWF0Ow0KfQ0KDQp2YXIgbWF0Y2gxICAgICAgICAgPSAvXGQvOyAgICAgICAgICAgIC8vICAgICAgIDAgLSA5DQp2YXIgbWF0Y2gyICAgICAgICAgPSAvXGRcZC87ICAgICAgICAgIC8vICAgICAgMDAgLSA5OQ0KdmFyIG1hdGNoMyAgICAgICAgID0gL1xkezN9LzsgICAgICAgICAvLyAgICAgMDAwIC0gOTk5DQp2YXIgbWF0Y2g0ICAgICAgICAgPSAvXGR7NH0vOyAgICAgICAgIC8vICAgIDAwMDAgLSA5OTk5DQp2YXIgbWF0Y2g2ICAgICAgICAgPSAvWystXT9cZHs2fS87ICAgIC8vIC05OTk5OTkgLSA5OTk5OTkNCnZhciBtYXRjaDF0bzIgICAgICA9IC9cZFxkPy87ICAgICAgICAgLy8gICAgICAgMCAtIDk5DQp2YXIgbWF0Y2gzdG80ICAgICAgPSAvXGRcZFxkXGQ/LzsgICAgIC8vICAgICA5OTkgLSA5OTk5DQp2YXIgbWF0Y2g1dG82ICAgICAgPSAvXGRcZFxkXGRcZFxkPy87IC8vICAgOTk5OTkgLSA5OTk5OTkNCnZhciBtYXRjaDF0bzMgICAgICA9IC9cZHsxLDN9LzsgICAgICAgLy8gICAgICAgMCAtIDk5OQ0KdmFyIG1hdGNoMXRvNCAgICAgID0gL1xkezEsNH0vOyAgICAgICAvLyAgICAgICAwIC0gOTk5OQ0KdmFyIG1hdGNoMXRvNiAgICAgID0gL1srLV0/XGR7MSw2fS87ICAvLyAtOTk5OTk5IC0gOTk5OTk5DQoNCnZhciBtYXRjaFVuc2lnbmVkICA9IC9cZCsvOyAgICAgICAgICAgLy8gICAgICAgMCAtIGluZg0KdmFyIG1hdGNoU2lnbmVkICAgID0gL1srLV0/XGQrLzsgICAgICAvLyAgICAtaW5mIC0gaW5mDQoNCnZhciBtYXRjaE9mZnNldCAgICA9IC9afFsrLV1cZFxkOj9cZFxkL2dpOyAvLyArMDA6MDAgLTAwOjAwICswMDAwIC0wMDAwIG9yIFoNCnZhciBtYXRjaFNob3J0T2Zmc2V0ID0gL1p8WystXVxkXGQoPzo6P1xkXGQpPy9naTsgLy8gKzAwIC0wMCArMDA6MDAgLTAwOjAwICswMDAwIC0wMDAwIG9yIFoNCg0KdmFyIG1hdGNoVGltZXN0YW1wID0gL1srLV0/XGQrKFwuXGR7MSwzfSk/LzsgLy8gMTIzNDU2Nzg5IDEyMzQ1Njc4OS4xMjMNCg0KLy8gYW55IHdvcmQgKG9yIHR3bykgY2hhcmFjdGVycyBvciBudW1iZXJzIGluY2x1ZGluZyB0d28vdGhyZWUgd29yZCBtb250aCBpbiBhcmFiaWMuDQovLyBpbmNsdWRlcyBzY290dGlzaCBnYWVsaWMgdHdvIHdvcmQgYW5kIGh5cGhlbmF0ZWQgbW9udGhzDQp2YXIgbWF0Y2hXb3JkID0gL1swLTldKlsnYS16XHUwMEEwLVx1MDVGRlx1MDcwMC1cdUQ3RkZcdUY5MDAtXHVGRENGXHVGREYwLVx1RkZFRl0rfFtcdTA2MDAtXHUwNkZGXC9dKyhccyo/W1x1MDYwMC1cdTA2RkZdKyl7MSwyfS9pOw0KDQoNCnZhciByZWdleGVzID0ge307DQoNCmZ1bmN0aW9uIGFkZFJlZ2V4VG9rZW4gKHRva2VuLCByZWdleCwgc3RyaWN0UmVnZXgpIHsNCiAgICByZWdleGVzW3Rva2VuXSA9IGlzRnVuY3Rpb24ocmVnZXgpID8gcmVnZXggOiBmdW5jdGlvbiAoaXNTdHJpY3QsIGxvY2FsZURhdGEpIHsNCiAgICAgICAgcmV0dXJuIChpc1N0cmljdCAmJiBzdHJpY3RSZWdleCkgPyBzdHJpY3RSZWdleCA6IHJlZ2V4Ow0KICAgIH07DQp9DQoNCmZ1bmN0aW9uIGdldFBhcnNlUmVnZXhGb3JUb2tlbiAodG9rZW4sIGNvbmZpZykgew0KICAgIGlmICghaGFzT3duUHJvcChyZWdleGVzLCB0b2tlbikpIHsNCiAgICAgICAgcmV0dXJuIG5ldyBSZWdFeHAodW5lc2NhcGVGb3JtYXQodG9rZW4pKTsNCiAgICB9DQoNCiAgICByZXR1cm4gcmVnZXhlc1t0b2tlbl0oY29uZmlnLl9zdHJpY3QsIGNvbmZpZy5fbG9jYWxlKTsNCn0NCg0KLy8gQ29kZSBmcm9tIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMzU2MTQ5My9pcy10aGVyZS1hLXJlZ2V4cC1lc2NhcGUtZnVuY3Rpb24taW4tamF2YXNjcmlwdA0KZnVuY3Rpb24gdW5lc2NhcGVGb3JtYXQocykgew0KICAgIHJldHVybiByZWdleEVzY2FwZShzLnJlcGxhY2UoJ1xcJywgJycpLnJlcGxhY2UoL1xcKFxbKXxcXChcXSl8XFsoW15cXVxbXSopXF18XFwoLikvZywgZnVuY3Rpb24gKG1hdGNoZWQsIHAxLCBwMiwgcDMsIHA0KSB7DQogICAgICAgIHJldHVybiBwMSB8fCBwMiB8fCBwMyB8fCBwNDsNCiAgICB9KSk7DQp9DQoNCmZ1bmN0aW9uIHJlZ2V4RXNjYXBlKHMpIHsNCiAgICByZXR1cm4gcy5yZXBsYWNlKC9bLVwvXFxeJCorPy4oKXxbXF17fV0vZywgJ1xcJCYnKTsNCn0NCg0KdmFyIHRva2VucyA9IHt9Ow0KDQpmdW5jdGlvbiBhZGRQYXJzZVRva2VuICh0b2tlbiwgY2FsbGJhY2spIHsNCiAgICB2YXIgaSwgZnVuYyA9IGNhbGxiYWNrOw0KICAgIGlmICh0eXBlb2YgdG9rZW4gPT09ICdzdHJpbmcnKSB7DQogICAgICAgIHRva2VuID0gW3Rva2VuXTsNCiAgICB9DQogICAgaWYgKGlzTnVtYmVyKGNhbGxiYWNrKSkgew0KICAgICAgICBmdW5jID0gZnVuY3Rpb24gKGlucHV0LCBhcnJheSkgew0KICAgICAgICAgICAgYXJyYXlbY2FsbGJhY2tdID0gdG9JbnQoaW5wdXQpOw0KICAgICAgICB9Ow0KICAgIH0NCiAgICBmb3IgKGkgPSAwOyBpIDwgdG9rZW4ubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgdG9rZW5zW3Rva2VuW2ldXSA9IGZ1bmM7DQogICAgfQ0KfQ0KDQpmdW5jdGlvbiBhZGRXZWVrUGFyc2VUb2tlbiAodG9rZW4sIGNhbGxiYWNrKSB7DQogICAgYWRkUGFyc2VUb2tlbih0b2tlbiwgZnVuY3Rpb24gKGlucHV0LCBhcnJheSwgY29uZmlnLCB0b2tlbikgew0KICAgICAgICBjb25maWcuX3cgPSBjb25maWcuX3cgfHwge307DQogICAgICAgIGNhbGxiYWNrKGlucHV0LCBjb25maWcuX3csIGNvbmZpZywgdG9rZW4pOw0KICAgIH0pOw0KfQ0KDQpmdW5jdGlvbiBhZGRUaW1lVG9BcnJheUZyb21Ub2tlbih0b2tlbiwgaW5wdXQsIGNvbmZpZykgew0KICAgIGlmIChpbnB1dCAhPSBudWxsICYmIGhhc093blByb3AodG9rZW5zLCB0b2tlbikpIHsNCiAgICAgICAgdG9rZW5zW3Rva2VuXShpbnB1dCwgY29uZmlnLl9hLCBjb25maWcsIHRva2VuKTsNCiAgICB9DQp9DQoNCnZhciBZRUFSID0gMDsNCnZhciBNT05USCA9IDE7DQp2YXIgREFURSA9IDI7DQp2YXIgSE9VUiA9IDM7DQp2YXIgTUlOVVRFID0gNDsNCnZhciBTRUNPTkQgPSA1Ow0KdmFyIE1JTExJU0VDT05EID0gNjsNCnZhciBXRUVLID0gNzsNCnZhciBXRUVLREFZID0gODsNCg0KdmFyIGluZGV4T2Y7DQoNCmlmIChBcnJheS5wcm90b3R5cGUuaW5kZXhPZikgew0KICAgIGluZGV4T2YgPSBBcnJheS5wcm90b3R5cGUuaW5kZXhPZjsNCn0gZWxzZSB7DQogICAgaW5kZXhPZiA9IGZ1bmN0aW9uIChvKSB7DQogICAgICAgIC8vIEkga25vdw0KICAgICAgICB2YXIgaTsNCiAgICAgICAgZm9yIChpID0gMDsgaSA8IHRoaXMubGVuZ3RoOyArK2kpIHsNCiAgICAgICAgICAgIGlmICh0aGlzW2ldID09PSBvKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIC0xOw0KICAgIH07DQp9DQoNCnZhciBpbmRleE9mJDEgPSBpbmRleE9mOw0KDQpmdW5jdGlvbiBkYXlzSW5Nb250aCh5ZWFyLCBtb250aCkgew0KICAgIHJldHVybiBuZXcgRGF0ZShEYXRlLlVUQyh5ZWFyLCBtb250aCArIDEsIDApKS5nZXRVVENEYXRlKCk7DQp9DQoNCi8vIEZPUk1BVFRJTkcNCg0KYWRkRm9ybWF0VG9rZW4oJ00nLCBbJ01NJywgMl0sICdNbycsIGZ1bmN0aW9uICgpIHsNCiAgICByZXR1cm4gdGhpcy5tb250aCgpICsgMTsNCn0pOw0KDQphZGRGb3JtYXRUb2tlbignTU1NJywgMCwgMCwgZnVuY3Rpb24gKGZvcm1hdCkgew0KICAgIHJldHVybiB0aGlzLmxvY2FsZURhdGEoKS5tb250aHNTaG9ydCh0aGlzLCBmb3JtYXQpOw0KfSk7DQoNCmFkZEZvcm1hdFRva2VuKCdNTU1NJywgMCwgMCwgZnVuY3Rpb24gKGZvcm1hdCkgew0KICAgIHJldHVybiB0aGlzLmxvY2FsZURhdGEoKS5tb250aHModGhpcywgZm9ybWF0KTsNCn0pOw0KDQovLyBBTElBU0VTDQoNCmFkZFVuaXRBbGlhcygnbW9udGgnLCAnTScpOw0KDQovLyBQUklPUklUWQ0KDQphZGRVbml0UHJpb3JpdHkoJ21vbnRoJywgOCk7DQoNCi8vIFBBUlNJTkcNCg0KYWRkUmVnZXhUb2tlbignTScsICAgIG1hdGNoMXRvMik7DQphZGRSZWdleFRva2VuKCdNTScsICAgbWF0Y2gxdG8yLCBtYXRjaDIpOw0KYWRkUmVnZXhUb2tlbignTU1NJywgIGZ1bmN0aW9uIChpc1N0cmljdCwgbG9jYWxlKSB7DQogICAgcmV0dXJuIGxvY2FsZS5tb250aHNTaG9ydFJlZ2V4KGlzU3RyaWN0KTsNCn0pOw0KYWRkUmVnZXhUb2tlbignTU1NTScsIGZ1bmN0aW9uIChpc1N0cmljdCwgbG9jYWxlKSB7DQogICAgcmV0dXJuIGxvY2FsZS5tb250aHNSZWdleChpc1N0cmljdCk7DQp9KTsNCg0KYWRkUGFyc2VUb2tlbihbJ00nLCAnTU0nXSwgZnVuY3Rpb24gKGlucHV0LCBhcnJheSkgew0KICAgIGFycmF5W01PTlRIXSA9IHRvSW50KGlucHV0KSAtIDE7DQp9KTsNCg0KYWRkUGFyc2VUb2tlbihbJ01NTScsICdNTU1NJ10sIGZ1bmN0aW9uIChpbnB1dCwgYXJyYXksIGNvbmZpZywgdG9rZW4pIHsNCiAgICB2YXIgbW9udGggPSBjb25maWcuX2xvY2FsZS5tb250aHNQYXJzZShpbnB1dCwgdG9rZW4sIGNvbmZpZy5fc3RyaWN0KTsNCiAgICAvLyBpZiB3ZSBkaWRuJ3QgZmluZCBhIG1vbnRoIG5hbWUsIG1hcmsgdGhlIGRhdGUgYXMgaW52YWxpZC4NCiAgICBpZiAobW9udGggIT0gbnVsbCkgew0KICAgICAgICBhcnJheVtNT05USF0gPSBtb250aDsNCiAgICB9IGVsc2Ugew0KICAgICAgICBnZXRQYXJzaW5nRmxhZ3MoY29uZmlnKS5pbnZhbGlkTW9udGggPSBpbnB1dDsNCiAgICB9DQp9KTsNCg0KLy8gTE9DQUxFUw0KDQp2YXIgTU9OVEhTX0lOX0ZPUk1BVCA9IC9EW29EXT8oXFtbXlxbXF1dKlxdfFxzKStNTU1NPy87DQp2YXIgZGVmYXVsdExvY2FsZU1vbnRocyA9ICdKYW51YXJ5X0ZlYnJ1YXJ5X01hcmNoX0FwcmlsX01heV9KdW5lX0p1bHlfQXVndXN0X1NlcHRlbWJlcl9PY3RvYmVyX05vdmVtYmVyX0RlY2VtYmVyJy5zcGxpdCgnXycpOw0KZnVuY3Rpb24gbG9jYWxlTW9udGhzIChtLCBmb3JtYXQpIHsNCiAgICBpZiAoIW0pIHsNCiAgICAgICAgcmV0dXJuIGlzQXJyYXkodGhpcy5fbW9udGhzKSA/IHRoaXMuX21vbnRocyA6DQogICAgICAgICAgICB0aGlzLl9tb250aHNbJ3N0YW5kYWxvbmUnXTsNCiAgICB9DQogICAgcmV0dXJuIGlzQXJyYXkodGhpcy5fbW9udGhzKSA/IHRoaXMuX21vbnRoc1ttLm1vbnRoKCldIDoNCiAgICAgICAgdGhpcy5fbW9udGhzWyh0aGlzLl9tb250aHMuaXNGb3JtYXQgfHwgTU9OVEhTX0lOX0ZPUk1BVCkudGVzdChmb3JtYXQpID8gJ2Zvcm1hdCcgOiAnc3RhbmRhbG9uZSddW20ubW9udGgoKV07DQp9DQoNCnZhciBkZWZhdWx0TG9jYWxlTW9udGhzU2hvcnQgPSAnSmFuX0ZlYl9NYXJfQXByX01heV9KdW5fSnVsX0F1Z19TZXBfT2N0X05vdl9EZWMnLnNwbGl0KCdfJyk7DQpmdW5jdGlvbiBsb2NhbGVNb250aHNTaG9ydCAobSwgZm9ybWF0KSB7DQogICAgaWYgKCFtKSB7DQogICAgICAgIHJldHVybiBpc0FycmF5KHRoaXMuX21vbnRoc1Nob3J0KSA/IHRoaXMuX21vbnRoc1Nob3J0IDoNCiAgICAgICAgICAgIHRoaXMuX21vbnRoc1Nob3J0WydzdGFuZGFsb25lJ107DQogICAgfQ0KICAgIHJldHVybiBpc0FycmF5KHRoaXMuX21vbnRoc1Nob3J0KSA/IHRoaXMuX21vbnRoc1Nob3J0W20ubW9udGgoKV0gOg0KICAgICAgICB0aGlzLl9tb250aHNTaG9ydFtNT05USFNfSU5fRk9STUFULnRlc3QoZm9ybWF0KSA/ICdmb3JtYXQnIDogJ3N0YW5kYWxvbmUnXVttLm1vbnRoKCldOw0KfQ0KDQpmdW5jdGlvbiBoYW5kbGVTdHJpY3RQYXJzZShtb250aE5hbWUsIGZvcm1hdCwgc3RyaWN0KSB7DQogICAgdmFyIGksIGlpLCBtb20sIGxsYyA9IG1vbnRoTmFtZS50b0xvY2FsZUxvd2VyQ2FzZSgpOw0KICAgIGlmICghdGhpcy5fbW9udGhzUGFyc2UpIHsNCiAgICAgICAgLy8gdGhpcyBpcyBub3QgdXNlZA0KICAgICAgICB0aGlzLl9tb250aHNQYXJzZSA9IFtdOw0KICAgICAgICB0aGlzLl9sb25nTW9udGhzUGFyc2UgPSBbXTsNCiAgICAgICAgdGhpcy5fc2hvcnRNb250aHNQYXJzZSA9IFtdOw0KICAgICAgICBmb3IgKGkgPSAwOyBpIDwgMTI7ICsraSkgew0KICAgICAgICAgICAgbW9tID0gY3JlYXRlVVRDKFsyMDAwLCBpXSk7DQogICAgICAgICAgICB0aGlzLl9zaG9ydE1vbnRoc1BhcnNlW2ldID0gdGhpcy5tb250aHNTaG9ydChtb20sICcnKS50b0xvY2FsZUxvd2VyQ2FzZSgpOw0KICAgICAgICAgICAgdGhpcy5fbG9uZ01vbnRoc1BhcnNlW2ldID0gdGhpcy5tb250aHMobW9tLCAnJykudG9Mb2NhbGVMb3dlckNhc2UoKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIGlmIChzdHJpY3QpIHsNCiAgICAgICAgaWYgKGZvcm1hdCA9PT0gJ01NTScpIHsNCiAgICAgICAgICAgIGlpID0gaW5kZXhPZiQxLmNhbGwodGhpcy5fc2hvcnRNb250aHNQYXJzZSwgbGxjKTsNCiAgICAgICAgICAgIHJldHVybiBpaSAhPT0gLTEgPyBpaSA6IG51bGw7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBpaSA9IGluZGV4T2YkMS5jYWxsKHRoaXMuX2xvbmdNb250aHNQYXJzZSwgbGxjKTsNCiAgICAgICAgICAgIHJldHVybiBpaSAhPT0gLTEgPyBpaSA6IG51bGw7DQogICAgICAgIH0NCiAgICB9IGVsc2Ugew0KICAgICAgICBpZiAoZm9ybWF0ID09PSAnTU1NJykgew0KICAgICAgICAgICAgaWkgPSBpbmRleE9mJDEuY2FsbCh0aGlzLl9zaG9ydE1vbnRoc1BhcnNlLCBsbGMpOw0KICAgICAgICAgICAgaWYgKGlpICE9PSAtMSkgew0KICAgICAgICAgICAgICAgIHJldHVybiBpaTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlpID0gaW5kZXhPZiQxLmNhbGwodGhpcy5fbG9uZ01vbnRoc1BhcnNlLCBsbGMpOw0KICAgICAgICAgICAgcmV0dXJuIGlpICE9PSAtMSA/IGlpIDogbnVsbDsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGlpID0gaW5kZXhPZiQxLmNhbGwodGhpcy5fbG9uZ01vbnRoc1BhcnNlLCBsbGMpOw0KICAgICAgICAgICAgaWYgKGlpICE9PSAtMSkgew0KICAgICAgICAgICAgICAgIHJldHVybiBpaTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlpID0gaW5kZXhPZiQxLmNhbGwodGhpcy5fc2hvcnRNb250aHNQYXJzZSwgbGxjKTsNCiAgICAgICAgICAgIHJldHVybiBpaSAhPT0gLTEgPyBpaSA6IG51bGw7DQogICAgICAgIH0NCiAgICB9DQp9DQoNCmZ1bmN0aW9uIGxvY2FsZU1vbnRoc1BhcnNlIChtb250aE5hbWUsIGZvcm1hdCwgc3RyaWN0KSB7DQogICAgdmFyIGksIG1vbSwgcmVnZXg7DQoNCiAgICBpZiAodGhpcy5fbW9udGhzUGFyc2VFeGFjdCkgew0KICAgICAgICByZXR1cm4gaGFuZGxlU3RyaWN0UGFyc2UuY2FsbCh0aGlzLCBtb250aE5hbWUsIGZvcm1hdCwgc3RyaWN0KTsNCiAgICB9DQoNCiAgICBpZiAoIXRoaXMuX21vbnRoc1BhcnNlKSB7DQogICAgICAgIHRoaXMuX21vbnRoc1BhcnNlID0gW107DQogICAgICAgIHRoaXMuX2xvbmdNb250aHNQYXJzZSA9IFtdOw0KICAgICAgICB0aGlzLl9zaG9ydE1vbnRoc1BhcnNlID0gW107DQogICAgfQ0KDQogICAgLy8gVE9ETzogYWRkIHNvcnRpbmcNCiAgICAvLyBTb3J0aW5nIG1ha2VzIHN1cmUgaWYgb25lIG1vbnRoIChvciBhYmJyKSBpcyBhIHByZWZpeCBvZiBhbm90aGVyDQogICAgLy8gc2VlIHNvcnRpbmcgaW4gY29tcHV0ZU1vbnRoc1BhcnNlDQogICAgZm9yIChpID0gMDsgaSA8IDEyOyBpKyspIHsNCiAgICAgICAgLy8gbWFrZSB0aGUgcmVnZXggaWYgd2UgZG9uJ3QgaGF2ZSBpdCBhbHJlYWR5DQogICAgICAgIG1vbSA9IGNyZWF0ZVVUQyhbMjAwMCwgaV0pOw0KICAgICAgICBpZiAoc3RyaWN0ICYmICF0aGlzLl9sb25nTW9udGhzUGFyc2VbaV0pIHsNCiAgICAgICAgICAgIHRoaXMuX2xvbmdNb250aHNQYXJzZVtpXSA9IG5ldyBSZWdFeHAoJ14nICsgdGhpcy5tb250aHMobW9tLCAnJykucmVwbGFjZSgnLicsICcnKSArICckJywgJ2knKTsNCiAgICAgICAgICAgIHRoaXMuX3Nob3J0TW9udGhzUGFyc2VbaV0gPSBuZXcgUmVnRXhwKCdeJyArIHRoaXMubW9udGhzU2hvcnQobW9tLCAnJykucmVwbGFjZSgnLicsICcnKSArICckJywgJ2knKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoIXN0cmljdCAmJiAhdGhpcy5fbW9udGhzUGFyc2VbaV0pIHsNCiAgICAgICAgICAgIHJlZ2V4ID0gJ14nICsgdGhpcy5tb250aHMobW9tLCAnJykgKyAnfF4nICsgdGhpcy5tb250aHNTaG9ydChtb20sICcnKTsNCiAgICAgICAgICAgIHRoaXMuX21vbnRoc1BhcnNlW2ldID0gbmV3IFJlZ0V4cChyZWdleC5yZXBsYWNlKCcuJywgJycpLCAnaScpOw0KICAgICAgICB9DQogICAgICAgIC8vIHRlc3QgdGhlIHJlZ2V4DQogICAgICAgIGlmIChzdHJpY3QgJiYgZm9ybWF0ID09PSAnTU1NTScgJiYgdGhpcy5fbG9uZ01vbnRoc1BhcnNlW2ldLnRlc3QobW9udGhOYW1lKSkgew0KICAgICAgICAgICAgcmV0dXJuIGk7DQogICAgICAgIH0gZWxzZSBpZiAoc3RyaWN0ICYmIGZvcm1hdCA9PT0gJ01NTScgJiYgdGhpcy5fc2hvcnRNb250aHNQYXJzZVtpXS50ZXN0KG1vbnRoTmFtZSkpIHsNCiAgICAgICAgICAgIHJldHVybiBpOw0KICAgICAgICB9IGVsc2UgaWYgKCFzdHJpY3QgJiYgdGhpcy5fbW9udGhzUGFyc2VbaV0udGVzdChtb250aE5hbWUpKSB7DQogICAgICAgICAgICByZXR1cm4gaTsNCiAgICAgICAgfQ0KICAgIH0NCn0NCg0KLy8gTU9NRU5UUw0KDQpmdW5jdGlvbiBzZXRNb250aCAobW9tLCB2YWx1ZSkgew0KICAgIHZhciBkYXlPZk1vbnRoOw0KDQogICAgaWYgKCFtb20uaXNWYWxpZCgpKSB7DQogICAgICAgIC8vIE5vIG9wDQogICAgICAgIHJldHVybiBtb207DQogICAgfQ0KDQogICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHsNCiAgICAgICAgaWYgKC9eXGQrJC8udGVzdCh2YWx1ZSkpIHsNCiAgICAgICAgICAgIHZhbHVlID0gdG9JbnQodmFsdWUpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgdmFsdWUgPSBtb20ubG9jYWxlRGF0YSgpLm1vbnRoc1BhcnNlKHZhbHVlKTsNCiAgICAgICAgICAgIC8vIFRPRE86IEFub3RoZXIgc2lsZW50IGZhaWx1cmU/DQogICAgICAgICAgICBpZiAoIWlzTnVtYmVyKHZhbHVlKSkgew0KICAgICAgICAgICAgICAgIHJldHVybiBtb207DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBkYXlPZk1vbnRoID0gTWF0aC5taW4obW9tLmRhdGUoKSwgZGF5c0luTW9udGgobW9tLnllYXIoKSwgdmFsdWUpKTsNCiAgICBtb20uX2RbJ3NldCcgKyAobW9tLl9pc1VUQyA/ICdVVEMnIDogJycpICsgJ01vbnRoJ10odmFsdWUsIGRheU9mTW9udGgpOw0KICAgIHJldHVybiBtb207DQp9DQoNCmZ1bmN0aW9uIGdldFNldE1vbnRoICh2YWx1ZSkgew0KICAgIGlmICh2YWx1ZSAhPSBudWxsKSB7DQogICAgICAgIHNldE1vbnRoKHRoaXMsIHZhbHVlKTsNCiAgICAgICAgaG9va3MudXBkYXRlT2Zmc2V0KHRoaXMsIHRydWUpOw0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICB9IGVsc2Ugew0KICAgICAgICByZXR1cm4gZ2V0KHRoaXMsICdNb250aCcpOw0KICAgIH0NCn0NCg0KZnVuY3Rpb24gZ2V0RGF5c0luTW9udGggKCkgew0KICAgIHJldHVybiBkYXlzSW5Nb250aCh0aGlzLnllYXIoKSwgdGhpcy5tb250aCgpKTsNCn0NCg0KdmFyIGRlZmF1bHRNb250aHNTaG9ydFJlZ2V4ID0gbWF0Y2hXb3JkOw0KZnVuY3Rpb24gbW9udGhzU2hvcnRSZWdleCAoaXNTdHJpY3QpIHsNCiAgICBpZiAodGhpcy5fbW9udGhzUGFyc2VFeGFjdCkgew0KICAgICAgICBpZiAoIWhhc093blByb3AodGhpcywgJ19tb250aHNSZWdleCcpKSB7DQogICAgICAgICAgICBjb21wdXRlTW9udGhzUGFyc2UuY2FsbCh0aGlzKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoaXNTdHJpY3QpIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLl9tb250aHNTaG9ydFN0cmljdFJlZ2V4Ow0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuX21vbnRoc1Nob3J0UmVnZXg7DQogICAgICAgIH0NCiAgICB9IGVsc2Ugew0KICAgICAgICBpZiAoIWhhc093blByb3AodGhpcywgJ19tb250aHNTaG9ydFJlZ2V4JykpIHsNCiAgICAgICAgICAgIHRoaXMuX21vbnRoc1Nob3J0UmVnZXggPSBkZWZhdWx0TW9udGhzU2hvcnRSZWdleDsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdGhpcy5fbW9udGhzU2hvcnRTdHJpY3RSZWdleCAmJiBpc1N0cmljdCA/DQogICAgICAgICAgICB0aGlzLl9tb250aHNTaG9ydFN0cmljdFJlZ2V4IDogdGhpcy5fbW9udGhzU2hvcnRSZWdleDsNCiAgICB9DQp9DQoNCnZhciBkZWZhdWx0TW9udGhzUmVnZXggPSBtYXRjaFdvcmQ7DQpmdW5jdGlvbiBtb250aHNSZWdleCAoaXNTdHJpY3QpIHsNCiAgICBpZiAodGhpcy5fbW9udGhzUGFyc2VFeGFjdCkgew0KICAgICAgICBpZiAoIWhhc093blByb3AodGhpcywgJ19tb250aHNSZWdleCcpKSB7DQogICAgICAgICAgICBjb21wdXRlTW9udGhzUGFyc2UuY2FsbCh0aGlzKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoaXNTdHJpY3QpIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLl9tb250aHNTdHJpY3RSZWdleDsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLl9tb250aHNSZWdleDsNCiAgICAgICAgfQ0KICAgIH0gZWxzZSB7DQogICAgICAgIGlmICghaGFzT3duUHJvcCh0aGlzLCAnX21vbnRoc1JlZ2V4JykpIHsNCiAgICAgICAgICAgIHRoaXMuX21vbnRoc1JlZ2V4ID0gZGVmYXVsdE1vbnRoc1JlZ2V4Ow0KICAgICAgICB9DQogICAgICAgIHJldHVybiB0aGlzLl9tb250aHNTdHJpY3RSZWdleCAmJiBpc1N0cmljdCA/DQogICAgICAgICAgICB0aGlzLl9tb250aHNTdHJpY3RSZWdleCA6IHRoaXMuX21vbnRoc1JlZ2V4Ow0KICAgIH0NCn0NCg0KZnVuY3Rpb24gY29tcHV0ZU1vbnRoc1BhcnNlICgpIHsNCiAgICBmdW5jdGlvbiBjbXBMZW5SZXYoYSwgYikgew0KICAgICAgICByZXR1cm4gYi5sZW5ndGggLSBhLmxlbmd0aDsNCiAgICB9DQoNCiAgICB2YXIgc2hvcnRQaWVjZXMgPSBbXSwgbG9uZ1BpZWNlcyA9IFtdLCBtaXhlZFBpZWNlcyA9IFtdLA0KICAgICAgICBpLCBtb207DQogICAgZm9yIChpID0gMDsgaSA8IDEyOyBpKyspIHsNCiAgICAgICAgLy8gbWFrZSB0aGUgcmVnZXggaWYgd2UgZG9uJ3QgaGF2ZSBpdCBhbHJlYWR5DQogICAgICAgIG1vbSA9IGNyZWF0ZVVUQyhbMjAwMCwgaV0pOw0KICAgICAgICBzaG9ydFBpZWNlcy5wdXNoKHRoaXMubW9udGhzU2hvcnQobW9tLCAnJykpOw0KICAgICAgICBsb25nUGllY2VzLnB1c2godGhpcy5tb250aHMobW9tLCAnJykpOw0KICAgICAgICBtaXhlZFBpZWNlcy5wdXNoKHRoaXMubW9udGhzKG1vbSwgJycpKTsNCiAgICAgICAgbWl4ZWRQaWVjZXMucHVzaCh0aGlzLm1vbnRoc1Nob3J0KG1vbSwgJycpKTsNCiAgICB9DQogICAgLy8gU29ydGluZyBtYWtlcyBzdXJlIGlmIG9uZSBtb250aCAob3IgYWJicikgaXMgYSBwcmVmaXggb2YgYW5vdGhlciBpdA0KICAgIC8vIHdpbGwgbWF0Y2ggdGhlIGxvbmdlciBwaWVjZS4NCiAgICBzaG9ydFBpZWNlcy5zb3J0KGNtcExlblJldik7DQogICAgbG9uZ1BpZWNlcy5zb3J0KGNtcExlblJldik7DQogICAgbWl4ZWRQaWVjZXMuc29ydChjbXBMZW5SZXYpOw0KICAgIGZvciAoaSA9IDA7IGkgPCAxMjsgaSsrKSB7DQogICAgICAgIHNob3J0UGllY2VzW2ldID0gcmVnZXhFc2NhcGUoc2hvcnRQaWVjZXNbaV0pOw0KICAgICAgICBsb25nUGllY2VzW2ldID0gcmVnZXhFc2NhcGUobG9uZ1BpZWNlc1tpXSk7DQogICAgfQ0KICAgIGZvciAoaSA9IDA7IGkgPCAyNDsgaSsrKSB7DQogICAgICAgIG1peGVkUGllY2VzW2ldID0gcmVnZXhFc2NhcGUobWl4ZWRQaWVjZXNbaV0pOw0KICAgIH0NCg0KICAgIHRoaXMuX21vbnRoc1JlZ2V4ID0gbmV3IFJlZ0V4cCgnXignICsgbWl4ZWRQaWVjZXMuam9pbignfCcpICsgJyknLCAnaScpOw0KICAgIHRoaXMuX21vbnRoc1Nob3J0UmVnZXggPSB0aGlzLl9tb250aHNSZWdleDsNCiAgICB0aGlzLl9tb250aHNTdHJpY3RSZWdleCA9IG5ldyBSZWdFeHAoJ14oJyArIGxvbmdQaWVjZXMuam9pbignfCcpICsgJyknLCAnaScpOw0KICAgIHRoaXMuX21vbnRoc1Nob3J0U3RyaWN0UmVnZXggPSBuZXcgUmVnRXhwKCdeKCcgKyBzaG9ydFBpZWNlcy5qb2luKCd8JykgKyAnKScsICdpJyk7DQp9DQoNCi8vIEZPUk1BVFRJTkcNCg0KYWRkRm9ybWF0VG9rZW4oJ1knLCAwLCAwLCBmdW5jdGlvbiAoKSB7DQogICAgdmFyIHkgPSB0aGlzLnllYXIoKTsNCiAgICByZXR1cm4geSA8PSA5OTk5ID8gJycgKyB5IDogJysnICsgeTsNCn0pOw0KDQphZGRGb3JtYXRUb2tlbigwLCBbJ1lZJywgMl0sIDAsIGZ1bmN0aW9uICgpIHsNCiAgICByZXR1cm4gdGhpcy55ZWFyKCkgJSAxMDA7DQp9KTsNCg0KYWRkRm9ybWF0VG9rZW4oMCwgWydZWVlZJywgICA0XSwgICAgICAgMCwgJ3llYXInKTsNCmFkZEZvcm1hdFRva2VuKDAsIFsnWVlZWVknLCAgNV0sICAgICAgIDAsICd5ZWFyJyk7DQphZGRGb3JtYXRUb2tlbigwLCBbJ1lZWVlZWScsIDYsIHRydWVdLCAwLCAneWVhcicpOw0KDQovLyBBTElBU0VTDQoNCmFkZFVuaXRBbGlhcygneWVhcicsICd5Jyk7DQoNCi8vIFBSSU9SSVRJRVMNCg0KYWRkVW5pdFByaW9yaXR5KCd5ZWFyJywgMSk7DQoNCi8vIFBBUlNJTkcNCg0KYWRkUmVnZXhUb2tlbignWScsICAgICAgbWF0Y2hTaWduZWQpOw0KYWRkUmVnZXhUb2tlbignWVknLCAgICAgbWF0Y2gxdG8yLCBtYXRjaDIpOw0KYWRkUmVnZXhUb2tlbignWVlZWScsICAgbWF0Y2gxdG80LCBtYXRjaDQpOw0KYWRkUmVnZXhUb2tlbignWVlZWVknLCAgbWF0Y2gxdG82LCBtYXRjaDYpOw0KYWRkUmVnZXhUb2tlbignWVlZWVlZJywgbWF0Y2gxdG82LCBtYXRjaDYpOw0KDQphZGRQYXJzZVRva2VuKFsnWVlZWVknLCAnWVlZWVlZJ10sIFlFQVIpOw0KYWRkUGFyc2VUb2tlbignWVlZWScsIGZ1bmN0aW9uIChpbnB1dCwgYXJyYXkpIHsNCiAgICBhcnJheVtZRUFSXSA9IGlucHV0Lmxlbmd0aCA9PT0gMiA/IGhvb2tzLnBhcnNlVHdvRGlnaXRZZWFyKGlucHV0KSA6IHRvSW50KGlucHV0KTsNCn0pOw0KYWRkUGFyc2VUb2tlbignWVknLCBmdW5jdGlvbiAoaW5wdXQsIGFycmF5KSB7DQogICAgYXJyYXlbWUVBUl0gPSBob29rcy5wYXJzZVR3b0RpZ2l0WWVhcihpbnB1dCk7DQp9KTsNCmFkZFBhcnNlVG9rZW4oJ1knLCBmdW5jdGlvbiAoaW5wdXQsIGFycmF5KSB7DQogICAgYXJyYXlbWUVBUl0gPSBwYXJzZUludChpbnB1dCwgMTApOw0KfSk7DQoNCi8vIEhFTFBFUlMNCg0KZnVuY3Rpb24gZGF5c0luWWVhcih5ZWFyKSB7DQogICAgcmV0dXJuIGlzTGVhcFllYXIoeWVhcikgPyAzNjYgOiAzNjU7DQp9DQoNCmZ1bmN0aW9uIGlzTGVhcFllYXIoeWVhcikgew0KICAgIHJldHVybiAoeWVhciAlIDQgPT09IDAgJiYgeWVhciAlIDEwMCAhPT0gMCkgfHwgeWVhciAlIDQwMCA9PT0gMDsNCn0NCg0KLy8gSE9PS1MNCg0KaG9va3MucGFyc2VUd29EaWdpdFllYXIgPSBmdW5jdGlvbiAoaW5wdXQpIHsNCiAgICByZXR1cm4gdG9JbnQoaW5wdXQpICsgKHRvSW50KGlucHV0KSA+IDY4ID8gMTkwMCA6IDIwMDApOw0KfTsNCg0KLy8gTU9NRU5UUw0KDQp2YXIgZ2V0U2V0WWVhciA9IG1ha2VHZXRTZXQoJ0Z1bGxZZWFyJywgdHJ1ZSk7DQoNCmZ1bmN0aW9uIGdldElzTGVhcFllYXIgKCkgew0KICAgIHJldHVybiBpc0xlYXBZZWFyKHRoaXMueWVhcigpKTsNCn0NCg0KZnVuY3Rpb24gY3JlYXRlRGF0ZSAoeSwgbSwgZCwgaCwgTSwgcywgbXMpIHsNCiAgICAvLyBjYW4ndCBqdXN0IGFwcGx5KCkgdG8gY3JlYXRlIGEgZGF0ZToNCiAgICAvLyBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL3EvMTgxMzQ4DQogICAgdmFyIGRhdGUgPSBuZXcgRGF0ZSh5LCBtLCBkLCBoLCBNLCBzLCBtcyk7DQoNCiAgICAvLyB0aGUgZGF0ZSBjb25zdHJ1Y3RvciByZW1hcHMgeWVhcnMgMC05OSB0byAxOTAwLTE5OTkNCiAgICBpZiAoeSA8IDEwMCAmJiB5ID49IDAgJiYgaXNGaW5pdGUoZGF0ZS5nZXRGdWxsWWVhcigpKSkgew0KICAgICAgICBkYXRlLnNldEZ1bGxZZWFyKHkpOw0KICAgIH0NCiAgICByZXR1cm4gZGF0ZTsNCn0NCg0KZnVuY3Rpb24gY3JlYXRlVVRDRGF0ZSAoeSkgew0KICAgIHZhciBkYXRlID0gbmV3IERhdGUoRGF0ZS5VVEMuYXBwbHkobnVsbCwgYXJndW1lbnRzKSk7DQoNCiAgICAvLyB0aGUgRGF0ZS5VVEMgZnVuY3Rpb24gcmVtYXBzIHllYXJzIDAtOTkgdG8gMTkwMC0xOTk5DQogICAgaWYgKHkgPCAxMDAgJiYgeSA+PSAwICYmIGlzRmluaXRlKGRhdGUuZ2V0VVRDRnVsbFllYXIoKSkpIHsNCiAgICAgICAgZGF0ZS5zZXRVVENGdWxsWWVhcih5KTsNCiAgICB9DQogICAgcmV0dXJuIGRhdGU7DQp9DQoNCi8vIHN0YXJ0LW9mLWZpcnN0LXdlZWsgLSBzdGFydC1vZi15ZWFyDQpmdW5jdGlvbiBmaXJzdFdlZWtPZmZzZXQoeWVhciwgZG93LCBkb3kpIHsNCiAgICB2YXIgLy8gZmlyc3Qtd2VlayBkYXkgLS0gd2hpY2ggamFudWFyeSBpcyBhbHdheXMgaW4gdGhlIGZpcnN0IHdlZWsgKDQgZm9yIGlzbywgMSBmb3Igb3RoZXIpDQogICAgICAgIGZ3ZCA9IDcgKyBkb3cgLSBkb3ksDQogICAgICAgIC8vIGZpcnN0LXdlZWsgZGF5IGxvY2FsIHdlZWtkYXkgLS0gd2hpY2ggbG9jYWwgd2Vla2RheSBpcyBmd2QNCiAgICAgICAgZndkbHcgPSAoNyArIGNyZWF0ZVVUQ0RhdGUoeWVhciwgMCwgZndkKS5nZXRVVENEYXkoKSAtIGRvdykgJSA3Ow0KDQogICAgcmV0dXJuIC1md2RsdyArIGZ3ZCAtIDE7DQp9DQoNCi8vIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0lTT193ZWVrX2RhdGUjQ2FsY3VsYXRpbmdfYV9kYXRlX2dpdmVuX3RoZV95ZWFyLjJDX3dlZWtfbnVtYmVyX2FuZF93ZWVrZGF5DQpmdW5jdGlvbiBkYXlPZlllYXJGcm9tV2Vla3MoeWVhciwgd2Vlaywgd2Vla2RheSwgZG93LCBkb3kpIHsNCiAgICB2YXIgbG9jYWxXZWVrZGF5ID0gKDcgKyB3ZWVrZGF5IC0gZG93KSAlIDcsDQogICAgICAgIHdlZWtPZmZzZXQgPSBmaXJzdFdlZWtPZmZzZXQoeWVhciwgZG93LCBkb3kpLA0KICAgICAgICBkYXlPZlllYXIgPSAxICsgNyAqICh3ZWVrIC0gMSkgKyBsb2NhbFdlZWtkYXkgKyB3ZWVrT2Zmc2V0LA0KICAgICAgICByZXNZZWFyLCByZXNEYXlPZlllYXI7DQoNCiAgICBpZiAoZGF5T2ZZZWFyIDw9IDApIHsNCiAgICAgICAgcmVzWWVhciA9IHllYXIgLSAxOw0KICAgICAgICByZXNEYXlPZlllYXIgPSBkYXlzSW5ZZWFyKHJlc1llYXIpICsgZGF5T2ZZZWFyOw0KICAgIH0gZWxzZSBpZiAoZGF5T2ZZZWFyID4gZGF5c0luWWVhcih5ZWFyKSkgew0KICAgICAgICByZXNZZWFyID0geWVhciArIDE7DQogICAgICAgIHJlc0RheU9mWWVhciA9IGRheU9mWWVhciAtIGRheXNJblllYXIoeWVhcik7DQogICAgfSBlbHNlIHsNCiAgICAgICAgcmVzWWVhciA9IHllYXI7DQogICAgICAgIHJlc0RheU9mWWVhciA9IGRheU9mWWVhcjsNCiAgICB9DQoNCiAgICByZXR1cm4gew0KICAgICAgICB5ZWFyOiByZXNZZWFyLA0KICAgICAgICBkYXlPZlllYXI6IHJlc0RheU9mWWVhcg0KICAgIH07DQp9DQoNCmZ1bmN0aW9uIHdlZWtPZlllYXIobW9tLCBkb3csIGRveSkgew0KICAgIHZhciB3ZWVrT2Zmc2V0ID0gZmlyc3RXZWVrT2Zmc2V0KG1vbS55ZWFyKCksIGRvdywgZG95KSwNCiAgICAgICAgd2VlayA9IE1hdGguZmxvb3IoKG1vbS5kYXlPZlllYXIoKSAtIHdlZWtPZmZzZXQgLSAxKSAvIDcpICsgMSwNCiAgICAgICAgcmVzV2VlaywgcmVzWWVhcjsNCg0KICAgIGlmICh3ZWVrIDwgMSkgew0KICAgICAgICByZXNZZWFyID0gbW9tLnllYXIoKSAtIDE7DQogICAgICAgIHJlc1dlZWsgPSB3ZWVrICsgd2Vla3NJblllYXIocmVzWWVhciwgZG93LCBkb3kpOw0KICAgIH0gZWxzZSBpZiAod2VlayA+IHdlZWtzSW5ZZWFyKG1vbS55ZWFyKCksIGRvdywgZG95KSkgew0KICAgICAgICByZXNXZWVrID0gd2VlayAtIHdlZWtzSW5ZZWFyKG1vbS55ZWFyKCksIGRvdywgZG95KTsNCiAgICAgICAgcmVzWWVhciA9IG1vbS55ZWFyKCkgKyAxOw0KICAgIH0gZWxzZSB7DQogICAgICAgIHJlc1llYXIgPSBtb20ueWVhcigpOw0KICAgICAgICByZXNXZWVrID0gd2VlazsNCiAgICB9DQoNCiAgICByZXR1cm4gew0KICAgICAgICB3ZWVrOiByZXNXZWVrLA0KICAgICAgICB5ZWFyOiByZXNZZWFyDQogICAgfTsNCn0NCg0KZnVuY3Rpb24gd2Vla3NJblllYXIoeWVhciwgZG93LCBkb3kpIHsNCiAgICB2YXIgd2Vla09mZnNldCA9IGZpcnN0V2Vla09mZnNldCh5ZWFyLCBkb3csIGRveSksDQogICAgICAgIHdlZWtPZmZzZXROZXh0ID0gZmlyc3RXZWVrT2Zmc2V0KHllYXIgKyAxLCBkb3csIGRveSk7DQogICAgcmV0dXJuIChkYXlzSW5ZZWFyKHllYXIpIC0gd2Vla09mZnNldCArIHdlZWtPZmZzZXROZXh0KSAvIDc7DQp9DQoNCi8vIEZPUk1BVFRJTkcNCg0KYWRkRm9ybWF0VG9rZW4oJ3cnLCBbJ3d3JywgMl0sICd3bycsICd3ZWVrJyk7DQphZGRGb3JtYXRUb2tlbignVycsIFsnV1cnLCAyXSwgJ1dvJywgJ2lzb1dlZWsnKTsNCg0KLy8gQUxJQVNFUw0KDQphZGRVbml0QWxpYXMoJ3dlZWsnLCAndycpOw0KYWRkVW5pdEFsaWFzKCdpc29XZWVrJywgJ1cnKTsNCg0KLy8gUFJJT1JJVElFUw0KDQphZGRVbml0UHJpb3JpdHkoJ3dlZWsnLCA1KTsNCmFkZFVuaXRQcmlvcml0eSgnaXNvV2VlaycsIDUpOw0KDQovLyBQQVJTSU5HDQoNCmFkZFJlZ2V4VG9rZW4oJ3cnLCAgbWF0Y2gxdG8yKTsNCmFkZFJlZ2V4VG9rZW4oJ3d3JywgbWF0Y2gxdG8yLCBtYXRjaDIpOw0KYWRkUmVnZXhUb2tlbignVycsICBtYXRjaDF0bzIpOw0KYWRkUmVnZXhUb2tlbignV1cnLCBtYXRjaDF0bzIsIG1hdGNoMik7DQoNCmFkZFdlZWtQYXJzZVRva2VuKFsndycsICd3dycsICdXJywgJ1dXJ10sIGZ1bmN0aW9uIChpbnB1dCwgd2VlaywgY29uZmlnLCB0b2tlbikgew0KICAgIHdlZWtbdG9rZW4uc3Vic3RyKDAsIDEpXSA9IHRvSW50KGlucHV0KTsNCn0pOw0KDQovLyBIRUxQRVJTDQoNCi8vIExPQ0FMRVMNCg0KZnVuY3Rpb24gbG9jYWxlV2VlayAobW9tKSB7DQogICAgcmV0dXJuIHdlZWtPZlllYXIobW9tLCB0aGlzLl93ZWVrLmRvdywgdGhpcy5fd2Vlay5kb3kpLndlZWs7DQp9DQoNCnZhciBkZWZhdWx0TG9jYWxlV2VlayA9IHsNCiAgICBkb3cgOiAwLCAvLyBTdW5kYXkgaXMgdGhlIGZpcnN0IGRheSBvZiB0aGUgd2Vlay4NCiAgICBkb3kgOiA2ICAvLyBUaGUgd2VlayB0aGF0IGNvbnRhaW5zIEphbiAxc3QgaXMgdGhlIGZpcnN0IHdlZWsgb2YgdGhlIHllYXIuDQp9Ow0KDQpmdW5jdGlvbiBsb2NhbGVGaXJzdERheU9mV2VlayAoKSB7DQogICAgcmV0dXJuIHRoaXMuX3dlZWsuZG93Ow0KfQ0KDQpmdW5jdGlvbiBsb2NhbGVGaXJzdERheU9mWWVhciAoKSB7DQogICAgcmV0dXJuIHRoaXMuX3dlZWsuZG95Ow0KfQ0KDQovLyBNT01FTlRTDQoNCmZ1bmN0aW9uIGdldFNldFdlZWsgKGlucHV0KSB7DQogICAgdmFyIHdlZWsgPSB0aGlzLmxvY2FsZURhdGEoKS53ZWVrKHRoaXMpOw0KICAgIHJldHVybiBpbnB1dCA9PSBudWxsID8gd2VlayA6IHRoaXMuYWRkKChpbnB1dCAtIHdlZWspICogNywgJ2QnKTsNCn0NCg0KZnVuY3Rpb24gZ2V0U2V0SVNPV2VlayAoaW5wdXQpIHsNCiAgICB2YXIgd2VlayA9IHdlZWtPZlllYXIodGhpcywgMSwgNCkud2VlazsNCiAgICByZXR1cm4gaW5wdXQgPT0gbnVsbCA/IHdlZWsgOiB0aGlzLmFkZCgoaW5wdXQgLSB3ZWVrKSAqIDcsICdkJyk7DQp9DQoNCi8vIEZPUk1BVFRJTkcNCg0KYWRkRm9ybWF0VG9rZW4oJ2QnLCAwLCAnZG8nLCAnZGF5Jyk7DQoNCmFkZEZvcm1hdFRva2VuKCdkZCcsIDAsIDAsIGZ1bmN0aW9uIChmb3JtYXQpIHsNCiAgICByZXR1cm4gdGhpcy5sb2NhbGVEYXRhKCkud2Vla2RheXNNaW4odGhpcywgZm9ybWF0KTsNCn0pOw0KDQphZGRGb3JtYXRUb2tlbignZGRkJywgMCwgMCwgZnVuY3Rpb24gKGZvcm1hdCkgew0KICAgIHJldHVybiB0aGlzLmxvY2FsZURhdGEoKS53ZWVrZGF5c1Nob3J0KHRoaXMsIGZvcm1hdCk7DQp9KTsNCg0KYWRkRm9ybWF0VG9rZW4oJ2RkZGQnLCAwLCAwLCBmdW5jdGlvbiAoZm9ybWF0KSB7DQogICAgcmV0dXJuIHRoaXMubG9jYWxlRGF0YSgpLndlZWtkYXlzKHRoaXMsIGZvcm1hdCk7DQp9KTsNCg0KYWRkRm9ybWF0VG9rZW4oJ2UnLCAwLCAwLCAnd2Vla2RheScpOw0KYWRkRm9ybWF0VG9rZW4oJ0UnLCAwLCAwLCAnaXNvV2Vla2RheScpOw0KDQovLyBBTElBU0VTDQoNCmFkZFVuaXRBbGlhcygnZGF5JywgJ2QnKTsNCmFkZFVuaXRBbGlhcygnd2Vla2RheScsICdlJyk7DQphZGRVbml0QWxpYXMoJ2lzb1dlZWtkYXknLCAnRScpOw0KDQovLyBQUklPUklUWQ0KYWRkVW5pdFByaW9yaXR5KCdkYXknLCAxMSk7DQphZGRVbml0UHJpb3JpdHkoJ3dlZWtkYXknLCAxMSk7DQphZGRVbml0UHJpb3JpdHkoJ2lzb1dlZWtkYXknLCAxMSk7DQoNCi8vIFBBUlNJTkcNCg0KYWRkUmVnZXhUb2tlbignZCcsICAgIG1hdGNoMXRvMik7DQphZGRSZWdleFRva2VuKCdlJywgICAgbWF0Y2gxdG8yKTsNCmFkZFJlZ2V4VG9rZW4oJ0UnLCAgICBtYXRjaDF0bzIpOw0KYWRkUmVnZXhUb2tlbignZGQnLCAgIGZ1bmN0aW9uIChpc1N0cmljdCwgbG9jYWxlKSB7DQogICAgcmV0dXJuIGxvY2FsZS53ZWVrZGF5c01pblJlZ2V4KGlzU3RyaWN0KTsNCn0pOw0KYWRkUmVnZXhUb2tlbignZGRkJywgICBmdW5jdGlvbiAoaXNTdHJpY3QsIGxvY2FsZSkgew0KICAgIHJldHVybiBsb2NhbGUud2Vla2RheXNTaG9ydFJlZ2V4KGlzU3RyaWN0KTsNCn0pOw0KYWRkUmVnZXhUb2tlbignZGRkZCcsICAgZnVuY3Rpb24gKGlzU3RyaWN0LCBsb2NhbGUpIHsNCiAgICByZXR1cm4gbG9jYWxlLndlZWtkYXlzUmVnZXgoaXNTdHJpY3QpOw0KfSk7DQoNCmFkZFdlZWtQYXJzZVRva2VuKFsnZGQnLCAnZGRkJywgJ2RkZGQnXSwgZnVuY3Rpb24gKGlucHV0LCB3ZWVrLCBjb25maWcsIHRva2VuKSB7DQogICAgdmFyIHdlZWtkYXkgPSBjb25maWcuX2xvY2FsZS53ZWVrZGF5c1BhcnNlKGlucHV0LCB0b2tlbiwgY29uZmlnLl9zdHJpY3QpOw0KICAgIC8vIGlmIHdlIGRpZG4ndCBnZXQgYSB3ZWVrZGF5IG5hbWUsIG1hcmsgdGhlIGRhdGUgYXMgaW52YWxpZA0KICAgIGlmICh3ZWVrZGF5ICE9IG51bGwpIHsNCiAgICAgICAgd2Vlay5kID0gd2Vla2RheTsNCiAgICB9IGVsc2Ugew0KICAgICAgICBnZXRQYXJzaW5nRmxhZ3MoY29uZmlnKS5pbnZhbGlkV2Vla2RheSA9IGlucHV0Ow0KICAgIH0NCn0pOw0KDQphZGRXZWVrUGFyc2VUb2tlbihbJ2QnLCAnZScsICdFJ10sIGZ1bmN0aW9uIChpbnB1dCwgd2VlaywgY29uZmlnLCB0b2tlbikgew0KICAgIHdlZWtbdG9rZW5dID0gdG9JbnQoaW5wdXQpOw0KfSk7DQoNCi8vIEhFTFBFUlMNCg0KZnVuY3Rpb24gcGFyc2VXZWVrZGF5KGlucHV0LCBsb2NhbGUpIHsNCiAgICBpZiAodHlwZW9mIGlucHV0ICE9PSAnc3RyaW5nJykgew0KICAgICAgICByZXR1cm4gaW5wdXQ7DQogICAgfQ0KDQogICAgaWYgKCFpc05hTihpbnB1dCkpIHsNCiAgICAgICAgcmV0dXJuIHBhcnNlSW50KGlucHV0LCAxMCk7DQogICAgfQ0KDQogICAgaW5wdXQgPSBsb2NhbGUud2Vla2RheXNQYXJzZShpbnB1dCk7DQogICAgaWYgKHR5cGVvZiBpbnB1dCA9PT0gJ251bWJlcicpIHsNCiAgICAgICAgcmV0dXJuIGlucHV0Ow0KICAgIH0NCg0KICAgIHJldHVybiBudWxsOw0KfQ0KDQpmdW5jdGlvbiBwYXJzZUlzb1dlZWtkYXkoaW5wdXQsIGxvY2FsZSkgew0KICAgIGlmICh0eXBlb2YgaW5wdXQgPT09ICdzdHJpbmcnKSB7DQogICAgICAgIHJldHVybiBsb2NhbGUud2Vla2RheXNQYXJzZShpbnB1dCkgJSA3IHx8IDc7DQogICAgfQ0KICAgIHJldHVybiBpc05hTihpbnB1dCkgPyBudWxsIDogaW5wdXQ7DQp9DQoNCi8vIExPQ0FMRVMNCg0KdmFyIGRlZmF1bHRMb2NhbGVXZWVrZGF5cyA9ICdTdW5kYXlfTW9uZGF5X1R1ZXNkYXlfV2VkbmVzZGF5X1RodXJzZGF5X0ZyaWRheV9TYXR1cmRheScuc3BsaXQoJ18nKTsNCmZ1bmN0aW9uIGxvY2FsZVdlZWtkYXlzIChtLCBmb3JtYXQpIHsNCiAgICBpZiAoIW0pIHsNCiAgICAgICAgcmV0dXJuIGlzQXJyYXkodGhpcy5fd2Vla2RheXMpID8gdGhpcy5fd2Vla2RheXMgOg0KICAgICAgICAgICAgdGhpcy5fd2Vla2RheXNbJ3N0YW5kYWxvbmUnXTsNCiAgICB9DQogICAgcmV0dXJuIGlzQXJyYXkodGhpcy5fd2Vla2RheXMpID8gdGhpcy5fd2Vla2RheXNbbS5kYXkoKV0gOg0KICAgICAgICB0aGlzLl93ZWVrZGF5c1t0aGlzLl93ZWVrZGF5cy5pc0Zvcm1hdC50ZXN0KGZvcm1hdCkgPyAnZm9ybWF0JyA6ICdzdGFuZGFsb25lJ11bbS5kYXkoKV07DQp9DQoNCnZhciBkZWZhdWx0TG9jYWxlV2Vla2RheXNTaG9ydCA9ICdTdW5fTW9uX1R1ZV9XZWRfVGh1X0ZyaV9TYXQnLnNwbGl0KCdfJyk7DQpmdW5jdGlvbiBsb2NhbGVXZWVrZGF5c1Nob3J0IChtKSB7DQogICAgcmV0dXJuIChtKSA/IHRoaXMuX3dlZWtkYXlzU2hvcnRbbS5kYXkoKV0gOiB0aGlzLl93ZWVrZGF5c1Nob3J0Ow0KfQ0KDQp2YXIgZGVmYXVsdExvY2FsZVdlZWtkYXlzTWluID0gJ1N1X01vX1R1X1dlX1RoX0ZyX1NhJy5zcGxpdCgnXycpOw0KZnVuY3Rpb24gbG9jYWxlV2Vla2RheXNNaW4gKG0pIHsNCiAgICByZXR1cm4gKG0pID8gdGhpcy5fd2Vla2RheXNNaW5bbS5kYXkoKV0gOiB0aGlzLl93ZWVrZGF5c01pbjsNCn0NCg0KZnVuY3Rpb24gaGFuZGxlU3RyaWN0UGFyc2UkMSh3ZWVrZGF5TmFtZSwgZm9ybWF0LCBzdHJpY3QpIHsNCiAgICB2YXIgaSwgaWksIG1vbSwgbGxjID0gd2Vla2RheU5hbWUudG9Mb2NhbGVMb3dlckNhc2UoKTsNCiAgICBpZiAoIXRoaXMuX3dlZWtkYXlzUGFyc2UpIHsNCiAgICAgICAgdGhpcy5fd2Vla2RheXNQYXJzZSA9IFtdOw0KICAgICAgICB0aGlzLl9zaG9ydFdlZWtkYXlzUGFyc2UgPSBbXTsNCiAgICAgICAgdGhpcy5fbWluV2Vla2RheXNQYXJzZSA9IFtdOw0KDQogICAgICAgIGZvciAoaSA9IDA7IGkgPCA3OyArK2kpIHsNCiAgICAgICAgICAgIG1vbSA9IGNyZWF0ZVVUQyhbMjAwMCwgMV0pLmRheShpKTsNCiAgICAgICAgICAgIHRoaXMuX21pbldlZWtkYXlzUGFyc2VbaV0gPSB0aGlzLndlZWtkYXlzTWluKG1vbSwgJycpLnRvTG9jYWxlTG93ZXJDYXNlKCk7DQogICAgICAgICAgICB0aGlzLl9zaG9ydFdlZWtkYXlzUGFyc2VbaV0gPSB0aGlzLndlZWtkYXlzU2hvcnQobW9tLCAnJykudG9Mb2NhbGVMb3dlckNhc2UoKTsNCiAgICAgICAgICAgIHRoaXMuX3dlZWtkYXlzUGFyc2VbaV0gPSB0aGlzLndlZWtkYXlzKG1vbSwgJycpLnRvTG9jYWxlTG93ZXJDYXNlKCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICBpZiAoc3RyaWN0KSB7DQogICAgICAgIGlmIChmb3JtYXQgPT09ICdkZGRkJykgew0KICAgICAgICAgICAgaWkgPSBpbmRleE9mJDEuY2FsbCh0aGlzLl93ZWVrZGF5c1BhcnNlLCBsbGMpOw0KICAgICAgICAgICAgcmV0dXJuIGlpICE9PSAtMSA/IGlpIDogbnVsbDsNCiAgICAgICAgfSBlbHNlIGlmIChmb3JtYXQgPT09ICdkZGQnKSB7DQogICAgICAgICAgICBpaSA9IGluZGV4T2YkMS5jYWxsKHRoaXMuX3Nob3J0V2Vla2RheXNQYXJzZSwgbGxjKTsNCiAgICAgICAgICAgIHJldHVybiBpaSAhPT0gLTEgPyBpaSA6IG51bGw7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBpaSA9IGluZGV4T2YkMS5jYWxsKHRoaXMuX21pbldlZWtkYXlzUGFyc2UsIGxsYyk7DQogICAgICAgICAgICByZXR1cm4gaWkgIT09IC0xID8gaWkgOiBudWxsOw0KICAgICAgICB9DQogICAgfSBlbHNlIHsNCiAgICAgICAgaWYgKGZvcm1hdCA9PT0gJ2RkZGQnKSB7DQogICAgICAgICAgICBpaSA9IGluZGV4T2YkMS5jYWxsKHRoaXMuX3dlZWtkYXlzUGFyc2UsIGxsYyk7DQogICAgICAgICAgICBpZiAoaWkgIT09IC0xKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGlpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWkgPSBpbmRleE9mJDEuY2FsbCh0aGlzLl9zaG9ydFdlZWtkYXlzUGFyc2UsIGxsYyk7DQogICAgICAgICAgICBpZiAoaWkgIT09IC0xKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGlpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWkgPSBpbmRleE9mJDEuY2FsbCh0aGlzLl9taW5XZWVrZGF5c1BhcnNlLCBsbGMpOw0KICAgICAgICAgICAgcmV0dXJuIGlpICE9PSAtMSA/IGlpIDogbnVsbDsNCiAgICAgICAgfSBlbHNlIGlmIChmb3JtYXQgPT09ICdkZGQnKSB7DQogICAgICAgICAgICBpaSA9IGluZGV4T2YkMS5jYWxsKHRoaXMuX3Nob3J0V2Vla2RheXNQYXJzZSwgbGxjKTsNCiAgICAgICAgICAgIGlmIChpaSAhPT0gLTEpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gaWk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpaSA9IGluZGV4T2YkMS5jYWxsKHRoaXMuX3dlZWtkYXlzUGFyc2UsIGxsYyk7DQogICAgICAgICAgICBpZiAoaWkgIT09IC0xKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGlpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWkgPSBpbmRleE9mJDEuY2FsbCh0aGlzLl9taW5XZWVrZGF5c1BhcnNlLCBsbGMpOw0KICAgICAgICAgICAgcmV0dXJuIGlpICE9PSAtMSA/IGlpIDogbnVsbDsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGlpID0gaW5kZXhPZiQxLmNhbGwodGhpcy5fbWluV2Vla2RheXNQYXJzZSwgbGxjKTsNCiAgICAgICAgICAgIGlmIChpaSAhPT0gLTEpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gaWk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpaSA9IGluZGV4T2YkMS5jYWxsKHRoaXMuX3dlZWtkYXlzUGFyc2UsIGxsYyk7DQogICAgICAgICAgICBpZiAoaWkgIT09IC0xKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGlpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWkgPSBpbmRleE9mJDEuY2FsbCh0aGlzLl9zaG9ydFdlZWtkYXlzUGFyc2UsIGxsYyk7DQogICAgICAgICAgICByZXR1cm4gaWkgIT09IC0xID8gaWkgOiBudWxsOw0KICAgICAgICB9DQogICAgfQ0KfQ0KDQpmdW5jdGlvbiBsb2NhbGVXZWVrZGF5c1BhcnNlICh3ZWVrZGF5TmFtZSwgZm9ybWF0LCBzdHJpY3QpIHsNCiAgICB2YXIgaSwgbW9tLCByZWdleDsNCg0KICAgIGlmICh0aGlzLl93ZWVrZGF5c1BhcnNlRXhhY3QpIHsNCiAgICAgICAgcmV0dXJuIGhhbmRsZVN0cmljdFBhcnNlJDEuY2FsbCh0aGlzLCB3ZWVrZGF5TmFtZSwgZm9ybWF0LCBzdHJpY3QpOw0KICAgIH0NCg0KICAgIGlmICghdGhpcy5fd2Vla2RheXNQYXJzZSkgew0KICAgICAgICB0aGlzLl93ZWVrZGF5c1BhcnNlID0gW107DQogICAgICAgIHRoaXMuX21pbldlZWtkYXlzUGFyc2UgPSBbXTsNCiAgICAgICAgdGhpcy5fc2hvcnRXZWVrZGF5c1BhcnNlID0gW107DQogICAgICAgIHRoaXMuX2Z1bGxXZWVrZGF5c1BhcnNlID0gW107DQogICAgfQ0KDQogICAgZm9yIChpID0gMDsgaSA8IDc7IGkrKykgew0KICAgICAgICAvLyBtYWtlIHRoZSByZWdleCBpZiB3ZSBkb24ndCBoYXZlIGl0IGFscmVhZHkNCg0KICAgICAgICBtb20gPSBjcmVhdGVVVEMoWzIwMDAsIDFdKS5kYXkoaSk7DQogICAgICAgIGlmIChzdHJpY3QgJiYgIXRoaXMuX2Z1bGxXZWVrZGF5c1BhcnNlW2ldKSB7DQogICAgICAgICAgICB0aGlzLl9mdWxsV2Vla2RheXNQYXJzZVtpXSA9IG5ldyBSZWdFeHAoJ14nICsgdGhpcy53ZWVrZGF5cyhtb20sICcnKS5yZXBsYWNlKCcuJywgJ1wuPycpICsgJyQnLCAnaScpOw0KICAgICAgICAgICAgdGhpcy5fc2hvcnRXZWVrZGF5c1BhcnNlW2ldID0gbmV3IFJlZ0V4cCgnXicgKyB0aGlzLndlZWtkYXlzU2hvcnQobW9tLCAnJykucmVwbGFjZSgnLicsICdcLj8nKSArICckJywgJ2knKTsNCiAgICAgICAgICAgIHRoaXMuX21pbldlZWtkYXlzUGFyc2VbaV0gPSBuZXcgUmVnRXhwKCdeJyArIHRoaXMud2Vla2RheXNNaW4obW9tLCAnJykucmVwbGFjZSgnLicsICdcLj8nKSArICckJywgJ2knKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoIXRoaXMuX3dlZWtkYXlzUGFyc2VbaV0pIHsNCiAgICAgICAgICAgIHJlZ2V4ID0gJ14nICsgdGhpcy53ZWVrZGF5cyhtb20sICcnKSArICd8XicgKyB0aGlzLndlZWtkYXlzU2hvcnQobW9tLCAnJykgKyAnfF4nICsgdGhpcy53ZWVrZGF5c01pbihtb20sICcnKTsNCiAgICAgICAgICAgIHRoaXMuX3dlZWtkYXlzUGFyc2VbaV0gPSBuZXcgUmVnRXhwKHJlZ2V4LnJlcGxhY2UoJy4nLCAnJyksICdpJyk7DQogICAgICAgIH0NCiAgICAgICAgLy8gdGVzdCB0aGUgcmVnZXgNCiAgICAgICAgaWYgKHN0cmljdCAmJiBmb3JtYXQgPT09ICdkZGRkJyAmJiB0aGlzLl9mdWxsV2Vla2RheXNQYXJzZVtpXS50ZXN0KHdlZWtkYXlOYW1lKSkgew0KICAgICAgICAgICAgcmV0dXJuIGk7DQogICAgICAgIH0gZWxzZSBpZiAoc3RyaWN0ICYmIGZvcm1hdCA9PT0gJ2RkZCcgJiYgdGhpcy5fc2hvcnRXZWVrZGF5c1BhcnNlW2ldLnRlc3Qod2Vla2RheU5hbWUpKSB7DQogICAgICAgICAgICByZXR1cm4gaTsNCiAgICAgICAgfSBlbHNlIGlmIChzdHJpY3QgJiYgZm9ybWF0ID09PSAnZGQnICYmIHRoaXMuX21pbldlZWtkYXlzUGFyc2VbaV0udGVzdCh3ZWVrZGF5TmFtZSkpIHsNCiAgICAgICAgICAgIHJldHVybiBpOw0KICAgICAgICB9IGVsc2UgaWYgKCFzdHJpY3QgJiYgdGhpcy5fd2Vla2RheXNQYXJzZVtpXS50ZXN0KHdlZWtkYXlOYW1lKSkgew0KICAgICAgICAgICAgcmV0dXJuIGk7DQogICAgICAgIH0NCiAgICB9DQp9DQoNCi8vIE1PTUVOVFMNCg0KZnVuY3Rpb24gZ2V0U2V0RGF5T2ZXZWVrIChpbnB1dCkgew0KICAgIGlmICghdGhpcy5pc1ZhbGlkKCkpIHsNCiAgICAgICAgcmV0dXJuIGlucHV0ICE9IG51bGwgPyB0aGlzIDogTmFOOw0KICAgIH0NCiAgICB2YXIgZGF5ID0gdGhpcy5faXNVVEMgPyB0aGlzLl9kLmdldFVUQ0RheSgpIDogdGhpcy5fZC5nZXREYXkoKTsNCiAgICBpZiAoaW5wdXQgIT0gbnVsbCkgew0KICAgICAgICBpbnB1dCA9IHBhcnNlV2Vla2RheShpbnB1dCwgdGhpcy5sb2NhbGVEYXRhKCkpOw0KICAgICAgICByZXR1cm4gdGhpcy5hZGQoaW5wdXQgLSBkYXksICdkJyk7DQogICAgfSBlbHNlIHsNCiAgICAgICAgcmV0dXJuIGRheTsNCiAgICB9DQp9DQoNCmZ1bmN0aW9uIGdldFNldExvY2FsZURheU9mV2VlayAoaW5wdXQpIHsNCiAgICBpZiAoIXRoaXMuaXNWYWxpZCgpKSB7DQogICAgICAgIHJldHVybiBpbnB1dCAhPSBudWxsID8gdGhpcyA6IE5hTjsNCiAgICB9DQogICAgdmFyIHdlZWtkYXkgPSAodGhpcy5kYXkoKSArIDcgLSB0aGlzLmxvY2FsZURhdGEoKS5fd2Vlay5kb3cpICUgNzsNCiAgICByZXR1cm4gaW5wdXQgPT0gbnVsbCA/IHdlZWtkYXkgOiB0aGlzLmFkZChpbnB1dCAtIHdlZWtkYXksICdkJyk7DQp9DQoNCmZ1bmN0aW9uIGdldFNldElTT0RheU9mV2VlayAoaW5wdXQpIHsNCiAgICBpZiAoIXRoaXMuaXNWYWxpZCgpKSB7DQogICAgICAgIHJldHVybiBpbnB1dCAhPSBudWxsID8gdGhpcyA6IE5hTjsNCiAgICB9DQoNCiAgICAvLyBiZWhhdmVzIHRoZSBzYW1lIGFzIG1vbWVudCNkYXkgZXhjZXB0DQogICAgLy8gYXMgYSBnZXR0ZXIsIHJldHVybnMgNyBpbnN0ZWFkIG9mIDAgKDEtNyByYW5nZSBpbnN0ZWFkIG9mIDAtNikNCiAgICAvLyBhcyBhIHNldHRlciwgc3VuZGF5IHNob3VsZCBiZWxvbmcgdG8gdGhlIHByZXZpb3VzIHdlZWsuDQoNCiAgICBpZiAoaW5wdXQgIT0gbnVsbCkgew0KICAgICAgICB2YXIgd2Vla2RheSA9IHBhcnNlSXNvV2Vla2RheShpbnB1dCwgdGhpcy5sb2NhbGVEYXRhKCkpOw0KICAgICAgICByZXR1cm4gdGhpcy5kYXkodGhpcy5kYXkoKSAlIDcgPyB3ZWVrZGF5IDogd2Vla2RheSAtIDcpOw0KICAgIH0gZWxzZSB7DQogICAgICAgIHJldHVybiB0aGlzLmRheSgpIHx8IDc7DQogICAgfQ0KfQ0KDQp2YXIgZGVmYXVsdFdlZWtkYXlzUmVnZXggPSBtYXRjaFdvcmQ7DQpmdW5jdGlvbiB3ZWVrZGF5c1JlZ2V4IChpc1N0cmljdCkgew0KICAgIGlmICh0aGlzLl93ZWVrZGF5c1BhcnNlRXhhY3QpIHsNCiAgICAgICAgaWYgKCFoYXNPd25Qcm9wKHRoaXMsICdfd2Vla2RheXNSZWdleCcpKSB7DQogICAgICAgICAgICBjb21wdXRlV2Vla2RheXNQYXJzZS5jYWxsKHRoaXMpOw0KICAgICAgICB9DQogICAgICAgIGlmIChpc1N0cmljdCkgew0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3dlZWtkYXlzU3RyaWN0UmVnZXg7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5fd2Vla2RheXNSZWdleDsNCiAgICAgICAgfQ0KICAgIH0gZWxzZSB7DQogICAgICAgIGlmICghaGFzT3duUHJvcCh0aGlzLCAnX3dlZWtkYXlzUmVnZXgnKSkgew0KICAgICAgICAgICAgdGhpcy5fd2Vla2RheXNSZWdleCA9IGRlZmF1bHRXZWVrZGF5c1JlZ2V4Ow0KICAgICAgICB9DQogICAgICAgIHJldHVybiB0aGlzLl93ZWVrZGF5c1N0cmljdFJlZ2V4ICYmIGlzU3RyaWN0ID8NCiAgICAgICAgICAgIHRoaXMuX3dlZWtkYXlzU3RyaWN0UmVnZXggOiB0aGlzLl93ZWVrZGF5c1JlZ2V4Ow0KICAgIH0NCn0NCg0KdmFyIGRlZmF1bHRXZWVrZGF5c1Nob3J0UmVnZXggPSBtYXRjaFdvcmQ7DQpmdW5jdGlvbiB3ZWVrZGF5c1Nob3J0UmVnZXggKGlzU3RyaWN0KSB7DQogICAgaWYgKHRoaXMuX3dlZWtkYXlzUGFyc2VFeGFjdCkgew0KICAgICAgICBpZiAoIWhhc093blByb3AodGhpcywgJ193ZWVrZGF5c1JlZ2V4JykpIHsNCiAgICAgICAgICAgIGNvbXB1dGVXZWVrZGF5c1BhcnNlLmNhbGwodGhpcyk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGlzU3RyaWN0KSB7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5fd2Vla2RheXNTaG9ydFN0cmljdFJlZ2V4Ow0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3dlZWtkYXlzU2hvcnRSZWdleDsNCiAgICAgICAgfQ0KICAgIH0gZWxzZSB7DQogICAgICAgIGlmICghaGFzT3duUHJvcCh0aGlzLCAnX3dlZWtkYXlzU2hvcnRSZWdleCcpKSB7DQogICAgICAgICAgICB0aGlzLl93ZWVrZGF5c1Nob3J0UmVnZXggPSBkZWZhdWx0V2Vla2RheXNTaG9ydFJlZ2V4Ow0KICAgICAgICB9DQogICAgICAgIHJldHVybiB0aGlzLl93ZWVrZGF5c1Nob3J0U3RyaWN0UmVnZXggJiYgaXNTdHJpY3QgPw0KICAgICAgICAgICAgdGhpcy5fd2Vla2RheXNTaG9ydFN0cmljdFJlZ2V4IDogdGhpcy5fd2Vla2RheXNTaG9ydFJlZ2V4Ow0KICAgIH0NCn0NCg0KdmFyIGRlZmF1bHRXZWVrZGF5c01pblJlZ2V4ID0gbWF0Y2hXb3JkOw0KZnVuY3Rpb24gd2Vla2RheXNNaW5SZWdleCAoaXNTdHJpY3QpIHsNCiAgICBpZiAodGhpcy5fd2Vla2RheXNQYXJzZUV4YWN0KSB7DQogICAgICAgIGlmICghaGFzT3duUHJvcCh0aGlzLCAnX3dlZWtkYXlzUmVnZXgnKSkgew0KICAgICAgICAgICAgY29tcHV0ZVdlZWtkYXlzUGFyc2UuY2FsbCh0aGlzKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoaXNTdHJpY3QpIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLl93ZWVrZGF5c01pblN0cmljdFJlZ2V4Ow0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3dlZWtkYXlzTWluUmVnZXg7DQogICAgICAgIH0NCiAgICB9IGVsc2Ugew0KICAgICAgICBpZiAoIWhhc093blByb3AodGhpcywgJ193ZWVrZGF5c01pblJlZ2V4JykpIHsNCiAgICAgICAgICAgIHRoaXMuX3dlZWtkYXlzTWluUmVnZXggPSBkZWZhdWx0V2Vla2RheXNNaW5SZWdleDsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdGhpcy5fd2Vla2RheXNNaW5TdHJpY3RSZWdleCAmJiBpc1N0cmljdCA/DQogICAgICAgICAgICB0aGlzLl93ZWVrZGF5c01pblN0cmljdFJlZ2V4IDogdGhpcy5fd2Vla2RheXNNaW5SZWdleDsNCiAgICB9DQp9DQoNCg0KZnVuY3Rpb24gY29tcHV0ZVdlZWtkYXlzUGFyc2UgKCkgew0KICAgIGZ1bmN0aW9uIGNtcExlblJldihhLCBiKSB7DQogICAgICAgIHJldHVybiBiLmxlbmd0aCAtIGEubGVuZ3RoOw0KICAgIH0NCg0KICAgIHZhciBtaW5QaWVjZXMgPSBbXSwgc2hvcnRQaWVjZXMgPSBbXSwgbG9uZ1BpZWNlcyA9IFtdLCBtaXhlZFBpZWNlcyA9IFtdLA0KICAgICAgICBpLCBtb20sIG1pbnAsIHNob3J0cCwgbG9uZ3A7DQogICAgZm9yIChpID0gMDsgaSA8IDc7IGkrKykgew0KICAgICAgICAvLyBtYWtlIHRoZSByZWdleCBpZiB3ZSBkb24ndCBoYXZlIGl0IGFscmVhZHkNCiAgICAgICAgbW9tID0gY3JlYXRlVVRDKFsyMDAwLCAxXSkuZGF5KGkpOw0KICAgICAgICBtaW5wID0gdGhpcy53ZWVrZGF5c01pbihtb20sICcnKTsNCiAgICAgICAgc2hvcnRwID0gdGhpcy53ZWVrZGF5c1Nob3J0KG1vbSwgJycpOw0KICAgICAgICBsb25ncCA9IHRoaXMud2Vla2RheXMobW9tLCAnJyk7DQogICAgICAgIG1pblBpZWNlcy5wdXNoKG1pbnApOw0KICAgICAgICBzaG9ydFBpZWNlcy5wdXNoKHNob3J0cCk7DQogICAgICAgIGxvbmdQaWVjZXMucHVzaChsb25ncCk7DQogICAgICAgIG1peGVkUGllY2VzLnB1c2gobWlucCk7DQogICAgICAgIG1peGVkUGllY2VzLnB1c2goc2hvcnRwKTsNCiAgICAgICAgbWl4ZWRQaWVjZXMucHVzaChsb25ncCk7DQogICAgfQ0KICAgIC8vIFNvcnRpbmcgbWFrZXMgc3VyZSBpZiBvbmUgd2Vla2RheSAob3IgYWJicikgaXMgYSBwcmVmaXggb2YgYW5vdGhlciBpdA0KICAgIC8vIHdpbGwgbWF0Y2ggdGhlIGxvbmdlciBwaWVjZS4NCiAgICBtaW5QaWVjZXMuc29ydChjbXBMZW5SZXYpOw0KICAgIHNob3J0UGllY2VzLnNvcnQoY21wTGVuUmV2KTsNCiAgICBsb25nUGllY2VzLnNvcnQoY21wTGVuUmV2KTsNCiAgICBtaXhlZFBpZWNlcy5zb3J0KGNtcExlblJldik7DQogICAgZm9yIChpID0gMDsgaSA8IDc7IGkrKykgew0KICAgICAgICBzaG9ydFBpZWNlc1tpXSA9IHJlZ2V4RXNjYXBlKHNob3J0UGllY2VzW2ldKTsNCiAgICAgICAgbG9uZ1BpZWNlc1tpXSA9IHJlZ2V4RXNjYXBlKGxvbmdQaWVjZXNbaV0pOw0KICAgICAgICBtaXhlZFBpZWNlc1tpXSA9IHJlZ2V4RXNjYXBlKG1peGVkUGllY2VzW2ldKTsNCiAgICB9DQoNCiAgICB0aGlzLl93ZWVrZGF5c1JlZ2V4ID0gbmV3IFJlZ0V4cCgnXignICsgbWl4ZWRQaWVjZXMuam9pbignfCcpICsgJyknLCAnaScpOw0KICAgIHRoaXMuX3dlZWtkYXlzU2hvcnRSZWdleCA9IHRoaXMuX3dlZWtkYXlzUmVnZXg7DQogICAgdGhpcy5fd2Vla2RheXNNaW5SZWdleCA9IHRoaXMuX3dlZWtkYXlzUmVnZXg7DQoNCiAgICB0aGlzLl93ZWVrZGF5c1N0cmljdFJlZ2V4ID0gbmV3IFJlZ0V4cCgnXignICsgbG9uZ1BpZWNlcy5qb2luKCd8JykgKyAnKScsICdpJyk7DQogICAgdGhpcy5fd2Vla2RheXNTaG9ydFN0cmljdFJlZ2V4ID0gbmV3IFJlZ0V4cCgnXignICsgc2hvcnRQaWVjZXMuam9pbignfCcpICsgJyknLCAnaScpOw0KICAgIHRoaXMuX3dlZWtkYXlzTWluU3RyaWN0UmVnZXggPSBuZXcgUmVnRXhwKCdeKCcgKyBtaW5QaWVjZXMuam9pbignfCcpICsgJyknLCAnaScpOw0KfQ0KDQovLyBGT1JNQVRUSU5HDQoNCmZ1bmN0aW9uIGhGb3JtYXQoKSB7DQogICAgcmV0dXJuIHRoaXMuaG91cnMoKSAlIDEyIHx8IDEyOw0KfQ0KDQpmdW5jdGlvbiBrRm9ybWF0KCkgew0KICAgIHJldHVybiB0aGlzLmhvdXJzKCkgfHwgMjQ7DQp9DQoNCmFkZEZvcm1hdFRva2VuKCdIJywgWydISCcsIDJdLCAwLCAnaG91cicpOw0KYWRkRm9ybWF0VG9rZW4oJ2gnLCBbJ2hoJywgMl0sIDAsIGhGb3JtYXQpOw0KYWRkRm9ybWF0VG9rZW4oJ2snLCBbJ2trJywgMl0sIDAsIGtGb3JtYXQpOw0KDQphZGRGb3JtYXRUb2tlbignaG1tJywgMCwgMCwgZnVuY3Rpb24gKCkgew0KICAgIHJldHVybiAnJyArIGhGb3JtYXQuYXBwbHkodGhpcykgKyB6ZXJvRmlsbCh0aGlzLm1pbnV0ZXMoKSwgMik7DQp9KTsNCg0KYWRkRm9ybWF0VG9rZW4oJ2htbXNzJywgMCwgMCwgZnVuY3Rpb24gKCkgew0KICAgIHJldHVybiAnJyArIGhGb3JtYXQuYXBwbHkodGhpcykgKyB6ZXJvRmlsbCh0aGlzLm1pbnV0ZXMoKSwgMikgKw0KICAgICAgICB6ZXJvRmlsbCh0aGlzLnNlY29uZHMoKSwgMik7DQp9KTsNCg0KYWRkRm9ybWF0VG9rZW4oJ0htbScsIDAsIDAsIGZ1bmN0aW9uICgpIHsNCiAgICByZXR1cm4gJycgKyB0aGlzLmhvdXJzKCkgKyB6ZXJvRmlsbCh0aGlzLm1pbnV0ZXMoKSwgMik7DQp9KTsNCg0KYWRkRm9ybWF0VG9rZW4oJ0htbXNzJywgMCwgMCwgZnVuY3Rpb24gKCkgew0KICAgIHJldHVybiAnJyArIHRoaXMuaG91cnMoKSArIHplcm9GaWxsKHRoaXMubWludXRlcygpLCAyKSArDQogICAgICAgIHplcm9GaWxsKHRoaXMuc2Vjb25kcygpLCAyKTsNCn0pOw0KDQpmdW5jdGlvbiBtZXJpZGllbSAodG9rZW4sIGxvd2VyY2FzZSkgew0KICAgIGFkZEZvcm1hdFRva2VuKHRva2VuLCAwLCAwLCBmdW5jdGlvbiAoKSB7DQogICAgICAgIHJldHVybiB0aGlzLmxvY2FsZURhdGEoKS5tZXJpZGllbSh0aGlzLmhvdXJzKCksIHRoaXMubWludXRlcygpLCBsb3dlcmNhc2UpOw0KICAgIH0pOw0KfQ0KDQptZXJpZGllbSgnYScsIHRydWUpOw0KbWVyaWRpZW0oJ0EnLCBmYWxzZSk7DQoNCi8vIEFMSUFTRVMNCg0KYWRkVW5pdEFsaWFzKCdob3VyJywgJ2gnKTsNCg0KLy8gUFJJT1JJVFkNCmFkZFVuaXRQcmlvcml0eSgnaG91cicsIDEzKTsNCg0KLy8gUEFSU0lORw0KDQpmdW5jdGlvbiBtYXRjaE1lcmlkaWVtIChpc1N0cmljdCwgbG9jYWxlKSB7DQogICAgcmV0dXJuIGxvY2FsZS5fbWVyaWRpZW1QYXJzZTsNCn0NCg0KYWRkUmVnZXhUb2tlbignYScsICBtYXRjaE1lcmlkaWVtKTsNCmFkZFJlZ2V4VG9rZW4oJ0EnLCAgbWF0Y2hNZXJpZGllbSk7DQphZGRSZWdleFRva2VuKCdIJywgIG1hdGNoMXRvMik7DQphZGRSZWdleFRva2VuKCdoJywgIG1hdGNoMXRvMik7DQphZGRSZWdleFRva2VuKCdrJywgIG1hdGNoMXRvMik7DQphZGRSZWdleFRva2VuKCdISCcsIG1hdGNoMXRvMiwgbWF0Y2gyKTsNCmFkZFJlZ2V4VG9rZW4oJ2hoJywgbWF0Y2gxdG8yLCBtYXRjaDIpOw0KYWRkUmVnZXhUb2tlbigna2snLCBtYXRjaDF0bzIsIG1hdGNoMik7DQoNCmFkZFJlZ2V4VG9rZW4oJ2htbScsIG1hdGNoM3RvNCk7DQphZGRSZWdleFRva2VuKCdobW1zcycsIG1hdGNoNXRvNik7DQphZGRSZWdleFRva2VuKCdIbW0nLCBtYXRjaDN0bzQpOw0KYWRkUmVnZXhUb2tlbignSG1tc3MnLCBtYXRjaDV0bzYpOw0KDQphZGRQYXJzZVRva2VuKFsnSCcsICdISCddLCBIT1VSKTsNCmFkZFBhcnNlVG9rZW4oWydrJywgJ2trJ10sIGZ1bmN0aW9uIChpbnB1dCwgYXJyYXksIGNvbmZpZykgew0KICAgIHZhciBrSW5wdXQgPSB0b0ludChpbnB1dCk7DQogICAgYXJyYXlbSE9VUl0gPSBrSW5wdXQgPT09IDI0ID8gMCA6IGtJbnB1dDsNCn0pOw0KYWRkUGFyc2VUb2tlbihbJ2EnLCAnQSddLCBmdW5jdGlvbiAoaW5wdXQsIGFycmF5LCBjb25maWcpIHsNCiAgICBjb25maWcuX2lzUG0gPSBjb25maWcuX2xvY2FsZS5pc1BNKGlucHV0KTsNCiAgICBjb25maWcuX21lcmlkaWVtID0gaW5wdXQ7DQp9KTsNCmFkZFBhcnNlVG9rZW4oWydoJywgJ2hoJ10sIGZ1bmN0aW9uIChpbnB1dCwgYXJyYXksIGNvbmZpZykgew0KICAgIGFycmF5W0hPVVJdID0gdG9JbnQoaW5wdXQpOw0KICAgIGdldFBhcnNpbmdGbGFncyhjb25maWcpLmJpZ0hvdXIgPSB0cnVlOw0KfSk7DQphZGRQYXJzZVRva2VuKCdobW0nLCBmdW5jdGlvbiAoaW5wdXQsIGFycmF5LCBjb25maWcpIHsNCiAgICB2YXIgcG9zID0gaW5wdXQubGVuZ3RoIC0gMjsNCiAgICBhcnJheVtIT1VSXSA9IHRvSW50KGlucHV0LnN1YnN0cigwLCBwb3MpKTsNCiAgICBhcnJheVtNSU5VVEVdID0gdG9JbnQoaW5wdXQuc3Vic3RyKHBvcykpOw0KICAgIGdldFBhcnNpbmdGbGFncyhjb25maWcpLmJpZ0hvdXIgPSB0cnVlOw0KfSk7DQphZGRQYXJzZVRva2VuKCdobW1zcycsIGZ1bmN0aW9uIChpbnB1dCwgYXJyYXksIGNvbmZpZykgew0KICAgIHZhciBwb3MxID0gaW5wdXQubGVuZ3RoIC0gNDsNCiAgICB2YXIgcG9zMiA9IGlucHV0Lmxlbmd0aCAtIDI7DQogICAgYXJyYXlbSE9VUl0gPSB0b0ludChpbnB1dC5zdWJzdHIoMCwgcG9zMSkpOw0KICAgIGFycmF5W01JTlVURV0gPSB0b0ludChpbnB1dC5zdWJzdHIocG9zMSwgMikpOw0KICAgIGFycmF5W1NFQ09ORF0gPSB0b0ludChpbnB1dC5zdWJzdHIocG9zMikpOw0KICAgIGdldFBhcnNpbmdGbGFncyhjb25maWcpLmJpZ0hvdXIgPSB0cnVlOw0KfSk7DQphZGRQYXJzZVRva2VuKCdIbW0nLCBmdW5jdGlvbiAoaW5wdXQsIGFycmF5LCBjb25maWcpIHsNCiAgICB2YXIgcG9zID0gaW5wdXQubGVuZ3RoIC0gMjsNCiAgICBhcnJheVtIT1VSXSA9IHRvSW50KGlucHV0LnN1YnN0cigwLCBwb3MpKTsNCiAgICBhcnJheVtNSU5VVEVdID0gdG9JbnQoaW5wdXQuc3Vic3RyKHBvcykpOw0KfSk7DQphZGRQYXJzZVRva2VuKCdIbW1zcycsIGZ1bmN0aW9uIChpbnB1dCwgYXJyYXksIGNvbmZpZykgew0KICAgIHZhciBwb3MxID0gaW5wdXQubGVuZ3RoIC0gNDsNCiAgICB2YXIgcG9zMiA9IGlucHV0Lmxlbmd0aCAtIDI7DQogICAgYXJyYXlbSE9VUl0gPSB0b0ludChpbnB1dC5zdWJzdHIoMCwgcG9zMSkpOw0KICAgIGFycmF5W01JTlVURV0gPSB0b0ludChpbnB1dC5zdWJzdHIocG9zMSwgMikpOw0KICAgIGFycmF5W1NFQ09ORF0gPSB0b0ludChpbnB1dC5zdWJzdHIocG9zMikpOw0KfSk7DQoNCi8vIExPQ0FMRVMNCg0KZnVuY3Rpb24gbG9jYWxlSXNQTSAoaW5wdXQpIHsNCiAgICAvLyBJRTggUXVpcmtzIE1vZGUgJiBJRTcgU3RhbmRhcmRzIE1vZGUgZG8gbm90IGFsbG93IGFjY2Vzc2luZyBzdHJpbmdzIGxpa2UgYXJyYXlzDQogICAgLy8gVXNpbmcgY2hhckF0IHNob3VsZCBiZSBtb3JlIGNvbXBhdGlibGUuDQogICAgcmV0dXJuICgoaW5wdXQgKyAnJykudG9Mb3dlckNhc2UoKS5jaGFyQXQoMCkgPT09ICdwJyk7DQp9DQoNCnZhciBkZWZhdWx0TG9jYWxlTWVyaWRpZW1QYXJzZSA9IC9bYXBdXC4/bT9cLj8vaTsNCmZ1bmN0aW9uIGxvY2FsZU1lcmlkaWVtIChob3VycywgbWludXRlcywgaXNMb3dlcikgew0KICAgIGlmIChob3VycyA+IDExKSB7DQogICAgICAgIHJldHVybiBpc0xvd2VyID8gJ3BtJyA6ICdQTSc7DQogICAgfSBlbHNlIHsNCiAgICAgICAgcmV0dXJuIGlzTG93ZXIgPyAnYW0nIDogJ0FNJzsNCiAgICB9DQp9DQoNCg0KLy8gTU9NRU5UUw0KDQovLyBTZXR0aW5nIHRoZSBob3VyIHNob3VsZCBrZWVwIHRoZSB0aW1lLCBiZWNhdXNlIHRoZSB1c2VyIGV4cGxpY2l0bHkNCi8vIHNwZWNpZmllZCB3aGljaCBob3VyIGhlIHdhbnRzLiBTbyB0cnlpbmcgdG8gbWFpbnRhaW4gdGhlIHNhbWUgaG91ciAoaW4NCi8vIGEgbmV3IHRpbWV6b25lKSBtYWtlcyBzZW5zZS4gQWRkaW5nL3N1YnRyYWN0aW5nIGhvdXJzIGRvZXMgbm90IGZvbGxvdw0KLy8gdGhpcyBydWxlLg0KdmFyIGdldFNldEhvdXIgPSBtYWtlR2V0U2V0KCdIb3VycycsIHRydWUpOw0KDQovLyBtb250aHMNCi8vIHdlZWsNCi8vIHdlZWtkYXlzDQovLyBtZXJpZGllbQ0KdmFyIGJhc2VDb25maWcgPSB7DQogICAgY2FsZW5kYXI6IGRlZmF1bHRDYWxlbmRhciwNCiAgICBsb25nRGF0ZUZvcm1hdDogZGVmYXVsdExvbmdEYXRlRm9ybWF0LA0KICAgIGludmFsaWREYXRlOiBkZWZhdWx0SW52YWxpZERhdGUsDQogICAgb3JkaW5hbDogZGVmYXVsdE9yZGluYWwsDQogICAgZGF5T2ZNb250aE9yZGluYWxQYXJzZTogZGVmYXVsdERheU9mTW9udGhPcmRpbmFsUGFyc2UsDQogICAgcmVsYXRpdmVUaW1lOiBkZWZhdWx0UmVsYXRpdmVUaW1lLA0KDQogICAgbW9udGhzOiBkZWZhdWx0TG9jYWxlTW9udGhzLA0KICAgIG1vbnRoc1Nob3J0OiBkZWZhdWx0TG9jYWxlTW9udGhzU2hvcnQsDQoNCiAgICB3ZWVrOiBkZWZhdWx0TG9jYWxlV2VlaywNCg0KICAgIHdlZWtkYXlzOiBkZWZhdWx0TG9jYWxlV2Vla2RheXMsDQogICAgd2Vla2RheXNNaW46IGRlZmF1bHRMb2NhbGVXZWVrZGF5c01pbiwNCiAgICB3ZWVrZGF5c1Nob3J0OiBkZWZhdWx0TG9jYWxlV2Vla2RheXNTaG9ydCwNCg0KICAgIG1lcmlkaWVtUGFyc2U6IGRlZmF1bHRMb2NhbGVNZXJpZGllbVBhcnNlDQp9Ow0KDQovLyBpbnRlcm5hbCBzdG9yYWdlIGZvciBsb2NhbGUgY29uZmlnIGZpbGVzDQp2YXIgbG9jYWxlcyA9IHt9Ow0KdmFyIGxvY2FsZUZhbWlsaWVzID0ge307DQp2YXIgZ2xvYmFsTG9jYWxlOw0KDQpmdW5jdGlvbiBub3JtYWxpemVMb2NhbGUoa2V5KSB7DQogICAgcmV0dXJuIGtleSA/IGtleS50b0xvd2VyQ2FzZSgpLnJlcGxhY2UoJ18nLCAnLScpIDoga2V5Ow0KfQ0KDQovLyBwaWNrIHRoZSBsb2NhbGUgZnJvbSB0aGUgYXJyYXkNCi8vIHRyeSBbJ2VuLWF1JywgJ2VuLWdiJ10gYXMgJ2VuLWF1JywgJ2VuLWdiJywgJ2VuJywgYXMgaW4gbW92ZSB0aHJvdWdoIHRoZSBsaXN0IHRyeWluZyBlYWNoDQovLyBzdWJzdHJpbmcgZnJvbSBtb3N0IHNwZWNpZmljIHRvIGxlYXN0LCBidXQgbW92ZSB0byB0aGUgbmV4dCBhcnJheSBpdGVtIGlmIGl0J3MgYSBtb3JlIHNwZWNpZmljIHZhcmlhbnQgdGhhbiB0aGUgY3VycmVudCByb290DQpmdW5jdGlvbiBjaG9vc2VMb2NhbGUobmFtZXMpIHsNCiAgICB2YXIgaSA9IDAsIGosIG5leHQsIGxvY2FsZSwgc3BsaXQ7DQoNCiAgICB3aGlsZSAoaSA8IG5hbWVzLmxlbmd0aCkgew0KICAgICAgICBzcGxpdCA9IG5vcm1hbGl6ZUxvY2FsZShuYW1lc1tpXSkuc3BsaXQoJy0nKTsNCiAgICAgICAgaiA9IHNwbGl0Lmxlbmd0aDsNCiAgICAgICAgbmV4dCA9IG5vcm1hbGl6ZUxvY2FsZShuYW1lc1tpICsgMV0pOw0KICAgICAgICBuZXh0ID0gbmV4dCA/IG5leHQuc3BsaXQoJy0nKSA6IG51bGw7DQogICAgICAgIHdoaWxlIChqID4gMCkgew0KICAgICAgICAgICAgbG9jYWxlID0gbG9hZExvY2FsZShzcGxpdC5zbGljZSgwLCBqKS5qb2luKCctJykpOw0KICAgICAgICAgICAgaWYgKGxvY2FsZSkgew0KICAgICAgICAgICAgICAgIHJldHVybiBsb2NhbGU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAobmV4dCAmJiBuZXh0Lmxlbmd0aCA+PSBqICYmIGNvbXBhcmVBcnJheXMoc3BsaXQsIG5leHQsIHRydWUpID49IGogLSAxKSB7DQogICAgICAgICAgICAgICAgLy90aGUgbmV4dCBhcnJheSBpdGVtIGlzIGJldHRlciB0aGFuIGEgc2hhbGxvd2VyIHN1YnN0cmluZyBvZiB0aGlzIG9uZQ0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgai0tOw0KICAgICAgICB9DQogICAgICAgIGkrKzsNCiAgICB9DQogICAgcmV0dXJuIG51bGw7DQp9DQoNCmZ1bmN0aW9uIGxvYWRMb2NhbGUobmFtZSkgew0KICAgIHZhciBvbGRMb2NhbGUgPSBudWxsOw0KICAgIC8vIFRPRE86IEZpbmQgYSBiZXR0ZXIgd2F5IHRvIHJlZ2lzdGVyIGFuZCBsb2FkIGFsbCB0aGUgbG9jYWxlcyBpbiBOb2RlDQogICAgaWYgKCFsb2NhbGVzW25hbWVdICYmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJykgJiYNCiAgICAgICAgICAgIG1vZHVsZSAmJiBtb2R1bGUuZXhwb3J0cykgew0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgb2xkTG9jYWxlID0gZ2xvYmFsTG9jYWxlLl9hYmJyOw0KICAgICAgICAgICAgcmVxdWlyZSgnLi9sb2NhbGUvJyArIG5hbWUpOw0KICAgICAgICAgICAgLy8gYmVjYXVzZSBkZWZpbmVMb2NhbGUgY3VycmVudGx5IGFsc28gc2V0cyB0aGUgZ2xvYmFsIGxvY2FsZSwgd2UNCiAgICAgICAgICAgIC8vIHdhbnQgdG8gdW5kbyB0aGF0IGZvciBsYXp5IGxvYWRlZCBsb2NhbGVzDQogICAgICAgICAgICBnZXRTZXRHbG9iYWxMb2NhbGUob2xkTG9jYWxlKTsNCiAgICAgICAgfSBjYXRjaCAoZSkgeyB9DQogICAgfQ0KICAgIHJldHVybiBsb2NhbGVzW25hbWVdOw0KfQ0KDQovLyBUaGlzIGZ1bmN0aW9uIHdpbGwgbG9hZCBsb2NhbGUgYW5kIHRoZW4gc2V0IHRoZSBnbG9iYWwgbG9jYWxlLiAgSWYNCi8vIG5vIGFyZ3VtZW50cyBhcmUgcGFzc2VkIGluLCBpdCB3aWxsIHNpbXBseSByZXR1cm4gdGhlIGN1cnJlbnQgZ2xvYmFsDQovLyBsb2NhbGUga2V5Lg0KZnVuY3Rpb24gZ2V0U2V0R2xvYmFsTG9jYWxlIChrZXksIHZhbHVlcykgew0KICAgIHZhciBkYXRhOw0KICAgIGlmIChrZXkpIHsNCiAgICAgICAgaWYgKGlzVW5kZWZpbmVkKHZhbHVlcykpIHsNCiAgICAgICAgICAgIGRhdGEgPSBnZXRMb2NhbGUoa2V5KTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIGRhdGEgPSBkZWZpbmVMb2NhbGUoa2V5LCB2YWx1ZXMpOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKGRhdGEpIHsNCiAgICAgICAgICAgIC8vIG1vbWVudC5kdXJhdGlvbi5fbG9jYWxlID0gbW9tZW50Ll9sb2NhbGUgPSBkYXRhOw0KICAgICAgICAgICAgZ2xvYmFsTG9jYWxlID0gZGF0YTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHJldHVybiBnbG9iYWxMb2NhbGUuX2FiYnI7DQp9DQoNCmZ1bmN0aW9uIGRlZmluZUxvY2FsZSAobmFtZSwgY29uZmlnKSB7DQogICAgaWYgKGNvbmZpZyAhPT0gbnVsbCkgew0KICAgICAgICB2YXIgcGFyZW50Q29uZmlnID0gYmFzZUNvbmZpZzsNCiAgICAgICAgY29uZmlnLmFiYnIgPSBuYW1lOw0KICAgICAgICBpZiAobG9jYWxlc1tuYW1lXSAhPSBudWxsKSB7DQogICAgICAgICAgICBkZXByZWNhdGVTaW1wbGUoJ2RlZmluZUxvY2FsZU92ZXJyaWRlJywNCiAgICAgICAgICAgICAgICAgICAgJ3VzZSBtb21lbnQudXBkYXRlTG9jYWxlKGxvY2FsZU5hbWUsIGNvbmZpZykgdG8gY2hhbmdlICcgKw0KICAgICAgICAgICAgICAgICAgICAnYW4gZXhpc3RpbmcgbG9jYWxlLiBtb21lbnQuZGVmaW5lTG9jYWxlKGxvY2FsZU5hbWUsICcgKw0KICAgICAgICAgICAgICAgICAgICAnY29uZmlnKSBzaG91bGQgb25seSBiZSB1c2VkIGZvciBjcmVhdGluZyBhIG5ldyBsb2NhbGUgJyArDQogICAgICAgICAgICAgICAgICAgICdTZWUgaHR0cDovL21vbWVudGpzLmNvbS9ndWlkZXMvIy93YXJuaW5ncy9kZWZpbmUtbG9jYWxlLyBmb3IgbW9yZSBpbmZvLicpOw0KICAgICAgICAgICAgcGFyZW50Q29uZmlnID0gbG9jYWxlc1tuYW1lXS5fY29uZmlnOw0KICAgICAgICB9IGVsc2UgaWYgKGNvbmZpZy5wYXJlbnRMb2NhbGUgIT0gbnVsbCkgew0KICAgICAgICAgICAgaWYgKGxvY2FsZXNbY29uZmlnLnBhcmVudExvY2FsZV0gIT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIHBhcmVudENvbmZpZyA9IGxvY2FsZXNbY29uZmlnLnBhcmVudExvY2FsZV0uX2NvbmZpZzsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgaWYgKCFsb2NhbGVGYW1pbGllc1tjb25maWcucGFyZW50TG9jYWxlXSkgew0KICAgICAgICAgICAgICAgICAgICBsb2NhbGVGYW1pbGllc1tjb25maWcucGFyZW50TG9jYWxlXSA9IFtdOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBsb2NhbGVGYW1pbGllc1tjb25maWcucGFyZW50TG9jYWxlXS5wdXNoKHsNCiAgICAgICAgICAgICAgICAgICAgbmFtZTogbmFtZSwNCiAgICAgICAgICAgICAgICAgICAgY29uZmlnOiBjb25maWcNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBsb2NhbGVzW25hbWVdID0gbmV3IExvY2FsZShtZXJnZUNvbmZpZ3MocGFyZW50Q29uZmlnLCBjb25maWcpKTsNCg0KICAgICAgICBpZiAobG9jYWxlRmFtaWxpZXNbbmFtZV0pIHsNCiAgICAgICAgICAgIGxvY2FsZUZhbWlsaWVzW25hbWVdLmZvckVhY2goZnVuY3Rpb24gKHgpIHsNCiAgICAgICAgICAgICAgICBkZWZpbmVMb2NhbGUoeC5uYW1lLCB4LmNvbmZpZyk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIGJhY2t3YXJkcyBjb21wYXQgZm9yIG5vdzogYWxzbyBzZXQgdGhlIGxvY2FsZQ0KICAgICAgICAvLyBtYWtlIHN1cmUgd2Ugc2V0IHRoZSBsb2NhbGUgQUZURVIgYWxsIGNoaWxkIGxvY2FsZXMgaGF2ZSBiZWVuDQogICAgICAgIC8vIGNyZWF0ZWQsIHNvIHdlIHdvbid0IGVuZCB1cCB3aXRoIHRoZSBjaGlsZCBsb2NhbGUgc2V0Lg0KICAgICAgICBnZXRTZXRHbG9iYWxMb2NhbGUobmFtZSk7DQoNCg0KICAgICAgICByZXR1cm4gbG9jYWxlc1tuYW1lXTsNCiAgICB9IGVsc2Ugew0KICAgICAgICAvLyB1c2VmdWwgZm9yIHRlc3RpbmcNCiAgICAgICAgZGVsZXRlIGxvY2FsZXNbbmFtZV07DQogICAgICAgIHJldHVybiBudWxsOw0KICAgIH0NCn0NCg0KZnVuY3Rpb24gdXBkYXRlTG9jYWxlKG5hbWUsIGNvbmZpZykgew0KICAgIGlmIChjb25maWcgIT0gbnVsbCkgew0KICAgICAgICB2YXIgbG9jYWxlLCBwYXJlbnRDb25maWcgPSBiYXNlQ29uZmlnOw0KICAgICAgICAvLyBNRVJHRQ0KICAgICAgICBpZiAobG9jYWxlc1tuYW1lXSAhPSBudWxsKSB7DQogICAgICAgICAgICBwYXJlbnRDb25maWcgPSBsb2NhbGVzW25hbWVdLl9jb25maWc7DQogICAgICAgIH0NCiAgICAgICAgY29uZmlnID0gbWVyZ2VDb25maWdzKHBhcmVudENvbmZpZywgY29uZmlnKTsNCiAgICAgICAgbG9jYWxlID0gbmV3IExvY2FsZShjb25maWcpOw0KICAgICAgICBsb2NhbGUucGFyZW50TG9jYWxlID0gbG9jYWxlc1tuYW1lXTsNCiAgICAgICAgbG9jYWxlc1tuYW1lXSA9IGxvY2FsZTsNCg0KICAgICAgICAvLyBiYWNrd2FyZHMgY29tcGF0IGZvciBub3c6IGFsc28gc2V0IHRoZSBsb2NhbGUNCiAgICAgICAgZ2V0U2V0R2xvYmFsTG9jYWxlKG5hbWUpOw0KICAgIH0gZWxzZSB7DQogICAgICAgIC8vIHBhc3MgbnVsbCBmb3IgY29uZmlnIHRvIHVudXBkYXRlLCB1c2VmdWwgZm9yIHRlc3RzDQogICAgICAgIGlmIChsb2NhbGVzW25hbWVdICE9IG51bGwpIHsNCiAgICAgICAgICAgIGlmIChsb2NhbGVzW25hbWVdLnBhcmVudExvY2FsZSAhPSBudWxsKSB7DQogICAgICAgICAgICAgICAgbG9jYWxlc1tuYW1lXSA9IGxvY2FsZXNbbmFtZV0ucGFyZW50TG9jYWxlOw0KICAgICAgICAgICAgfSBlbHNlIGlmIChsb2NhbGVzW25hbWVdICE9IG51bGwpIHsNCiAgICAgICAgICAgICAgICBkZWxldGUgbG9jYWxlc1tuYW1lXTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gbG9jYWxlc1tuYW1lXTsNCn0NCg0KLy8gcmV0dXJucyBsb2NhbGUgZGF0YQ0KZnVuY3Rpb24gZ2V0TG9jYWxlIChrZXkpIHsNCiAgICB2YXIgbG9jYWxlOw0KDQogICAgaWYgKGtleSAmJiBrZXkuX2xvY2FsZSAmJiBrZXkuX2xvY2FsZS5fYWJicikgew0KICAgICAgICBrZXkgPSBrZXkuX2xvY2FsZS5fYWJicjsNCiAgICB9DQoNCiAgICBpZiAoIWtleSkgew0KICAgICAgICByZXR1cm4gZ2xvYmFsTG9jYWxlOw0KICAgIH0NCg0KICAgIGlmICghaXNBcnJheShrZXkpKSB7DQogICAgICAgIC8vc2hvcnQtY2lyY3VpdCBldmVyeXRoaW5nIGVsc2UNCiAgICAgICAgbG9jYWxlID0gbG9hZExvY2FsZShrZXkpOw0KICAgICAgICBpZiAobG9jYWxlKSB7DQogICAgICAgICAgICByZXR1cm4gbG9jYWxlOw0KICAgICAgICB9DQogICAgICAgIGtleSA9IFtrZXldOw0KICAgIH0NCg0KICAgIHJldHVybiBjaG9vc2VMb2NhbGUoa2V5KTsNCn0NCg0KZnVuY3Rpb24gbGlzdExvY2FsZXMoKSB7DQogICAgcmV0dXJuIGtleXMkMShsb2NhbGVzKTsNCn0NCg0KZnVuY3Rpb24gY2hlY2tPdmVyZmxvdyAobSkgew0KICAgIHZhciBvdmVyZmxvdzsNCiAgICB2YXIgYSA9IG0uX2E7DQoNCiAgICBpZiAoYSAmJiBnZXRQYXJzaW5nRmxhZ3MobSkub3ZlcmZsb3cgPT09IC0yKSB7DQogICAgICAgIG92ZXJmbG93ID0NCiAgICAgICAgICAgIGFbTU9OVEhdICAgICAgIDwgMCB8fCBhW01PTlRIXSAgICAgICA+IDExICA/IE1PTlRIIDoNCiAgICAgICAgICAgIGFbREFURV0gICAgICAgIDwgMSB8fCBhW0RBVEVdICAgICAgICA+IGRheXNJbk1vbnRoKGFbWUVBUl0sIGFbTU9OVEhdKSA/IERBVEUgOg0KICAgICAgICAgICAgYVtIT1VSXSAgICAgICAgPCAwIHx8IGFbSE9VUl0gICAgICAgID4gMjQgfHwgKGFbSE9VUl0gPT09IDI0ICYmIChhW01JTlVURV0gIT09IDAgfHwgYVtTRUNPTkRdICE9PSAwIHx8IGFbTUlMTElTRUNPTkRdICE9PSAwKSkgPyBIT1VSIDoNCiAgICAgICAgICAgIGFbTUlOVVRFXSAgICAgIDwgMCB8fCBhW01JTlVURV0gICAgICA+IDU5ICA/IE1JTlVURSA6DQogICAgICAgICAgICBhW1NFQ09ORF0gICAgICA8IDAgfHwgYVtTRUNPTkRdICAgICAgPiA1OSAgPyBTRUNPTkQgOg0KICAgICAgICAgICAgYVtNSUxMSVNFQ09ORF0gPCAwIHx8IGFbTUlMTElTRUNPTkRdID4gOTk5ID8gTUlMTElTRUNPTkQgOg0KICAgICAgICAgICAgLTE7DQoNCiAgICAgICAgaWYgKGdldFBhcnNpbmdGbGFncyhtKS5fb3ZlcmZsb3dEYXlPZlllYXIgJiYgKG92ZXJmbG93IDwgWUVBUiB8fCBvdmVyZmxvdyA+IERBVEUpKSB7DQogICAgICAgICAgICBvdmVyZmxvdyA9IERBVEU7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGdldFBhcnNpbmdGbGFncyhtKS5fb3ZlcmZsb3dXZWVrcyAmJiBvdmVyZmxvdyA9PT0gLTEpIHsNCiAgICAgICAgICAgIG92ZXJmbG93ID0gV0VFSzsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoZ2V0UGFyc2luZ0ZsYWdzKG0pLl9vdmVyZmxvd1dlZWtkYXkgJiYgb3ZlcmZsb3cgPT09IC0xKSB7DQogICAgICAgICAgICBvdmVyZmxvdyA9IFdFRUtEQVk7DQogICAgICAgIH0NCg0KICAgICAgICBnZXRQYXJzaW5nRmxhZ3MobSkub3ZlcmZsb3cgPSBvdmVyZmxvdzsNCiAgICB9DQoNCiAgICByZXR1cm4gbTsNCn0NCg0KLy8gaXNvIDg2MDEgcmVnZXgNCi8vIDAwMDAtMDAtMDAgMDAwMC1XMDAgb3IgMDAwMC1XMDAtMCArIFQgKyAwMCBvciAwMDowMCBvciAwMDowMDowMCBvciAwMDowMDowMC4wMDAgKyArMDA6MDAgb3IgKzAwMDAgb3IgKzAwKQ0KdmFyIGV4dGVuZGVkSXNvUmVnZXggPSAvXlxzKigoPzpbKy1dXGR7Nn18XGR7NH0pLSg/OlxkXGQtXGRcZHxXXGRcZC1cZHxXXGRcZHxcZFxkXGR8XGRcZCkpKD86KFR8ICkoXGRcZCg/OjpcZFxkKD86OlxkXGQoPzpbLixdXGQrKT8pPyk/KShbXCtcLV1cZFxkKD86Oj9cZFxkKT98XHMqWik/KT8kLzsNCnZhciBiYXNpY0lzb1JlZ2V4ID0gL15ccyooKD86WystXVxkezZ9fFxkezR9KSg/OlxkXGRcZFxkfFdcZFxkXGR8V1xkXGR8XGRcZFxkfFxkXGQpKSg/OihUfCApKFxkXGQoPzpcZFxkKD86XGRcZCg/OlsuLF1cZCspPyk/KT8pKFtcK1wtXVxkXGQoPzo6P1xkXGQpP3xccypaKT8pPyQvOw0KDQp2YXIgdHpSZWdleCA9IC9afFsrLV1cZFxkKD86Oj9cZFxkKT8vOw0KDQp2YXIgaXNvRGF0ZXMgPSBbDQogICAgWydZWVlZWVktTU0tREQnLCAvWystXVxkezZ9LVxkXGQtXGRcZC9dLA0KICAgIFsnWVlZWS1NTS1ERCcsIC9cZHs0fS1cZFxkLVxkXGQvXSwNCiAgICBbJ0dHR0ctW1ddV1ctRScsIC9cZHs0fS1XXGRcZC1cZC9dLA0KICAgIFsnR0dHRy1bV11XVycsIC9cZHs0fS1XXGRcZC8sIGZhbHNlXSwNCiAgICBbJ1lZWVktREREJywgL1xkezR9LVxkezN9L10sDQogICAgWydZWVlZLU1NJywgL1xkezR9LVxkXGQvLCBmYWxzZV0sDQogICAgWydZWVlZWVlNTUREJywgL1srLV1cZHsxMH0vXSwNCiAgICBbJ1lZWVlNTUREJywgL1xkezh9L10sDQogICAgLy8gWVlZWU1NIGlzIE5PVCBhbGxvd2VkIGJ5IHRoZSBzdGFuZGFyZA0KICAgIFsnR0dHR1tXXVdXRScsIC9cZHs0fVdcZHszfS9dLA0KICAgIFsnR0dHR1tXXVdXJywgL1xkezR9V1xkezJ9LywgZmFsc2VdLA0KICAgIFsnWVlZWURERCcsIC9cZHs3fS9dDQpdOw0KDQovLyBpc28gdGltZSBmb3JtYXRzIGFuZCByZWdleGVzDQp2YXIgaXNvVGltZXMgPSBbDQogICAgWydISDptbTpzcy5TU1NTJywgL1xkXGQ6XGRcZDpcZFxkXC5cZCsvXSwNCiAgICBbJ0hIOm1tOnNzLFNTU1MnLCAvXGRcZDpcZFxkOlxkXGQsXGQrL10sDQogICAgWydISDptbTpzcycsIC9cZFxkOlxkXGQ6XGRcZC9dLA0KICAgIFsnSEg6bW0nLCAvXGRcZDpcZFxkL10sDQogICAgWydISG1tc3MuU1NTUycsIC9cZFxkXGRcZFxkXGRcLlxkKy9dLA0KICAgIFsnSEhtbXNzLFNTU1MnLCAvXGRcZFxkXGRcZFxkLFxkKy9dLA0KICAgIFsnSEhtbXNzJywgL1xkXGRcZFxkXGRcZC9dLA0KICAgIFsnSEhtbScsIC9cZFxkXGRcZC9dLA0KICAgIFsnSEgnLCAvXGRcZC9dDQpdOw0KDQp2YXIgYXNwTmV0SnNvblJlZ2V4ID0gL15cLz9EYXRlXCgoXC0/XGQrKS9pOw0KDQovLyBkYXRlIGZyb20gaXNvIGZvcm1hdA0KZnVuY3Rpb24gY29uZmlnRnJvbUlTTyhjb25maWcpIHsNCiAgICB2YXIgaSwgbCwNCiAgICAgICAgc3RyaW5nID0gY29uZmlnLl9pLA0KICAgICAgICBtYXRjaCA9IGV4dGVuZGVkSXNvUmVnZXguZXhlYyhzdHJpbmcpIHx8IGJhc2ljSXNvUmVnZXguZXhlYyhzdHJpbmcpLA0KICAgICAgICBhbGxvd1RpbWUsIGRhdGVGb3JtYXQsIHRpbWVGb3JtYXQsIHR6Rm9ybWF0Ow0KDQogICAgaWYgKG1hdGNoKSB7DQogICAgICAgIGdldFBhcnNpbmdGbGFncyhjb25maWcpLmlzbyA9IHRydWU7DQoNCiAgICAgICAgZm9yIChpID0gMCwgbCA9IGlzb0RhdGVzLmxlbmd0aDsgaSA8IGw7IGkrKykgew0KICAgICAgICAgICAgaWYgKGlzb0RhdGVzW2ldWzFdLmV4ZWMobWF0Y2hbMV0pKSB7DQogICAgICAgICAgICAgICAgZGF0ZUZvcm1hdCA9IGlzb0RhdGVzW2ldWzBdOw0KICAgICAgICAgICAgICAgIGFsbG93VGltZSA9IGlzb0RhdGVzW2ldWzJdICE9PSBmYWxzZTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBpZiAoZGF0ZUZvcm1hdCA9PSBudWxsKSB7DQogICAgICAgICAgICBjb25maWcuX2lzVmFsaWQgPSBmYWxzZTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICBpZiAobWF0Y2hbM10pIHsNCiAgICAgICAgICAgIGZvciAoaSA9IDAsIGwgPSBpc29UaW1lcy5sZW5ndGg7IGkgPCBsOyBpKyspIHsNCiAgICAgICAgICAgICAgICBpZiAoaXNvVGltZXNbaV1bMV0uZXhlYyhtYXRjaFszXSkpIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gbWF0Y2hbMl0gc2hvdWxkIGJlICdUJyBvciBzcGFjZQ0KICAgICAgICAgICAgICAgICAgICB0aW1lRm9ybWF0ID0gKG1hdGNoWzJdIHx8ICcgJykgKyBpc29UaW1lc1tpXVswXTsNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKHRpbWVGb3JtYXQgPT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIGNvbmZpZy5faXNWYWxpZCA9IGZhbHNlOw0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBpZiAoIWFsbG93VGltZSAmJiB0aW1lRm9ybWF0ICE9IG51bGwpIHsNCiAgICAgICAgICAgIGNvbmZpZy5faXNWYWxpZCA9IGZhbHNlOw0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIGlmIChtYXRjaFs0XSkgew0KICAgICAgICAgICAgaWYgKHR6UmVnZXguZXhlYyhtYXRjaFs0XSkpIHsNCiAgICAgICAgICAgICAgICB0ekZvcm1hdCA9ICdaJzsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgY29uZmlnLl9pc1ZhbGlkID0gZmFsc2U7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGNvbmZpZy5fZiA9IGRhdGVGb3JtYXQgKyAodGltZUZvcm1hdCB8fCAnJykgKyAodHpGb3JtYXQgfHwgJycpOw0KICAgICAgICBjb25maWdGcm9tU3RyaW5nQW5kRm9ybWF0KGNvbmZpZyk7DQogICAgfSBlbHNlIHsNCiAgICAgICAgY29uZmlnLl9pc1ZhbGlkID0gZmFsc2U7DQogICAgfQ0KfQ0KDQovLyBSRkMgMjgyMiByZWdleDogRm9yIGRldGFpbHMgc2VlIGh0dHBzOi8vdG9vbHMuaWV0Zi5vcmcvaHRtbC9yZmMyODIyI3NlY3Rpb24tMy4zDQp2YXIgYmFzaWNSZmNSZWdleCA9IC9eKCg/Ok1vbnxUdWV8V2VkfFRodXxGcml8U2F0fFN1biksP1xzKT8oXGQ/XGRccyg/OkphbnxGZWJ8TWFyfEFwcnxNYXl8SnVufEp1bHxBdWd8U2VwfE9jdHxOb3Z8RGVjKVxzKD86XGRcZCk/XGRcZFxzKShcZFxkOlxkXGQpKFw6XGRcZCk/KFxzKD86VVR8R01UfFtFQ01QXVtTRF1UfFtBLUlLLVphLWlrLXpdfFsrLV1cZHs0fSkpJC87DQoNCi8vIGRhdGUgYW5kIHRpbWUgZnJvbSByZWYgMjgyMiBmb3JtYXQNCmZ1bmN0aW9uIGNvbmZpZ0Zyb21SRkMyODIyKGNvbmZpZykgew0KICAgIHZhciBzdHJpbmcsIG1hdGNoLCBkYXlGb3JtYXQsDQogICAgICAgIGRhdGVGb3JtYXQsIHRpbWVGb3JtYXQsIHR6Rm9ybWF0Ow0KICAgIHZhciB0aW1lem9uZXMgPSB7DQogICAgICAgICcgR01UJzogJyArMDAwMCcsDQogICAgICAgICcgRURUJzogJyAtMDQwMCcsDQogICAgICAgICcgRVNUJzogJyAtMDUwMCcsDQogICAgICAgICcgQ0RUJzogJyAtMDUwMCcsDQogICAgICAgICcgQ1NUJzogJyAtMDYwMCcsDQogICAgICAgICcgTURUJzogJyAtMDYwMCcsDQogICAgICAgICcgTVNUJzogJyAtMDcwMCcsDQogICAgICAgICcgUERUJzogJyAtMDcwMCcsDQogICAgICAgICcgUFNUJzogJyAtMDgwMCcNCiAgICB9Ow0KICAgIHZhciBtaWxpdGFyeSA9ICdZWFdWVVRTUlFQT05aQUJDREVGR0hJS0xNJzsNCiAgICB2YXIgdGltZXpvbmUsIHRpbWV6b25lSW5kZXg7DQoNCiAgICBzdHJpbmcgPSBjb25maWcuX2kNCiAgICAgICAgLnJlcGxhY2UoL1woW15cKV0qXCl8W1xuXHRdL2csICcgJykgLy8gUmVtb3ZlIGNvbW1lbnRzIGFuZCBmb2xkaW5nIHdoaXRlc3BhY2UNCiAgICAgICAgLnJlcGxhY2UoLyhcc1xzKykvZywgJyAnKSAvLyBSZXBsYWNlIG11bHRpcGxlLXNwYWNlcyB3aXRoIGEgc2luZ2xlIHNwYWNlDQogICAgICAgIC5yZXBsYWNlKC9eXHN8XHMkL2csICcnKTsgLy8gUmVtb3ZlIGxlYWRpbmcgYW5kIHRyYWlsaW5nIHNwYWNlcw0KICAgIG1hdGNoID0gYmFzaWNSZmNSZWdleC5leGVjKHN0cmluZyk7DQoNCiAgICBpZiAobWF0Y2gpIHsNCiAgICAgICAgZGF5Rm9ybWF0ID0gbWF0Y2hbMV0gPyAnZGRkJyArICgobWF0Y2hbMV0ubGVuZ3RoID09PSA1KSA/ICcsICcgOiAnICcpIDogJyc7DQogICAgICAgIGRhdGVGb3JtYXQgPSAnRCBNTU0gJyArICgobWF0Y2hbMl0ubGVuZ3RoID4gMTApID8gJ1lZWVkgJyA6ICdZWSAnKTsNCiAgICAgICAgdGltZUZvcm1hdCA9ICdISDptbScgKyAobWF0Y2hbNF0gPyAnOnNzJyA6ICcnKTsNCg0KICAgICAgICAvLyBUT0RPOiBSZXBsYWNlIHRoZSB2YW5pbGxhIEpTIERhdGUgb2JqZWN0IHdpdGggYW4gaW5kZXBlbnRlbnQgZGF5LW9mLXdlZWsgY2hlY2suDQogICAgICAgIGlmIChtYXRjaFsxXSkgeyAvLyBkYXkgb2Ygd2VlayBnaXZlbg0KICAgICAgICAgICAgdmFyIG1vbWVudERhdGUgPSBuZXcgRGF0ZShtYXRjaFsyXSk7DQogICAgICAgICAgICB2YXIgbW9tZW50RGF5ID0gWydTdW4nLCdNb24nLCdUdWUnLCdXZWQnLCdUaHUnLCdGcmknLCdTYXQnXVttb21lbnREYXRlLmdldERheSgpXTsNCg0KICAgICAgICAgICAgaWYgKG1hdGNoWzFdLnN1YnN0cigwLDMpICE9PSBtb21lbnREYXkpIHsNCiAgICAgICAgICAgICAgICBnZXRQYXJzaW5nRmxhZ3MoY29uZmlnKS53ZWVrZGF5TWlzbWF0Y2ggPSB0cnVlOw0KICAgICAgICAgICAgICAgIGNvbmZpZy5faXNWYWxpZCA9IGZhbHNlOw0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHN3aXRjaCAobWF0Y2hbNV0ubGVuZ3RoKSB7DQogICAgICAgICAgICBjYXNlIDI6IC8vIG1pbGl0YXJ5DQogICAgICAgICAgICAgICAgaWYgKHRpbWV6b25lSW5kZXggPT09IDApIHsNCiAgICAgICAgICAgICAgICAgICAgdGltZXpvbmUgPSAnICswMDAwJzsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICB0aW1lem9uZUluZGV4ID0gbWlsaXRhcnkuaW5kZXhPZihtYXRjaFs1XVsxXS50b1VwcGVyQ2FzZSgpKSAtIDEyOw0KICAgICAgICAgICAgICAgICAgICB0aW1lem9uZSA9ICgodGltZXpvbmVJbmRleCA8IDApID8gJyAtJyA6ICcgKycpICsNCiAgICAgICAgICAgICAgICAgICAgICAgICgoJycgKyB0aW1lem9uZUluZGV4KS5yZXBsYWNlKC9eLT8vLCAnMCcpKS5tYXRjaCgvLi4kLylbMF0gKyAnMDAnOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgNDogLy8gWm9uZQ0KICAgICAgICAgICAgICAgIHRpbWV6b25lID0gdGltZXpvbmVzW21hdGNoWzVdXTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGRlZmF1bHQ6IC8vIFVUIG9yICsvLTk5OTkNCiAgICAgICAgICAgICAgICB0aW1lem9uZSA9IHRpbWV6b25lc1snIEdNVCddOw0KICAgICAgICB9DQogICAgICAgIG1hdGNoWzVdID0gdGltZXpvbmU7DQogICAgICAgIGNvbmZpZy5faSA9IG1hdGNoLnNwbGljZSgxKS5qb2luKCcnKTsNCiAgICAgICAgdHpGb3JtYXQgPSAnIFpaJzsNCiAgICAgICAgY29uZmlnLl9mID0gZGF5Rm9ybWF0ICsgZGF0ZUZvcm1hdCArIHRpbWVGb3JtYXQgKyB0ekZvcm1hdDsNCiAgICAgICAgY29uZmlnRnJvbVN0cmluZ0FuZEZvcm1hdChjb25maWcpOw0KICAgICAgICBnZXRQYXJzaW5nRmxhZ3MoY29uZmlnKS5yZmMyODIyID0gdHJ1ZTsNCiAgICB9IGVsc2Ugew0KICAgICAgICBjb25maWcuX2lzVmFsaWQgPSBmYWxzZTsNCiAgICB9DQp9DQoNCi8vIGRhdGUgZnJvbSBpc28gZm9ybWF0IG9yIGZhbGxiYWNrDQpmdW5jdGlvbiBjb25maWdGcm9tU3RyaW5nKGNvbmZpZykgew0KICAgIHZhciBtYXRjaGVkID0gYXNwTmV0SnNvblJlZ2V4LmV4ZWMoY29uZmlnLl9pKTsNCg0KICAgIGlmIChtYXRjaGVkICE9PSBudWxsKSB7DQogICAgICAgIGNvbmZpZy5fZCA9IG5ldyBEYXRlKCttYXRjaGVkWzFdKTsNCiAgICAgICAgcmV0dXJuOw0KICAgIH0NCg0KICAgIGNvbmZpZ0Zyb21JU08oY29uZmlnKTsNCiAgICBpZiAoY29uZmlnLl9pc1ZhbGlkID09PSBmYWxzZSkgew0KICAgICAgICBkZWxldGUgY29uZmlnLl9pc1ZhbGlkOw0KICAgIH0gZWxzZSB7DQogICAgICAgIHJldHVybjsNCiAgICB9DQoNCiAgICBjb25maWdGcm9tUkZDMjgyMihjb25maWcpOw0KICAgIGlmIChjb25maWcuX2lzVmFsaWQgPT09IGZhbHNlKSB7DQogICAgICAgIGRlbGV0ZSBjb25maWcuX2lzVmFsaWQ7DQogICAgfSBlbHNlIHsNCiAgICAgICAgcmV0dXJuOw0KICAgIH0NCg0KICAgIC8vIEZpbmFsIGF0dGVtcHQsIHVzZSBJbnB1dCBGYWxsYmFjaw0KICAgIGhvb2tzLmNyZWF0ZUZyb21JbnB1dEZhbGxiYWNrKGNvbmZpZyk7DQp9DQoNCmhvb2tzLmNyZWF0ZUZyb21JbnB1dEZhbGxiYWNrID0gZGVwcmVjYXRlKA0KICAgICd2YWx1ZSBwcm92aWRlZCBpcyBub3QgaW4gYSByZWNvZ25pemVkIFJGQzI4MjIgb3IgSVNPIGZvcm1hdC4gbW9tZW50IGNvbnN0cnVjdGlvbiBmYWxscyBiYWNrIHRvIGpzIERhdGUoKSwgJyArDQogICAgJ3doaWNoIGlzIG5vdCByZWxpYWJsZSBhY3Jvc3MgYWxsIGJyb3dzZXJzIGFuZCB2ZXJzaW9ucy4gTm9uIFJGQzI4MjIvSVNPIGRhdGUgZm9ybWF0cyBhcmUgJyArDQogICAgJ2Rpc2NvdXJhZ2VkIGFuZCB3aWxsIGJlIHJlbW92ZWQgaW4gYW4gdXBjb21pbmcgbWFqb3IgcmVsZWFzZS4gUGxlYXNlIHJlZmVyIHRvICcgKw0KICAgICdodHRwOi8vbW9tZW50anMuY29tL2d1aWRlcy8jL3dhcm5pbmdzL2pzLWRhdGUvIGZvciBtb3JlIGluZm8uJywNCiAgICBmdW5jdGlvbiAoY29uZmlnKSB7DQogICAgICAgIGNvbmZpZy5fZCA9IG5ldyBEYXRlKGNvbmZpZy5faSArIChjb25maWcuX3VzZVVUQyA/ICcgVVRDJyA6ICcnKSk7DQogICAgfQ0KKTsNCg0KLy8gUGljayB0aGUgZmlyc3QgZGVmaW5lZCBvZiB0d28gb3IgdGhyZWUgYXJndW1lbnRzLg0KZnVuY3Rpb24gZGVmYXVsdHMoYSwgYiwgYykgew0KICAgIGlmIChhICE9IG51bGwpIHsNCiAgICAgICAgcmV0dXJuIGE7DQogICAgfQ0KICAgIGlmIChiICE9IG51bGwpIHsNCiAgICAgICAgcmV0dXJuIGI7DQogICAgfQ0KICAgIHJldHVybiBjOw0KfQ0KDQpmdW5jdGlvbiBjdXJyZW50RGF0ZUFycmF5KGNvbmZpZykgew0KICAgIC8vIGhvb2tzIGlzIGFjdHVhbGx5IHRoZSBleHBvcnRlZCBtb21lbnQgb2JqZWN0DQogICAgdmFyIG5vd1ZhbHVlID0gbmV3IERhdGUoaG9va3Mubm93KCkpOw0KICAgIGlmIChjb25maWcuX3VzZVVUQykgew0KICAgICAgICByZXR1cm4gW25vd1ZhbHVlLmdldFVUQ0Z1bGxZZWFyKCksIG5vd1ZhbHVlLmdldFVUQ01vbnRoKCksIG5vd1ZhbHVlLmdldFVUQ0RhdGUoKV07DQogICAgfQ0KICAgIHJldHVybiBbbm93VmFsdWUuZ2V0RnVsbFllYXIoKSwgbm93VmFsdWUuZ2V0TW9udGgoKSwgbm93VmFsdWUuZ2V0RGF0ZSgpXTsNCn0NCg0KLy8gY29udmVydCBhbiBhcnJheSB0byBhIGRhdGUuDQovLyB0aGUgYXJyYXkgc2hvdWxkIG1pcnJvciB0aGUgcGFyYW1ldGVycyBiZWxvdw0KLy8gbm90ZTogYWxsIHZhbHVlcyBwYXN0IHRoZSB5ZWFyIGFyZSBvcHRpb25hbCBhbmQgd2lsbCBkZWZhdWx0IHRvIHRoZSBsb3dlc3QgcG9zc2libGUgdmFsdWUuDQovLyBbeWVhciwgbW9udGgsIGRheSAsIGhvdXIsIG1pbnV0ZSwgc2Vjb25kLCBtaWxsaXNlY29uZF0NCmZ1bmN0aW9uIGNvbmZpZ0Zyb21BcnJheSAoY29uZmlnKSB7DQogICAgdmFyIGksIGRhdGUsIGlucHV0ID0gW10sIGN1cnJlbnREYXRlLCB5ZWFyVG9Vc2U7DQoNCiAgICBpZiAoY29uZmlnLl9kKSB7DQogICAgICAgIHJldHVybjsNCiAgICB9DQoNCiAgICBjdXJyZW50RGF0ZSA9IGN1cnJlbnREYXRlQXJyYXkoY29uZmlnKTsNCg0KICAgIC8vY29tcHV0ZSBkYXkgb2YgdGhlIHllYXIgZnJvbSB3ZWVrcyBhbmQgd2Vla2RheXMNCiAgICBpZiAoY29uZmlnLl93ICYmIGNvbmZpZy5fYVtEQVRFXSA9PSBudWxsICYmIGNvbmZpZy5fYVtNT05USF0gPT0gbnVsbCkgew0KICAgICAgICBkYXlPZlllYXJGcm9tV2Vla0luZm8oY29uZmlnKTsNCiAgICB9DQoNCiAgICAvL2lmIHRoZSBkYXkgb2YgdGhlIHllYXIgaXMgc2V0LCBmaWd1cmUgb3V0IHdoYXQgaXQgaXMNCiAgICBpZiAoY29uZmlnLl9kYXlPZlllYXIgIT0gbnVsbCkgew0KICAgICAgICB5ZWFyVG9Vc2UgPSBkZWZhdWx0cyhjb25maWcuX2FbWUVBUl0sIGN1cnJlbnREYXRlW1lFQVJdKTsNCg0KICAgICAgICBpZiAoY29uZmlnLl9kYXlPZlllYXIgPiBkYXlzSW5ZZWFyKHllYXJUb1VzZSkgfHwgY29uZmlnLl9kYXlPZlllYXIgPT09IDApIHsNCiAgICAgICAgICAgIGdldFBhcnNpbmdGbGFncyhjb25maWcpLl9vdmVyZmxvd0RheU9mWWVhciA9IHRydWU7DQogICAgICAgIH0NCg0KICAgICAgICBkYXRlID0gY3JlYXRlVVRDRGF0ZSh5ZWFyVG9Vc2UsIDAsIGNvbmZpZy5fZGF5T2ZZZWFyKTsNCiAgICAgICAgY29uZmlnLl9hW01PTlRIXSA9IGRhdGUuZ2V0VVRDTW9udGgoKTsNCiAgICAgICAgY29uZmlnLl9hW0RBVEVdID0gZGF0ZS5nZXRVVENEYXRlKCk7DQogICAgfQ0KDQogICAgLy8gRGVmYXVsdCB0byBjdXJyZW50IGRhdGUuDQogICAgLy8gKiBpZiBubyB5ZWFyLCBtb250aCwgZGF5IG9mIG1vbnRoIGFyZSBnaXZlbiwgZGVmYXVsdCB0byB0b2RheQ0KICAgIC8vICogaWYgZGF5IG9mIG1vbnRoIGlzIGdpdmVuLCBkZWZhdWx0IG1vbnRoIGFuZCB5ZWFyDQogICAgLy8gKiBpZiBtb250aCBpcyBnaXZlbiwgZGVmYXVsdCBvbmx5IHllYXINCiAgICAvLyAqIGlmIHllYXIgaXMgZ2l2ZW4sIGRvbid0IGRlZmF1bHQgYW55dGhpbmcNCiAgICBmb3IgKGkgPSAwOyBpIDwgMyAmJiBjb25maWcuX2FbaV0gPT0gbnVsbDsgKytpKSB7DQogICAgICAgIGNvbmZpZy5fYVtpXSA9IGlucHV0W2ldID0gY3VycmVudERhdGVbaV07DQogICAgfQ0KDQogICAgLy8gWmVybyBvdXQgd2hhdGV2ZXIgd2FzIG5vdCBkZWZhdWx0ZWQsIGluY2x1ZGluZyB0aW1lDQogICAgZm9yICg7IGkgPCA3OyBpKyspIHsNCiAgICAgICAgY29uZmlnLl9hW2ldID0gaW5wdXRbaV0gPSAoY29uZmlnLl9hW2ldID09IG51bGwpID8gKGkgPT09IDIgPyAxIDogMCkgOiBjb25maWcuX2FbaV07DQogICAgfQ0KDQogICAgLy8gQ2hlY2sgZm9yIDI0OjAwOjAwLjAwMA0KICAgIGlmIChjb25maWcuX2FbSE9VUl0gPT09IDI0ICYmDQogICAgICAgICAgICBjb25maWcuX2FbTUlOVVRFXSA9PT0gMCAmJg0KICAgICAgICAgICAgY29uZmlnLl9hW1NFQ09ORF0gPT09IDAgJiYNCiAgICAgICAgICAgIGNvbmZpZy5fYVtNSUxMSVNFQ09ORF0gPT09IDApIHsNCiAgICAgICAgY29uZmlnLl9uZXh0RGF5ID0gdHJ1ZTsNCiAgICAgICAgY29uZmlnLl9hW0hPVVJdID0gMDsNCiAgICB9DQoNCiAgICBjb25maWcuX2QgPSAoY29uZmlnLl91c2VVVEMgPyBjcmVhdGVVVENEYXRlIDogY3JlYXRlRGF0ZSkuYXBwbHkobnVsbCwgaW5wdXQpOw0KICAgIC8vIEFwcGx5IHRpbWV6b25lIG9mZnNldCBmcm9tIGlucHV0LiBUaGUgYWN0dWFsIHV0Y09mZnNldCBjYW4gYmUgY2hhbmdlZA0KICAgIC8vIHdpdGggcGFyc2Vab25lLg0KICAgIGlmIChjb25maWcuX3R6bSAhPSBudWxsKSB7DQogICAgICAgIGNvbmZpZy5fZC5zZXRVVENNaW51dGVzKGNvbmZpZy5fZC5nZXRVVENNaW51dGVzKCkgLSBjb25maWcuX3R6bSk7DQogICAgfQ0KDQogICAgaWYgKGNvbmZpZy5fbmV4dERheSkgew0KICAgICAgICBjb25maWcuX2FbSE9VUl0gPSAyNDsNCiAgICB9DQp9DQoNCmZ1bmN0aW9uIGRheU9mWWVhckZyb21XZWVrSW5mbyhjb25maWcpIHsNCiAgICB2YXIgdywgd2Vla1llYXIsIHdlZWssIHdlZWtkYXksIGRvdywgZG95LCB0ZW1wLCB3ZWVrZGF5T3ZlcmZsb3c7DQoNCiAgICB3ID0gY29uZmlnLl93Ow0KICAgIGlmICh3LkdHICE9IG51bGwgfHwgdy5XICE9IG51bGwgfHwgdy5FICE9IG51bGwpIHsNCiAgICAgICAgZG93ID0gMTsNCiAgICAgICAgZG95ID0gNDsNCg0KICAgICAgICAvLyBUT0RPOiBXZSBuZWVkIHRvIHRha2UgdGhlIGN1cnJlbnQgaXNvV2Vla1llYXIsIGJ1dCB0aGF0IGRlcGVuZHMgb24NCiAgICAgICAgLy8gaG93IHdlIGludGVycHJldCBub3cgKGxvY2FsLCB1dGMsIGZpeGVkIG9mZnNldCkuIFNvIGNyZWF0ZQ0KICAgICAgICAvLyBhIG5vdyB2ZXJzaW9uIG9mIGN1cnJlbnQgY29uZmlnICh0YWtlIGxvY2FsL3V0Yy9vZmZzZXQgZmxhZ3MsIGFuZA0KICAgICAgICAvLyBjcmVhdGUgbm93KS4NCiAgICAgICAgd2Vla1llYXIgPSBkZWZhdWx0cyh3LkdHLCBjb25maWcuX2FbWUVBUl0sIHdlZWtPZlllYXIoY3JlYXRlTG9jYWwoKSwgMSwgNCkueWVhcik7DQogICAgICAgIHdlZWsgPSBkZWZhdWx0cyh3LlcsIDEpOw0KICAgICAgICB3ZWVrZGF5ID0gZGVmYXVsdHMody5FLCAxKTsNCiAgICAgICAgaWYgKHdlZWtkYXkgPCAxIHx8IHdlZWtkYXkgPiA3KSB7DQogICAgICAgICAgICB3ZWVrZGF5T3ZlcmZsb3cgPSB0cnVlOw0KICAgICAgICB9DQogICAgfSBlbHNlIHsNCiAgICAgICAgZG93ID0gY29uZmlnLl9sb2NhbGUuX3dlZWsuZG93Ow0KICAgICAgICBkb3kgPSBjb25maWcuX2xvY2FsZS5fd2Vlay5kb3k7DQoNCiAgICAgICAgdmFyIGN1cldlZWsgPSB3ZWVrT2ZZZWFyKGNyZWF0ZUxvY2FsKCksIGRvdywgZG95KTsNCg0KICAgICAgICB3ZWVrWWVhciA9IGRlZmF1bHRzKHcuZ2csIGNvbmZpZy5fYVtZRUFSXSwgY3VyV2Vlay55ZWFyKTsNCg0KICAgICAgICAvLyBEZWZhdWx0IHRvIGN1cnJlbnQgd2Vlay4NCiAgICAgICAgd2VlayA9IGRlZmF1bHRzKHcudywgY3VyV2Vlay53ZWVrKTsNCg0KICAgICAgICBpZiAody5kICE9IG51bGwpIHsNCiAgICAgICAgICAgIC8vIHdlZWtkYXkgLS0gbG93IGRheSBudW1iZXJzIGFyZSBjb25zaWRlcmVkIG5leHQgd2Vlaw0KICAgICAgICAgICAgd2Vla2RheSA9IHcuZDsNCiAgICAgICAgICAgIGlmICh3ZWVrZGF5IDwgMCB8fCB3ZWVrZGF5ID4gNikgew0KICAgICAgICAgICAgICAgIHdlZWtkYXlPdmVyZmxvdyA9IHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgIH0gZWxzZSBpZiAody5lICE9IG51bGwpIHsNCiAgICAgICAgICAgIC8vIGxvY2FsIHdlZWtkYXkgLS0gY291bnRpbmcgc3RhcnRzIGZyb20gYmVnaW5pbmcgb2Ygd2Vlaw0KICAgICAgICAgICAgd2Vla2RheSA9IHcuZSArIGRvdzsNCiAgICAgICAgICAgIGlmICh3LmUgPCAwIHx8IHcuZSA+IDYpIHsNCiAgICAgICAgICAgICAgICB3ZWVrZGF5T3ZlcmZsb3cgPSB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgLy8gZGVmYXVsdCB0byBiZWdpbmluZyBvZiB3ZWVrDQogICAgICAgICAgICB3ZWVrZGF5ID0gZG93Ow0KICAgICAgICB9DQogICAgfQ0KICAgIGlmICh3ZWVrIDwgMSB8fCB3ZWVrID4gd2Vla3NJblllYXIod2Vla1llYXIsIGRvdywgZG95KSkgew0KICAgICAgICBnZXRQYXJzaW5nRmxhZ3MoY29uZmlnKS5fb3ZlcmZsb3dXZWVrcyA9IHRydWU7DQogICAgfSBlbHNlIGlmICh3ZWVrZGF5T3ZlcmZsb3cgIT0gbnVsbCkgew0KICAgICAgICBnZXRQYXJzaW5nRmxhZ3MoY29uZmlnKS5fb3ZlcmZsb3dXZWVrZGF5ID0gdHJ1ZTsNCiAgICB9IGVsc2Ugew0KICAgICAgICB0ZW1wID0gZGF5T2ZZZWFyRnJvbVdlZWtzKHdlZWtZZWFyLCB3ZWVrLCB3ZWVrZGF5LCBkb3csIGRveSk7DQogICAgICAgIGNvbmZpZy5fYVtZRUFSXSA9IHRlbXAueWVhcjsNCiAgICAgICAgY29uZmlnLl9kYXlPZlllYXIgPSB0ZW1wLmRheU9mWWVhcjsNCiAgICB9DQp9DQoNCi8vIGNvbnN0YW50IHRoYXQgcmVmZXJzIHRvIHRoZSBJU08gc3RhbmRhcmQNCmhvb2tzLklTT184NjAxID0gZnVuY3Rpb24gKCkge307DQoNCi8vIGNvbnN0YW50IHRoYXQgcmVmZXJzIHRvIHRoZSBSRkMgMjgyMiBmb3JtDQpob29rcy5SRkNfMjgyMiA9IGZ1bmN0aW9uICgpIHt9Ow0KDQovLyBkYXRlIGZyb20gc3RyaW5nIGFuZCBmb3JtYXQgc3RyaW5nDQpmdW5jdGlvbiBjb25maWdGcm9tU3RyaW5nQW5kRm9ybWF0KGNvbmZpZykgew0KICAgIC8vIFRPRE86IE1vdmUgdGhpcyB0byBhbm90aGVyIHBhcnQgb2YgdGhlIGNyZWF0aW9uIGZsb3cgdG8gcHJldmVudCBjaXJjdWxhciBkZXBzDQogICAgaWYgKGNvbmZpZy5fZiA9PT0gaG9va3MuSVNPXzg2MDEpIHsNCiAgICAgICAgY29uZmlnRnJvbUlTTyhjb25maWcpOw0KICAgICAgICByZXR1cm47DQogICAgfQ0KICAgIGlmIChjb25maWcuX2YgPT09IGhvb2tzLlJGQ18yODIyKSB7DQogICAgICAgIGNvbmZpZ0Zyb21SRkMyODIyKGNvbmZpZyk7DQogICAgICAgIHJldHVybjsNCiAgICB9DQogICAgY29uZmlnLl9hID0gW107DQogICAgZ2V0UGFyc2luZ0ZsYWdzKGNvbmZpZykuZW1wdHkgPSB0cnVlOw0KDQogICAgLy8gVGhpcyBhcnJheSBpcyB1c2VkIHRvIG1ha2UgYSBEYXRlLCBlaXRoZXIgd2l0aCBgbmV3IERhdGVgIG9yIGBEYXRlLlVUQ2ANCiAgICB2YXIgc3RyaW5nID0gJycgKyBjb25maWcuX2ksDQogICAgICAgIGksIHBhcnNlZElucHV0LCB0b2tlbnMsIHRva2VuLCBza2lwcGVkLA0KICAgICAgICBzdHJpbmdMZW5ndGggPSBzdHJpbmcubGVuZ3RoLA0KICAgICAgICB0b3RhbFBhcnNlZElucHV0TGVuZ3RoID0gMDsNCg0KICAgIHRva2VucyA9IGV4cGFuZEZvcm1hdChjb25maWcuX2YsIGNvbmZpZy5fbG9jYWxlKS5tYXRjaChmb3JtYXR0aW5nVG9rZW5zKSB8fCBbXTsNCg0KICAgIGZvciAoaSA9IDA7IGkgPCB0b2tlbnMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgdG9rZW4gPSB0b2tlbnNbaV07DQogICAgICAgIHBhcnNlZElucHV0ID0gKHN0cmluZy5tYXRjaChnZXRQYXJzZVJlZ2V4Rm9yVG9rZW4odG9rZW4sIGNvbmZpZykpIHx8IFtdKVswXTsNCiAgICAgICAgLy8gY29uc29sZS5sb2coJ3Rva2VuJywgdG9rZW4sICdwYXJzZWRJbnB1dCcsIHBhcnNlZElucHV0LA0KICAgICAgICAvLyAgICAgICAgICdyZWdleCcsIGdldFBhcnNlUmVnZXhGb3JUb2tlbih0b2tlbiwgY29uZmlnKSk7DQogICAgICAgIGlmIChwYXJzZWRJbnB1dCkgew0KICAgICAgICAgICAgc2tpcHBlZCA9IHN0cmluZy5zdWJzdHIoMCwgc3RyaW5nLmluZGV4T2YocGFyc2VkSW5wdXQpKTsNCiAgICAgICAgICAgIGlmIChza2lwcGVkLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgICAgICBnZXRQYXJzaW5nRmxhZ3MoY29uZmlnKS51bnVzZWRJbnB1dC5wdXNoKHNraXBwZWQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgc3RyaW5nID0gc3RyaW5nLnNsaWNlKHN0cmluZy5pbmRleE9mKHBhcnNlZElucHV0KSArIHBhcnNlZElucHV0Lmxlbmd0aCk7DQogICAgICAgICAgICB0b3RhbFBhcnNlZElucHV0TGVuZ3RoICs9IHBhcnNlZElucHV0Lmxlbmd0aDsNCiAgICAgICAgfQ0KICAgICAgICAvLyBkb24ndCBwYXJzZSBpZiBpdCdzIG5vdCBhIGtub3duIHRva2VuDQogICAgICAgIGlmIChmb3JtYXRUb2tlbkZ1bmN0aW9uc1t0b2tlbl0pIHsNCiAgICAgICAgICAgIGlmIChwYXJzZWRJbnB1dCkgew0KICAgICAgICAgICAgICAgIGdldFBhcnNpbmdGbGFncyhjb25maWcpLmVtcHR5ID0gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICBnZXRQYXJzaW5nRmxhZ3MoY29uZmlnKS51bnVzZWRUb2tlbnMucHVzaCh0b2tlbik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBhZGRUaW1lVG9BcnJheUZyb21Ub2tlbih0b2tlbiwgcGFyc2VkSW5wdXQsIGNvbmZpZyk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZiAoY29uZmlnLl9zdHJpY3QgJiYgIXBhcnNlZElucHV0KSB7DQogICAgICAgICAgICBnZXRQYXJzaW5nRmxhZ3MoY29uZmlnKS51bnVzZWRUb2tlbnMucHVzaCh0b2tlbik7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvLyBhZGQgcmVtYWluaW5nIHVucGFyc2VkIGlucHV0IGxlbmd0aCB0byB0aGUgc3RyaW5nDQogICAgZ2V0UGFyc2luZ0ZsYWdzKGNvbmZpZykuY2hhcnNMZWZ0T3ZlciA9IHN0cmluZ0xlbmd0aCAtIHRvdGFsUGFyc2VkSW5wdXRMZW5ndGg7DQogICAgaWYgKHN0cmluZy5sZW5ndGggPiAwKSB7DQogICAgICAgIGdldFBhcnNpbmdGbGFncyhjb25maWcpLnVudXNlZElucHV0LnB1c2goc3RyaW5nKTsNCiAgICB9DQoNCiAgICAvLyBjbGVhciBfMTJoIGZsYWcgaWYgaG91ciBpcyA8PSAxMg0KICAgIGlmIChjb25maWcuX2FbSE9VUl0gPD0gMTIgJiYNCiAgICAgICAgZ2V0UGFyc2luZ0ZsYWdzKGNvbmZpZykuYmlnSG91ciA9PT0gdHJ1ZSAmJg0KICAgICAgICBjb25maWcuX2FbSE9VUl0gPiAwKSB7DQogICAgICAgIGdldFBhcnNpbmdGbGFncyhjb25maWcpLmJpZ0hvdXIgPSB1bmRlZmluZWQ7DQogICAgfQ0KDQogICAgZ2V0UGFyc2luZ0ZsYWdzKGNvbmZpZykucGFyc2VkRGF0ZVBhcnRzID0gY29uZmlnLl9hLnNsaWNlKDApOw0KICAgIGdldFBhcnNpbmdGbGFncyhjb25maWcpLm1lcmlkaWVtID0gY29uZmlnLl9tZXJpZGllbTsNCiAgICAvLyBoYW5kbGUgbWVyaWRpZW0NCiAgICBjb25maWcuX2FbSE9VUl0gPSBtZXJpZGllbUZpeFdyYXAoY29uZmlnLl9sb2NhbGUsIGNvbmZpZy5fYVtIT1VSXSwgY29uZmlnLl9tZXJpZGllbSk7DQoNCiAgICBjb25maWdGcm9tQXJyYXkoY29uZmlnKTsNCiAgICBjaGVja092ZXJmbG93KGNvbmZpZyk7DQp9DQoNCg0KZnVuY3Rpb24gbWVyaWRpZW1GaXhXcmFwIChsb2NhbGUsIGhvdXIsIG1lcmlkaWVtKSB7DQogICAgdmFyIGlzUG07DQoNCiAgICBpZiAobWVyaWRpZW0gPT0gbnVsbCkgew0KICAgICAgICAvLyBub3RoaW5nIHRvIGRvDQogICAgICAgIHJldHVybiBob3VyOw0KICAgIH0NCiAgICBpZiAobG9jYWxlLm1lcmlkaWVtSG91ciAhPSBudWxsKSB7DQogICAgICAgIHJldHVybiBsb2NhbGUubWVyaWRpZW1Ib3VyKGhvdXIsIG1lcmlkaWVtKTsNCiAgICB9IGVsc2UgaWYgKGxvY2FsZS5pc1BNICE9IG51bGwpIHsNCiAgICAgICAgLy8gRmFsbGJhY2sNCiAgICAgICAgaXNQbSA9IGxvY2FsZS5pc1BNKG1lcmlkaWVtKTsNCiAgICAgICAgaWYgKGlzUG0gJiYgaG91ciA8IDEyKSB7DQogICAgICAgICAgICBob3VyICs9IDEyOw0KICAgICAgICB9DQogICAgICAgIGlmICghaXNQbSAmJiBob3VyID09PSAxMikgew0KICAgICAgICAgICAgaG91ciA9IDA7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGhvdXI7DQogICAgfSBlbHNlIHsNCiAgICAgICAgLy8gdGhpcyBpcyBub3Qgc3VwcG9zZWQgdG8gaGFwcGVuDQogICAgICAgIHJldHVybiBob3VyOw0KICAgIH0NCn0NCg0KLy8gZGF0ZSBmcm9tIHN0cmluZyBhbmQgYXJyYXkgb2YgZm9ybWF0IHN0cmluZ3MNCmZ1bmN0aW9uIGNvbmZpZ0Zyb21TdHJpbmdBbmRBcnJheShjb25maWcpIHsNCiAgICB2YXIgdGVtcENvbmZpZywNCiAgICAgICAgYmVzdE1vbWVudCwNCg0KICAgICAgICBzY29yZVRvQmVhdCwNCiAgICAgICAgaSwNCiAgICAgICAgY3VycmVudFNjb3JlOw0KDQogICAgaWYgKGNvbmZpZy5fZi5sZW5ndGggPT09IDApIHsNCiAgICAgICAgZ2V0UGFyc2luZ0ZsYWdzKGNvbmZpZykuaW52YWxpZEZvcm1hdCA9IHRydWU7DQogICAgICAgIGNvbmZpZy5fZCA9IG5ldyBEYXRlKE5hTik7DQogICAgICAgIHJldHVybjsNCiAgICB9DQoNCiAgICBmb3IgKGkgPSAwOyBpIDwgY29uZmlnLl9mLmxlbmd0aDsgaSsrKSB7DQogICAgICAgIGN1cnJlbnRTY29yZSA9IDA7DQogICAgICAgIHRlbXBDb25maWcgPSBjb3B5Q29uZmlnKHt9LCBjb25maWcpOw0KICAgICAgICBpZiAoY29uZmlnLl91c2VVVEMgIT0gbnVsbCkgew0KICAgICAgICAgICAgdGVtcENvbmZpZy5fdXNlVVRDID0gY29uZmlnLl91c2VVVEM7DQogICAgICAgIH0NCiAgICAgICAgdGVtcENvbmZpZy5fZiA9IGNvbmZpZy5fZltpXTsNCiAgICAgICAgY29uZmlnRnJvbVN0cmluZ0FuZEZvcm1hdCh0ZW1wQ29uZmlnKTsNCg0KICAgICAgICBpZiAoIWlzVmFsaWQodGVtcENvbmZpZykpIHsNCiAgICAgICAgICAgIGNvbnRpbnVlOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gaWYgdGhlcmUgaXMgYW55IGlucHV0IHRoYXQgd2FzIG5vdCBwYXJzZWQgYWRkIGEgcGVuYWx0eSBmb3IgdGhhdCBmb3JtYXQNCiAgICAgICAgY3VycmVudFNjb3JlICs9IGdldFBhcnNpbmdGbGFncyh0ZW1wQ29uZmlnKS5jaGFyc0xlZnRPdmVyOw0KDQogICAgICAgIC8vb3IgdG9rZW5zDQogICAgICAgIGN1cnJlbnRTY29yZSArPSBnZXRQYXJzaW5nRmxhZ3ModGVtcENvbmZpZykudW51c2VkVG9rZW5zLmxlbmd0aCAqIDEwOw0KDQogICAgICAgIGdldFBhcnNpbmdGbGFncyh0ZW1wQ29uZmlnKS5zY29yZSA9IGN1cnJlbnRTY29yZTsNCg0KICAgICAgICBpZiAoc2NvcmVUb0JlYXQgPT0gbnVsbCB8fCBjdXJyZW50U2NvcmUgPCBzY29yZVRvQmVhdCkgew0KICAgICAgICAgICAgc2NvcmVUb0JlYXQgPSBjdXJyZW50U2NvcmU7DQogICAgICAgICAgICBiZXN0TW9tZW50ID0gdGVtcENvbmZpZzsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIGV4dGVuZChjb25maWcsIGJlc3RNb21lbnQgfHwgdGVtcENvbmZpZyk7DQp9DQoNCmZ1bmN0aW9uIGNvbmZpZ0Zyb21PYmplY3QoY29uZmlnKSB7DQogICAgaWYgKGNvbmZpZy5fZCkgew0KICAgICAgICByZXR1cm47DQogICAgfQ0KDQogICAgdmFyIGkgPSBub3JtYWxpemVPYmplY3RVbml0cyhjb25maWcuX2kpOw0KICAgIGNvbmZpZy5fYSA9IG1hcChbaS55ZWFyLCBpLm1vbnRoLCBpLmRheSB8fCBpLmRhdGUsIGkuaG91ciwgaS5taW51dGUsIGkuc2Vjb25kLCBpLm1pbGxpc2Vjb25kXSwgZnVuY3Rpb24gKG9iaikgew0KICAgICAgICByZXR1cm4gb2JqICYmIHBhcnNlSW50KG9iaiwgMTApOw0KICAgIH0pOw0KDQogICAgY29uZmlnRnJvbUFycmF5KGNvbmZpZyk7DQp9DQoNCmZ1bmN0aW9uIGNyZWF0ZUZyb21Db25maWcgKGNvbmZpZykgew0KICAgIHZhciByZXMgPSBuZXcgTW9tZW50KGNoZWNrT3ZlcmZsb3cocHJlcGFyZUNvbmZpZyhjb25maWcpKSk7DQogICAgaWYgKHJlcy5fbmV4dERheSkgew0KICAgICAgICAvLyBBZGRpbmcgaXMgc21hcnQgZW5vdWdoIGFyb3VuZCBEU1QNCiAgICAgICAgcmVzLmFkZCgxLCAnZCcpOw0KICAgICAgICByZXMuX25leHREYXkgPSB1bmRlZmluZWQ7DQogICAgfQ0KDQogICAgcmV0dXJuIHJlczsNCn0NCg0KZnVuY3Rpb24gcHJlcGFyZUNvbmZpZyAoY29uZmlnKSB7DQogICAgdmFyIGlucHV0ID0gY29uZmlnLl9pLA0KICAgICAgICBmb3JtYXQgPSBjb25maWcuX2Y7DQoNCiAgICBjb25maWcuX2xvY2FsZSA9IGNvbmZpZy5fbG9jYWxlIHx8IGdldExvY2FsZShjb25maWcuX2wpOw0KDQogICAgaWYgKGlucHV0ID09PSBudWxsIHx8IChmb3JtYXQgPT09IHVuZGVmaW5lZCAmJiBpbnB1dCA9PT0gJycpKSB7DQogICAgICAgIHJldHVybiBjcmVhdGVJbnZhbGlkKHtudWxsSW5wdXQ6IHRydWV9KTsNCiAgICB9DQoNCiAgICBpZiAodHlwZW9mIGlucHV0ID09PSAnc3RyaW5nJykgew0KICAgICAgICBjb25maWcuX2kgPSBpbnB1dCA9IGNvbmZpZy5fbG9jYWxlLnByZXBhcnNlKGlucHV0KTsNCiAgICB9DQoNCiAgICBpZiAoaXNNb21lbnQoaW5wdXQpKSB7DQogICAgICAgIHJldHVybiBuZXcgTW9tZW50KGNoZWNrT3ZlcmZsb3coaW5wdXQpKTsNCiAgICB9IGVsc2UgaWYgKGlzRGF0ZShpbnB1dCkpIHsNCiAgICAgICAgY29uZmlnLl9kID0gaW5wdXQ7DQogICAgfSBlbHNlIGlmIChpc0FycmF5KGZvcm1hdCkpIHsNCiAgICAgICAgY29uZmlnRnJvbVN0cmluZ0FuZEFycmF5KGNvbmZpZyk7DQogICAgfSBlbHNlIGlmIChmb3JtYXQpIHsNCiAgICAgICAgY29uZmlnRnJvbVN0cmluZ0FuZEZvcm1hdChjb25maWcpOw0KICAgIH0gIGVsc2Ugew0KICAgICAgICBjb25maWdGcm9tSW5wdXQoY29uZmlnKTsNCiAgICB9DQoNCiAgICBpZiAoIWlzVmFsaWQoY29uZmlnKSkgew0KICAgICAgICBjb25maWcuX2QgPSBudWxsOw0KICAgIH0NCg0KICAgIHJldHVybiBjb25maWc7DQp9DQoNCmZ1bmN0aW9uIGNvbmZpZ0Zyb21JbnB1dChjb25maWcpIHsNCiAgICB2YXIgaW5wdXQgPSBjb25maWcuX2k7DQogICAgaWYgKGlzVW5kZWZpbmVkKGlucHV0KSkgew0KICAgICAgICBjb25maWcuX2QgPSBuZXcgRGF0ZShob29rcy5ub3coKSk7DQogICAgfSBlbHNlIGlmIChpc0RhdGUoaW5wdXQpKSB7DQogICAgICAgIGNvbmZpZy5fZCA9IG5ldyBEYXRlKGlucHV0LnZhbHVlT2YoKSk7DQogICAgfSBlbHNlIGlmICh0eXBlb2YgaW5wdXQgPT09ICdzdHJpbmcnKSB7DQogICAgICAgIGNvbmZpZ0Zyb21TdHJpbmcoY29uZmlnKTsNCiAgICB9IGVsc2UgaWYgKGlzQXJyYXkoaW5wdXQpKSB7DQogICAgICAgIGNvbmZpZy5fYSA9IG1hcChpbnB1dC5zbGljZSgwKSwgZnVuY3Rpb24gKG9iaikgew0KICAgICAgICAgICAgcmV0dXJuIHBhcnNlSW50KG9iaiwgMTApOw0KICAgICAgICB9KTsNCiAgICAgICAgY29uZmlnRnJvbUFycmF5KGNvbmZpZyk7DQogICAgfSBlbHNlIGlmIChpc09iamVjdChpbnB1dCkpIHsNCiAgICAgICAgY29uZmlnRnJvbU9iamVjdChjb25maWcpOw0KICAgIH0gZWxzZSBpZiAoaXNOdW1iZXIoaW5wdXQpKSB7DQogICAgICAgIC8vIGZyb20gbWlsbGlzZWNvbmRzDQogICAgICAgIGNvbmZpZy5fZCA9IG5ldyBEYXRlKGlucHV0KTsNCiAgICB9IGVsc2Ugew0KICAgICAgICBob29rcy5jcmVhdGVGcm9tSW5wdXRGYWxsYmFjayhjb25maWcpOw0KICAgIH0NCn0NCg0KZnVuY3Rpb24gY3JlYXRlTG9jYWxPclVUQyAoaW5wdXQsIGZvcm1hdCwgbG9jYWxlLCBzdHJpY3QsIGlzVVRDKSB7DQogICAgdmFyIGMgPSB7fTsNCg0KICAgIGlmIChsb2NhbGUgPT09IHRydWUgfHwgbG9jYWxlID09PSBmYWxzZSkgew0KICAgICAgICBzdHJpY3QgPSBsb2NhbGU7DQogICAgICAgIGxvY2FsZSA9IHVuZGVmaW5lZDsNCiAgICB9DQoNCiAgICBpZiAoKGlzT2JqZWN0KGlucHV0KSAmJiBpc09iamVjdEVtcHR5KGlucHV0KSkgfHwNCiAgICAgICAgICAgIChpc0FycmF5KGlucHV0KSAmJiBpbnB1dC5sZW5ndGggPT09IDApKSB7DQogICAgICAgIGlucHV0ID0gdW5kZWZpbmVkOw0KICAgIH0NCiAgICAvLyBvYmplY3QgY29uc3RydWN0aW9uIG11c3QgYmUgZG9uZSB0aGlzIHdheS4NCiAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vbW9tZW50L21vbWVudC9pc3N1ZXMvMTQyMw0KICAgIGMuX2lzQU1vbWVudE9iamVjdCA9IHRydWU7DQogICAgYy5fdXNlVVRDID0gYy5faXNVVEMgPSBpc1VUQzsNCiAgICBjLl9sID0gbG9jYWxlOw0KICAgIGMuX2kgPSBpbnB1dDsNCiAgICBjLl9mID0gZm9ybWF0Ow0KICAgIGMuX3N0cmljdCA9IHN0cmljdDsNCg0KICAgIHJldHVybiBjcmVhdGVGcm9tQ29uZmlnKGMpOw0KfQ0KDQpmdW5jdGlvbiBjcmVhdGVMb2NhbCAoaW5wdXQsIGZvcm1hdCwgbG9jYWxlLCBzdHJpY3QpIHsNCiAgICByZXR1cm4gY3JlYXRlTG9jYWxPclVUQyhpbnB1dCwgZm9ybWF0LCBsb2NhbGUsIHN0cmljdCwgZmFsc2UpOw0KfQ0KDQp2YXIgcHJvdG90eXBlTWluID0gZGVwcmVjYXRlKA0KICAgICdtb21lbnQoKS5taW4gaXMgZGVwcmVjYXRlZCwgdXNlIG1vbWVudC5tYXggaW5zdGVhZC4gaHR0cDovL21vbWVudGpzLmNvbS9ndWlkZXMvIy93YXJuaW5ncy9taW4tbWF4LycsDQogICAgZnVuY3Rpb24gKCkgew0KICAgICAgICB2YXIgb3RoZXIgPSBjcmVhdGVMb2NhbC5hcHBseShudWxsLCBhcmd1bWVudHMpOw0KICAgICAgICBpZiAodGhpcy5pc1ZhbGlkKCkgJiYgb3RoZXIuaXNWYWxpZCgpKSB7DQogICAgICAgICAgICByZXR1cm4gb3RoZXIgPCB0aGlzID8gdGhpcyA6IG90aGVyOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZUludmFsaWQoKTsNCiAgICAgICAgfQ0KICAgIH0NCik7DQoNCnZhciBwcm90b3R5cGVNYXggPSBkZXByZWNhdGUoDQogICAgJ21vbWVudCgpLm1heCBpcyBkZXByZWNhdGVkLCB1c2UgbW9tZW50Lm1pbiBpbnN0ZWFkLiBodHRwOi8vbW9tZW50anMuY29tL2d1aWRlcy8jL3dhcm5pbmdzL21pbi1tYXgvJywNCiAgICBmdW5jdGlvbiAoKSB7DQogICAgICAgIHZhciBvdGhlciA9IGNyZWF0ZUxvY2FsLmFwcGx5KG51bGwsIGFyZ3VtZW50cyk7DQogICAgICAgIGlmICh0aGlzLmlzVmFsaWQoKSAmJiBvdGhlci5pc1ZhbGlkKCkpIHsNCiAgICAgICAgICAgIHJldHVybiBvdGhlciA+IHRoaXMgPyB0aGlzIDogb3RoZXI7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gY3JlYXRlSW52YWxpZCgpOw0KICAgICAgICB9DQogICAgfQ0KKTsNCg0KLy8gUGljayBhIG1vbWVudCBtIGZyb20gbW9tZW50cyBzbyB0aGF0IG1bZm5dKG90aGVyKSBpcyB0cnVlIGZvciBhbGwNCi8vIG90aGVyLiBUaGlzIHJlbGllcyBvbiB0aGUgZnVuY3Rpb24gZm4gdG8gYmUgdHJhbnNpdGl2ZS4NCi8vDQovLyBtb21lbnRzIHNob3VsZCBlaXRoZXIgYmUgYW4gYXJyYXkgb2YgbW9tZW50IG9iamVjdHMgb3IgYW4gYXJyYXksIHdob3NlDQovLyBmaXJzdCBlbGVtZW50IGlzIGFuIGFycmF5IG9mIG1vbWVudCBvYmplY3RzLg0KZnVuY3Rpb24gcGlja0J5KGZuLCBtb21lbnRzKSB7DQogICAgdmFyIHJlcywgaTsNCiAgICBpZiAobW9tZW50cy5sZW5ndGggPT09IDEgJiYgaXNBcnJheShtb21lbnRzWzBdKSkgew0KICAgICAgICBtb21lbnRzID0gbW9tZW50c1swXTsNCiAgICB9DQogICAgaWYgKCFtb21lbnRzLmxlbmd0aCkgew0KICAgICAgICByZXR1cm4gY3JlYXRlTG9jYWwoKTsNCiAgICB9DQogICAgcmVzID0gbW9tZW50c1swXTsNCiAgICBmb3IgKGkgPSAxOyBpIDwgbW9tZW50cy5sZW5ndGg7ICsraSkgew0KICAgICAgICBpZiAoIW1vbWVudHNbaV0uaXNWYWxpZCgpIHx8IG1vbWVudHNbaV1bZm5dKHJlcykpIHsNCiAgICAgICAgICAgIHJlcyA9IG1vbWVudHNbaV07DQogICAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIHJlczsNCn0NCg0KLy8gVE9ETzogVXNlIFtdLnNvcnQgaW5zdGVhZD8NCmZ1bmN0aW9uIG1pbiAoKSB7DQogICAgdmFyIGFyZ3MgPSBbXS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMCk7DQoNCiAgICByZXR1cm4gcGlja0J5KCdpc0JlZm9yZScsIGFyZ3MpOw0KfQ0KDQpmdW5jdGlvbiBtYXggKCkgew0KICAgIHZhciBhcmdzID0gW10uc2xpY2UuY2FsbChhcmd1bWVudHMsIDApOw0KDQogICAgcmV0dXJuIHBpY2tCeSgnaXNBZnRlcicsIGFyZ3MpOw0KfQ0KDQp2YXIgbm93ID0gZnVuY3Rpb24gKCkgew0KICAgIHJldHVybiBEYXRlLm5vdyA/IERhdGUubm93KCkgOiArKG5ldyBEYXRlKCkpOw0KfTsNCg0KdmFyIG9yZGVyaW5nID0gWyd5ZWFyJywgJ3F1YXJ0ZXInLCAnbW9udGgnLCAnd2VlaycsICdkYXknLCAnaG91cicsICdtaW51dGUnLCAnc2Vjb25kJywgJ21pbGxpc2Vjb25kJ107DQoNCmZ1bmN0aW9uIGlzRHVyYXRpb25WYWxpZChtKSB7DQogICAgZm9yICh2YXIga2V5IGluIG0pIHsNCiAgICAgICAgaWYgKCEob3JkZXJpbmcuaW5kZXhPZihrZXkpICE9PSAtMSAmJiAobVtrZXldID09IG51bGwgfHwgIWlzTmFOKG1ba2V5XSkpKSkgew0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgdmFyIHVuaXRIYXNEZWNpbWFsID0gZmFsc2U7DQogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBvcmRlcmluZy5sZW5ndGg7ICsraSkgew0KICAgICAgICBpZiAobVtvcmRlcmluZ1tpXV0pIHsNCiAgICAgICAgICAgIGlmICh1bml0SGFzRGVjaW1hbCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsgLy8gb25seSBhbGxvdyBub24taW50ZWdlcnMgZm9yIHNtYWxsZXN0IHVuaXQNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChwYXJzZUZsb2F0KG1bb3JkZXJpbmdbaV1dKSAhPT0gdG9JbnQobVtvcmRlcmluZ1tpXV0pKSB7DQogICAgICAgICAgICAgICAgdW5pdEhhc0RlY2ltYWwgPSB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KDQogICAgcmV0dXJuIHRydWU7DQp9DQoNCmZ1bmN0aW9uIGlzVmFsaWQkMSgpIHsNCiAgICByZXR1cm4gdGhpcy5faXNWYWxpZDsNCn0NCg0KZnVuY3Rpb24gY3JlYXRlSW52YWxpZCQxKCkgew0KICAgIHJldHVybiBjcmVhdGVEdXJhdGlvbihOYU4pOw0KfQ0KDQpmdW5jdGlvbiBEdXJhdGlvbiAoZHVyYXRpb24pIHsNCiAgICB2YXIgbm9ybWFsaXplZElucHV0ID0gbm9ybWFsaXplT2JqZWN0VW5pdHMoZHVyYXRpb24pLA0KICAgICAgICB5ZWFycyA9IG5vcm1hbGl6ZWRJbnB1dC55ZWFyIHx8IDAsDQogICAgICAgIHF1YXJ0ZXJzID0gbm9ybWFsaXplZElucHV0LnF1YXJ0ZXIgfHwgMCwNCiAgICAgICAgbW9udGhzID0gbm9ybWFsaXplZElucHV0Lm1vbnRoIHx8IDAsDQogICAgICAgIHdlZWtzID0gbm9ybWFsaXplZElucHV0LndlZWsgfHwgMCwNCiAgICAgICAgZGF5cyA9IG5vcm1hbGl6ZWRJbnB1dC5kYXkgfHwgMCwNCiAgICAgICAgaG91cnMgPSBub3JtYWxpemVkSW5wdXQuaG91ciB8fCAwLA0KICAgICAgICBtaW51dGVzID0gbm9ybWFsaXplZElucHV0Lm1pbnV0ZSB8fCAwLA0KICAgICAgICBzZWNvbmRzID0gbm9ybWFsaXplZElucHV0LnNlY29uZCB8fCAwLA0KICAgICAgICBtaWxsaXNlY29uZHMgPSBub3JtYWxpemVkSW5wdXQubWlsbGlzZWNvbmQgfHwgMDsNCg0KICAgIHRoaXMuX2lzVmFsaWQgPSBpc0R1cmF0aW9uVmFsaWQobm9ybWFsaXplZElucHV0KTsNCg0KICAgIC8vIHJlcHJlc2VudGF0aW9uIGZvciBkYXRlQWRkUmVtb3ZlDQogICAgdGhpcy5fbWlsbGlzZWNvbmRzID0gK21pbGxpc2Vjb25kcyArDQogICAgICAgIHNlY29uZHMgKiAxZTMgKyAvLyAxMDAwDQogICAgICAgIG1pbnV0ZXMgKiA2ZTQgKyAvLyAxMDAwICogNjANCiAgICAgICAgaG91cnMgKiAxMDAwICogNjAgKiA2MDsgLy91c2luZyAxMDAwICogNjAgKiA2MCBpbnN0ZWFkIG9mIDM2ZTUgdG8gYXZvaWQgZmxvYXRpbmcgcG9pbnQgcm91bmRpbmcgZXJyb3JzIGh0dHBzOi8vZ2l0aHViLmNvbS9tb21lbnQvbW9tZW50L2lzc3Vlcy8yOTc4DQogICAgLy8gQmVjYXVzZSBvZiBkYXRlQWRkUmVtb3ZlIHRyZWF0cyAyNCBob3VycyBhcyBkaWZmZXJlbnQgZnJvbSBhDQogICAgLy8gZGF5IHdoZW4gd29ya2luZyBhcm91bmQgRFNULCB3ZSBuZWVkIHRvIHN0b3JlIHRoZW0gc2VwYXJhdGVseQ0KICAgIHRoaXMuX2RheXMgPSArZGF5cyArDQogICAgICAgIHdlZWtzICogNzsNCiAgICAvLyBJdCBpcyBpbXBvc3NpYmxlIHRyYW5zbGF0ZSBtb250aHMgaW50byBkYXlzIHdpdGhvdXQga25vd2luZw0KICAgIC8vIHdoaWNoIG1vbnRocyB5b3UgYXJlIGFyZSB0YWxraW5nIGFib3V0LCBzbyB3ZSBoYXZlIHRvIHN0b3JlDQogICAgLy8gaXQgc2VwYXJhdGVseS4NCiAgICB0aGlzLl9tb250aHMgPSArbW9udGhzICsNCiAgICAgICAgcXVhcnRlcnMgKiAzICsNCiAgICAgICAgeWVhcnMgKiAxMjsNCg0KICAgIHRoaXMuX2RhdGEgPSB7fTsNCg0KICAgIHRoaXMuX2xvY2FsZSA9IGdldExvY2FsZSgpOw0KDQogICAgdGhpcy5fYnViYmxlKCk7DQp9DQoNCmZ1bmN0aW9uIGlzRHVyYXRpb24gKG9iaikgew0KICAgIHJldHVybiBvYmogaW5zdGFuY2VvZiBEdXJhdGlvbjsNCn0NCg0KZnVuY3Rpb24gYWJzUm91bmQgKG51bWJlcikgew0KICAgIGlmIChudW1iZXIgPCAwKSB7DQogICAgICAgIHJldHVybiBNYXRoLnJvdW5kKC0xICogbnVtYmVyKSAqIC0xOw0KICAgIH0gZWxzZSB7DQogICAgICAgIHJldHVybiBNYXRoLnJvdW5kKG51bWJlcik7DQogICAgfQ0KfQ0KDQovLyBGT1JNQVRUSU5HDQoNCmZ1bmN0aW9uIG9mZnNldCAodG9rZW4sIHNlcGFyYXRvcikgew0KICAgIGFkZEZvcm1hdFRva2VuKHRva2VuLCAwLCAwLCBmdW5jdGlvbiAoKSB7DQogICAgICAgIHZhciBvZmZzZXQgPSB0aGlzLnV0Y09mZnNldCgpOw0KICAgICAgICB2YXIgc2lnbiA9ICcrJzsNCiAgICAgICAgaWYgKG9mZnNldCA8IDApIHsNCiAgICAgICAgICAgIG9mZnNldCA9IC1vZmZzZXQ7DQogICAgICAgICAgICBzaWduID0gJy0nOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBzaWduICsgemVyb0ZpbGwofn4ob2Zmc2V0IC8gNjApLCAyKSArIHNlcGFyYXRvciArIHplcm9GaWxsKH5+KG9mZnNldCkgJSA2MCwgMik7DQogICAgfSk7DQp9DQoNCm9mZnNldCgnWicsICc6Jyk7DQpvZmZzZXQoJ1paJywgJycpOw0KDQovLyBQQVJTSU5HDQoNCmFkZFJlZ2V4VG9rZW4oJ1onLCAgbWF0Y2hTaG9ydE9mZnNldCk7DQphZGRSZWdleFRva2VuKCdaWicsIG1hdGNoU2hvcnRPZmZzZXQpOw0KYWRkUGFyc2VUb2tlbihbJ1onLCAnWlonXSwgZnVuY3Rpb24gKGlucHV0LCBhcnJheSwgY29uZmlnKSB7DQogICAgY29uZmlnLl91c2VVVEMgPSB0cnVlOw0KICAgIGNvbmZpZy5fdHptID0gb2Zmc2V0RnJvbVN0cmluZyhtYXRjaFNob3J0T2Zmc2V0LCBpbnB1dCk7DQp9KTsNCg0KLy8gSEVMUEVSUw0KDQovLyB0aW1lem9uZSBjaHVua2VyDQovLyAnKzEwOjAwJyA+IFsnMTAnLCAgJzAwJ10NCi8vICctMTUzMCcgID4gWyctMTUnLCAnMzAnXQ0KdmFyIGNodW5rT2Zmc2V0ID0gLyhbXCtcLV18XGRcZCkvZ2k7DQoNCmZ1bmN0aW9uIG9mZnNldEZyb21TdHJpbmcobWF0Y2hlciwgc3RyaW5nKSB7DQogICAgdmFyIG1hdGNoZXMgPSAoc3RyaW5nIHx8ICcnKS5tYXRjaChtYXRjaGVyKTsNCg0KICAgIGlmIChtYXRjaGVzID09PSBudWxsKSB7DQogICAgICAgIHJldHVybiBudWxsOw0KICAgIH0NCg0KICAgIHZhciBjaHVuayAgID0gbWF0Y2hlc1ttYXRjaGVzLmxlbmd0aCAtIDFdIHx8IFtdOw0KICAgIHZhciBwYXJ0cyAgID0gKGNodW5rICsgJycpLm1hdGNoKGNodW5rT2Zmc2V0KSB8fCBbJy0nLCAwLCAwXTsNCiAgICB2YXIgbWludXRlcyA9ICsocGFydHNbMV0gKiA2MCkgKyB0b0ludChwYXJ0c1syXSk7DQoNCiAgICByZXR1cm4gbWludXRlcyA9PT0gMCA/DQogICAgICAwIDoNCiAgICAgIHBhcnRzWzBdID09PSAnKycgPyBtaW51dGVzIDogLW1pbnV0ZXM7DQp9DQoNCi8vIFJldHVybiBhIG1vbWVudCBmcm9tIGlucHV0LCB0aGF0IGlzIGxvY2FsL3V0Yy96b25lIGVxdWl2YWxlbnQgdG8gbW9kZWwuDQpmdW5jdGlvbiBjbG9uZVdpdGhPZmZzZXQoaW5wdXQsIG1vZGVsKSB7DQogICAgdmFyIHJlcywgZGlmZjsNCiAgICBpZiAobW9kZWwuX2lzVVRDKSB7DQogICAgICAgIHJlcyA9IG1vZGVsLmNsb25lKCk7DQogICAgICAgIGRpZmYgPSAoaXNNb21lbnQoaW5wdXQpIHx8IGlzRGF0ZShpbnB1dCkgPyBpbnB1dC52YWx1ZU9mKCkgOiBjcmVhdGVMb2NhbChpbnB1dCkudmFsdWVPZigpKSAtIHJlcy52YWx1ZU9mKCk7DQogICAgICAgIC8vIFVzZSBsb3ctbGV2ZWwgYXBpLCBiZWNhdXNlIHRoaXMgZm4gaXMgbG93LWxldmVsIGFwaS4NCiAgICAgICAgcmVzLl9kLnNldFRpbWUocmVzLl9kLnZhbHVlT2YoKSArIGRpZmYpOw0KICAgICAgICBob29rcy51cGRhdGVPZmZzZXQocmVzLCBmYWxzZSk7DQogICAgICAgIHJldHVybiByZXM7DQogICAgfSBlbHNlIHsNCiAgICAgICAgcmV0dXJuIGNyZWF0ZUxvY2FsKGlucHV0KS5sb2NhbCgpOw0KICAgIH0NCn0NCg0KZnVuY3Rpb24gZ2V0RGF0ZU9mZnNldCAobSkgew0KICAgIC8vIE9uIEZpcmVmb3guMjQgRGF0ZSNnZXRUaW1lem9uZU9mZnNldCByZXR1cm5zIGEgZmxvYXRpbmcgcG9pbnQuDQogICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL21vbWVudC9tb21lbnQvcHVsbC8xODcxDQogICAgcmV0dXJuIC1NYXRoLnJvdW5kKG0uX2QuZ2V0VGltZXpvbmVPZmZzZXQoKSAvIDE1KSAqIDE1Ow0KfQ0KDQovLyBIT09LUw0KDQovLyBUaGlzIGZ1bmN0aW9uIHdpbGwgYmUgY2FsbGVkIHdoZW5ldmVyIGEgbW9tZW50IGlzIG11dGF0ZWQuDQovLyBJdCBpcyBpbnRlbmRlZCB0byBrZWVwIHRoZSBvZmZzZXQgaW4gc3luYyB3aXRoIHRoZSB0aW1lem9uZS4NCmhvb2tzLnVwZGF0ZU9mZnNldCA9IGZ1bmN0aW9uICgpIHt9Ow0KDQovLyBNT01FTlRTDQoNCi8vIGtlZXBMb2NhbFRpbWUgPSB0cnVlIG1lYW5zIG9ubHkgY2hhbmdlIHRoZSB0aW1lem9uZSwgd2l0aG91dA0KLy8gYWZmZWN0aW5nIHRoZSBsb2NhbCBob3VyLiBTbyA1OjMxOjI2ICswMzAwIC0tW3V0Y09mZnNldCgyLCB0cnVlKV0tLT4NCi8vIDU6MzE6MjYgKzAyMDAgSXQgaXMgcG9zc2libGUgdGhhdCA1OjMxOjI2IGRvZXNuJ3QgZXhpc3Qgd2l0aCBvZmZzZXQNCi8vICswMjAwLCBzbyB3ZSBhZGp1c3QgdGhlIHRpbWUgYXMgbmVlZGVkLCB0byBiZSB2YWxpZC4NCi8vDQovLyBLZWVwaW5nIHRoZSB0aW1lIGFjdHVhbGx5IGFkZHMvc3VidHJhY3RzIChvbmUgaG91cikNCi8vIGZyb20gdGhlIGFjdHVhbCByZXByZXNlbnRlZCB0aW1lLiBUaGF0IGlzIHdoeSB3ZSBjYWxsIHVwZGF0ZU9mZnNldA0KLy8gYSBzZWNvbmQgdGltZS4gSW4gY2FzZSBpdCB3YW50cyB1cyB0byBjaGFuZ2UgdGhlIG9mZnNldCBhZ2Fpbg0KLy8gX2NoYW5nZUluUHJvZ3Jlc3MgPT0gdHJ1ZSBjYXNlLCB0aGVuIHdlIGhhdmUgdG8gYWRqdXN0LCBiZWNhdXNlDQovLyB0aGVyZSBpcyBubyBzdWNoIHRpbWUgaW4gdGhlIGdpdmVuIHRpbWV6b25lLg0KZnVuY3Rpb24gZ2V0U2V0T2Zmc2V0IChpbnB1dCwga2VlcExvY2FsVGltZSwga2VlcE1pbnV0ZXMpIHsNCiAgICB2YXIgb2Zmc2V0ID0gdGhpcy5fb2Zmc2V0IHx8IDAsDQogICAgICAgIGxvY2FsQWRqdXN0Ow0KICAgIGlmICghdGhpcy5pc1ZhbGlkKCkpIHsNCiAgICAgICAgcmV0dXJuIGlucHV0ICE9IG51bGwgPyB0aGlzIDogTmFOOw0KICAgIH0NCiAgICBpZiAoaW5wdXQgIT0gbnVsbCkgew0KICAgICAgICBpZiAodHlwZW9mIGlucHV0ID09PSAnc3RyaW5nJykgew0KICAgICAgICAgICAgaW5wdXQgPSBvZmZzZXRGcm9tU3RyaW5nKG1hdGNoU2hvcnRPZmZzZXQsIGlucHV0KTsNCiAgICAgICAgICAgIGlmIChpbnB1dCA9PT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9IGVsc2UgaWYgKE1hdGguYWJzKGlucHV0KSA8IDE2ICYmICFrZWVwTWludXRlcykgew0KICAgICAgICAgICAgaW5wdXQgPSBpbnB1dCAqIDYwOw0KICAgICAgICB9DQogICAgICAgIGlmICghdGhpcy5faXNVVEMgJiYga2VlcExvY2FsVGltZSkgew0KICAgICAgICAgICAgbG9jYWxBZGp1c3QgPSBnZXREYXRlT2Zmc2V0KHRoaXMpOw0KICAgICAgICB9DQogICAgICAgIHRoaXMuX29mZnNldCA9IGlucHV0Ow0KICAgICAgICB0aGlzLl9pc1VUQyA9IHRydWU7DQogICAgICAgIGlmIChsb2NhbEFkanVzdCAhPSBudWxsKSB7DQogICAgICAgICAgICB0aGlzLmFkZChsb2NhbEFkanVzdCwgJ20nKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAob2Zmc2V0ICE9PSBpbnB1dCkgew0KICAgICAgICAgICAgaWYgKCFrZWVwTG9jYWxUaW1lIHx8IHRoaXMuX2NoYW5nZUluUHJvZ3Jlc3MpIHsNCiAgICAgICAgICAgICAgICBhZGRTdWJ0cmFjdCh0aGlzLCBjcmVhdGVEdXJhdGlvbihpbnB1dCAtIG9mZnNldCwgJ20nKSwgMSwgZmFsc2UpOw0KICAgICAgICAgICAgfSBlbHNlIGlmICghdGhpcy5fY2hhbmdlSW5Qcm9ncmVzcykgew0KICAgICAgICAgICAgICAgIHRoaXMuX2NoYW5nZUluUHJvZ3Jlc3MgPSB0cnVlOw0KICAgICAgICAgICAgICAgIGhvb2tzLnVwZGF0ZU9mZnNldCh0aGlzLCB0cnVlKTsNCiAgICAgICAgICAgICAgICB0aGlzLl9jaGFuZ2VJblByb2dyZXNzID0gbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICB9IGVsc2Ugew0KICAgICAgICByZXR1cm4gdGhpcy5faXNVVEMgPyBvZmZzZXQgOiBnZXREYXRlT2Zmc2V0KHRoaXMpOw0KICAgIH0NCn0NCg0KZnVuY3Rpb24gZ2V0U2V0Wm9uZSAoaW5wdXQsIGtlZXBMb2NhbFRpbWUpIHsNCiAgICBpZiAoaW5wdXQgIT0gbnVsbCkgew0KICAgICAgICBpZiAodHlwZW9mIGlucHV0ICE9PSAnc3RyaW5nJykgew0KICAgICAgICAgICAgaW5wdXQgPSAtaW5wdXQ7DQogICAgICAgIH0NCg0KICAgICAgICB0aGlzLnV0Y09mZnNldChpbnB1dCwga2VlcExvY2FsVGltZSk7DQoNCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgfSBlbHNlIHsNCiAgICAgICAgcmV0dXJuIC10aGlzLnV0Y09mZnNldCgpOw0KICAgIH0NCn0NCg0KZnVuY3Rpb24gc2V0T2Zmc2V0VG9VVEMgKGtlZXBMb2NhbFRpbWUpIHsNCiAgICByZXR1cm4gdGhpcy51dGNPZmZzZXQoMCwga2VlcExvY2FsVGltZSk7DQp9DQoNCmZ1bmN0aW9uIHNldE9mZnNldFRvTG9jYWwgKGtlZXBMb2NhbFRpbWUpIHsNCiAgICBpZiAodGhpcy5faXNVVEMpIHsNCiAgICAgICAgdGhpcy51dGNPZmZzZXQoMCwga2VlcExvY2FsVGltZSk7DQogICAgICAgIHRoaXMuX2lzVVRDID0gZmFsc2U7DQoNCiAgICAgICAgaWYgKGtlZXBMb2NhbFRpbWUpIHsNCiAgICAgICAgICAgIHRoaXMuc3VidHJhY3QoZ2V0RGF0ZU9mZnNldCh0aGlzKSwgJ20nKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gdGhpczsNCn0NCg0KZnVuY3Rpb24gc2V0T2Zmc2V0VG9QYXJzZWRPZmZzZXQgKCkgew0KICAgIGlmICh0aGlzLl90em0gIT0gbnVsbCkgew0KICAgICAgICB0aGlzLnV0Y09mZnNldCh0aGlzLl90em0sIGZhbHNlLCB0cnVlKTsNCiAgICB9IGVsc2UgaWYgKHR5cGVvZiB0aGlzLl9pID09PSAnc3RyaW5nJykgew0KICAgICAgICB2YXIgdFpvbmUgPSBvZmZzZXRGcm9tU3RyaW5nKG1hdGNoT2Zmc2V0LCB0aGlzLl9pKTsNCiAgICAgICAgaWYgKHRab25lICE9IG51bGwpIHsNCiAgICAgICAgICAgIHRoaXMudXRjT2Zmc2V0KHRab25lKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgIHRoaXMudXRjT2Zmc2V0KDAsIHRydWUpOw0KICAgICAgICB9DQogICAgfQ0KICAgIHJldHVybiB0aGlzOw0KfQ0KDQpmdW5jdGlvbiBoYXNBbGlnbmVkSG91ck9mZnNldCAoaW5wdXQpIHsNCiAgICBpZiAoIXRoaXMuaXNWYWxpZCgpKSB7DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQogICAgaW5wdXQgPSBpbnB1dCA/IGNyZWF0ZUxvY2FsKGlucHV0KS51dGNPZmZzZXQoKSA6IDA7DQoNCiAgICByZXR1cm4gKHRoaXMudXRjT2Zmc2V0KCkgLSBpbnB1dCkgJSA2MCA9PT0gMDsNCn0NCg0KZnVuY3Rpb24gaXNEYXlsaWdodFNhdmluZ1RpbWUgKCkgew0KICAgIHJldHVybiAoDQogICAgICAgIHRoaXMudXRjT2Zmc2V0KCkgPiB0aGlzLmNsb25lKCkubW9udGgoMCkudXRjT2Zmc2V0KCkgfHwNCiAgICAgICAgdGhpcy51dGNPZmZzZXQoKSA+IHRoaXMuY2xvbmUoKS5tb250aCg1KS51dGNPZmZzZXQoKQ0KICAgICk7DQp9DQoNCmZ1bmN0aW9uIGlzRGF5bGlnaHRTYXZpbmdUaW1lU2hpZnRlZCAoKSB7DQogICAgaWYgKCFpc1VuZGVmaW5lZCh0aGlzLl9pc0RTVFNoaWZ0ZWQpKSB7DQogICAgICAgIHJldHVybiB0aGlzLl9pc0RTVFNoaWZ0ZWQ7DQogICAgfQ0KDQogICAgdmFyIGMgPSB7fTsNCg0KICAgIGNvcHlDb25maWcoYywgdGhpcyk7DQogICAgYyA9IHByZXBhcmVDb25maWcoYyk7DQoNCiAgICBpZiAoYy5fYSkgew0KICAgICAgICB2YXIgb3RoZXIgPSBjLl9pc1VUQyA/IGNyZWF0ZVVUQyhjLl9hKSA6IGNyZWF0ZUxvY2FsKGMuX2EpOw0KICAgICAgICB0aGlzLl9pc0RTVFNoaWZ0ZWQgPSB0aGlzLmlzVmFsaWQoKSAmJg0KICAgICAgICAgICAgY29tcGFyZUFycmF5cyhjLl9hLCBvdGhlci50b0FycmF5KCkpID4gMDsNCiAgICB9IGVsc2Ugew0KICAgICAgICB0aGlzLl9pc0RTVFNoaWZ0ZWQgPSBmYWxzZTsNCiAgICB9DQoNCiAgICByZXR1cm4gdGhpcy5faXNEU1RTaGlmdGVkOw0KfQ0KDQpmdW5jdGlvbiBpc0xvY2FsICgpIHsNCiAgICByZXR1cm4gdGhpcy5pc1ZhbGlkKCkgPyAhdGhpcy5faXNVVEMgOiBmYWxzZTsNCn0NCg0KZnVuY3Rpb24gaXNVdGNPZmZzZXQgKCkgew0KICAgIHJldHVybiB0aGlzLmlzVmFsaWQoKSA/IHRoaXMuX2lzVVRDIDogZmFsc2U7DQp9DQoNCmZ1bmN0aW9uIGlzVXRjICgpIHsNCiAgICByZXR1cm4gdGhpcy5pc1ZhbGlkKCkgPyB0aGlzLl9pc1VUQyAmJiB0aGlzLl9vZmZzZXQgPT09IDAgOiBmYWxzZTsNCn0NCg0KLy8gQVNQLk5FVCBqc29uIGRhdGUgZm9ybWF0IHJlZ2V4DQp2YXIgYXNwTmV0UmVnZXggPSAvXihcLSk/KD86KFxkKilbLiBdKT8oXGQrKVw6KFxkKykoPzpcOihcZCspKFwuXGQqKT8pPyQvOw0KDQovLyBmcm9tIGh0dHA6Ly9kb2NzLmNsb3N1cmUtbGlicmFyeS5nb29nbGVjb2RlLmNvbS9naXQvY2xvc3VyZV9nb29nX2RhdGVfZGF0ZS5qcy5zb3VyY2UuaHRtbA0KLy8gc29tZXdoYXQgbW9yZSBpbiBsaW5lIHdpdGggNC40LjMuMiAyMDA0IHNwZWMsIGJ1dCBhbGxvd3MgZGVjaW1hbCBhbnl3aGVyZQ0KLy8gYW5kIGZ1cnRoZXIgbW9kaWZpZWQgdG8gYWxsb3cgZm9yIHN0cmluZ3MgY29udGFpbmluZyBib3RoIHdlZWsgYW5kIGRheQ0KdmFyIGlzb1JlZ2V4ID0gL14oLSk/UCg/OigtP1swLTksLl0qKVkpPyg/OigtP1swLTksLl0qKU0pPyg/OigtP1swLTksLl0qKVcpPyg/OigtP1swLTksLl0qKUQpPyg/OlQoPzooLT9bMC05LC5dKilIKT8oPzooLT9bMC05LC5dKilNKT8oPzooLT9bMC05LC5dKilTKT8pPyQvOw0KDQpmdW5jdGlvbiBjcmVhdGVEdXJhdGlvbiAoaW5wdXQsIGtleSkgew0KICAgIHZhciBkdXJhdGlvbiA9IGlucHV0LA0KICAgICAgICAvLyBtYXRjaGluZyBhZ2FpbnN0IHJlZ2V4cCBpcyBleHBlbnNpdmUsIGRvIGl0IG9uIGRlbWFuZA0KICAgICAgICBtYXRjaCA9IG51bGwsDQogICAgICAgIHNpZ24sDQogICAgICAgIHJldCwNCiAgICAgICAgZGlmZlJlczsNCg0KICAgIGlmIChpc0R1cmF0aW9uKGlucHV0KSkgew0KICAgICAgICBkdXJhdGlvbiA9IHsNCiAgICAgICAgICAgIG1zIDogaW5wdXQuX21pbGxpc2Vjb25kcywNCiAgICAgICAgICAgIGQgIDogaW5wdXQuX2RheXMsDQogICAgICAgICAgICBNICA6IGlucHV0Ll9tb250aHMNCiAgICAgICAgfTsNCiAgICB9IGVsc2UgaWYgKGlzTnVtYmVyKGlucHV0KSkgew0KICAgICAgICBkdXJhdGlvbiA9IHt9Ow0KICAgICAgICBpZiAoa2V5KSB7DQogICAgICAgICAgICBkdXJhdGlvbltrZXldID0gaW5wdXQ7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBkdXJhdGlvbi5taWxsaXNlY29uZHMgPSBpbnB1dDsNCiAgICAgICAgfQ0KICAgIH0gZWxzZSBpZiAoISEobWF0Y2ggPSBhc3BOZXRSZWdleC5leGVjKGlucHV0KSkpIHsNCiAgICAgICAgc2lnbiA9IChtYXRjaFsxXSA9PT0gJy0nKSA/IC0xIDogMTsNCiAgICAgICAgZHVyYXRpb24gPSB7DQogICAgICAgICAgICB5ICA6IDAsDQogICAgICAgICAgICBkICA6IHRvSW50KG1hdGNoW0RBVEVdKSAgICAgICAgICAgICAgICAgICAgICAgICAqIHNpZ24sDQogICAgICAgICAgICBoICA6IHRvSW50KG1hdGNoW0hPVVJdKSAgICAgICAgICAgICAgICAgICAgICAgICAqIHNpZ24sDQogICAgICAgICAgICBtICA6IHRvSW50KG1hdGNoW01JTlVURV0pICAgICAgICAgICAgICAgICAgICAgICAqIHNpZ24sDQogICAgICAgICAgICBzICA6IHRvSW50KG1hdGNoW1NFQ09ORF0pICAgICAgICAgICAgICAgICAgICAgICAqIHNpZ24sDQogICAgICAgICAgICBtcyA6IHRvSW50KGFic1JvdW5kKG1hdGNoW01JTExJU0VDT05EXSAqIDEwMDApKSAqIHNpZ24gLy8gdGhlIG1pbGxpc2Vjb25kIGRlY2ltYWwgcG9pbnQgaXMgaW5jbHVkZWQgaW4gdGhlIG1hdGNoDQogICAgICAgIH07DQogICAgfSBlbHNlIGlmICghIShtYXRjaCA9IGlzb1JlZ2V4LmV4ZWMoaW5wdXQpKSkgew0KICAgICAgICBzaWduID0gKG1hdGNoWzFdID09PSAnLScpID8gLTEgOiAxOw0KICAgICAgICBkdXJhdGlvbiA9IHsNCiAgICAgICAgICAgIHkgOiBwYXJzZUlzbyhtYXRjaFsyXSwgc2lnbiksDQogICAgICAgICAgICBNIDogcGFyc2VJc28obWF0Y2hbM10sIHNpZ24pLA0KICAgICAgICAgICAgdyA6IHBhcnNlSXNvKG1hdGNoWzRdLCBzaWduKSwNCiAgICAgICAgICAgIGQgOiBwYXJzZUlzbyhtYXRjaFs1XSwgc2lnbiksDQogICAgICAgICAgICBoIDogcGFyc2VJc28obWF0Y2hbNl0sIHNpZ24pLA0KICAgICAgICAgICAgbSA6IHBhcnNlSXNvKG1hdGNoWzddLCBzaWduKSwNCiAgICAgICAgICAgIHMgOiBwYXJzZUlzbyhtYXRjaFs4XSwgc2lnbikNCiAgICAgICAgfTsNCiAgICB9IGVsc2UgaWYgKGR1cmF0aW9uID09IG51bGwpIHsvLyBjaGVja3MgZm9yIG51bGwgb3IgdW5kZWZpbmVkDQogICAgICAgIGR1cmF0aW9uID0ge307DQogICAgfSBlbHNlIGlmICh0eXBlb2YgZHVyYXRpb24gPT09ICdvYmplY3QnICYmICgnZnJvbScgaW4gZHVyYXRpb24gfHwgJ3RvJyBpbiBkdXJhdGlvbikpIHsNCiAgICAgICAgZGlmZlJlcyA9IG1vbWVudHNEaWZmZXJlbmNlKGNyZWF0ZUxvY2FsKGR1cmF0aW9uLmZyb20pLCBjcmVhdGVMb2NhbChkdXJhdGlvbi50bykpOw0KDQogICAgICAgIGR1cmF0aW9uID0ge307DQogICAgICAgIGR1cmF0aW9uLm1zID0gZGlmZlJlcy5taWxsaXNlY29uZHM7DQogICAgICAgIGR1cmF0aW9uLk0gPSBkaWZmUmVzLm1vbnRoczsNCiAgICB9DQoNCiAgICByZXQgPSBuZXcgRHVyYXRpb24oZHVyYXRpb24pOw0KDQogICAgaWYgKGlzRHVyYXRpb24oaW5wdXQpICYmIGhhc093blByb3AoaW5wdXQsICdfbG9jYWxlJykpIHsNCiAgICAgICAgcmV0Ll9sb2NhbGUgPSBpbnB1dC5fbG9jYWxlOw0KICAgIH0NCg0KICAgIHJldHVybiByZXQ7DQp9DQoNCmNyZWF0ZUR1cmF0aW9uLmZuID0gRHVyYXRpb24ucHJvdG90eXBlOw0KY3JlYXRlRHVyYXRpb24uaW52YWxpZCA9IGNyZWF0ZUludmFsaWQkMTsNCg0KZnVuY3Rpb24gcGFyc2VJc28gKGlucCwgc2lnbikgew0KICAgIC8vIFdlJ2Qgbm9ybWFsbHkgdXNlIH5+aW5wIGZvciB0aGlzLCBidXQgdW5mb3J0dW5hdGVseSBpdCBhbHNvDQogICAgLy8gY29udmVydHMgZmxvYXRzIHRvIGludHMuDQogICAgLy8gaW5wIG1heSBiZSB1bmRlZmluZWQsIHNvIGNhcmVmdWwgY2FsbGluZyByZXBsYWNlIG9uIGl0Lg0KICAgIHZhciByZXMgPSBpbnAgJiYgcGFyc2VGbG9hdChpbnAucmVwbGFjZSgnLCcsICcuJykpOw0KICAgIC8vIGFwcGx5IHNpZ24gd2hpbGUgd2UncmUgYXQgaXQNCiAgICByZXR1cm4gKGlzTmFOKHJlcykgPyAwIDogcmVzKSAqIHNpZ247DQp9DQoNCmZ1bmN0aW9uIHBvc2l0aXZlTW9tZW50c0RpZmZlcmVuY2UoYmFzZSwgb3RoZXIpIHsNCiAgICB2YXIgcmVzID0ge21pbGxpc2Vjb25kczogMCwgbW9udGhzOiAwfTsNCg0KICAgIHJlcy5tb250aHMgPSBvdGhlci5tb250aCgpIC0gYmFzZS5tb250aCgpICsNCiAgICAgICAgKG90aGVyLnllYXIoKSAtIGJhc2UueWVhcigpKSAqIDEyOw0KICAgIGlmIChiYXNlLmNsb25lKCkuYWRkKHJlcy5tb250aHMsICdNJykuaXNBZnRlcihvdGhlcikpIHsNCiAgICAgICAgLS1yZXMubW9udGhzOw0KICAgIH0NCg0KICAgIHJlcy5taWxsaXNlY29uZHMgPSArb3RoZXIgLSArKGJhc2UuY2xvbmUoKS5hZGQocmVzLm1vbnRocywgJ00nKSk7DQoNCiAgICByZXR1cm4gcmVzOw0KfQ0KDQpmdW5jdGlvbiBtb21lbnRzRGlmZmVyZW5jZShiYXNlLCBvdGhlcikgew0KICAgIHZhciByZXM7DQogICAgaWYgKCEoYmFzZS5pc1ZhbGlkKCkgJiYgb3RoZXIuaXNWYWxpZCgpKSkgew0KICAgICAgICByZXR1cm4ge21pbGxpc2Vjb25kczogMCwgbW9udGhzOiAwfTsNCiAgICB9DQoNCiAgICBvdGhlciA9IGNsb25lV2l0aE9mZnNldChvdGhlciwgYmFzZSk7DQogICAgaWYgKGJhc2UuaXNCZWZvcmUob3RoZXIpKSB7DQogICAgICAgIHJlcyA9IHBvc2l0aXZlTW9tZW50c0RpZmZlcmVuY2UoYmFzZSwgb3RoZXIpOw0KICAgIH0gZWxzZSB7DQogICAgICAgIHJlcyA9IHBvc2l0aXZlTW9tZW50c0RpZmZlcmVuY2Uob3RoZXIsIGJhc2UpOw0KICAgICAgICByZXMubWlsbGlzZWNvbmRzID0gLXJlcy5taWxsaXNlY29uZHM7DQogICAgICAgIHJlcy5tb250aHMgPSAtcmVzLm1vbnRoczsNCiAgICB9DQoNCiAgICByZXR1cm4gcmVzOw0KfQ0KDQovLyBUT0RPOiByZW1vdmUgJ25hbWUnIGFyZyBhZnRlciBkZXByZWNhdGlvbiBpcyByZW1vdmVkDQpmdW5jdGlvbiBjcmVhdGVBZGRlcihkaXJlY3Rpb24sIG5hbWUpIHsNCiAgICByZXR1cm4gZnVuY3Rpb24gKHZhbCwgcGVyaW9kKSB7DQogICAgICAgIHZhciBkdXIsIHRtcDsNCiAgICAgICAgLy9pbnZlcnQgdGhlIGFyZ3VtZW50cywgYnV0IGNvbXBsYWluIGFib3V0IGl0DQogICAgICAgIGlmIChwZXJpb2QgIT09IG51bGwgJiYgIWlzTmFOKCtwZXJpb2QpKSB7DQogICAgICAgICAgICBkZXByZWNhdGVTaW1wbGUobmFtZSwgJ21vbWVudCgpLicgKyBuYW1lICArICcocGVyaW9kLCBudW1iZXIpIGlzIGRlcHJlY2F0ZWQuIFBsZWFzZSB1c2UgbW9tZW50KCkuJyArIG5hbWUgKyAnKG51bWJlciwgcGVyaW9kKS4gJyArDQogICAgICAgICAgICAnU2VlIGh0dHA6Ly9tb21lbnRqcy5jb20vZ3VpZGVzLyMvd2FybmluZ3MvYWRkLWludmVydGVkLXBhcmFtLyBmb3IgbW9yZSBpbmZvLicpOw0KICAgICAgICAgICAgdG1wID0gdmFsOyB2YWwgPSBwZXJpb2Q7IHBlcmlvZCA9IHRtcDsNCiAgICAgICAgfQ0KDQogICAgICAgIHZhbCA9IHR5cGVvZiB2YWwgPT09ICdzdHJpbmcnID8gK3ZhbCA6IHZhbDsNCiAgICAgICAgZHVyID0gY3JlYXRlRHVyYXRpb24odmFsLCBwZXJpb2QpOw0KICAgICAgICBhZGRTdWJ0cmFjdCh0aGlzLCBkdXIsIGRpcmVjdGlvbik7DQogICAgICAgIHJldHVybiB0aGlzOw0KICAgIH07DQp9DQoNCmZ1bmN0aW9uIGFkZFN1YnRyYWN0IChtb20sIGR1cmF0aW9uLCBpc0FkZGluZywgdXBkYXRlT2Zmc2V0KSB7DQogICAgdmFyIG1pbGxpc2Vjb25kcyA9IGR1cmF0aW9uLl9taWxsaXNlY29uZHMsDQogICAgICAgIGRheXMgPSBhYnNSb3VuZChkdXJhdGlvbi5fZGF5cyksDQogICAgICAgIG1vbnRocyA9IGFic1JvdW5kKGR1cmF0aW9uLl9tb250aHMpOw0KDQogICAgaWYgKCFtb20uaXNWYWxpZCgpKSB7DQogICAgICAgIC8vIE5vIG9wDQogICAgICAgIHJldHVybjsNCiAgICB9DQoNCiAgICB1cGRhdGVPZmZzZXQgPSB1cGRhdGVPZmZzZXQgPT0gbnVsbCA/IHRydWUgOiB1cGRhdGVPZmZzZXQ7DQoNCiAgICBpZiAobWlsbGlzZWNvbmRzKSB7DQogICAgICAgIG1vbS5fZC5zZXRUaW1lKG1vbS5fZC52YWx1ZU9mKCkgKyBtaWxsaXNlY29uZHMgKiBpc0FkZGluZyk7DQogICAgfQ0KICAgIGlmIChkYXlzKSB7DQogICAgICAgIHNldCQxKG1vbSwgJ0RhdGUnLCBnZXQobW9tLCAnRGF0ZScpICsgZGF5cyAqIGlzQWRkaW5nKTsNCiAgICB9DQogICAgaWYgKG1vbnRocykgew0KICAgICAgICBzZXRNb250aChtb20sIGdldChtb20sICdNb250aCcpICsgbW9udGhzICogaXNBZGRpbmcpOw0KICAgIH0NCiAgICBpZiAodXBkYXRlT2Zmc2V0KSB7DQogICAgICAgIGhvb2tzLnVwZGF0ZU9mZnNldChtb20sIGRheXMgfHwgbW9udGhzKTsNCiAgICB9DQp9DQoNCnZhciBhZGQgICAgICA9IGNyZWF0ZUFkZGVyKDEsICdhZGQnKTsNCnZhciBzdWJ0cmFjdCA9IGNyZWF0ZUFkZGVyKC0xLCAnc3VidHJhY3QnKTsNCg0KZnVuY3Rpb24gZ2V0Q2FsZW5kYXJGb3JtYXQobXlNb21lbnQsIG5vdykgew0KICAgIHZhciBkaWZmID0gbXlNb21lbnQuZGlmZihub3csICdkYXlzJywgdHJ1ZSk7DQogICAgcmV0dXJuIGRpZmYgPCAtNiA/ICdzYW1lRWxzZScgOg0KICAgICAgICAgICAgZGlmZiA8IC0xID8gJ2xhc3RXZWVrJyA6DQogICAgICAgICAgICBkaWZmIDwgMCA/ICdsYXN0RGF5JyA6DQogICAgICAgICAgICBkaWZmIDwgMSA/ICdzYW1lRGF5JyA6DQogICAgICAgICAgICBkaWZmIDwgMiA/ICduZXh0RGF5JyA6DQogICAgICAgICAgICBkaWZmIDwgNyA/ICduZXh0V2VlaycgOiAnc2FtZUVsc2UnOw0KfQ0KDQpmdW5jdGlvbiBjYWxlbmRhciQxICh0aW1lLCBmb3JtYXRzKSB7DQogICAgLy8gV2Ugd2FudCB0byBjb21wYXJlIHRoZSBzdGFydCBvZiB0b2RheSwgdnMgdGhpcy4NCiAgICAvLyBHZXR0aW5nIHN0YXJ0LW9mLXRvZGF5IGRlcGVuZHMgb24gd2hldGhlciB3ZSdyZSBsb2NhbC91dGMvb2Zmc2V0IG9yIG5vdC4NCiAgICB2YXIgbm93ID0gdGltZSB8fCBjcmVhdGVMb2NhbCgpLA0KICAgICAgICBzb2QgPSBjbG9uZVdpdGhPZmZzZXQobm93LCB0aGlzKS5zdGFydE9mKCdkYXknKSwNCiAgICAgICAgZm9ybWF0ID0gaG9va3MuY2FsZW5kYXJGb3JtYXQodGhpcywgc29kKSB8fCAnc2FtZUVsc2UnOw0KDQogICAgdmFyIG91dHB1dCA9IGZvcm1hdHMgJiYgKGlzRnVuY3Rpb24oZm9ybWF0c1tmb3JtYXRdKSA/IGZvcm1hdHNbZm9ybWF0XS5jYWxsKHRoaXMsIG5vdykgOiBmb3JtYXRzW2Zvcm1hdF0pOw0KDQogICAgcmV0dXJuIHRoaXMuZm9ybWF0KG91dHB1dCB8fCB0aGlzLmxvY2FsZURhdGEoKS5jYWxlbmRhcihmb3JtYXQsIHRoaXMsIGNyZWF0ZUxvY2FsKG5vdykpKTsNCn0NCg0KZnVuY3Rpb24gY2xvbmUgKCkgew0KICAgIHJldHVybiBuZXcgTW9tZW50KHRoaXMpOw0KfQ0KDQpmdW5jdGlvbiBpc0FmdGVyIChpbnB1dCwgdW5pdHMpIHsNCiAgICB2YXIgbG9jYWxJbnB1dCA9IGlzTW9tZW50KGlucHV0KSA/IGlucHV0IDogY3JlYXRlTG9jYWwoaW5wdXQpOw0KICAgIGlmICghKHRoaXMuaXNWYWxpZCgpICYmIGxvY2FsSW5wdXQuaXNWYWxpZCgpKSkgew0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgfQ0KICAgIHVuaXRzID0gbm9ybWFsaXplVW5pdHMoIWlzVW5kZWZpbmVkKHVuaXRzKSA/IHVuaXRzIDogJ21pbGxpc2Vjb25kJyk7DQogICAgaWYgKHVuaXRzID09PSAnbWlsbGlzZWNvbmQnKSB7DQogICAgICAgIHJldHVybiB0aGlzLnZhbHVlT2YoKSA+IGxvY2FsSW5wdXQudmFsdWVPZigpOw0KICAgIH0gZWxzZSB7DQogICAgICAgIHJldHVybiBsb2NhbElucHV0LnZhbHVlT2YoKSA8IHRoaXMuY2xvbmUoKS5zdGFydE9mKHVuaXRzKS52YWx1ZU9mKCk7DQogICAgfQ0KfQ0KDQpmdW5jdGlvbiBpc0JlZm9yZSAoaW5wdXQsIHVuaXRzKSB7DQogICAgdmFyIGxvY2FsSW5wdXQgPSBpc01vbWVudChpbnB1dCkgPyBpbnB1dCA6IGNyZWF0ZUxvY2FsKGlucHV0KTsNCiAgICBpZiAoISh0aGlzLmlzVmFsaWQoKSAmJiBsb2NhbElucHV0LmlzVmFsaWQoKSkpIHsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCiAgICB1bml0cyA9IG5vcm1hbGl6ZVVuaXRzKCFpc1VuZGVmaW5lZCh1bml0cykgPyB1bml0cyA6ICdtaWxsaXNlY29uZCcpOw0KICAgIGlmICh1bml0cyA9PT0gJ21pbGxpc2Vjb25kJykgew0KICAgICAgICByZXR1cm4gdGhpcy52YWx1ZU9mKCkgPCBsb2NhbElucHV0LnZhbHVlT2YoKTsNCiAgICB9IGVsc2Ugew0KICAgICAgICByZXR1cm4gdGhpcy5jbG9uZSgpLmVuZE9mKHVuaXRzKS52YWx1ZU9mKCkgPCBsb2NhbElucHV0LnZhbHVlT2YoKTsNCiAgICB9DQp9DQoNCmZ1bmN0aW9uIGlzQmV0d2VlbiAoZnJvbSwgdG8sIHVuaXRzLCBpbmNsdXNpdml0eSkgew0KICAgIGluY2x1c2l2aXR5ID0gaW5jbHVzaXZpdHkgfHwgJygpJzsNCiAgICByZXR1cm4gKGluY2x1c2l2aXR5WzBdID09PSAnKCcgPyB0aGlzLmlzQWZ0ZXIoZnJvbSwgdW5pdHMpIDogIXRoaXMuaXNCZWZvcmUoZnJvbSwgdW5pdHMpKSAmJg0KICAgICAgICAoaW5jbHVzaXZpdHlbMV0gPT09ICcpJyA/IHRoaXMuaXNCZWZvcmUodG8sIHVuaXRzKSA6ICF0aGlzLmlzQWZ0ZXIodG8sIHVuaXRzKSk7DQp9DQoNCmZ1bmN0aW9uIGlzU2FtZSAoaW5wdXQsIHVuaXRzKSB7DQogICAgdmFyIGxvY2FsSW5wdXQgPSBpc01vbWVudChpbnB1dCkgPyBpbnB1dCA6IGNyZWF0ZUxvY2FsKGlucHV0KSwNCiAgICAgICAgaW5wdXRNczsNCiAgICBpZiAoISh0aGlzLmlzVmFsaWQoKSAmJiBsb2NhbElucHV0LmlzVmFsaWQoKSkpIHsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCiAgICB1bml0cyA9IG5vcm1hbGl6ZVVuaXRzKHVuaXRzIHx8ICdtaWxsaXNlY29uZCcpOw0KICAgIGlmICh1bml0cyA9PT0gJ21pbGxpc2Vjb25kJykgew0KICAgICAgICByZXR1cm4gdGhpcy52YWx1ZU9mKCkgPT09IGxvY2FsSW5wdXQudmFsdWVPZigpOw0KICAgIH0gZWxzZSB7DQogICAgICAgIGlucHV0TXMgPSBsb2NhbElucHV0LnZhbHVlT2YoKTsNCiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoKS5zdGFydE9mKHVuaXRzKS52YWx1ZU9mKCkgPD0gaW5wdXRNcyAmJiBpbnB1dE1zIDw9IHRoaXMuY2xvbmUoKS5lbmRPZih1bml0cykudmFsdWVPZigpOw0KICAgIH0NCn0NCg0KZnVuY3Rpb24gaXNTYW1lT3JBZnRlciAoaW5wdXQsIHVuaXRzKSB7DQogICAgcmV0dXJuIHRoaXMuaXNTYW1lKGlucHV0LCB1bml0cykgfHwgdGhpcy5pc0FmdGVyKGlucHV0LHVuaXRzKTsNCn0NCg0KZnVuY3Rpb24gaXNTYW1lT3JCZWZvcmUgKGlucHV0LCB1bml0cykgew0KICAgIHJldHVybiB0aGlzLmlzU2FtZShpbnB1dCwgdW5pdHMpIHx8IHRoaXMuaXNCZWZvcmUoaW5wdXQsdW5pdHMpOw0KfQ0KDQpmdW5jdGlvbiBkaWZmIChpbnB1dCwgdW5pdHMsIGFzRmxvYXQpIHsNCiAgICB2YXIgdGhhdCwNCiAgICAgICAgem9uZURlbHRhLA0KICAgICAgICBkZWx0YSwgb3V0cHV0Ow0KDQogICAgaWYgKCF0aGlzLmlzVmFsaWQoKSkgew0KICAgICAgICByZXR1cm4gTmFOOw0KICAgIH0NCg0KICAgIHRoYXQgPSBjbG9uZVdpdGhPZmZzZXQoaW5wdXQsIHRoaXMpOw0KDQogICAgaWYgKCF0aGF0LmlzVmFsaWQoKSkgew0KICAgICAgICByZXR1cm4gTmFOOw0KICAgIH0NCg0KICAgIHpvbmVEZWx0YSA9ICh0aGF0LnV0Y09mZnNldCgpIC0gdGhpcy51dGNPZmZzZXQoKSkgKiA2ZTQ7DQoNCiAgICB1bml0cyA9IG5vcm1hbGl6ZVVuaXRzKHVuaXRzKTsNCg0KICAgIGlmICh1bml0cyA9PT0gJ3llYXInIHx8IHVuaXRzID09PSAnbW9udGgnIHx8IHVuaXRzID09PSAncXVhcnRlcicpIHsNCiAgICAgICAgb3V0cHV0ID0gbW9udGhEaWZmKHRoaXMsIHRoYXQpOw0KICAgICAgICBpZiAodW5pdHMgPT09ICdxdWFydGVyJykgew0KICAgICAgICAgICAgb3V0cHV0ID0gb3V0cHV0IC8gMzsNCiAgICAgICAgfSBlbHNlIGlmICh1bml0cyA9PT0gJ3llYXInKSB7DQogICAgICAgICAgICBvdXRwdXQgPSBvdXRwdXQgLyAxMjsNCiAgICAgICAgfQ0KICAgIH0gZWxzZSB7DQogICAgICAgIGRlbHRhID0gdGhpcyAtIHRoYXQ7DQogICAgICAgIG91dHB1dCA9IHVuaXRzID09PSAnc2Vjb25kJyA/IGRlbHRhIC8gMWUzIDogLy8gMTAwMA0KICAgICAgICAgICAgdW5pdHMgPT09ICdtaW51dGUnID8gZGVsdGEgLyA2ZTQgOiAvLyAxMDAwICogNjANCiAgICAgICAgICAgIHVuaXRzID09PSAnaG91cicgPyBkZWx0YSAvIDM2ZTUgOiAvLyAxMDAwICogNjAgKiA2MA0KICAgICAgICAgICAgdW5pdHMgPT09ICdkYXknID8gKGRlbHRhIC0gem9uZURlbHRhKSAvIDg2NGU1IDogLy8gMTAwMCAqIDYwICogNjAgKiAyNCwgbmVnYXRlIGRzdA0KICAgICAgICAgICAgdW5pdHMgPT09ICd3ZWVrJyA/IChkZWx0YSAtIHpvbmVEZWx0YSkgLyA2MDQ4ZTUgOiAvLyAxMDAwICogNjAgKiA2MCAqIDI0ICogNywgbmVnYXRlIGRzdA0KICAgICAgICAgICAgZGVsdGE7DQogICAgfQ0KICAgIHJldHVybiBhc0Zsb2F0ID8gb3V0cHV0IDogYWJzRmxvb3Iob3V0cHV0KTsNCn0NCg0KZnVuY3Rpb24gbW9udGhEaWZmIChhLCBiKSB7DQogICAgLy8gZGlmZmVyZW5jZSBpbiBtb250aHMNCiAgICB2YXIgd2hvbGVNb250aERpZmYgPSAoKGIueWVhcigpIC0gYS55ZWFyKCkpICogMTIpICsgKGIubW9udGgoKSAtIGEubW9udGgoKSksDQogICAgICAgIC8vIGIgaXMgaW4gKGFuY2hvciAtIDEgbW9udGgsIGFuY2hvciArIDEgbW9udGgpDQogICAgICAgIGFuY2hvciA9IGEuY2xvbmUoKS5hZGQod2hvbGVNb250aERpZmYsICdtb250aHMnKSwNCiAgICAgICAgYW5jaG9yMiwgYWRqdXN0Ow0KDQogICAgaWYgKGIgLSBhbmNob3IgPCAwKSB7DQogICAgICAgIGFuY2hvcjIgPSBhLmNsb25lKCkuYWRkKHdob2xlTW9udGhEaWZmIC0gMSwgJ21vbnRocycpOw0KICAgICAgICAvLyBsaW5lYXIgYWNyb3NzIHRoZSBtb250aA0KICAgICAgICBhZGp1c3QgPSAoYiAtIGFuY2hvcikgLyAoYW5jaG9yIC0gYW5jaG9yMik7DQogICAgfSBlbHNlIHsNCiAgICAgICAgYW5jaG9yMiA9IGEuY2xvbmUoKS5hZGQod2hvbGVNb250aERpZmYgKyAxLCAnbW9udGhzJyk7DQogICAgICAgIC8vIGxpbmVhciBhY3Jvc3MgdGhlIG1vbnRoDQogICAgICAgIGFkanVzdCA9IChiIC0gYW5jaG9yKSAvIChhbmNob3IyIC0gYW5jaG9yKTsNCiAgICB9DQoNCiAgICAvL2NoZWNrIGZvciBuZWdhdGl2ZSB6ZXJvLCByZXR1cm4gemVybyBpZiBuZWdhdGl2ZSB6ZXJvDQogICAgcmV0dXJuIC0od2hvbGVNb250aERpZmYgKyBhZGp1c3QpIHx8IDA7DQp9DQoNCmhvb2tzLmRlZmF1bHRGb3JtYXQgPSAnWVlZWS1NTS1ERFRISDptbTpzc1onOw0KaG9va3MuZGVmYXVsdEZvcm1hdFV0YyA9ICdZWVlZLU1NLUREVEhIOm1tOnNzW1pdJzsNCg0KZnVuY3Rpb24gdG9TdHJpbmcgKCkgew0KICAgIHJldHVybiB0aGlzLmNsb25lKCkubG9jYWxlKCdlbicpLmZvcm1hdCgnZGRkIE1NTSBERCBZWVlZIEhIOm1tOnNzIFtHTVRdWlonKTsNCn0NCg0KZnVuY3Rpb24gdG9JU09TdHJpbmcoKSB7DQogICAgaWYgKCF0aGlzLmlzVmFsaWQoKSkgew0KICAgICAgICByZXR1cm4gbnVsbDsNCiAgICB9DQogICAgdmFyIG0gPSB0aGlzLmNsb25lKCkudXRjKCk7DQogICAgaWYgKG0ueWVhcigpIDwgMCB8fCBtLnllYXIoKSA+IDk5OTkpIHsNCiAgICAgICAgcmV0dXJuIGZvcm1hdE1vbWVudChtLCAnWVlZWVlZLU1NLUREW1RdSEg6bW06c3MuU1NTW1pdJyk7DQogICAgfQ0KICAgIGlmIChpc0Z1bmN0aW9uKERhdGUucHJvdG90eXBlLnRvSVNPU3RyaW5nKSkgew0KICAgICAgICAvLyBuYXRpdmUgaW1wbGVtZW50YXRpb24gaXMgfjUweCBmYXN0ZXIsIHVzZSBpdCB3aGVuIHdlIGNhbg0KICAgICAgICByZXR1cm4gdGhpcy50b0RhdGUoKS50b0lTT1N0cmluZygpOw0KICAgIH0NCiAgICByZXR1cm4gZm9ybWF0TW9tZW50KG0sICdZWVlZLU1NLUREW1RdSEg6bW06c3MuU1NTW1pdJyk7DQp9DQoNCi8qKg0KICogUmV0dXJuIGEgaHVtYW4gcmVhZGFibGUgcmVwcmVzZW50YXRpb24gb2YgYSBtb21lbnQgdGhhdCBjYW4NCiAqIGFsc28gYmUgZXZhbHVhdGVkIHRvIGdldCBhIG5ldyBtb21lbnQgd2hpY2ggaXMgdGhlIHNhbWUNCiAqDQogKiBAbGluayBodHRwczovL25vZGVqcy5vcmcvZGlzdC9sYXRlc3QvZG9jcy9hcGkvdXRpbC5odG1sI3V0aWxfY3VzdG9tX2luc3BlY3RfZnVuY3Rpb25fb25fb2JqZWN0cw0KICovDQpmdW5jdGlvbiBpbnNwZWN0ICgpIHsNCiAgICBpZiAoIXRoaXMuaXNWYWxpZCgpKSB7DQogICAgICAgIHJldHVybiAnbW9tZW50LmludmFsaWQoLyogJyArIHRoaXMuX2kgKyAnICovKSc7DQogICAgfQ0KICAgIHZhciBmdW5jID0gJ21vbWVudCc7DQogICAgdmFyIHpvbmUgPSAnJzsNCiAgICBpZiAoIXRoaXMuaXNMb2NhbCgpKSB7DQogICAgICAgIGZ1bmMgPSB0aGlzLnV0Y09mZnNldCgpID09PSAwID8gJ21vbWVudC51dGMnIDogJ21vbWVudC5wYXJzZVpvbmUnOw0KICAgICAgICB6b25lID0gJ1onOw0KICAgIH0NCiAgICB2YXIgcHJlZml4ID0gJ1snICsgZnVuYyArICcoIl0nOw0KICAgIHZhciB5ZWFyID0gKDAgPD0gdGhpcy55ZWFyKCkgJiYgdGhpcy55ZWFyKCkgPD0gOTk5OSkgPyAnWVlZWScgOiAnWVlZWVlZJzsNCiAgICB2YXIgZGF0ZXRpbWUgPSAnLU1NLUREW1RdSEg6bW06c3MuU1NTJzsNCiAgICB2YXIgc3VmZml4ID0gem9uZSArICdbIildJzsNCg0KICAgIHJldHVybiB0aGlzLmZvcm1hdChwcmVmaXggKyB5ZWFyICsgZGF0ZXRpbWUgKyBzdWZmaXgpOw0KfQ0KDQpmdW5jdGlvbiBmb3JtYXQgKGlucHV0U3RyaW5nKSB7DQogICAgaWYgKCFpbnB1dFN0cmluZykgew0KICAgICAgICBpbnB1dFN0cmluZyA9IHRoaXMuaXNVdGMoKSA/IGhvb2tzLmRlZmF1bHRGb3JtYXRVdGMgOiBob29rcy5kZWZhdWx0Rm9ybWF0Ow0KICAgIH0NCiAgICB2YXIgb3V0cHV0ID0gZm9ybWF0TW9tZW50KHRoaXMsIGlucHV0U3RyaW5nKTsNCiAgICByZXR1cm4gdGhpcy5sb2NhbGVEYXRhKCkucG9zdGZvcm1hdChvdXRwdXQpOw0KfQ0KDQpmdW5jdGlvbiBmcm9tICh0aW1lLCB3aXRob3V0U3VmZml4KSB7DQogICAgaWYgKHRoaXMuaXNWYWxpZCgpICYmDQogICAgICAgICAgICAoKGlzTW9tZW50KHRpbWUpICYmIHRpbWUuaXNWYWxpZCgpKSB8fA0KICAgICAgICAgICAgIGNyZWF0ZUxvY2FsKHRpbWUpLmlzVmFsaWQoKSkpIHsNCiAgICAgICAgcmV0dXJuIGNyZWF0ZUR1cmF0aW9uKHt0bzogdGhpcywgZnJvbTogdGltZX0pLmxvY2FsZSh0aGlzLmxvY2FsZSgpKS5odW1hbml6ZSghd2l0aG91dFN1ZmZpeCk7DQogICAgfSBlbHNlIHsNCiAgICAgICAgcmV0dXJuIHRoaXMubG9jYWxlRGF0YSgpLmludmFsaWREYXRlKCk7DQogICAgfQ0KfQ0KDQpmdW5jdGlvbiBmcm9tTm93ICh3aXRob3V0U3VmZml4KSB7DQogICAgcmV0dXJuIHRoaXMuZnJvbShjcmVhdGVMb2NhbCgpLCB3aXRob3V0U3VmZml4KTsNCn0NCg0KZnVuY3Rpb24gdG8gKHRpbWUsIHdpdGhvdXRTdWZmaXgpIHsNCiAgICBpZiAodGhpcy5pc1ZhbGlkKCkgJiYNCiAgICAgICAgICAgICgoaXNNb21lbnQodGltZSkgJiYgdGltZS5pc1ZhbGlkKCkpIHx8DQogICAgICAgICAgICAgY3JlYXRlTG9jYWwodGltZSkuaXNWYWxpZCgpKSkgew0KICAgICAgICByZXR1cm4gY3JlYXRlRHVyYXRpb24oe2Zyb206IHRoaXMsIHRvOiB0aW1lfSkubG9jYWxlKHRoaXMubG9jYWxlKCkpLmh1bWFuaXplKCF3aXRob3V0U3VmZml4KTsNCiAgICB9IGVsc2Ugew0KICAgICAgICByZXR1cm4gdGhpcy5sb2NhbGVEYXRhKCkuaW52YWxpZERhdGUoKTsNCiAgICB9DQp9DQoNCmZ1bmN0aW9uIHRvTm93ICh3aXRob3V0U3VmZml4KSB7DQogICAgcmV0dXJuIHRoaXMudG8oY3JlYXRlTG9jYWwoKSwgd2l0aG91dFN1ZmZpeCk7DQp9DQoNCi8vIElmIHBhc3NlZCBhIGxvY2FsZSBrZXksIGl0IHdpbGwgc2V0IHRoZSBsb2NhbGUgZm9yIHRoaXMNCi8vIGluc3RhbmNlLiAgT3RoZXJ3aXNlLCBpdCB3aWxsIHJldHVybiB0aGUgbG9jYWxlIGNvbmZpZ3VyYXRpb24NCi8vIHZhcmlhYmxlcyBmb3IgdGhpcyBpbnN0YW5jZS4NCmZ1bmN0aW9uIGxvY2FsZSAoa2V5KSB7DQogICAgdmFyIG5ld0xvY2FsZURhdGE7DQoNCiAgICBpZiAoa2V5ID09PSB1bmRlZmluZWQpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuX2xvY2FsZS5fYWJicjsNCiAgICB9IGVsc2Ugew0KICAgICAgICBuZXdMb2NhbGVEYXRhID0gZ2V0TG9jYWxlKGtleSk7DQogICAgICAgIGlmIChuZXdMb2NhbGVEYXRhICE9IG51bGwpIHsNCiAgICAgICAgICAgIHRoaXMuX2xvY2FsZSA9IG5ld0xvY2FsZURhdGE7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgfQ0KfQ0KDQp2YXIgbGFuZyA9IGRlcHJlY2F0ZSgNCiAgICAnbW9tZW50KCkubGFuZygpIGlzIGRlcHJlY2F0ZWQuIEluc3RlYWQsIHVzZSBtb21lbnQoKS5sb2NhbGVEYXRhKCkgdG8gZ2V0IHRoZSBsYW5ndWFnZSBjb25maWd1cmF0aW9uLiBVc2UgbW9tZW50KCkubG9jYWxlKCkgdG8gY2hhbmdlIGxhbmd1YWdlcy4nLA0KICAgIGZ1bmN0aW9uIChrZXkpIHsNCiAgICAgICAgaWYgKGtleSA9PT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5sb2NhbGVEYXRhKCk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5sb2NhbGUoa2V5KTsNCiAgICAgICAgfQ0KICAgIH0NCik7DQoNCmZ1bmN0aW9uIGxvY2FsZURhdGEgKCkgew0KICAgIHJldHVybiB0aGlzLl9sb2NhbGU7DQp9DQoNCmZ1bmN0aW9uIHN0YXJ0T2YgKHVuaXRzKSB7DQogICAgdW5pdHMgPSBub3JtYWxpemVVbml0cyh1bml0cyk7DQogICAgLy8gdGhlIGZvbGxvd2luZyBzd2l0Y2ggaW50ZW50aW9uYWxseSBvbWl0cyBicmVhayBrZXl3b3Jkcw0KICAgIC8vIHRvIHV0aWxpemUgZmFsbGluZyB0aHJvdWdoIHRoZSBjYXNlcy4NCiAgICBzd2l0Y2ggKHVuaXRzKSB7DQogICAgICAgIGNhc2UgJ3llYXInOg0KICAgICAgICAgICAgdGhpcy5tb250aCgwKTsNCiAgICAgICAgICAgIC8qIGZhbGxzIHRocm91Z2ggKi8NCiAgICAgICAgY2FzZSAncXVhcnRlcic6DQogICAgICAgIGNhc2UgJ21vbnRoJzoNCiAgICAgICAgICAgIHRoaXMuZGF0ZSgxKTsNCiAgICAgICAgICAgIC8qIGZhbGxzIHRocm91Z2ggKi8NCiAgICAgICAgY2FzZSAnd2Vlayc6DQogICAgICAgIGNhc2UgJ2lzb1dlZWsnOg0KICAgICAgICBjYXNlICdkYXknOg0KICAgICAgICBjYXNlICdkYXRlJzoNCiAgICAgICAgICAgIHRoaXMuaG91cnMoMCk7DQogICAgICAgICAgICAvKiBmYWxscyB0aHJvdWdoICovDQogICAgICAgIGNhc2UgJ2hvdXInOg0KICAgICAgICAgICAgdGhpcy5taW51dGVzKDApOw0KICAgICAgICAgICAgLyogZmFsbHMgdGhyb3VnaCAqLw0KICAgICAgICBjYXNlICdtaW51dGUnOg0KICAgICAgICAgICAgdGhpcy5zZWNvbmRzKDApOw0KICAgICAgICAgICAgLyogZmFsbHMgdGhyb3VnaCAqLw0KICAgICAgICBjYXNlICdzZWNvbmQnOg0KICAgICAgICAgICAgdGhpcy5taWxsaXNlY29uZHMoMCk7DQogICAgfQ0KDQogICAgLy8gd2Vla3MgYXJlIGEgc3BlY2lhbCBjYXNlDQogICAgaWYgKHVuaXRzID09PSAnd2VlaycpIHsNCiAgICAgICAgdGhpcy53ZWVrZGF5KDApOw0KICAgIH0NCiAgICBpZiAodW5pdHMgPT09ICdpc29XZWVrJykgew0KICAgICAgICB0aGlzLmlzb1dlZWtkYXkoMSk7DQogICAgfQ0KDQogICAgLy8gcXVhcnRlcnMgYXJlIGFsc28gc3BlY2lhbA0KICAgIGlmICh1bml0cyA9PT0gJ3F1YXJ0ZXInKSB7DQogICAgICAgIHRoaXMubW9udGgoTWF0aC5mbG9vcih0aGlzLm1vbnRoKCkgLyAzKSAqIDMpOw0KICAgIH0NCg0KICAgIHJldHVybiB0aGlzOw0KfQ0KDQpmdW5jdGlvbiBlbmRPZiAodW5pdHMpIHsNCiAgICB1bml0cyA9IG5vcm1hbGl6ZVVuaXRzKHVuaXRzKTsNCiAgICBpZiAodW5pdHMgPT09IHVuZGVmaW5lZCB8fCB1bml0cyA9PT0gJ21pbGxpc2Vjb25kJykgew0KICAgICAgICByZXR1cm4gdGhpczsNCiAgICB9DQoNCiAgICAvLyAnZGF0ZScgaXMgYW4gYWxpYXMgZm9yICdkYXknLCBzbyBpdCBzaG91bGQgYmUgY29uc2lkZXJlZCBhcyBzdWNoLg0KICAgIGlmICh1bml0cyA9PT0gJ2RhdGUnKSB7DQogICAgICAgIHVuaXRzID0gJ2RheSc7DQogICAgfQ0KDQogICAgcmV0dXJuIHRoaXMuc3RhcnRPZih1bml0cykuYWRkKDEsICh1bml0cyA9PT0gJ2lzb1dlZWsnID8gJ3dlZWsnIDogdW5pdHMpKS5zdWJ0cmFjdCgxLCAnbXMnKTsNCn0NCg0KZnVuY3Rpb24gdmFsdWVPZiAoKSB7DQogICAgcmV0dXJuIHRoaXMuX2QudmFsdWVPZigpIC0gKCh0aGlzLl9vZmZzZXQgfHwgMCkgKiA2MDAwMCk7DQp9DQoNCmZ1bmN0aW9uIHVuaXggKCkgew0KICAgIHJldHVybiBNYXRoLmZsb29yKHRoaXMudmFsdWVPZigpIC8gMTAwMCk7DQp9DQoNCmZ1bmN0aW9uIHRvRGF0ZSAoKSB7DQogICAgcmV0dXJuIG5ldyBEYXRlKHRoaXMudmFsdWVPZigpKTsNCn0NCg0KZnVuY3Rpb24gdG9BcnJheSAoKSB7DQogICAgdmFyIG0gPSB0aGlzOw0KICAgIHJldHVybiBbbS55ZWFyKCksIG0ubW9udGgoKSwgbS5kYXRlKCksIG0uaG91cigpLCBtLm1pbnV0ZSgpLCBtLnNlY29uZCgpLCBtLm1pbGxpc2Vjb25kKCldOw0KfQ0KDQpmdW5jdGlvbiB0b09iamVjdCAoKSB7DQogICAgdmFyIG0gPSB0aGlzOw0KICAgIHJldHVybiB7DQogICAgICAgIHllYXJzOiBtLnllYXIoKSwNCiAgICAgICAgbW9udGhzOiBtLm1vbnRoKCksDQogICAgICAgIGRhdGU6IG0uZGF0ZSgpLA0KICAgICAgICBob3VyczogbS5ob3VycygpLA0KICAgICAgICBtaW51dGVzOiBtLm1pbnV0ZXMoKSwNCiAgICAgICAgc2Vjb25kczogbS5zZWNvbmRzKCksDQogICAgICAgIG1pbGxpc2Vjb25kczogbS5taWxsaXNlY29uZHMoKQ0KICAgIH07DQp9DQoNCmZ1bmN0aW9uIHRvSlNPTiAoKSB7DQogICAgLy8gbmV3IERhdGUoTmFOKS50b0pTT04oKSA9PT0gbnVsbA0KICAgIHJldHVybiB0aGlzLmlzVmFsaWQoKSA/IHRoaXMudG9JU09TdHJpbmcoKSA6IG51bGw7DQp9DQoNCmZ1bmN0aW9uIGlzVmFsaWQkMiAoKSB7DQogICAgcmV0dXJuIGlzVmFsaWQodGhpcyk7DQp9DQoNCmZ1bmN0aW9uIHBhcnNpbmdGbGFncyAoKSB7DQogICAgcmV0dXJuIGV4dGVuZCh7fSwgZ2V0UGFyc2luZ0ZsYWdzKHRoaXMpKTsNCn0NCg0KZnVuY3Rpb24gaW52YWxpZEF0ICgpIHsNCiAgICByZXR1cm4gZ2V0UGFyc2luZ0ZsYWdzKHRoaXMpLm92ZXJmbG93Ow0KfQ0KDQpmdW5jdGlvbiBjcmVhdGlvbkRhdGEoKSB7DQogICAgcmV0dXJuIHsNCiAgICAgICAgaW5wdXQ6IHRoaXMuX2ksDQogICAgICAgIGZvcm1hdDogdGhpcy5fZiwNCiAgICAgICAgbG9jYWxlOiB0aGlzLl9sb2NhbGUsDQogICAgICAgIGlzVVRDOiB0aGlzLl9pc1VUQywNCiAgICAgICAgc3RyaWN0OiB0aGlzLl9zdHJpY3QNCiAgICB9Ow0KfQ0KDQovLyBGT1JNQVRUSU5HDQoNCmFkZEZvcm1hdFRva2VuKDAsIFsnZ2cnLCAyXSwgMCwgZnVuY3Rpb24gKCkgew0KICAgIHJldHVybiB0aGlzLndlZWtZZWFyKCkgJSAxMDA7DQp9KTsNCg0KYWRkRm9ybWF0VG9rZW4oMCwgWydHRycsIDJdLCAwLCBmdW5jdGlvbiAoKSB7DQogICAgcmV0dXJuIHRoaXMuaXNvV2Vla1llYXIoKSAlIDEwMDsNCn0pOw0KDQpmdW5jdGlvbiBhZGRXZWVrWWVhckZvcm1hdFRva2VuICh0b2tlbiwgZ2V0dGVyKSB7DQogICAgYWRkRm9ybWF0VG9rZW4oMCwgW3Rva2VuLCB0b2tlbi5sZW5ndGhdLCAwLCBnZXR0ZXIpOw0KfQ0KDQphZGRXZWVrWWVhckZvcm1hdFRva2VuKCdnZ2dnJywgICAgICd3ZWVrWWVhcicpOw0KYWRkV2Vla1llYXJGb3JtYXRUb2tlbignZ2dnZ2cnLCAgICAnd2Vla1llYXInKTsNCmFkZFdlZWtZZWFyRm9ybWF0VG9rZW4oJ0dHR0cnLCAgJ2lzb1dlZWtZZWFyJyk7DQphZGRXZWVrWWVhckZvcm1hdFRva2VuKCdHR0dHRycsICdpc29XZWVrWWVhcicpOw0KDQovLyBBTElBU0VTDQoNCmFkZFVuaXRBbGlhcygnd2Vla1llYXInLCAnZ2cnKTsNCmFkZFVuaXRBbGlhcygnaXNvV2Vla1llYXInLCAnR0cnKTsNCg0KLy8gUFJJT1JJVFkNCg0KYWRkVW5pdFByaW9yaXR5KCd3ZWVrWWVhcicsIDEpOw0KYWRkVW5pdFByaW9yaXR5KCdpc29XZWVrWWVhcicsIDEpOw0KDQoNCi8vIFBBUlNJTkcNCg0KYWRkUmVnZXhUb2tlbignRycsICAgICAgbWF0Y2hTaWduZWQpOw0KYWRkUmVnZXhUb2tlbignZycsICAgICAgbWF0Y2hTaWduZWQpOw0KYWRkUmVnZXhUb2tlbignR0cnLCAgICAgbWF0Y2gxdG8yLCBtYXRjaDIpOw0KYWRkUmVnZXhUb2tlbignZ2cnLCAgICAgbWF0Y2gxdG8yLCBtYXRjaDIpOw0KYWRkUmVnZXhUb2tlbignR0dHRycsICAgbWF0Y2gxdG80LCBtYXRjaDQpOw0KYWRkUmVnZXhUb2tlbignZ2dnZycsICAgbWF0Y2gxdG80LCBtYXRjaDQpOw0KYWRkUmVnZXhUb2tlbignR0dHR0cnLCAgbWF0Y2gxdG82LCBtYXRjaDYpOw0KYWRkUmVnZXhUb2tlbignZ2dnZ2cnLCAgbWF0Y2gxdG82LCBtYXRjaDYpOw0KDQphZGRXZWVrUGFyc2VUb2tlbihbJ2dnZ2cnLCAnZ2dnZ2cnLCAnR0dHRycsICdHR0dHRyddLCBmdW5jdGlvbiAoaW5wdXQsIHdlZWssIGNvbmZpZywgdG9rZW4pIHsNCiAgICB3ZWVrW3Rva2VuLnN1YnN0cigwLCAyKV0gPSB0b0ludChpbnB1dCk7DQp9KTsNCg0KYWRkV2Vla1BhcnNlVG9rZW4oWydnZycsICdHRyddLCBmdW5jdGlvbiAoaW5wdXQsIHdlZWssIGNvbmZpZywgdG9rZW4pIHsNCiAgICB3ZWVrW3Rva2VuXSA9IGhvb2tzLnBhcnNlVHdvRGlnaXRZZWFyKGlucHV0KTsNCn0pOw0KDQovLyBNT01FTlRTDQoNCmZ1bmN0aW9uIGdldFNldFdlZWtZZWFyIChpbnB1dCkgew0KICAgIHJldHVybiBnZXRTZXRXZWVrWWVhckhlbHBlci5jYWxsKHRoaXMsDQogICAgICAgICAgICBpbnB1dCwNCiAgICAgICAgICAgIHRoaXMud2VlaygpLA0KICAgICAgICAgICAgdGhpcy53ZWVrZGF5KCksDQogICAgICAgICAgICB0aGlzLmxvY2FsZURhdGEoKS5fd2Vlay5kb3csDQogICAgICAgICAgICB0aGlzLmxvY2FsZURhdGEoKS5fd2Vlay5kb3kpOw0KfQ0KDQpmdW5jdGlvbiBnZXRTZXRJU09XZWVrWWVhciAoaW5wdXQpIHsNCiAgICByZXR1cm4gZ2V0U2V0V2Vla1llYXJIZWxwZXIuY2FsbCh0aGlzLA0KICAgICAgICAgICAgaW5wdXQsIHRoaXMuaXNvV2VlaygpLCB0aGlzLmlzb1dlZWtkYXkoKSwgMSwgNCk7DQp9DQoNCmZ1bmN0aW9uIGdldElTT1dlZWtzSW5ZZWFyICgpIHsNCiAgICByZXR1cm4gd2Vla3NJblllYXIodGhpcy55ZWFyKCksIDEsIDQpOw0KfQ0KDQpmdW5jdGlvbiBnZXRXZWVrc0luWWVhciAoKSB7DQogICAgdmFyIHdlZWtJbmZvID0gdGhpcy5sb2NhbGVEYXRhKCkuX3dlZWs7DQogICAgcmV0dXJuIHdlZWtzSW5ZZWFyKHRoaXMueWVhcigpLCB3ZWVrSW5mby5kb3csIHdlZWtJbmZvLmRveSk7DQp9DQoNCmZ1bmN0aW9uIGdldFNldFdlZWtZZWFySGVscGVyKGlucHV0LCB3ZWVrLCB3ZWVrZGF5LCBkb3csIGRveSkgew0KICAgIHZhciB3ZWVrc1RhcmdldDsNCiAgICBpZiAoaW5wdXQgPT0gbnVsbCkgew0KICAgICAgICByZXR1cm4gd2Vla09mWWVhcih0aGlzLCBkb3csIGRveSkueWVhcjsNCiAgICB9IGVsc2Ugew0KICAgICAgICB3ZWVrc1RhcmdldCA9IHdlZWtzSW5ZZWFyKGlucHV0LCBkb3csIGRveSk7DQogICAgICAgIGlmICh3ZWVrID4gd2Vla3NUYXJnZXQpIHsNCiAgICAgICAgICAgIHdlZWsgPSB3ZWVrc1RhcmdldDsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gc2V0V2Vla0FsbC5jYWxsKHRoaXMsIGlucHV0LCB3ZWVrLCB3ZWVrZGF5LCBkb3csIGRveSk7DQogICAgfQ0KfQ0KDQpmdW5jdGlvbiBzZXRXZWVrQWxsKHdlZWtZZWFyLCB3ZWVrLCB3ZWVrZGF5LCBkb3csIGRveSkgew0KICAgIHZhciBkYXlPZlllYXJEYXRhID0gZGF5T2ZZZWFyRnJvbVdlZWtzKHdlZWtZZWFyLCB3ZWVrLCB3ZWVrZGF5LCBkb3csIGRveSksDQogICAgICAgIGRhdGUgPSBjcmVhdGVVVENEYXRlKGRheU9mWWVhckRhdGEueWVhciwgMCwgZGF5T2ZZZWFyRGF0YS5kYXlPZlllYXIpOw0KDQogICAgdGhpcy55ZWFyKGRhdGUuZ2V0VVRDRnVsbFllYXIoKSk7DQogICAgdGhpcy5tb250aChkYXRlLmdldFVUQ01vbnRoKCkpOw0KICAgIHRoaXMuZGF0ZShkYXRlLmdldFVUQ0RhdGUoKSk7DQogICAgcmV0dXJuIHRoaXM7DQp9DQoNCi8vIEZPUk1BVFRJTkcNCg0KYWRkRm9ybWF0VG9rZW4oJ1EnLCAwLCAnUW8nLCAncXVhcnRlcicpOw0KDQovLyBBTElBU0VTDQoNCmFkZFVuaXRBbGlhcygncXVhcnRlcicsICdRJyk7DQoNCi8vIFBSSU9SSVRZDQoNCmFkZFVuaXRQcmlvcml0eSgncXVhcnRlcicsIDcpOw0KDQovLyBQQVJTSU5HDQoNCmFkZFJlZ2V4VG9rZW4oJ1EnLCBtYXRjaDEpOw0KYWRkUGFyc2VUb2tlbignUScsIGZ1bmN0aW9uIChpbnB1dCwgYXJyYXkpIHsNCiAgICBhcnJheVtNT05USF0gPSAodG9JbnQoaW5wdXQpIC0gMSkgKiAzOw0KfSk7DQoNCi8vIE1PTUVOVFMNCg0KZnVuY3Rpb24gZ2V0U2V0UXVhcnRlciAoaW5wdXQpIHsNCiAgICByZXR1cm4gaW5wdXQgPT0gbnVsbCA/IE1hdGguY2VpbCgodGhpcy5tb250aCgpICsgMSkgLyAzKSA6IHRoaXMubW9udGgoKGlucHV0IC0gMSkgKiAzICsgdGhpcy5tb250aCgpICUgMyk7DQp9DQoNCi8vIEZPUk1BVFRJTkcNCg0KYWRkRm9ybWF0VG9rZW4oJ0QnLCBbJ0REJywgMl0sICdEbycsICdkYXRlJyk7DQoNCi8vIEFMSUFTRVMNCg0KYWRkVW5pdEFsaWFzKCdkYXRlJywgJ0QnKTsNCg0KLy8gUFJJT1JPSVRZDQphZGRVbml0UHJpb3JpdHkoJ2RhdGUnLCA5KTsNCg0KLy8gUEFSU0lORw0KDQphZGRSZWdleFRva2VuKCdEJywgIG1hdGNoMXRvMik7DQphZGRSZWdleFRva2VuKCdERCcsIG1hdGNoMXRvMiwgbWF0Y2gyKTsNCmFkZFJlZ2V4VG9rZW4oJ0RvJywgZnVuY3Rpb24gKGlzU3RyaWN0LCBsb2NhbGUpIHsNCiAgICAvLyBUT0RPOiBSZW1vdmUgIm9yZGluYWxQYXJzZSIgZmFsbGJhY2sgaW4gbmV4dCBtYWpvciByZWxlYXNlLg0KICAgIHJldHVybiBpc1N0cmljdCA/DQogICAgICAobG9jYWxlLl9kYXlPZk1vbnRoT3JkaW5hbFBhcnNlIHx8IGxvY2FsZS5fb3JkaW5hbFBhcnNlKSA6DQogICAgICBsb2NhbGUuX2RheU9mTW9udGhPcmRpbmFsUGFyc2VMZW5pZW50Ow0KfSk7DQoNCmFkZFBhcnNlVG9rZW4oWydEJywgJ0REJ10sIERBVEUpOw0KYWRkUGFyc2VUb2tlbignRG8nLCBmdW5jdGlvbiAoaW5wdXQsIGFycmF5KSB7DQogICAgYXJyYXlbREFURV0gPSB0b0ludChpbnB1dC5tYXRjaChtYXRjaDF0bzIpWzBdLCAxMCk7DQp9KTsNCg0KLy8gTU9NRU5UUw0KDQp2YXIgZ2V0U2V0RGF5T2ZNb250aCA9IG1ha2VHZXRTZXQoJ0RhdGUnLCB0cnVlKTsNCg0KLy8gRk9STUFUVElORw0KDQphZGRGb3JtYXRUb2tlbignREREJywgWydEREREJywgM10sICdERERvJywgJ2RheU9mWWVhcicpOw0KDQovLyBBTElBU0VTDQoNCmFkZFVuaXRBbGlhcygnZGF5T2ZZZWFyJywgJ0RERCcpOw0KDQovLyBQUklPUklUWQ0KYWRkVW5pdFByaW9yaXR5KCdkYXlPZlllYXInLCA0KTsNCg0KLy8gUEFSU0lORw0KDQphZGRSZWdleFRva2VuKCdEREQnLCAgbWF0Y2gxdG8zKTsNCmFkZFJlZ2V4VG9rZW4oJ0REREQnLCBtYXRjaDMpOw0KYWRkUGFyc2VUb2tlbihbJ0RERCcsICdEREREJ10sIGZ1bmN0aW9uIChpbnB1dCwgYXJyYXksIGNvbmZpZykgew0KICAgIGNvbmZpZy5fZGF5T2ZZZWFyID0gdG9JbnQoaW5wdXQpOw0KfSk7DQoNCi8vIEhFTFBFUlMNCg0KLy8gTU9NRU5UUw0KDQpmdW5jdGlvbiBnZXRTZXREYXlPZlllYXIgKGlucHV0KSB7DQogICAgdmFyIGRheU9mWWVhciA9IE1hdGgucm91bmQoKHRoaXMuY2xvbmUoKS5zdGFydE9mKCdkYXknKSAtIHRoaXMuY2xvbmUoKS5zdGFydE9mKCd5ZWFyJykpIC8gODY0ZTUpICsgMTsNCiAgICByZXR1cm4gaW5wdXQgPT0gbnVsbCA/IGRheU9mWWVhciA6IHRoaXMuYWRkKChpbnB1dCAtIGRheU9mWWVhciksICdkJyk7DQp9DQoNCi8vIEZPUk1BVFRJTkcNCg0KYWRkRm9ybWF0VG9rZW4oJ20nLCBbJ21tJywgMl0sIDAsICdtaW51dGUnKTsNCg0KLy8gQUxJQVNFUw0KDQphZGRVbml0QWxpYXMoJ21pbnV0ZScsICdtJyk7DQoNCi8vIFBSSU9SSVRZDQoNCmFkZFVuaXRQcmlvcml0eSgnbWludXRlJywgMTQpOw0KDQovLyBQQVJTSU5HDQoNCmFkZFJlZ2V4VG9rZW4oJ20nLCAgbWF0Y2gxdG8yKTsNCmFkZFJlZ2V4VG9rZW4oJ21tJywgbWF0Y2gxdG8yLCBtYXRjaDIpOw0KYWRkUGFyc2VUb2tlbihbJ20nLCAnbW0nXSwgTUlOVVRFKTsNCg0KLy8gTU9NRU5UUw0KDQp2YXIgZ2V0U2V0TWludXRlID0gbWFrZUdldFNldCgnTWludXRlcycsIGZhbHNlKTsNCg0KLy8gRk9STUFUVElORw0KDQphZGRGb3JtYXRUb2tlbigncycsIFsnc3MnLCAyXSwgMCwgJ3NlY29uZCcpOw0KDQovLyBBTElBU0VTDQoNCmFkZFVuaXRBbGlhcygnc2Vjb25kJywgJ3MnKTsNCg0KLy8gUFJJT1JJVFkNCg0KYWRkVW5pdFByaW9yaXR5KCdzZWNvbmQnLCAxNSk7DQoNCi8vIFBBUlNJTkcNCg0KYWRkUmVnZXhUb2tlbigncycsICBtYXRjaDF0bzIpOw0KYWRkUmVnZXhUb2tlbignc3MnLCBtYXRjaDF0bzIsIG1hdGNoMik7DQphZGRQYXJzZVRva2VuKFsncycsICdzcyddLCBTRUNPTkQpOw0KDQovLyBNT01FTlRTDQoNCnZhciBnZXRTZXRTZWNvbmQgPSBtYWtlR2V0U2V0KCdTZWNvbmRzJywgZmFsc2UpOw0KDQovLyBGT1JNQVRUSU5HDQoNCmFkZEZvcm1hdFRva2VuKCdTJywgMCwgMCwgZnVuY3Rpb24gKCkgew0KICAgIHJldHVybiB+fih0aGlzLm1pbGxpc2Vjb25kKCkgLyAxMDApOw0KfSk7DQoNCmFkZEZvcm1hdFRva2VuKDAsIFsnU1MnLCAyXSwgMCwgZnVuY3Rpb24gKCkgew0KICAgIHJldHVybiB+fih0aGlzLm1pbGxpc2Vjb25kKCkgLyAxMCk7DQp9KTsNCg0KYWRkRm9ybWF0VG9rZW4oMCwgWydTU1MnLCAzXSwgMCwgJ21pbGxpc2Vjb25kJyk7DQphZGRGb3JtYXRUb2tlbigwLCBbJ1NTU1MnLCA0XSwgMCwgZnVuY3Rpb24gKCkgew0KICAgIHJldHVybiB0aGlzLm1pbGxpc2Vjb25kKCkgKiAxMDsNCn0pOw0KYWRkRm9ybWF0VG9rZW4oMCwgWydTU1NTUycsIDVdLCAwLCBmdW5jdGlvbiAoKSB7DQogICAgcmV0dXJuIHRoaXMubWlsbGlzZWNvbmQoKSAqIDEwMDsNCn0pOw0KYWRkRm9ybWF0VG9rZW4oMCwgWydTU1NTU1MnLCA2XSwgMCwgZnVuY3Rpb24gKCkgew0KICAgIHJldHVybiB0aGlzLm1pbGxpc2Vjb25kKCkgKiAxMDAwOw0KfSk7DQphZGRGb3JtYXRUb2tlbigwLCBbJ1NTU1NTU1MnLCA3XSwgMCwgZnVuY3Rpb24gKCkgew0KICAgIHJldHVybiB0aGlzLm1pbGxpc2Vjb25kKCkgKiAxMDAwMDsNCn0pOw0KYWRkRm9ybWF0VG9rZW4oMCwgWydTU1NTU1NTUycsIDhdLCAwLCBmdW5jdGlvbiAoKSB7DQogICAgcmV0dXJuIHRoaXMubWlsbGlzZWNvbmQoKSAqIDEwMDAwMDsNCn0pOw0KYWRkRm9ybWF0VG9rZW4oMCwgWydTU1NTU1NTU1MnLCA5XSwgMCwgZnVuY3Rpb24gKCkgew0KICAgIHJldHVybiB0aGlzLm1pbGxpc2Vjb25kKCkgKiAxMDAwMDAwOw0KfSk7DQoNCg0KLy8gQUxJQVNFUw0KDQphZGRVbml0QWxpYXMoJ21pbGxpc2Vjb25kJywgJ21zJyk7DQoNCi8vIFBSSU9SSVRZDQoNCmFkZFVuaXRQcmlvcml0eSgnbWlsbGlzZWNvbmQnLCAxNik7DQoNCi8vIFBBUlNJTkcNCg0KYWRkUmVnZXhUb2tlbignUycsICAgIG1hdGNoMXRvMywgbWF0Y2gxKTsNCmFkZFJlZ2V4VG9rZW4oJ1NTJywgICBtYXRjaDF0bzMsIG1hdGNoMik7DQphZGRSZWdleFRva2VuKCdTU1MnLCAgbWF0Y2gxdG8zLCBtYXRjaDMpOw0KDQp2YXIgdG9rZW47DQpmb3IgKHRva2VuID0gJ1NTU1MnOyB0b2tlbi5sZW5ndGggPD0gOTsgdG9rZW4gKz0gJ1MnKSB7DQogICAgYWRkUmVnZXhUb2tlbih0b2tlbiwgbWF0Y2hVbnNpZ25lZCk7DQp9DQoNCmZ1bmN0aW9uIHBhcnNlTXMoaW5wdXQsIGFycmF5KSB7DQogICAgYXJyYXlbTUlMTElTRUNPTkRdID0gdG9JbnQoKCcwLicgKyBpbnB1dCkgKiAxMDAwKTsNCn0NCg0KZm9yICh0b2tlbiA9ICdTJzsgdG9rZW4ubGVuZ3RoIDw9IDk7IHRva2VuICs9ICdTJykgew0KICAgIGFkZFBhcnNlVG9rZW4odG9rZW4sIHBhcnNlTXMpOw0KfQ0KLy8gTU9NRU5UUw0KDQp2YXIgZ2V0U2V0TWlsbGlzZWNvbmQgPSBtYWtlR2V0U2V0KCdNaWxsaXNlY29uZHMnLCBmYWxzZSk7DQoNCi8vIEZPUk1BVFRJTkcNCg0KYWRkRm9ybWF0VG9rZW4oJ3onLCAgMCwgMCwgJ3pvbmVBYmJyJyk7DQphZGRGb3JtYXRUb2tlbignenonLCAwLCAwLCAnem9uZU5hbWUnKTsNCg0KLy8gTU9NRU5UUw0KDQpmdW5jdGlvbiBnZXRab25lQWJiciAoKSB7DQogICAgcmV0dXJuIHRoaXMuX2lzVVRDID8gJ1VUQycgOiAnJzsNCn0NCg0KZnVuY3Rpb24gZ2V0Wm9uZU5hbWUgKCkgew0KICAgIHJldHVybiB0aGlzLl9pc1VUQyA/ICdDb29yZGluYXRlZCBVbml2ZXJzYWwgVGltZScgOiAnJzsNCn0NCg0KdmFyIHByb3RvID0gTW9tZW50LnByb3RvdHlwZTsNCg0KcHJvdG8uYWRkICAgICAgICAgICAgICAgPSBhZGQ7DQpwcm90by5jYWxlbmRhciAgICAgICAgICA9IGNhbGVuZGFyJDE7DQpwcm90by5jbG9uZSAgICAgICAgICAgICA9IGNsb25lOw0KcHJvdG8uZGlmZiAgICAgICAgICAgICAgPSBkaWZmOw0KcHJvdG8uZW5kT2YgICAgICAgICAgICAgPSBlbmRPZjsNCnByb3RvLmZvcm1hdCAgICAgICAgICAgID0gZm9ybWF0Ow0KcHJvdG8uZnJvbSAgICAgICAgICAgICAgPSBmcm9tOw0KcHJvdG8uZnJvbU5vdyAgICAgICAgICAgPSBmcm9tTm93Ow0KcHJvdG8udG8gICAgICAgICAgICAgICAgPSB0bzsNCnByb3RvLnRvTm93ICAgICAgICAgICAgID0gdG9Ob3c7DQpwcm90by5nZXQgICAgICAgICAgICAgICA9IHN0cmluZ0dldDsNCnByb3RvLmludmFsaWRBdCAgICAgICAgID0gaW52YWxpZEF0Ow0KcHJvdG8uaXNBZnRlciAgICAgICAgICAgPSBpc0FmdGVyOw0KcHJvdG8uaXNCZWZvcmUgICAgICAgICAgPSBpc0JlZm9yZTsNCnByb3RvLmlzQmV0d2VlbiAgICAgICAgID0gaXNCZXR3ZWVuOw0KcHJvdG8uaXNTYW1lICAgICAgICAgICAgPSBpc1NhbWU7DQpwcm90by5pc1NhbWVPckFmdGVyICAgICA9IGlzU2FtZU9yQWZ0ZXI7DQpwcm90by5pc1NhbWVPckJlZm9yZSAgICA9IGlzU2FtZU9yQmVmb3JlOw0KcHJvdG8uaXNWYWxpZCAgICAgICAgICAgPSBpc1ZhbGlkJDI7DQpwcm90by5sYW5nICAgICAgICAgICAgICA9IGxhbmc7DQpwcm90by5sb2NhbGUgICAgICAgICAgICA9IGxvY2FsZTsNCnByb3RvLmxvY2FsZURhdGEgICAgICAgID0gbG9jYWxlRGF0YTsNCnByb3RvLm1heCAgICAgICAgICAgICAgID0gcHJvdG90eXBlTWF4Ow0KcHJvdG8ubWluICAgICAgICAgICAgICAgPSBwcm90b3R5cGVNaW47DQpwcm90by5wYXJzaW5nRmxhZ3MgICAgICA9IHBhcnNpbmdGbGFnczsNCnByb3RvLnNldCAgICAgICAgICAgICAgID0gc3RyaW5nU2V0Ow0KcHJvdG8uc3RhcnRPZiAgICAgICAgICAgPSBzdGFydE9mOw0KcHJvdG8uc3VidHJhY3QgICAgICAgICAgPSBzdWJ0cmFjdDsNCnByb3RvLnRvQXJyYXkgICAgICAgICAgID0gdG9BcnJheTsNCnByb3RvLnRvT2JqZWN0ICAgICAgICAgID0gdG9PYmplY3Q7DQpwcm90by50b0RhdGUgICAgICAgICAgICA9IHRvRGF0ZTsNCnByb3RvLnRvSVNPU3RyaW5nICAgICAgID0gdG9JU09TdHJpbmc7DQpwcm90by5pbnNwZWN0ICAgICAgICAgICA9IGluc3BlY3Q7DQpwcm90by50b0pTT04gICAgICAgICAgICA9IHRvSlNPTjsNCnByb3RvLnRvU3RyaW5nICAgICAgICAgID0gdG9TdHJpbmc7DQpwcm90by51bml4ICAgICAgICAgICAgICA9IHVuaXg7DQpwcm90by52YWx1ZU9mICAgICAgICAgICA9IHZhbHVlT2Y7DQpwcm90by5jcmVhdGlvbkRhdGEgICAgICA9IGNyZWF0aW9uRGF0YTsNCg0KLy8gWWVhcg0KcHJvdG8ueWVhciAgICAgICA9IGdldFNldFllYXI7DQpwcm90by5pc0xlYXBZZWFyID0gZ2V0SXNMZWFwWWVhcjsNCg0KLy8gV2VlayBZZWFyDQpwcm90by53ZWVrWWVhciAgICA9IGdldFNldFdlZWtZZWFyOw0KcHJvdG8uaXNvV2Vla1llYXIgPSBnZXRTZXRJU09XZWVrWWVhcjsNCg0KLy8gUXVhcnRlcg0KcHJvdG8ucXVhcnRlciA9IHByb3RvLnF1YXJ0ZXJzID0gZ2V0U2V0UXVhcnRlcjsNCg0KLy8gTW9udGgNCnByb3RvLm1vbnRoICAgICAgID0gZ2V0U2V0TW9udGg7DQpwcm90by5kYXlzSW5Nb250aCA9IGdldERheXNJbk1vbnRoOw0KDQovLyBXZWVrDQpwcm90by53ZWVrICAgICAgICAgICA9IHByb3RvLndlZWtzICAgICAgICA9IGdldFNldFdlZWs7DQpwcm90by5pc29XZWVrICAgICAgICA9IHByb3RvLmlzb1dlZWtzICAgICA9IGdldFNldElTT1dlZWs7DQpwcm90by53ZWVrc0luWWVhciAgICA9IGdldFdlZWtzSW5ZZWFyOw0KcHJvdG8uaXNvV2Vla3NJblllYXIgPSBnZXRJU09XZWVrc0luWWVhcjsNCg0KLy8gRGF5DQpwcm90by5kYXRlICAgICAgID0gZ2V0U2V0RGF5T2ZNb250aDsNCnByb3RvLmRheSAgICAgICAgPSBwcm90by5kYXlzICAgICAgICAgICAgID0gZ2V0U2V0RGF5T2ZXZWVrOw0KcHJvdG8ud2Vla2RheSAgICA9IGdldFNldExvY2FsZURheU9mV2VlazsNCnByb3RvLmlzb1dlZWtkYXkgPSBnZXRTZXRJU09EYXlPZldlZWs7DQpwcm90by5kYXlPZlllYXIgID0gZ2V0U2V0RGF5T2ZZZWFyOw0KDQovLyBIb3VyDQpwcm90by5ob3VyID0gcHJvdG8uaG91cnMgPSBnZXRTZXRIb3VyOw0KDQovLyBNaW51dGUNCnByb3RvLm1pbnV0ZSA9IHByb3RvLm1pbnV0ZXMgPSBnZXRTZXRNaW51dGU7DQoNCi8vIFNlY29uZA0KcHJvdG8uc2Vjb25kID0gcHJvdG8uc2Vjb25kcyA9IGdldFNldFNlY29uZDsNCg0KLy8gTWlsbGlzZWNvbmQNCnByb3RvLm1pbGxpc2Vjb25kID0gcHJvdG8ubWlsbGlzZWNvbmRzID0gZ2V0U2V0TWlsbGlzZWNvbmQ7DQoNCi8vIE9mZnNldA0KcHJvdG8udXRjT2Zmc2V0ICAgICAgICAgICAgPSBnZXRTZXRPZmZzZXQ7DQpwcm90by51dGMgICAgICAgICAgICAgICAgICA9IHNldE9mZnNldFRvVVRDOw0KcHJvdG8ubG9jYWwgICAgICAgICAgICAgICAgPSBzZXRPZmZzZXRUb0xvY2FsOw0KcHJvdG8ucGFyc2Vab25lICAgICAgICAgICAgPSBzZXRPZmZzZXRUb1BhcnNlZE9mZnNldDsNCnByb3RvLmhhc0FsaWduZWRIb3VyT2Zmc2V0ID0gaGFzQWxpZ25lZEhvdXJPZmZzZXQ7DQpwcm90by5pc0RTVCAgICAgICAgICAgICAgICA9IGlzRGF5bGlnaHRTYXZpbmdUaW1lOw0KcHJvdG8uaXNMb2NhbCAgICAgICAgICAgICAgPSBpc0xvY2FsOw0KcHJvdG8uaXNVdGNPZmZzZXQgICAgICAgICAgPSBpc1V0Y09mZnNldDsNCnByb3RvLmlzVXRjICAgICAgICAgICAgICAgID0gaXNVdGM7DQpwcm90by5pc1VUQyAgICAgICAgICAgICAgICA9IGlzVXRjOw0KDQovLyBUaW1lem9uZQ0KcHJvdG8uem9uZUFiYnIgPSBnZXRab25lQWJicjsNCnByb3RvLnpvbmVOYW1lID0gZ2V0Wm9uZU5hbWU7DQoNCi8vIERlcHJlY2F0aW9ucw0KcHJvdG8uZGF0ZXMgID0gZGVwcmVjYXRlKCdkYXRlcyBhY2Nlc3NvciBpcyBkZXByZWNhdGVkLiBVc2UgZGF0ZSBpbnN0ZWFkLicsIGdldFNldERheU9mTW9udGgpOw0KcHJvdG8ubW9udGhzID0gZGVwcmVjYXRlKCdtb250aHMgYWNjZXNzb3IgaXMgZGVwcmVjYXRlZC4gVXNlIG1vbnRoIGluc3RlYWQnLCBnZXRTZXRNb250aCk7DQpwcm90by55ZWFycyAgPSBkZXByZWNhdGUoJ3llYXJzIGFjY2Vzc29yIGlzIGRlcHJlY2F0ZWQuIFVzZSB5ZWFyIGluc3RlYWQnLCBnZXRTZXRZZWFyKTsNCnByb3RvLnpvbmUgICA9IGRlcHJlY2F0ZSgnbW9tZW50KCkuem9uZSBpcyBkZXByZWNhdGVkLCB1c2UgbW9tZW50KCkudXRjT2Zmc2V0IGluc3RlYWQuIGh0dHA6Ly9tb21lbnRqcy5jb20vZ3VpZGVzLyMvd2FybmluZ3Mvem9uZS8nLCBnZXRTZXRab25lKTsNCnByb3RvLmlzRFNUU2hpZnRlZCA9IGRlcHJlY2F0ZSgnaXNEU1RTaGlmdGVkIGlzIGRlcHJlY2F0ZWQuIFNlZSBodHRwOi8vbW9tZW50anMuY29tL2d1aWRlcy8jL3dhcm5pbmdzL2RzdC1zaGlmdGVkLyBmb3IgbW9yZSBpbmZvcm1hdGlvbicsIGlzRGF5bGlnaHRTYXZpbmdUaW1lU2hpZnRlZCk7DQoNCmZ1bmN0aW9uIGNyZWF0ZVVuaXggKGlucHV0KSB7DQogICAgcmV0dXJuIGNyZWF0ZUxvY2FsKGlucHV0ICogMTAwMCk7DQp9DQoNCmZ1bmN0aW9uIGNyZWF0ZUluWm9uZSAoKSB7DQogICAgcmV0dXJuIGNyZWF0ZUxvY2FsLmFwcGx5KG51bGwsIGFyZ3VtZW50cykucGFyc2Vab25lKCk7DQp9DQoNCmZ1bmN0aW9uIHByZVBhcnNlUG9zdEZvcm1hdCAoc3RyaW5nKSB7DQogICAgcmV0dXJuIHN0cmluZzsNCn0NCg0KdmFyIHByb3RvJDEgPSBMb2NhbGUucHJvdG90eXBlOw0KDQpwcm90byQxLmNhbGVuZGFyICAgICAgICA9IGNhbGVuZGFyOw0KcHJvdG8kMS5sb25nRGF0ZUZvcm1hdCAgPSBsb25nRGF0ZUZvcm1hdDsNCnByb3RvJDEuaW52YWxpZERhdGUgICAgID0gaW52YWxpZERhdGU7DQpwcm90byQxLm9yZGluYWwgICAgICAgICA9IG9yZGluYWw7DQpwcm90byQxLnByZXBhcnNlICAgICAgICA9IHByZVBhcnNlUG9zdEZvcm1hdDsNCnByb3RvJDEucG9zdGZvcm1hdCAgICAgID0gcHJlUGFyc2VQb3N0Rm9ybWF0Ow0KcHJvdG8kMS5yZWxhdGl2ZVRpbWUgICAgPSByZWxhdGl2ZVRpbWU7DQpwcm90byQxLnBhc3RGdXR1cmUgICAgICA9IHBhc3RGdXR1cmU7DQpwcm90byQxLnNldCAgICAgICAgICAgICA9IHNldDsNCg0KLy8gTW9udGgNCnByb3RvJDEubW9udGhzICAgICAgICAgICAgPSAgICAgICAgbG9jYWxlTW9udGhzOw0KcHJvdG8kMS5tb250aHNTaG9ydCAgICAgICA9ICAgICAgICBsb2NhbGVNb250aHNTaG9ydDsNCnByb3RvJDEubW9udGhzUGFyc2UgICAgICAgPSAgICAgICAgbG9jYWxlTW9udGhzUGFyc2U7DQpwcm90byQxLm1vbnRoc1JlZ2V4ICAgICAgID0gbW9udGhzUmVnZXg7DQpwcm90byQxLm1vbnRoc1Nob3J0UmVnZXggID0gbW9udGhzU2hvcnRSZWdleDsNCg0KLy8gV2Vlaw0KcHJvdG8kMS53ZWVrID0gbG9jYWxlV2VlazsNCnByb3RvJDEuZmlyc3REYXlPZlllYXIgPSBsb2NhbGVGaXJzdERheU9mWWVhcjsNCnByb3RvJDEuZmlyc3REYXlPZldlZWsgPSBsb2NhbGVGaXJzdERheU9mV2VlazsNCg0KLy8gRGF5IG9mIFdlZWsNCnByb3RvJDEud2Vla2RheXMgICAgICAgPSAgICAgICAgbG9jYWxlV2Vla2RheXM7DQpwcm90byQxLndlZWtkYXlzTWluICAgID0gICAgICAgIGxvY2FsZVdlZWtkYXlzTWluOw0KcHJvdG8kMS53ZWVrZGF5c1Nob3J0ICA9ICAgICAgICBsb2NhbGVXZWVrZGF5c1Nob3J0Ow0KcHJvdG8kMS53ZWVrZGF5c1BhcnNlICA9ICAgICAgICBsb2NhbGVXZWVrZGF5c1BhcnNlOw0KDQpwcm90byQxLndlZWtkYXlzUmVnZXggICAgICAgPSAgICAgICAgd2Vla2RheXNSZWdleDsNCnByb3RvJDEud2Vla2RheXNTaG9ydFJlZ2V4ICA9ICAgICAgICB3ZWVrZGF5c1Nob3J0UmVnZXg7DQpwcm90byQxLndlZWtkYXlzTWluUmVnZXggICAgPSAgICAgICAgd2Vla2RheXNNaW5SZWdleDsNCg0KLy8gSG91cnMNCnByb3RvJDEuaXNQTSA9IGxvY2FsZUlzUE07DQpwcm90byQxLm1lcmlkaWVtID0gbG9jYWxlTWVyaWRpZW07DQoNCmZ1bmN0aW9uIGdldCQxIChmb3JtYXQsIGluZGV4LCBmaWVsZCwgc2V0dGVyKSB7DQogICAgdmFyIGxvY2FsZSA9IGdldExvY2FsZSgpOw0KICAgIHZhciB1dGMgPSBjcmVhdGVVVEMoKS5zZXQoc2V0dGVyLCBpbmRleCk7DQogICAgcmV0dXJuIGxvY2FsZVtmaWVsZF0odXRjLCBmb3JtYXQpOw0KfQ0KDQpmdW5jdGlvbiBsaXN0TW9udGhzSW1wbCAoZm9ybWF0LCBpbmRleCwgZmllbGQpIHsNCiAgICBpZiAoaXNOdW1iZXIoZm9ybWF0KSkgew0KICAgICAgICBpbmRleCA9IGZvcm1hdDsNCiAgICAgICAgZm9ybWF0ID0gdW5kZWZpbmVkOw0KICAgIH0NCg0KICAgIGZvcm1hdCA9IGZvcm1hdCB8fCAnJzsNCg0KICAgIGlmIChpbmRleCAhPSBudWxsKSB7DQogICAgICAgIHJldHVybiBnZXQkMShmb3JtYXQsIGluZGV4LCBmaWVsZCwgJ21vbnRoJyk7DQogICAgfQ0KDQogICAgdmFyIGk7DQogICAgdmFyIG91dCA9IFtdOw0KICAgIGZvciAoaSA9IDA7IGkgPCAxMjsgaSsrKSB7DQogICAgICAgIG91dFtpXSA9IGdldCQxKGZvcm1hdCwgaSwgZmllbGQsICdtb250aCcpOw0KICAgIH0NCiAgICByZXR1cm4gb3V0Ow0KfQ0KDQovLyAoKQ0KLy8gKDUpDQovLyAoZm10LCA1KQ0KLy8gKGZtdCkNCi8vICh0cnVlKQ0KLy8gKHRydWUsIDUpDQovLyAodHJ1ZSwgZm10LCA1KQ0KLy8gKHRydWUsIGZtdCkNCmZ1bmN0aW9uIGxpc3RXZWVrZGF5c0ltcGwgKGxvY2FsZVNvcnRlZCwgZm9ybWF0LCBpbmRleCwgZmllbGQpIHsNCiAgICBpZiAodHlwZW9mIGxvY2FsZVNvcnRlZCA9PT0gJ2Jvb2xlYW4nKSB7DQogICAgICAgIGlmIChpc051bWJlcihmb3JtYXQpKSB7DQogICAgICAgICAgICBpbmRleCA9IGZvcm1hdDsNCiAgICAgICAgICAgIGZvcm1hdCA9IHVuZGVmaW5lZDsNCiAgICAgICAgfQ0KDQogICAgICAgIGZvcm1hdCA9IGZvcm1hdCB8fCAnJzsNCiAgICB9IGVsc2Ugew0KICAgICAgICBmb3JtYXQgPSBsb2NhbGVTb3J0ZWQ7DQogICAgICAgIGluZGV4ID0gZm9ybWF0Ow0KICAgICAgICBsb2NhbGVTb3J0ZWQgPSBmYWxzZTsNCg0KICAgICAgICBpZiAoaXNOdW1iZXIoZm9ybWF0KSkgew0KICAgICAgICAgICAgaW5kZXggPSBmb3JtYXQ7DQogICAgICAgICAgICBmb3JtYXQgPSB1bmRlZmluZWQ7DQogICAgICAgIH0NCg0KICAgICAgICBmb3JtYXQgPSBmb3JtYXQgfHwgJyc7DQogICAgfQ0KDQogICAgdmFyIGxvY2FsZSA9IGdldExvY2FsZSgpLA0KICAgICAgICBzaGlmdCA9IGxvY2FsZVNvcnRlZCA/IGxvY2FsZS5fd2Vlay5kb3cgOiAwOw0KDQogICAgaWYgKGluZGV4ICE9IG51bGwpIHsNCiAgICAgICAgcmV0dXJuIGdldCQxKGZvcm1hdCwgKGluZGV4ICsgc2hpZnQpICUgNywgZmllbGQsICdkYXknKTsNCiAgICB9DQoNCiAgICB2YXIgaTsNCiAgICB2YXIgb3V0ID0gW107DQogICAgZm9yIChpID0gMDsgaSA8IDc7IGkrKykgew0KICAgICAgICBvdXRbaV0gPSBnZXQkMShmb3JtYXQsIChpICsgc2hpZnQpICUgNywgZmllbGQsICdkYXknKTsNCiAgICB9DQogICAgcmV0dXJuIG91dDsNCn0NCg0KZnVuY3Rpb24gbGlzdE1vbnRocyAoZm9ybWF0LCBpbmRleCkgew0KICAgIHJldHVybiBsaXN0TW9udGhzSW1wbChmb3JtYXQsIGluZGV4LCAnbW9udGhzJyk7DQp9DQoNCmZ1bmN0aW9uIGxpc3RNb250aHNTaG9ydCAoZm9ybWF0LCBpbmRleCkgew0KICAgIHJldHVybiBsaXN0TW9udGhzSW1wbChmb3JtYXQsIGluZGV4LCAnbW9udGhzU2hvcnQnKTsNCn0NCg0KZnVuY3Rpb24gbGlzdFdlZWtkYXlzIChsb2NhbGVTb3J0ZWQsIGZvcm1hdCwgaW5kZXgpIHsNCiAgICByZXR1cm4gbGlzdFdlZWtkYXlzSW1wbChsb2NhbGVTb3J0ZWQsIGZvcm1hdCwgaW5kZXgsICd3ZWVrZGF5cycpOw0KfQ0KDQpmdW5jdGlvbiBsaXN0V2Vla2RheXNTaG9ydCAobG9jYWxlU29ydGVkLCBmb3JtYXQsIGluZGV4KSB7DQogICAgcmV0dXJuIGxpc3RXZWVrZGF5c0ltcGwobG9jYWxlU29ydGVkLCBmb3JtYXQsIGluZGV4LCAnd2Vla2RheXNTaG9ydCcpOw0KfQ0KDQpmdW5jdGlvbiBsaXN0V2Vla2RheXNNaW4gKGxvY2FsZVNvcnRlZCwgZm9ybWF0LCBpbmRleCkgew0KICAgIHJldHVybiBsaXN0V2Vla2RheXNJbXBsKGxvY2FsZVNvcnRlZCwgZm9ybWF0LCBpbmRleCwgJ3dlZWtkYXlzTWluJyk7DQp9DQoNCmdldFNldEdsb2JhbExvY2FsZSgnZW4nLCB7DQogICAgZGF5T2ZNb250aE9yZGluYWxQYXJzZTogL1xkezEsMn0odGh8c3R8bmR8cmQpLywNCiAgICBvcmRpbmFsIDogZnVuY3Rpb24gKG51bWJlcikgew0KICAgICAgICB2YXIgYiA9IG51bWJlciAlIDEwLA0KICAgICAgICAgICAgb3V0cHV0ID0gKHRvSW50KG51bWJlciAlIDEwMCAvIDEwKSA9PT0gMSkgPyAndGgnIDoNCiAgICAgICAgICAgIChiID09PSAxKSA/ICdzdCcgOg0KICAgICAgICAgICAgKGIgPT09IDIpID8gJ25kJyA6DQogICAgICAgICAgICAoYiA9PT0gMykgPyAncmQnIDogJ3RoJzsNCiAgICAgICAgcmV0dXJuIG51bWJlciArIG91dHB1dDsNCiAgICB9DQp9KTsNCg0KLy8gU2lkZSBlZmZlY3QgaW1wb3J0cw0KaG9va3MubGFuZyA9IGRlcHJlY2F0ZSgnbW9tZW50LmxhbmcgaXMgZGVwcmVjYXRlZC4gVXNlIG1vbWVudC5sb2NhbGUgaW5zdGVhZC4nLCBnZXRTZXRHbG9iYWxMb2NhbGUpOw0KaG9va3MubGFuZ0RhdGEgPSBkZXByZWNhdGUoJ21vbWVudC5sYW5nRGF0YSBpcyBkZXByZWNhdGVkLiBVc2UgbW9tZW50LmxvY2FsZURhdGEgaW5zdGVhZC4nLCBnZXRMb2NhbGUpOw0KDQp2YXIgbWF0aEFicyA9IE1hdGguYWJzOw0KDQpmdW5jdGlvbiBhYnMgKCkgew0KICAgIHZhciBkYXRhICAgICAgICAgICA9IHRoaXMuX2RhdGE7DQoNCiAgICB0aGlzLl9taWxsaXNlY29uZHMgPSBtYXRoQWJzKHRoaXMuX21pbGxpc2Vjb25kcyk7DQogICAgdGhpcy5fZGF5cyAgICAgICAgID0gbWF0aEFicyh0aGlzLl9kYXlzKTsNCiAgICB0aGlzLl9tb250aHMgICAgICAgPSBtYXRoQWJzKHRoaXMuX21vbnRocyk7DQoNCiAgICBkYXRhLm1pbGxpc2Vjb25kcyAgPSBtYXRoQWJzKGRhdGEubWlsbGlzZWNvbmRzKTsNCiAgICBkYXRhLnNlY29uZHMgICAgICAgPSBtYXRoQWJzKGRhdGEuc2Vjb25kcyk7DQogICAgZGF0YS5taW51dGVzICAgICAgID0gbWF0aEFicyhkYXRhLm1pbnV0ZXMpOw0KICAgIGRhdGEuaG91cnMgICAgICAgICA9IG1hdGhBYnMoZGF0YS5ob3Vycyk7DQogICAgZGF0YS5tb250aHMgICAgICAgID0gbWF0aEFicyhkYXRhLm1vbnRocyk7DQogICAgZGF0YS55ZWFycyAgICAgICAgID0gbWF0aEFicyhkYXRhLnllYXJzKTsNCg0KICAgIHJldHVybiB0aGlzOw0KfQ0KDQpmdW5jdGlvbiBhZGRTdWJ0cmFjdCQxIChkdXJhdGlvbiwgaW5wdXQsIHZhbHVlLCBkaXJlY3Rpb24pIHsNCiAgICB2YXIgb3RoZXIgPSBjcmVhdGVEdXJhdGlvbihpbnB1dCwgdmFsdWUpOw0KDQogICAgZHVyYXRpb24uX21pbGxpc2Vjb25kcyArPSBkaXJlY3Rpb24gKiBvdGhlci5fbWlsbGlzZWNvbmRzOw0KICAgIGR1cmF0aW9uLl9kYXlzICAgICAgICAgKz0gZGlyZWN0aW9uICogb3RoZXIuX2RheXM7DQogICAgZHVyYXRpb24uX21vbnRocyAgICAgICArPSBkaXJlY3Rpb24gKiBvdGhlci5fbW9udGhzOw0KDQogICAgcmV0dXJuIGR1cmF0aW9uLl9idWJibGUoKTsNCn0NCg0KLy8gc3VwcG9ydHMgb25seSAyLjAtc3R5bGUgYWRkKDEsICdzJykgb3IgYWRkKGR1cmF0aW9uKQ0KZnVuY3Rpb24gYWRkJDEgKGlucHV0LCB2YWx1ZSkgew0KICAgIHJldHVybiBhZGRTdWJ0cmFjdCQxKHRoaXMsIGlucHV0LCB2YWx1ZSwgMSk7DQp9DQoNCi8vIHN1cHBvcnRzIG9ubHkgMi4wLXN0eWxlIHN1YnRyYWN0KDEsICdzJykgb3Igc3VidHJhY3QoZHVyYXRpb24pDQpmdW5jdGlvbiBzdWJ0cmFjdCQxIChpbnB1dCwgdmFsdWUpIHsNCiAgICByZXR1cm4gYWRkU3VidHJhY3QkMSh0aGlzLCBpbnB1dCwgdmFsdWUsIC0xKTsNCn0NCg0KZnVuY3Rpb24gYWJzQ2VpbCAobnVtYmVyKSB7DQogICAgaWYgKG51bWJlciA8IDApIHsNCiAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IobnVtYmVyKTsNCiAgICB9IGVsc2Ugew0KICAgICAgICByZXR1cm4gTWF0aC5jZWlsKG51bWJlcik7DQogICAgfQ0KfQ0KDQpmdW5jdGlvbiBidWJibGUgKCkgew0KICAgIHZhciBtaWxsaXNlY29uZHMgPSB0aGlzLl9taWxsaXNlY29uZHM7DQogICAgdmFyIGRheXMgICAgICAgICA9IHRoaXMuX2RheXM7DQogICAgdmFyIG1vbnRocyAgICAgICA9IHRoaXMuX21vbnRoczsNCiAgICB2YXIgZGF0YSAgICAgICAgID0gdGhpcy5fZGF0YTsNCiAgICB2YXIgc2Vjb25kcywgbWludXRlcywgaG91cnMsIHllYXJzLCBtb250aHNGcm9tRGF5czsNCg0KICAgIC8vIGlmIHdlIGhhdmUgYSBtaXggb2YgcG9zaXRpdmUgYW5kIG5lZ2F0aXZlIHZhbHVlcywgYnViYmxlIGRvd24gZmlyc3QNCiAgICAvLyBjaGVjazogaHR0cHM6Ly9naXRodWIuY29tL21vbWVudC9tb21lbnQvaXNzdWVzLzIxNjYNCiAgICBpZiAoISgobWlsbGlzZWNvbmRzID49IDAgJiYgZGF5cyA+PSAwICYmIG1vbnRocyA+PSAwKSB8fA0KICAgICAgICAgICAgKG1pbGxpc2Vjb25kcyA8PSAwICYmIGRheXMgPD0gMCAmJiBtb250aHMgPD0gMCkpKSB7DQogICAgICAgIG1pbGxpc2Vjb25kcyArPSBhYnNDZWlsKG1vbnRoc1RvRGF5cyhtb250aHMpICsgZGF5cykgKiA4NjRlNTsNCiAgICAgICAgZGF5cyA9IDA7DQogICAgICAgIG1vbnRocyA9IDA7DQogICAgfQ0KDQogICAgLy8gVGhlIGZvbGxvd2luZyBjb2RlIGJ1YmJsZXMgdXAgdmFsdWVzLCBzZWUgdGhlIHRlc3RzIGZvcg0KICAgIC8vIGV4YW1wbGVzIG9mIHdoYXQgdGhhdCBtZWFucy4NCiAgICBkYXRhLm1pbGxpc2Vjb25kcyA9IG1pbGxpc2Vjb25kcyAlIDEwMDA7DQoNCiAgICBzZWNvbmRzICAgICAgICAgICA9IGFic0Zsb29yKG1pbGxpc2Vjb25kcyAvIDEwMDApOw0KICAgIGRhdGEuc2Vjb25kcyAgICAgID0gc2Vjb25kcyAlIDYwOw0KDQogICAgbWludXRlcyAgICAgICAgICAgPSBhYnNGbG9vcihzZWNvbmRzIC8gNjApOw0KICAgIGRhdGEubWludXRlcyAgICAgID0gbWludXRlcyAlIDYwOw0KDQogICAgaG91cnMgICAgICAgICAgICAgPSBhYnNGbG9vcihtaW51dGVzIC8gNjApOw0KICAgIGRhdGEuaG91cnMgICAgICAgID0gaG91cnMgJSAyNDsNCg0KICAgIGRheXMgKz0gYWJzRmxvb3IoaG91cnMgLyAyNCk7DQoNCiAgICAvLyBjb252ZXJ0IGRheXMgdG8gbW9udGhzDQogICAgbW9udGhzRnJvbURheXMgPSBhYnNGbG9vcihkYXlzVG9Nb250aHMoZGF5cykpOw0KICAgIG1vbnRocyArPSBtb250aHNGcm9tRGF5czsNCiAgICBkYXlzIC09IGFic0NlaWwobW9udGhzVG9EYXlzKG1vbnRoc0Zyb21EYXlzKSk7DQoNCiAgICAvLyAxMiBtb250aHMgLT4gMSB5ZWFyDQogICAgeWVhcnMgPSBhYnNGbG9vcihtb250aHMgLyAxMik7DQogICAgbW9udGhzICU9IDEyOw0KDQogICAgZGF0YS5kYXlzICAgPSBkYXlzOw0KICAgIGRhdGEubW9udGhzID0gbW9udGhzOw0KICAgIGRhdGEueWVhcnMgID0geWVhcnM7DQoNCiAgICByZXR1cm4gdGhpczsNCn0NCg0KZnVuY3Rpb24gZGF5c1RvTW9udGhzIChkYXlzKSB7DQogICAgLy8gNDAwIHllYXJzIGhhdmUgMTQ2MDk3IGRheXMgKHRha2luZyBpbnRvIGFjY291bnQgbGVhcCB5ZWFyIHJ1bGVzKQ0KICAgIC8vIDQwMCB5ZWFycyBoYXZlIDEyIG1vbnRocyA9PT0gNDgwMA0KICAgIHJldHVybiBkYXlzICogNDgwMCAvIDE0NjA5NzsNCn0NCg0KZnVuY3Rpb24gbW9udGhzVG9EYXlzIChtb250aHMpIHsNCiAgICAvLyB0aGUgcmV2ZXJzZSBvZiBkYXlzVG9Nb250aHMNCiAgICByZXR1cm4gbW9udGhzICogMTQ2MDk3IC8gNDgwMDsNCn0NCg0KZnVuY3Rpb24gYXMgKHVuaXRzKSB7DQogICAgaWYgKCF0aGlzLmlzVmFsaWQoKSkgew0KICAgICAgICByZXR1cm4gTmFOOw0KICAgIH0NCiAgICB2YXIgZGF5czsNCiAgICB2YXIgbW9udGhzOw0KICAgIHZhciBtaWxsaXNlY29uZHMgPSB0aGlzLl9taWxsaXNlY29uZHM7DQoNCiAgICB1bml0cyA9IG5vcm1hbGl6ZVVuaXRzKHVuaXRzKTsNCg0KICAgIGlmICh1bml0cyA9PT0gJ21vbnRoJyB8fCB1bml0cyA9PT0gJ3llYXInKSB7DQogICAgICAgIGRheXMgICA9IHRoaXMuX2RheXMgICArIG1pbGxpc2Vjb25kcyAvIDg2NGU1Ow0KICAgICAgICBtb250aHMgPSB0aGlzLl9tb250aHMgKyBkYXlzVG9Nb250aHMoZGF5cyk7DQogICAgICAgIHJldHVybiB1bml0cyA9PT0gJ21vbnRoJyA/IG1vbnRocyA6IG1vbnRocyAvIDEyOw0KICAgIH0gZWxzZSB7DQogICAgICAgIC8vIGhhbmRsZSBtaWxsaXNlY29uZHMgc2VwYXJhdGVseSBiZWNhdXNlIG9mIGZsb2F0aW5nIHBvaW50IG1hdGggZXJyb3JzIChpc3N1ZSAjMTg2NykNCiAgICAgICAgZGF5cyA9IHRoaXMuX2RheXMgKyBNYXRoLnJvdW5kKG1vbnRoc1RvRGF5cyh0aGlzLl9tb250aHMpKTsNCiAgICAgICAgc3dpdGNoICh1bml0cykgew0KICAgICAgICAgICAgY2FzZSAnd2VlaycgICA6IHJldHVybiBkYXlzIC8gNyAgICAgKyBtaWxsaXNlY29uZHMgLyA2MDQ4ZTU7DQogICAgICAgICAgICBjYXNlICdkYXknICAgIDogcmV0dXJuIGRheXMgICAgICAgICArIG1pbGxpc2Vjb25kcyAvIDg2NGU1Ow0KICAgICAgICAgICAgY2FzZSAnaG91cicgICA6IHJldHVybiBkYXlzICogMjQgICAgKyBtaWxsaXNlY29uZHMgLyAzNmU1Ow0KICAgICAgICAgICAgY2FzZSAnbWludXRlJyA6IHJldHVybiBkYXlzICogMTQ0MCAgKyBtaWxsaXNlY29uZHMgLyA2ZTQ7DQogICAgICAgICAgICBjYXNlICdzZWNvbmQnIDogcmV0dXJuIGRheXMgKiA4NjQwMCArIG1pbGxpc2Vjb25kcyAvIDEwMDA7DQogICAgICAgICAgICAvLyBNYXRoLmZsb29yIHByZXZlbnRzIGZsb2F0aW5nIHBvaW50IG1hdGggZXJyb3JzIGhlcmUNCiAgICAgICAgICAgIGNhc2UgJ21pbGxpc2Vjb25kJzogcmV0dXJuIE1hdGguZmxvb3IoZGF5cyAqIDg2NGU1KSArIG1pbGxpc2Vjb25kczsNCiAgICAgICAgICAgIGRlZmF1bHQ6IHRocm93IG5ldyBFcnJvcignVW5rbm93biB1bml0ICcgKyB1bml0cyk7DQogICAgICAgIH0NCiAgICB9DQp9DQoNCi8vIFRPRE86IFVzZSB0aGlzLmFzKCdtcycpPw0KZnVuY3Rpb24gdmFsdWVPZiQxICgpIHsNCiAgICBpZiAoIXRoaXMuaXNWYWxpZCgpKSB7DQogICAgICAgIHJldHVybiBOYU47DQogICAgfQ0KICAgIHJldHVybiAoDQogICAgICAgIHRoaXMuX21pbGxpc2Vjb25kcyArDQogICAgICAgIHRoaXMuX2RheXMgKiA4NjRlNSArDQogICAgICAgICh0aGlzLl9tb250aHMgJSAxMikgKiAyNTkyZTYgKw0KICAgICAgICB0b0ludCh0aGlzLl9tb250aHMgLyAxMikgKiAzMTUzNmU2DQogICAgKTsNCn0NCg0KZnVuY3Rpb24gbWFrZUFzIChhbGlhcykgew0KICAgIHJldHVybiBmdW5jdGlvbiAoKSB7DQogICAgICAgIHJldHVybiB0aGlzLmFzKGFsaWFzKTsNCiAgICB9Ow0KfQ0KDQp2YXIgYXNNaWxsaXNlY29uZHMgPSBtYWtlQXMoJ21zJyk7DQp2YXIgYXNTZWNvbmRzICAgICAgPSBtYWtlQXMoJ3MnKTsNCnZhciBhc01pbnV0ZXMgICAgICA9IG1ha2VBcygnbScpOw0KdmFyIGFzSG91cnMgICAgICAgID0gbWFrZUFzKCdoJyk7DQp2YXIgYXNEYXlzICAgICAgICAgPSBtYWtlQXMoJ2QnKTsNCnZhciBhc1dlZWtzICAgICAgICA9IG1ha2VBcygndycpOw0KdmFyIGFzTW9udGhzICAgICAgID0gbWFrZUFzKCdNJyk7DQp2YXIgYXNZZWFycyAgICAgICAgPSBtYWtlQXMoJ3knKTsNCg0KZnVuY3Rpb24gZ2V0JDIgKHVuaXRzKSB7DQogICAgdW5pdHMgPSBub3JtYWxpemVVbml0cyh1bml0cyk7DQogICAgcmV0dXJuIHRoaXMuaXNWYWxpZCgpID8gdGhpc1t1bml0cyArICdzJ10oKSA6IE5hTjsNCn0NCg0KZnVuY3Rpb24gbWFrZUdldHRlcihuYW1lKSB7DQogICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuaXNWYWxpZCgpID8gdGhpcy5fZGF0YVtuYW1lXSA6IE5hTjsNCiAgICB9Ow0KfQ0KDQp2YXIgbWlsbGlzZWNvbmRzID0gbWFrZUdldHRlcignbWlsbGlzZWNvbmRzJyk7DQp2YXIgc2Vjb25kcyAgICAgID0gbWFrZUdldHRlcignc2Vjb25kcycpOw0KdmFyIG1pbnV0ZXMgICAgICA9IG1ha2VHZXR0ZXIoJ21pbnV0ZXMnKTsNCnZhciBob3VycyAgICAgICAgPSBtYWtlR2V0dGVyKCdob3VycycpOw0KdmFyIGRheXMgICAgICAgICA9IG1ha2VHZXR0ZXIoJ2RheXMnKTsNCnZhciBtb250aHMgICAgICAgPSBtYWtlR2V0dGVyKCdtb250aHMnKTsNCnZhciB5ZWFycyAgICAgICAgPSBtYWtlR2V0dGVyKCd5ZWFycycpOw0KDQpmdW5jdGlvbiB3ZWVrcyAoKSB7DQogICAgcmV0dXJuIGFic0Zsb29yKHRoaXMuZGF5cygpIC8gNyk7DQp9DQoNCnZhciByb3VuZCA9IE1hdGgucm91bmQ7DQp2YXIgdGhyZXNob2xkcyA9IHsNCiAgICBzczogNDQsICAgICAgICAgLy8gYSBmZXcgc2Vjb25kcyB0byBzZWNvbmRzDQogICAgcyA6IDQ1LCAgICAgICAgIC8vIHNlY29uZHMgdG8gbWludXRlDQogICAgbSA6IDQ1LCAgICAgICAgIC8vIG1pbnV0ZXMgdG8gaG91cg0KICAgIGggOiAyMiwgICAgICAgICAvLyBob3VycyB0byBkYXkNCiAgICBkIDogMjYsICAgICAgICAgLy8gZGF5cyB0byBtb250aA0KICAgIE0gOiAxMSAgICAgICAgICAvLyBtb250aHMgdG8geWVhcg0KfTsNCg0KLy8gaGVscGVyIGZ1bmN0aW9uIGZvciBtb21lbnQuZm4uZnJvbSwgbW9tZW50LmZuLmZyb21Ob3csIGFuZCBtb21lbnQuZHVyYXRpb24uZm4uaHVtYW5pemUNCmZ1bmN0aW9uIHN1YnN0aXR1dGVUaW1lQWdvKHN0cmluZywgbnVtYmVyLCB3aXRob3V0U3VmZml4LCBpc0Z1dHVyZSwgbG9jYWxlKSB7DQogICAgcmV0dXJuIGxvY2FsZS5yZWxhdGl2ZVRpbWUobnVtYmVyIHx8IDEsICEhd2l0aG91dFN1ZmZpeCwgc3RyaW5nLCBpc0Z1dHVyZSk7DQp9DQoNCmZ1bmN0aW9uIHJlbGF0aXZlVGltZSQxIChwb3NOZWdEdXJhdGlvbiwgd2l0aG91dFN1ZmZpeCwgbG9jYWxlKSB7DQogICAgdmFyIGR1cmF0aW9uID0gY3JlYXRlRHVyYXRpb24ocG9zTmVnRHVyYXRpb24pLmFicygpOw0KICAgIHZhciBzZWNvbmRzICA9IHJvdW5kKGR1cmF0aW9uLmFzKCdzJykpOw0KICAgIHZhciBtaW51dGVzICA9IHJvdW5kKGR1cmF0aW9uLmFzKCdtJykpOw0KICAgIHZhciBob3VycyAgICA9IHJvdW5kKGR1cmF0aW9uLmFzKCdoJykpOw0KICAgIHZhciBkYXlzICAgICA9IHJvdW5kKGR1cmF0aW9uLmFzKCdkJykpOw0KICAgIHZhciBtb250aHMgICA9IHJvdW5kKGR1cmF0aW9uLmFzKCdNJykpOw0KICAgIHZhciB5ZWFycyAgICA9IHJvdW5kKGR1cmF0aW9uLmFzKCd5JykpOw0KDQogICAgdmFyIGEgPSBzZWNvbmRzIDw9IHRocmVzaG9sZHMuc3MgJiYgWydzJywgc2Vjb25kc10gIHx8DQogICAgICAgICAgICBzZWNvbmRzIDwgdGhyZXNob2xkcy5zICAgJiYgWydzcycsIHNlY29uZHNdIHx8DQogICAgICAgICAgICBtaW51dGVzIDw9IDEgICAgICAgICAgICAgJiYgWydtJ10gICAgICAgICAgIHx8DQogICAgICAgICAgICBtaW51dGVzIDwgdGhyZXNob2xkcy5tICAgJiYgWydtbScsIG1pbnV0ZXNdIHx8DQogICAgICAgICAgICBob3VycyAgIDw9IDEgICAgICAgICAgICAgJiYgWydoJ10gICAgICAgICAgIHx8DQogICAgICAgICAgICBob3VycyAgIDwgdGhyZXNob2xkcy5oICAgJiYgWydoaCcsIGhvdXJzXSAgIHx8DQogICAgICAgICAgICBkYXlzICAgIDw9IDEgICAgICAgICAgICAgJiYgWydkJ10gICAgICAgICAgIHx8DQogICAgICAgICAgICBkYXlzICAgIDwgdGhyZXNob2xkcy5kICAgJiYgWydkZCcsIGRheXNdICAgIHx8DQogICAgICAgICAgICBtb250aHMgIDw9IDEgICAgICAgICAgICAgJiYgWydNJ10gICAgICAgICAgIHx8DQogICAgICAgICAgICBtb250aHMgIDwgdGhyZXNob2xkcy5NICAgJiYgWydNTScsIG1vbnRoc10gIHx8DQogICAgICAgICAgICB5ZWFycyAgIDw9IDEgICAgICAgICAgICAgJiYgWyd5J10gICAgICAgICAgIHx8IFsneXknLCB5ZWFyc107DQoNCiAgICBhWzJdID0gd2l0aG91dFN1ZmZpeDsNCiAgICBhWzNdID0gK3Bvc05lZ0R1cmF0aW9uID4gMDsNCiAgICBhWzRdID0gbG9jYWxlOw0KICAgIHJldHVybiBzdWJzdGl0dXRlVGltZUFnby5hcHBseShudWxsLCBhKTsNCn0NCg0KLy8gVGhpcyBmdW5jdGlvbiBhbGxvd3MgeW91IHRvIHNldCB0aGUgcm91bmRpbmcgZnVuY3Rpb24gZm9yIHJlbGF0aXZlIHRpbWUgc3RyaW5ncw0KZnVuY3Rpb24gZ2V0U2V0UmVsYXRpdmVUaW1lUm91bmRpbmcgKHJvdW5kaW5nRnVuY3Rpb24pIHsNCiAgICBpZiAocm91bmRpbmdGdW5jdGlvbiA9PT0gdW5kZWZpbmVkKSB7DQogICAgICAgIHJldHVybiByb3VuZDsNCiAgICB9DQogICAgaWYgKHR5cGVvZihyb3VuZGluZ0Z1bmN0aW9uKSA9PT0gJ2Z1bmN0aW9uJykgew0KICAgICAgICByb3VuZCA9IHJvdW5kaW5nRnVuY3Rpb247DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCiAgICByZXR1cm4gZmFsc2U7DQp9DQoNCi8vIFRoaXMgZnVuY3Rpb24gYWxsb3dzIHlvdSB0byBzZXQgYSB0aHJlc2hvbGQgZm9yIHJlbGF0aXZlIHRpbWUgc3RyaW5ncw0KZnVuY3Rpb24gZ2V0U2V0UmVsYXRpdmVUaW1lVGhyZXNob2xkICh0aHJlc2hvbGQsIGxpbWl0KSB7DQogICAgaWYgKHRocmVzaG9sZHNbdGhyZXNob2xkXSA9PT0gdW5kZWZpbmVkKSB7DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9DQogICAgaWYgKGxpbWl0ID09PSB1bmRlZmluZWQpIHsNCiAgICAgICAgcmV0dXJuIHRocmVzaG9sZHNbdGhyZXNob2xkXTsNCiAgICB9DQogICAgdGhyZXNob2xkc1t0aHJlc2hvbGRdID0gbGltaXQ7DQogICAgaWYgKHRocmVzaG9sZCA9PT0gJ3MnKSB7DQogICAgICAgIHRocmVzaG9sZHMuc3MgPSBsaW1pdCAtIDE7DQogICAgfQ0KICAgIHJldHVybiB0cnVlOw0KfQ0KDQpmdW5jdGlvbiBodW1hbml6ZSAod2l0aFN1ZmZpeCkgew0KICAgIGlmICghdGhpcy5pc1ZhbGlkKCkpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMubG9jYWxlRGF0YSgpLmludmFsaWREYXRlKCk7DQogICAgfQ0KDQogICAgdmFyIGxvY2FsZSA9IHRoaXMubG9jYWxlRGF0YSgpOw0KICAgIHZhciBvdXRwdXQgPSByZWxhdGl2ZVRpbWUkMSh0aGlzLCAhd2l0aFN1ZmZpeCwgbG9jYWxlKTsNCg0KICAgIGlmICh3aXRoU3VmZml4KSB7DQogICAgICAgIG91dHB1dCA9IGxvY2FsZS5wYXN0RnV0dXJlKCt0aGlzLCBvdXRwdXQpOw0KICAgIH0NCg0KICAgIHJldHVybiBsb2NhbGUucG9zdGZvcm1hdChvdXRwdXQpOw0KfQ0KDQp2YXIgYWJzJDEgPSBNYXRoLmFiczsNCg0KZnVuY3Rpb24gdG9JU09TdHJpbmckMSgpIHsNCiAgICAvLyBmb3IgSVNPIHN0cmluZ3Mgd2UgZG8gbm90IHVzZSB0aGUgbm9ybWFsIGJ1YmJsaW5nIHJ1bGVzOg0KICAgIC8vICAqIG1pbGxpc2Vjb25kcyBidWJibGUgdXAgdW50aWwgdGhleSBiZWNvbWUgaG91cnMNCiAgICAvLyAgKiBkYXlzIGRvIG5vdCBidWJibGUgYXQgYWxsDQogICAgLy8gICogbW9udGhzIGJ1YmJsZSB1cCB1bnRpbCB0aGV5IGJlY29tZSB5ZWFycw0KICAgIC8vIFRoaXMgaXMgYmVjYXVzZSB0aGVyZSBpcyBubyBjb250ZXh0LWZyZWUgY29udmVyc2lvbiBiZXR3ZWVuIGhvdXJzIGFuZCBkYXlzDQogICAgLy8gKHRoaW5rIG9mIGNsb2NrIGNoYW5nZXMpDQogICAgLy8gYW5kIGFsc28gbm90IGJldHdlZW4gZGF5cyBhbmQgbW9udGhzICgyOC0zMSBkYXlzIHBlciBtb250aCkNCiAgICBpZiAoIXRoaXMuaXNWYWxpZCgpKSB7DQogICAgICAgIHJldHVybiB0aGlzLmxvY2FsZURhdGEoKS5pbnZhbGlkRGF0ZSgpOw0KICAgIH0NCg0KICAgIHZhciBzZWNvbmRzID0gYWJzJDEodGhpcy5fbWlsbGlzZWNvbmRzKSAvIDEwMDA7DQogICAgdmFyIGRheXMgICAgICAgICA9IGFicyQxKHRoaXMuX2RheXMpOw0KICAgIHZhciBtb250aHMgICAgICAgPSBhYnMkMSh0aGlzLl9tb250aHMpOw0KICAgIHZhciBtaW51dGVzLCBob3VycywgeWVhcnM7DQoNCiAgICAvLyAzNjAwIHNlY29uZHMgLT4gNjAgbWludXRlcyAtPiAxIGhvdXINCiAgICBtaW51dGVzICAgICAgICAgICA9IGFic0Zsb29yKHNlY29uZHMgLyA2MCk7DQogICAgaG91cnMgICAgICAgICAgICAgPSBhYnNGbG9vcihtaW51dGVzIC8gNjApOw0KICAgIHNlY29uZHMgJT0gNjA7DQogICAgbWludXRlcyAlPSA2MDsNCg0KICAgIC8vIDEyIG1vbnRocyAtPiAxIHllYXINCiAgICB5ZWFycyAgPSBhYnNGbG9vcihtb250aHMgLyAxMik7DQogICAgbW9udGhzICU9IDEyOw0KDQoNCiAgICAvLyBpbnNwaXJlZCBieSBodHRwczovL2dpdGh1Yi5jb20vZG9yZGlsbGUvbW9tZW50LWlzb2R1cmF0aW9uL2Jsb2IvbWFzdGVyL21vbWVudC5pc29kdXJhdGlvbi5qcw0KICAgIHZhciBZID0geWVhcnM7DQogICAgdmFyIE0gPSBtb250aHM7DQogICAgdmFyIEQgPSBkYXlzOw0KICAgIHZhciBoID0gaG91cnM7DQogICAgdmFyIG0gPSBtaW51dGVzOw0KICAgIHZhciBzID0gc2Vjb25kczsNCiAgICB2YXIgdG90YWwgPSB0aGlzLmFzU2Vjb25kcygpOw0KDQogICAgaWYgKCF0b3RhbCkgew0KICAgICAgICAvLyB0aGlzIGlzIHRoZSBzYW1lIGFzIEMjJ3MgKE5vZGEpIGFuZCBweXRob24gKGlzb2RhdGUpLi4uDQogICAgICAgIC8vIGJ1dCBub3Qgb3RoZXIgSlMgKGdvb2cuZGF0ZSkNCiAgICAgICAgcmV0dXJuICdQMEQnOw0KICAgIH0NCg0KICAgIHJldHVybiAodG90YWwgPCAwID8gJy0nIDogJycpICsNCiAgICAgICAgJ1AnICsNCiAgICAgICAgKFkgPyBZICsgJ1knIDogJycpICsNCiAgICAgICAgKE0gPyBNICsgJ00nIDogJycpICsNCiAgICAgICAgKEQgPyBEICsgJ0QnIDogJycpICsNCiAgICAgICAgKChoIHx8IG0gfHwgcykgPyAnVCcgOiAnJykgKw0KICAgICAgICAoaCA/IGggKyAnSCcgOiAnJykgKw0KICAgICAgICAobSA/IG0gKyAnTScgOiAnJykgKw0KICAgICAgICAocyA/IHMgKyAnUycgOiAnJyk7DQp9DQoNCnZhciBwcm90byQyID0gRHVyYXRpb24ucHJvdG90eXBlOw0KDQpwcm90byQyLmlzVmFsaWQgICAgICAgID0gaXNWYWxpZCQxOw0KcHJvdG8kMi5hYnMgICAgICAgICAgICA9IGFiczsNCnByb3RvJDIuYWRkICAgICAgICAgICAgPSBhZGQkMTsNCnByb3RvJDIuc3VidHJhY3QgICAgICAgPSBzdWJ0cmFjdCQxOw0KcHJvdG8kMi5hcyAgICAgICAgICAgICA9IGFzOw0KcHJvdG8kMi5hc01pbGxpc2Vjb25kcyA9IGFzTWlsbGlzZWNvbmRzOw0KcHJvdG8kMi5hc1NlY29uZHMgICAgICA9IGFzU2Vjb25kczsNCnByb3RvJDIuYXNNaW51dGVzICAgICAgPSBhc01pbnV0ZXM7DQpwcm90byQyLmFzSG91cnMgICAgICAgID0gYXNIb3VyczsNCnByb3RvJDIuYXNEYXlzICAgICAgICAgPSBhc0RheXM7DQpwcm90byQyLmFzV2Vla3MgICAgICAgID0gYXNXZWVrczsNCnByb3RvJDIuYXNNb250aHMgICAgICAgPSBhc01vbnRoczsNCnByb3RvJDIuYXNZZWFycyAgICAgICAgPSBhc1llYXJzOw0KcHJvdG8kMi52YWx1ZU9mICAgICAgICA9IHZhbHVlT2YkMTsNCnByb3RvJDIuX2J1YmJsZSAgICAgICAgPSBidWJibGU7DQpwcm90byQyLmdldCAgICAgICAgICAgID0gZ2V0JDI7DQpwcm90byQyLm1pbGxpc2Vjb25kcyAgID0gbWlsbGlzZWNvbmRzOw0KcHJvdG8kMi5zZWNvbmRzICAgICAgICA9IHNlY29uZHM7DQpwcm90byQyLm1pbnV0ZXMgICAgICAgID0gbWludXRlczsNCnByb3RvJDIuaG91cnMgICAgICAgICAgPSBob3VyczsNCnByb3RvJDIuZGF5cyAgICAgICAgICAgPSBkYXlzOw0KcHJvdG8kMi53ZWVrcyAgICAgICAgICA9IHdlZWtzOw0KcHJvdG8kMi5tb250aHMgICAgICAgICA9IG1vbnRoczsNCnByb3RvJDIueWVhcnMgICAgICAgICAgPSB5ZWFyczsNCnByb3RvJDIuaHVtYW5pemUgICAgICAgPSBodW1hbml6ZTsNCnByb3RvJDIudG9JU09TdHJpbmcgICAgPSB0b0lTT1N0cmluZyQxOw0KcHJvdG8kMi50b1N0cmluZyAgICAgICA9IHRvSVNPU3RyaW5nJDE7DQpwcm90byQyLnRvSlNPTiAgICAgICAgID0gdG9JU09TdHJpbmckMTsNCnByb3RvJDIubG9jYWxlICAgICAgICAgPSBsb2NhbGU7DQpwcm90byQyLmxvY2FsZURhdGEgICAgID0gbG9jYWxlRGF0YTsNCg0KLy8gRGVwcmVjYXRpb25zDQpwcm90byQyLnRvSXNvU3RyaW5nID0gZGVwcmVjYXRlKCd0b0lzb1N0cmluZygpIGlzIGRlcHJlY2F0ZWQuIFBsZWFzZSB1c2UgdG9JU09TdHJpbmcoKSBpbnN0ZWFkIChub3RpY2UgdGhlIGNhcGl0YWxzKScsIHRvSVNPU3RyaW5nJDEpOw0KcHJvdG8kMi5sYW5nID0gbGFuZzsNCg0KLy8gU2lkZSBlZmZlY3QgaW1wb3J0cw0KDQovLyBGT1JNQVRUSU5HDQoNCmFkZEZvcm1hdFRva2VuKCdYJywgMCwgMCwgJ3VuaXgnKTsNCmFkZEZvcm1hdFRva2VuKCd4JywgMCwgMCwgJ3ZhbHVlT2YnKTsNCg0KLy8gUEFSU0lORw0KDQphZGRSZWdleFRva2VuKCd4JywgbWF0Y2hTaWduZWQpOw0KYWRkUmVnZXhUb2tlbignWCcsIG1hdGNoVGltZXN0YW1wKTsNCmFkZFBhcnNlVG9rZW4oJ1gnLCBmdW5jdGlvbiAoaW5wdXQsIGFycmF5LCBjb25maWcpIHsNCiAgICBjb25maWcuX2QgPSBuZXcgRGF0ZShwYXJzZUZsb2F0KGlucHV0LCAxMCkgKiAxMDAwKTsNCn0pOw0KYWRkUGFyc2VUb2tlbigneCcsIGZ1bmN0aW9uIChpbnB1dCwgYXJyYXksIGNvbmZpZykgew0KICAgIGNvbmZpZy5fZCA9IG5ldyBEYXRlKHRvSW50KGlucHV0KSk7DQp9KTsNCg0KLy8gU2lkZSBlZmZlY3QgaW1wb3J0cw0KDQoNCmhvb2tzLnZlcnNpb24gPSAnMi4xOC4xJzsNCg0Kc2V0SG9va0NhbGxiYWNrKGNyZWF0ZUxvY2FsKTsNCg0KaG9va3MuZm4gICAgICAgICAgICAgICAgICAgID0gcHJvdG87DQpob29rcy5taW4gICAgICAgICAgICAgICAgICAgPSBtaW47DQpob29rcy5tYXggICAgICAgICAgICAgICAgICAgPSBtYXg7DQpob29rcy5ub3cgICAgICAgICAgICAgICAgICAgPSBub3c7DQpob29rcy51dGMgICAgICAgICAgICAgICAgICAgPSBjcmVhdGVVVEM7DQpob29rcy51bml4ICAgICAgICAgICAgICAgICAgPSBjcmVhdGVVbml4Ow0KaG9va3MubW9udGhzICAgICAgICAgICAgICAgID0gbGlzdE1vbnRoczsNCmhvb2tzLmlzRGF0ZSAgICAgICAgICAgICAgICA9IGlzRGF0ZTsNCmhvb2tzLmxvY2FsZSAgICAgICAgICAgICAgICA9IGdldFNldEdsb2JhbExvY2FsZTsNCmhvb2tzLmludmFsaWQgICAgICAgICAgICAgICA9IGNyZWF0ZUludmFsaWQ7DQpob29rcy5kdXJhdGlvbiAgICAgICAgICAgICAgPSBjcmVhdGVEdXJhdGlvbjsNCmhvb2tzLmlzTW9tZW50ICAgICAgICAgICAgICA9IGlzTW9tZW50Ow0KaG9va3Mud2Vla2RheXMgICAgICAgICAgICAgID0gbGlzdFdlZWtkYXlzOw0KaG9va3MucGFyc2Vab25lICAgICAgICAgICAgID0gY3JlYXRlSW5ab25lOw0KaG9va3MubG9jYWxlRGF0YSAgICAgICAgICAgID0gZ2V0TG9jYWxlOw0KaG9va3MuaXNEdXJhdGlvbiAgICAgICAgICAgID0gaXNEdXJhdGlvbjsNCmhvb2tzLm1vbnRoc1Nob3J0ICAgICAgICAgICA9IGxpc3RNb250aHNTaG9ydDsNCmhvb2tzLndlZWtkYXlzTWluICAgICAgICAgICA9IGxpc3RXZWVrZGF5c01pbjsNCmhvb2tzLmRlZmluZUxvY2FsZSAgICAgICAgICA9IGRlZmluZUxvY2FsZTsNCmhvb2tzLnVwZGF0ZUxvY2FsZSAgICAgICAgICA9IHVwZGF0ZUxvY2FsZTsNCmhvb2tzLmxvY2FsZXMgICAgICAgICAgICAgICA9IGxpc3RMb2NhbGVzOw0KaG9va3Mud2Vla2RheXNTaG9ydCAgICAgICAgID0gbGlzdFdlZWtkYXlzU2hvcnQ7DQpob29rcy5ub3JtYWxpemVVbml0cyAgICAgICAgPSBub3JtYWxpemVVbml0czsNCmhvb2tzLnJlbGF0aXZlVGltZVJvdW5kaW5nID0gZ2V0U2V0UmVsYXRpdmVUaW1lUm91bmRpbmc7DQpob29rcy5yZWxhdGl2ZVRpbWVUaHJlc2hvbGQgPSBnZXRTZXRSZWxhdGl2ZVRpbWVUaHJlc2hvbGQ7DQpob29rcy5jYWxlbmRhckZvcm1hdCAgICAgICAgPSBnZXRDYWxlbmRhckZvcm1hdDsNCmhvb2tzLnByb3RvdHlwZSAgICAgICAgICAgICA9IHByb3RvOw0KDQpyZXR1cm4gaG9va3M7DQoNCn0pKSk7DQoNCn0se31dLDc6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpew0KLyoqDQogKiBAbmFtZXNwYWNlIENoYXJ0DQogKi8NCnZhciBDaGFydCA9IHJlcXVpcmUoMjkpKCk7DQoNCkNoYXJ0LmhlbHBlcnMgPSByZXF1aXJlKDQ1KTsNCg0KLy8gQHRvZG8gZGlzcGF0Y2ggdGhlc2UgaGVscGVycyBpbnRvIGFwcHJvcHJpYXRlZCBoZWxwZXJzL2hlbHBlcnMuKiBmaWxlIGFuZCB3cml0ZSB1bml0IHRlc3RzIQ0KcmVxdWlyZSgyNykoQ2hhcnQpOw0KDQpDaGFydC5kZWZhdWx0cyA9IHJlcXVpcmUoMjUpOw0KQ2hhcnQuRWxlbWVudCA9IHJlcXVpcmUoMjYpOw0KQ2hhcnQuZWxlbWVudHMgPSByZXF1aXJlKDQwKTsNCkNoYXJ0LkludGVyYWN0aW9uID0gcmVxdWlyZSgyOCk7DQpDaGFydC5wbGF0Zm9ybSA9IHJlcXVpcmUoNDgpOw0KDQpyZXF1aXJlKDMxKShDaGFydCk7DQpyZXF1aXJlKDIyKShDaGFydCk7DQpyZXF1aXJlKDIzKShDaGFydCk7DQpyZXF1aXJlKDI0KShDaGFydCk7DQpyZXF1aXJlKDMwKShDaGFydCk7DQpyZXF1aXJlKDMzKShDaGFydCk7DQpyZXF1aXJlKDMyKShDaGFydCk7DQpyZXF1aXJlKDM1KShDaGFydCk7DQoNCnJlcXVpcmUoNTQpKENoYXJ0KTsNCnJlcXVpcmUoNTIpKENoYXJ0KTsNCnJlcXVpcmUoNTMpKENoYXJ0KTsNCnJlcXVpcmUoNTUpKENoYXJ0KTsNCnJlcXVpcmUoNTYpKENoYXJ0KTsNCnJlcXVpcmUoNTcpKENoYXJ0KTsNCg0KLy8gQ29udHJvbGxlcnMgbXVzdCBiZSBsb2FkZWQgYWZ0ZXIgZWxlbWVudHMNCi8vIFNlZSBDaGFydC5jb3JlLmRhdGFzZXRDb250cm9sbGVyLmRhdGFFbGVtZW50VHlwZQ0KcmVxdWlyZSgxNSkoQ2hhcnQpOw0KcmVxdWlyZSgxNikoQ2hhcnQpOw0KcmVxdWlyZSgxNykoQ2hhcnQpOw0KcmVxdWlyZSgxOCkoQ2hhcnQpOw0KcmVxdWlyZSgxOSkoQ2hhcnQpOw0KcmVxdWlyZSgyMCkoQ2hhcnQpOw0KcmVxdWlyZSgyMSkoQ2hhcnQpOw0KDQpyZXF1aXJlKDgpKENoYXJ0KTsNCnJlcXVpcmUoOSkoQ2hhcnQpOw0KcmVxdWlyZSgxMCkoQ2hhcnQpOw0KcmVxdWlyZSgxMSkoQ2hhcnQpOw0KcmVxdWlyZSgxMikoQ2hhcnQpOw0KcmVxdWlyZSgxMykoQ2hhcnQpOw0KcmVxdWlyZSgxNCkoQ2hhcnQpOw0KDQovLyBMb2FkaW5nIGJ1aWx0LWl0IHBsdWdpbnMNCnZhciBwbHVnaW5zID0gW107DQoNCnBsdWdpbnMucHVzaCgNCglyZXF1aXJlKDQ5KShDaGFydCksDQoJcmVxdWlyZSg1MCkoQ2hhcnQpLA0KCXJlcXVpcmUoNTEpKENoYXJ0KQ0KKTsNCg0KQ2hhcnQucGx1Z2lucy5yZWdpc3RlcihwbHVnaW5zKTsNCg0KQ2hhcnQucGxhdGZvcm0uaW5pdGlhbGl6ZSgpOw0KDQptb2R1bGUuZXhwb3J0cyA9IENoYXJ0Ow0KaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7DQoJd2luZG93LkNoYXJ0ID0gQ2hhcnQ7DQp9DQoNCi8vIERFUFJFQ0FUSU9OUw0KDQovKioNCiAqIFByb3ZpZGVkIGZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5LCB1c2UgQ2hhcnQuaGVscGVycy5jYW52YXMgaW5zdGVhZC4NCiAqIEBuYW1lc3BhY2UgQ2hhcnQuY2FudmFzSGVscGVycw0KICogQGRlcHJlY2F0ZWQgc2luY2UgdmVyc2lvbiAyLjYuMA0KICogQHRvZG8gcmVtb3ZlIGF0IHZlcnNpb24gMw0KICogQHByaXZhdGUNCiAqLw0KQ2hhcnQuY2FudmFzSGVscGVycyA9IENoYXJ0LmhlbHBlcnMuY2FudmFzOw0KDQp9LHsiMTAiOjEwLCIxMSI6MTEsIjEyIjoxMiwiMTMiOjEzLCIxNCI6MTQsIjE1IjoxNSwiMTYiOjE2LCIxNyI6MTcsIjE4IjoxOCwiMTkiOjE5LCIyMCI6MjAsIjIxIjoyMSwiMjIiOjIyLCIyMyI6MjMsIjI0IjoyNCwiMjUiOjI1LCIyNiI6MjYsIjI3IjoyNywiMjgiOjI4LCIyOSI6MjksIjMwIjozMCwiMzEiOjMxLCIzMiI6MzIsIjMzIjozMywiMzUiOjM1LCI0MCI6NDAsIjQ1Ijo0NSwiNDgiOjQ4LCI0OSI6NDksIjUwIjo1MCwiNTEiOjUxLCI1MiI6NTIsIjUzIjo1MywiNTQiOjU0LCI1NSI6NTUsIjU2Ijo1NiwiNTciOjU3LCI4Ijo4LCI5Ijo5fV0sODpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7DQondXNlIHN0cmljdCc7DQoNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oQ2hhcnQpIHsNCg0KCUNoYXJ0LkJhciA9IGZ1bmN0aW9uKGNvbnRleHQsIGNvbmZpZykgew0KCQljb25maWcudHlwZSA9ICdiYXInOw0KDQoJCXJldHVybiBuZXcgQ2hhcnQoY29udGV4dCwgY29uZmlnKTsNCgl9Ow0KDQp9Ow0KDQp9LHt9XSw5OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsNCid1c2Ugc3RyaWN0JzsNCg0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihDaGFydCkgew0KDQoJQ2hhcnQuQnViYmxlID0gZnVuY3Rpb24oY29udGV4dCwgY29uZmlnKSB7DQoJCWNvbmZpZy50eXBlID0gJ2J1YmJsZSc7DQoJCXJldHVybiBuZXcgQ2hhcnQoY29udGV4dCwgY29uZmlnKTsNCgl9Ow0KDQp9Ow0KDQp9LHt9XSwxMDpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7DQondXNlIHN0cmljdCc7DQoNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oQ2hhcnQpIHsNCg0KCUNoYXJ0LkRvdWdobnV0ID0gZnVuY3Rpb24oY29udGV4dCwgY29uZmlnKSB7DQoJCWNvbmZpZy50eXBlID0gJ2RvdWdobnV0JzsNCg0KCQlyZXR1cm4gbmV3IENoYXJ0KGNvbnRleHQsIGNvbmZpZyk7DQoJfTsNCg0KfTsNCg0KfSx7fV0sMTE6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpew0KJ3VzZSBzdHJpY3QnOw0KDQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKENoYXJ0KSB7DQoNCglDaGFydC5MaW5lID0gZnVuY3Rpb24oY29udGV4dCwgY29uZmlnKSB7DQoJCWNvbmZpZy50eXBlID0gJ2xpbmUnOw0KDQoJCXJldHVybiBuZXcgQ2hhcnQoY29udGV4dCwgY29uZmlnKTsNCgl9Ow0KDQp9Ow0KDQp9LHt9XSwxMjpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7DQondXNlIHN0cmljdCc7DQoNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oQ2hhcnQpIHsNCg0KCUNoYXJ0LlBvbGFyQXJlYSA9IGZ1bmN0aW9uKGNvbnRleHQsIGNvbmZpZykgew0KCQljb25maWcudHlwZSA9ICdwb2xhckFyZWEnOw0KDQoJCXJldHVybiBuZXcgQ2hhcnQoY29udGV4dCwgY29uZmlnKTsNCgl9Ow0KDQp9Ow0KDQp9LHt9XSwxMzpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7DQondXNlIHN0cmljdCc7DQoNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oQ2hhcnQpIHsNCg0KCUNoYXJ0LlJhZGFyID0gZnVuY3Rpb24oY29udGV4dCwgY29uZmlnKSB7DQoJCWNvbmZpZy50eXBlID0gJ3JhZGFyJzsNCg0KCQlyZXR1cm4gbmV3IENoYXJ0KGNvbnRleHQsIGNvbmZpZyk7DQoJfTsNCg0KfTsNCg0KfSx7fV0sMTQ6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpew0KJ3VzZSBzdHJpY3QnOw0KDQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKENoYXJ0KSB7DQoJQ2hhcnQuU2NhdHRlciA9IGZ1bmN0aW9uKGNvbnRleHQsIGNvbmZpZykgew0KCQljb25maWcudHlwZSA9ICdzY2F0dGVyJzsNCgkJcmV0dXJuIG5ldyBDaGFydChjb250ZXh0LCBjb25maWcpOw0KCX07DQp9Ow0KDQp9LHt9XSwxNTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7DQondXNlIHN0cmljdCc7DQoNCnZhciBkZWZhdWx0cyA9IHJlcXVpcmUoMjUpOw0KdmFyIGVsZW1lbnRzID0gcmVxdWlyZSg0MCk7DQp2YXIgaGVscGVycyA9IHJlcXVpcmUoNDUpOw0KDQpkZWZhdWx0cy5fc2V0KCdiYXInLCB7DQoJaG92ZXI6IHsNCgkJbW9kZTogJ2xhYmVsJw0KCX0sDQoNCglzY2FsZXM6IHsNCgkJeEF4ZXM6IFt7DQoJCQl0eXBlOiAnY2F0ZWdvcnknLA0KDQoJCQkvLyBTcGVjaWZpYyB0byBCYXIgQ29udHJvbGxlcg0KCQkJY2F0ZWdvcnlQZXJjZW50YWdlOiAwLjgsDQoJCQliYXJQZXJjZW50YWdlOiAwLjksDQoNCgkJCS8vIG9mZnNldCBzZXR0aW5ncw0KCQkJb2Zmc2V0OiB0cnVlLA0KDQoJCQkvLyBncmlkIGxpbmUgc2V0dGluZ3MNCgkJCWdyaWRMaW5lczogew0KCQkJCW9mZnNldEdyaWRMaW5lczogdHJ1ZQ0KCQkJfQ0KCQl9XSwNCg0KCQl5QXhlczogW3sNCgkJCXR5cGU6ICdsaW5lYXInDQoJCX1dDQoJfQ0KfSk7DQoNCmRlZmF1bHRzLl9zZXQoJ2hvcml6b250YWxCYXInLCB7DQoJaG92ZXI6IHsNCgkJbW9kZTogJ2luZGV4JywNCgkJYXhpczogJ3knDQoJfSwNCg0KCXNjYWxlczogew0KCQl4QXhlczogW3sNCgkJCXR5cGU6ICdsaW5lYXInLA0KCQkJcG9zaXRpb246ICdib3R0b20nDQoJCX1dLA0KDQoJCXlBeGVzOiBbew0KCQkJcG9zaXRpb246ICdsZWZ0JywNCgkJCXR5cGU6ICdjYXRlZ29yeScsDQoNCgkJCS8vIFNwZWNpZmljIHRvIEhvcml6b250YWwgQmFyIENvbnRyb2xsZXINCgkJCWNhdGVnb3J5UGVyY2VudGFnZTogMC44LA0KCQkJYmFyUGVyY2VudGFnZTogMC45LA0KDQoJCQkvLyBvZmZzZXQgc2V0dGluZ3MNCgkJCW9mZnNldDogdHJ1ZSwNCg0KCQkJLy8gZ3JpZCBsaW5lIHNldHRpbmdzDQoJCQlncmlkTGluZXM6IHsNCgkJCQlvZmZzZXRHcmlkTGluZXM6IHRydWUNCgkJCX0NCgkJfV0NCgl9LA0KDQoJZWxlbWVudHM6IHsNCgkJcmVjdGFuZ2xlOiB7DQoJCQlib3JkZXJTa2lwcGVkOiAnbGVmdCcNCgkJfQ0KCX0sDQoNCgl0b29sdGlwczogew0KCQljYWxsYmFja3M6IHsNCgkJCXRpdGxlOiBmdW5jdGlvbihpdGVtLCBkYXRhKSB7DQoJCQkJLy8gUGljayBmaXJzdCB4TGFiZWwgZm9yIG5vdw0KCQkJCXZhciB0aXRsZSA9ICcnOw0KDQoJCQkJaWYgKGl0ZW0ubGVuZ3RoID4gMCkgew0KCQkJCQlpZiAoaXRlbVswXS55TGFiZWwpIHsNCgkJCQkJCXRpdGxlID0gaXRlbVswXS55TGFiZWw7DQoJCQkJCX0gZWxzZSBpZiAoZGF0YS5sYWJlbHMubGVuZ3RoID4gMCAmJiBpdGVtWzBdLmluZGV4IDwgZGF0YS5sYWJlbHMubGVuZ3RoKSB7DQoJCQkJCQl0aXRsZSA9IGRhdGEubGFiZWxzW2l0ZW1bMF0uaW5kZXhdOw0KCQkJCQl9DQoJCQkJfQ0KDQoJCQkJcmV0dXJuIHRpdGxlOw0KCQkJfSwNCg0KCQkJbGFiZWw6IGZ1bmN0aW9uKGl0ZW0sIGRhdGEpIHsNCgkJCQl2YXIgZGF0YXNldExhYmVsID0gZGF0YS5kYXRhc2V0c1tpdGVtLmRhdGFzZXRJbmRleF0ubGFiZWwgfHwgJyc7DQoJCQkJcmV0dXJuIGRhdGFzZXRMYWJlbCArICc6ICcgKyBpdGVtLnhMYWJlbDsNCgkJCX0NCgkJfSwNCgkJbW9kZTogJ2luZGV4JywNCgkJYXhpczogJ3knDQoJfQ0KfSk7DQoNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oQ2hhcnQpIHsNCg0KCUNoYXJ0LmNvbnRyb2xsZXJzLmJhciA9IENoYXJ0LkRhdGFzZXRDb250cm9sbGVyLmV4dGVuZCh7DQoNCgkJZGF0YUVsZW1lbnRUeXBlOiBlbGVtZW50cy5SZWN0YW5nbGUsDQoNCgkJaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7DQoJCQl2YXIgbWUgPSB0aGlzOw0KCQkJdmFyIG1ldGE7DQoNCgkJCUNoYXJ0LkRhdGFzZXRDb250cm9sbGVyLnByb3RvdHlwZS5pbml0aWFsaXplLmFwcGx5KG1lLCBhcmd1bWVudHMpOw0KDQoJCQltZXRhID0gbWUuZ2V0TWV0YSgpOw0KCQkJbWV0YS5zdGFjayA9IG1lLmdldERhdGFzZXQoKS5zdGFjazsNCgkJCW1ldGEuYmFyID0gdHJ1ZTsNCgkJfSwNCg0KCQl1cGRhdGU6IGZ1bmN0aW9uKHJlc2V0KSB7DQoJCQl2YXIgbWUgPSB0aGlzOw0KCQkJdmFyIHJlY3RzID0gbWUuZ2V0TWV0YSgpLmRhdGE7DQoJCQl2YXIgaSwgaWxlbjsNCg0KCQkJbWUuX3J1bGVyID0gbWUuZ2V0UnVsZXIoKTsNCg0KCQkJZm9yIChpID0gMCwgaWxlbiA9IHJlY3RzLmxlbmd0aDsgaSA8IGlsZW47ICsraSkgew0KCQkJCW1lLnVwZGF0ZUVsZW1lbnQocmVjdHNbaV0sIGksIHJlc2V0KTsNCgkJCX0NCgkJfSwNCg0KCQl1cGRhdGVFbGVtZW50OiBmdW5jdGlvbihyZWN0YW5nbGUsIGluZGV4LCByZXNldCkgew0KCQkJdmFyIG1lID0gdGhpczsNCgkJCXZhciBjaGFydCA9IG1lLmNoYXJ0Ow0KCQkJdmFyIG1ldGEgPSBtZS5nZXRNZXRhKCk7DQoJCQl2YXIgZGF0YXNldCA9IG1lLmdldERhdGFzZXQoKTsNCgkJCXZhciBjdXN0b20gPSByZWN0YW5nbGUuY3VzdG9tIHx8IHt9Ow0KCQkJdmFyIHJlY3RhbmdsZU9wdGlvbnMgPSBjaGFydC5vcHRpb25zLmVsZW1lbnRzLnJlY3RhbmdsZTsNCg0KCQkJcmVjdGFuZ2xlLl94U2NhbGUgPSBtZS5nZXRTY2FsZUZvcklkKG1ldGEueEF4aXNJRCk7DQoJCQlyZWN0YW5nbGUuX3lTY2FsZSA9IG1lLmdldFNjYWxlRm9ySWQobWV0YS55QXhpc0lEKTsNCgkJCXJlY3RhbmdsZS5fZGF0YXNldEluZGV4ID0gbWUuaW5kZXg7DQoJCQlyZWN0YW5nbGUuX2luZGV4ID0gaW5kZXg7DQoNCgkJCXJlY3RhbmdsZS5fbW9kZWwgPSB7DQoJCQkJZGF0YXNldExhYmVsOiBkYXRhc2V0LmxhYmVsLA0KCQkJCWxhYmVsOiBjaGFydC5kYXRhLmxhYmVsc1tpbmRleF0sDQoJCQkJYm9yZGVyU2tpcHBlZDogY3VzdG9tLmJvcmRlclNraXBwZWQgPyBjdXN0b20uYm9yZGVyU2tpcHBlZCA6IHJlY3RhbmdsZU9wdGlvbnMuYm9yZGVyU2tpcHBlZCwNCgkJCQliYWNrZ3JvdW5kQ29sb3I6IGN1c3RvbS5iYWNrZ3JvdW5kQ29sb3IgPyBjdXN0b20uYmFja2dyb3VuZENvbG9yIDogaGVscGVycy52YWx1ZUF0SW5kZXhPckRlZmF1bHQoZGF0YXNldC5iYWNrZ3JvdW5kQ29sb3IsIGluZGV4LCByZWN0YW5nbGVPcHRpb25zLmJhY2tncm91bmRDb2xvciksDQoJCQkJYm9yZGVyQ29sb3I6IGN1c3RvbS5ib3JkZXJDb2xvciA/IGN1c3RvbS5ib3JkZXJDb2xvciA6IGhlbHBlcnMudmFsdWVBdEluZGV4T3JEZWZhdWx0KGRhdGFzZXQuYm9yZGVyQ29sb3IsIGluZGV4LCByZWN0YW5nbGVPcHRpb25zLmJvcmRlckNvbG9yKSwNCgkJCQlib3JkZXJXaWR0aDogY3VzdG9tLmJvcmRlcldpZHRoID8gY3VzdG9tLmJvcmRlcldpZHRoIDogaGVscGVycy52YWx1ZUF0SW5kZXhPckRlZmF1bHQoZGF0YXNldC5ib3JkZXJXaWR0aCwgaW5kZXgsIHJlY3RhbmdsZU9wdGlvbnMuYm9yZGVyV2lkdGgpDQoJCQl9Ow0KDQoJCQltZS51cGRhdGVFbGVtZW50R2VvbWV0cnkocmVjdGFuZ2xlLCBpbmRleCwgcmVzZXQpOw0KDQoJCQlyZWN0YW5nbGUucGl2b3QoKTsNCgkJfSwNCg0KCQkvKioNCgkJICogQHByaXZhdGUNCgkJICovDQoJCXVwZGF0ZUVsZW1lbnRHZW9tZXRyeTogZnVuY3Rpb24ocmVjdGFuZ2xlLCBpbmRleCwgcmVzZXQpIHsNCgkJCXZhciBtZSA9IHRoaXM7DQoJCQl2YXIgbW9kZWwgPSByZWN0YW5nbGUuX21vZGVsOw0KCQkJdmFyIHZzY2FsZSA9IG1lLmdldFZhbHVlU2NhbGUoKTsNCgkJCXZhciBiYXNlID0gdnNjYWxlLmdldEJhc2VQaXhlbCgpOw0KCQkJdmFyIGhvcml6b250YWwgPSB2c2NhbGUuaXNIb3Jpem9udGFsKCk7DQoJCQl2YXIgcnVsZXIgPSBtZS5fcnVsZXIgfHwgbWUuZ2V0UnVsZXIoKTsNCgkJCXZhciB2cGl4ZWxzID0gbWUuY2FsY3VsYXRlQmFyVmFsdWVQaXhlbHMobWUuaW5kZXgsIGluZGV4KTsNCgkJCXZhciBpcGl4ZWxzID0gbWUuY2FsY3VsYXRlQmFySW5kZXhQaXhlbHMobWUuaW5kZXgsIGluZGV4LCBydWxlcik7DQoNCgkJCW1vZGVsLmhvcml6b250YWwgPSBob3Jpem9udGFsOw0KCQkJbW9kZWwuYmFzZSA9IHJlc2V0ID8gYmFzZSA6IHZwaXhlbHMuYmFzZTsNCgkJCW1vZGVsLnggPSBob3Jpem9udGFsID8gcmVzZXQgPyBiYXNlIDogdnBpeGVscy5oZWFkIDogaXBpeGVscy5jZW50ZXI7DQoJCQltb2RlbC55ID0gaG9yaXpvbnRhbCA/IGlwaXhlbHMuY2VudGVyIDogcmVzZXQgPyBiYXNlIDogdnBpeGVscy5oZWFkOw0KCQkJbW9kZWwuaGVpZ2h0ID0gaG9yaXpvbnRhbCA/IGlwaXhlbHMuc2l6ZSA6IHVuZGVmaW5lZDsNCgkJCW1vZGVsLndpZHRoID0gaG9yaXpvbnRhbCA/IHVuZGVmaW5lZCA6IGlwaXhlbHMuc2l6ZTsNCgkJfSwNCg0KCQkvKioNCgkJICogQHByaXZhdGUNCgkJICovDQoJCWdldFZhbHVlU2NhbGVJZDogZnVuY3Rpb24oKSB7DQoJCQlyZXR1cm4gdGhpcy5nZXRNZXRhKCkueUF4aXNJRDsNCgkJfSwNCg0KCQkvKioNCgkJICogQHByaXZhdGUNCgkJICovDQoJCWdldEluZGV4U2NhbGVJZDogZnVuY3Rpb24oKSB7DQoJCQlyZXR1cm4gdGhpcy5nZXRNZXRhKCkueEF4aXNJRDsNCgkJfSwNCg0KCQkvKioNCgkJICogQHByaXZhdGUNCgkJICovDQoJCWdldFZhbHVlU2NhbGU6IGZ1bmN0aW9uKCkgew0KCQkJcmV0dXJuIHRoaXMuZ2V0U2NhbGVGb3JJZCh0aGlzLmdldFZhbHVlU2NhbGVJZCgpKTsNCgkJfSwNCg0KCQkvKioNCgkJICogQHByaXZhdGUNCgkJICovDQoJCWdldEluZGV4U2NhbGU6IGZ1bmN0aW9uKCkgew0KCQkJcmV0dXJuIHRoaXMuZ2V0U2NhbGVGb3JJZCh0aGlzLmdldEluZGV4U2NhbGVJZCgpKTsNCgkJfSwNCg0KCQkvKioNCgkJICogUmV0dXJucyB0aGUgZWZmZWN0aXZlIG51bWJlciBvZiBzdGFja3MgYmFzZWQgb24gZ3JvdXBzIGFuZCBiYXIgdmlzaWJpbGl0eS4NCgkJICogQHByaXZhdGUNCgkJICovDQoJCWdldFN0YWNrQ291bnQ6IGZ1bmN0aW9uKGxhc3QpIHsNCgkJCXZhciBtZSA9IHRoaXM7DQoJCQl2YXIgY2hhcnQgPSBtZS5jaGFydDsNCgkJCXZhciBzY2FsZSA9IG1lLmdldEluZGV4U2NhbGUoKTsNCgkJCXZhciBzdGFja2VkID0gc2NhbGUub3B0aW9ucy5zdGFja2VkOw0KCQkJdmFyIGlsZW4gPSBsYXN0ID09PSB1bmRlZmluZWQgPyBjaGFydC5kYXRhLmRhdGFzZXRzLmxlbmd0aCA6IGxhc3QgKyAxOw0KCQkJdmFyIHN0YWNrcyA9IFtdOw0KCQkJdmFyIGksIG1ldGE7DQoNCgkJCWZvciAoaSA9IDA7IGkgPCBpbGVuOyArK2kpIHsNCgkJCQltZXRhID0gY2hhcnQuZ2V0RGF0YXNldE1ldGEoaSk7DQoJCQkJaWYgKG1ldGEuYmFyICYmIGNoYXJ0LmlzRGF0YXNldFZpc2libGUoaSkgJiYNCgkJCQkJKHN0YWNrZWQgPT09IGZhbHNlIHx8DQoJCQkJCShzdGFja2VkID09PSB0cnVlICYmIHN0YWNrcy5pbmRleE9mKG1ldGEuc3RhY2spID09PSAtMSkgfHwNCgkJCQkJKHN0YWNrZWQgPT09IHVuZGVmaW5lZCAmJiAobWV0YS5zdGFjayA9PT0gdW5kZWZpbmVkIHx8IHN0YWNrcy5pbmRleE9mKG1ldGEuc3RhY2spID09PSAtMSkpKSkgew0KCQkJCQlzdGFja3MucHVzaChtZXRhLnN0YWNrKTsNCgkJCQl9DQoJCQl9DQoNCgkJCXJldHVybiBzdGFja3MubGVuZ3RoOw0KCQl9LA0KDQoJCS8qKg0KCQkgKiBSZXR1cm5zIHRoZSBzdGFjayBpbmRleCBmb3IgdGhlIGdpdmVuIGRhdGFzZXQgYmFzZWQgb24gZ3JvdXBzIGFuZCBiYXIgdmlzaWJpbGl0eS4NCgkJICogQHByaXZhdGUNCgkJICovDQoJCWdldFN0YWNrSW5kZXg6IGZ1bmN0aW9uKGRhdGFzZXRJbmRleCkgew0KCQkJcmV0dXJuIHRoaXMuZ2V0U3RhY2tDb3VudChkYXRhc2V0SW5kZXgpIC0gMTsNCgkJfSwNCg0KCQkvKioNCgkJICogQHByaXZhdGUNCgkJICovDQoJCWdldFJ1bGVyOiBmdW5jdGlvbigpIHsNCgkJCXZhciBtZSA9IHRoaXM7DQoJCQl2YXIgc2NhbGUgPSBtZS5nZXRJbmRleFNjYWxlKCk7DQoJCQl2YXIgc3RhY2tDb3VudCA9IG1lLmdldFN0YWNrQ291bnQoKTsNCgkJCXZhciBkYXRhc2V0SW5kZXggPSBtZS5pbmRleDsNCgkJCXZhciBwaXhlbHMgPSBbXTsNCgkJCXZhciBpc0hvcml6b250YWwgPSBzY2FsZS5pc0hvcml6b250YWwoKTsNCgkJCXZhciBzdGFydCA9IGlzSG9yaXpvbnRhbCA/IHNjYWxlLmxlZnQgOiBzY2FsZS50b3A7DQoJCQl2YXIgZW5kID0gc3RhcnQgKyAoaXNIb3Jpem9udGFsID8gc2NhbGUud2lkdGggOiBzY2FsZS5oZWlnaHQpOw0KCQkJdmFyIGksIGlsZW47DQoNCgkJCWZvciAoaSA9IDAsIGlsZW4gPSBtZS5nZXRNZXRhKCkuZGF0YS5sZW5ndGg7IGkgPCBpbGVuOyArK2kpIHsNCgkJCQlwaXhlbHMucHVzaChzY2FsZS5nZXRQaXhlbEZvclZhbHVlKG51bGwsIGksIGRhdGFzZXRJbmRleCkpOw0KCQkJfQ0KDQoJCQlyZXR1cm4gew0KCQkJCXBpeGVsczogcGl4ZWxzLA0KCQkJCXN0YXJ0OiBzdGFydCwNCgkJCQllbmQ6IGVuZCwNCgkJCQlzdGFja0NvdW50OiBzdGFja0NvdW50LA0KCQkJCXNjYWxlOiBzY2FsZQ0KCQkJfTsNCgkJfSwNCg0KCQkvKioNCgkJICogTm90ZTogcGl4ZWwgdmFsdWVzIGFyZSBub3QgY2xhbXBlZCB0byB0aGUgc2NhbGUgYXJlYS4NCgkJICogQHByaXZhdGUNCgkJICovDQoJCWNhbGN1bGF0ZUJhclZhbHVlUGl4ZWxzOiBmdW5jdGlvbihkYXRhc2V0SW5kZXgsIGluZGV4KSB7DQoJCQl2YXIgbWUgPSB0aGlzOw0KCQkJdmFyIGNoYXJ0ID0gbWUuY2hhcnQ7DQoJCQl2YXIgbWV0YSA9IG1lLmdldE1ldGEoKTsNCgkJCXZhciBzY2FsZSA9IG1lLmdldFZhbHVlU2NhbGUoKTsNCgkJCXZhciBkYXRhc2V0cyA9IGNoYXJ0LmRhdGEuZGF0YXNldHM7DQoJCQl2YXIgdmFsdWUgPSBzY2FsZS5nZXRSaWdodFZhbHVlKGRhdGFzZXRzW2RhdGFzZXRJbmRleF0uZGF0YVtpbmRleF0pOw0KCQkJdmFyIHN0YWNrZWQgPSBzY2FsZS5vcHRpb25zLnN0YWNrZWQ7DQoJCQl2YXIgc3RhY2sgPSBtZXRhLnN0YWNrOw0KCQkJdmFyIHN0YXJ0ID0gMDsNCgkJCXZhciBpLCBpbWV0YSwgaXZhbHVlLCBiYXNlLCBoZWFkLCBzaXplOw0KDQoJCQlpZiAoc3RhY2tlZCB8fCAoc3RhY2tlZCA9PT0gdW5kZWZpbmVkICYmIHN0YWNrICE9PSB1bmRlZmluZWQpKSB7DQoJCQkJZm9yIChpID0gMDsgaSA8IGRhdGFzZXRJbmRleDsgKytpKSB7DQoJCQkJCWltZXRhID0gY2hhcnQuZ2V0RGF0YXNldE1ldGEoaSk7DQoNCgkJCQkJaWYgKGltZXRhLmJhciAmJg0KCQkJCQkJaW1ldGEuc3RhY2sgPT09IHN0YWNrICYmDQoJCQkJCQlpbWV0YS5jb250cm9sbGVyLmdldFZhbHVlU2NhbGVJZCgpID09PSBzY2FsZS5pZCAmJg0KCQkJCQkJY2hhcnQuaXNEYXRhc2V0VmlzaWJsZShpKSkgew0KDQoJCQkJCQlpdmFsdWUgPSBzY2FsZS5nZXRSaWdodFZhbHVlKGRhdGFzZXRzW2ldLmRhdGFbaW5kZXhdKTsNCgkJCQkJCWlmICgodmFsdWUgPCAwICYmIGl2YWx1ZSA8IDApIHx8ICh2YWx1ZSA+PSAwICYmIGl2YWx1ZSA+IDApKSB7DQoJCQkJCQkJc3RhcnQgKz0gaXZhbHVlOw0KCQkJCQkJfQ0KCQkJCQl9DQoJCQkJfQ0KCQkJfQ0KDQoJCQliYXNlID0gc2NhbGUuZ2V0UGl4ZWxGb3JWYWx1ZShzdGFydCk7DQoJCQloZWFkID0gc2NhbGUuZ2V0UGl4ZWxGb3JWYWx1ZShzdGFydCArIHZhbHVlKTsNCgkJCXNpemUgPSAoaGVhZCAtIGJhc2UpIC8gMjsNCg0KCQkJcmV0dXJuIHsNCgkJCQlzaXplOiBzaXplLA0KCQkJCWJhc2U6IGJhc2UsDQoJCQkJaGVhZDogaGVhZCwNCgkJCQljZW50ZXI6IGhlYWQgKyBzaXplIC8gMg0KCQkJfTsNCgkJfSwNCg0KCQkvKioNCgkJICogQHByaXZhdGUNCgkJICovDQoJCWNhbGN1bGF0ZUJhckluZGV4UGl4ZWxzOiBmdW5jdGlvbihkYXRhc2V0SW5kZXgsIGluZGV4LCBydWxlcikgew0KCQkJdmFyIG1lID0gdGhpczsNCgkJCXZhciBvcHRpb25zID0gcnVsZXIuc2NhbGUub3B0aW9uczsNCgkJCXZhciBzdGFja0luZGV4ID0gbWUuZ2V0U3RhY2tJbmRleChkYXRhc2V0SW5kZXgpOw0KCQkJdmFyIHBpeGVscyA9IHJ1bGVyLnBpeGVsczsNCgkJCXZhciBiYXNlID0gcGl4ZWxzW2luZGV4XTsNCgkJCXZhciBsZW5ndGggPSBwaXhlbHMubGVuZ3RoOw0KCQkJdmFyIHN0YXJ0ID0gcnVsZXIuc3RhcnQ7DQoJCQl2YXIgZW5kID0gcnVsZXIuZW5kOw0KCQkJdmFyIGxlZnRTYW1wbGVTaXplLCByaWdodFNhbXBsZVNpemUsIGxlZnRDYXRlZ29yeVNpemUsIHJpZ2h0Q2F0ZWdvcnlTaXplLCBmdWxsQmFyU2l6ZSwgc2l6ZTsNCg0KCQkJaWYgKGxlbmd0aCA9PT0gMSkgew0KCQkJCWxlZnRTYW1wbGVTaXplID0gYmFzZSA+IHN0YXJ0ID8gYmFzZSAtIHN0YXJ0IDogZW5kIC0gYmFzZTsNCgkJCQlyaWdodFNhbXBsZVNpemUgPSBiYXNlIDwgZW5kID8gZW5kIC0gYmFzZSA6IGJhc2UgLSBzdGFydDsNCgkJCX0gZWxzZSB7DQoJCQkJaWYgKGluZGV4ID4gMCkgew0KCQkJCQlsZWZ0U2FtcGxlU2l6ZSA9IChiYXNlIC0gcGl4ZWxzW2luZGV4IC0gMV0pIC8gMjsNCgkJCQkJaWYgKGluZGV4ID09PSBsZW5ndGggLSAxKSB7DQoJCQkJCQlyaWdodFNhbXBsZVNpemUgPSBsZWZ0U2FtcGxlU2l6ZTsNCgkJCQkJfQ0KCQkJCX0NCgkJCQlpZiAoaW5kZXggPCBsZW5ndGggLSAxKSB7DQoJCQkJCXJpZ2h0U2FtcGxlU2l6ZSA9IChwaXhlbHNbaW5kZXggKyAxXSAtIGJhc2UpIC8gMjsNCgkJCQkJaWYgKGluZGV4ID09PSAwKSB7DQoJCQkJCQlsZWZ0U2FtcGxlU2l6ZSA9IHJpZ2h0U2FtcGxlU2l6ZTsNCgkJCQkJfQ0KCQkJCX0NCgkJCX0NCg0KCQkJbGVmdENhdGVnb3J5U2l6ZSA9IGxlZnRTYW1wbGVTaXplICogb3B0aW9ucy5jYXRlZ29yeVBlcmNlbnRhZ2U7DQoJCQlyaWdodENhdGVnb3J5U2l6ZSA9IHJpZ2h0U2FtcGxlU2l6ZSAqIG9wdGlvbnMuY2F0ZWdvcnlQZXJjZW50YWdlOw0KCQkJZnVsbEJhclNpemUgPSAobGVmdENhdGVnb3J5U2l6ZSArIHJpZ2h0Q2F0ZWdvcnlTaXplKSAvIHJ1bGVyLnN0YWNrQ291bnQ7DQoJCQlzaXplID0gZnVsbEJhclNpemUgKiBvcHRpb25zLmJhclBlcmNlbnRhZ2U7DQoNCgkJCXNpemUgPSBNYXRoLm1pbigNCgkJCQloZWxwZXJzLnZhbHVlT3JEZWZhdWx0KG9wdGlvbnMuYmFyVGhpY2tuZXNzLCBzaXplKSwNCgkJCQloZWxwZXJzLnZhbHVlT3JEZWZhdWx0KG9wdGlvbnMubWF4QmFyVGhpY2tuZXNzLCBJbmZpbml0eSkpOw0KDQoJCQliYXNlIC09IGxlZnRDYXRlZ29yeVNpemU7DQoJCQliYXNlICs9IGZ1bGxCYXJTaXplICogc3RhY2tJbmRleDsNCgkJCWJhc2UgKz0gKGZ1bGxCYXJTaXplIC0gc2l6ZSkgLyAyOw0KDQoJCQlyZXR1cm4gew0KCQkJCXNpemU6IHNpemUsDQoJCQkJYmFzZTogYmFzZSwNCgkJCQloZWFkOiBiYXNlICsgc2l6ZSwNCgkJCQljZW50ZXI6IGJhc2UgKyBzaXplIC8gMg0KCQkJfTsNCgkJfSwNCg0KCQlkcmF3OiBmdW5jdGlvbigpIHsNCgkJCXZhciBtZSA9IHRoaXM7DQoJCQl2YXIgY2hhcnQgPSBtZS5jaGFydDsNCgkJCXZhciBzY2FsZSA9IG1lLmdldFZhbHVlU2NhbGUoKTsNCgkJCXZhciByZWN0cyA9IG1lLmdldE1ldGEoKS5kYXRhOw0KCQkJdmFyIGRhdGFzZXQgPSBtZS5nZXREYXRhc2V0KCk7DQoJCQl2YXIgaWxlbiA9IHJlY3RzLmxlbmd0aDsNCgkJCXZhciBpID0gMDsNCg0KCQkJaGVscGVycy5jYW52YXMuY2xpcEFyZWEoY2hhcnQuY3R4LCBjaGFydC5jaGFydEFyZWEpOw0KDQoJCQlmb3IgKDsgaSA8IGlsZW47ICsraSkgew0KCQkJCWlmICghaXNOYU4oc2NhbGUuZ2V0UmlnaHRWYWx1ZShkYXRhc2V0LmRhdGFbaV0pKSkgew0KCQkJCQlyZWN0c1tpXS5kcmF3KCk7DQoJCQkJfQ0KCQkJfQ0KDQoJCQloZWxwZXJzLmNhbnZhcy51bmNsaXBBcmVhKGNoYXJ0LmN0eCk7DQoJCX0sDQoNCgkJc2V0SG92ZXJTdHlsZTogZnVuY3Rpb24ocmVjdGFuZ2xlKSB7DQoJCQl2YXIgZGF0YXNldCA9IHRoaXMuY2hhcnQuZGF0YS5kYXRhc2V0c1tyZWN0YW5nbGUuX2RhdGFzZXRJbmRleF07DQoJCQl2YXIgaW5kZXggPSByZWN0YW5nbGUuX2luZGV4Ow0KCQkJdmFyIGN1c3RvbSA9IHJlY3RhbmdsZS5jdXN0b20gfHwge307DQoJCQl2YXIgbW9kZWwgPSByZWN0YW5nbGUuX21vZGVsOw0KDQoJCQltb2RlbC5iYWNrZ3JvdW5kQ29sb3IgPSBjdXN0b20uaG92ZXJCYWNrZ3JvdW5kQ29sb3IgPyBjdXN0b20uaG92ZXJCYWNrZ3JvdW5kQ29sb3IgOiBoZWxwZXJzLnZhbHVlQXRJbmRleE9yRGVmYXVsdChkYXRhc2V0LmhvdmVyQmFja2dyb3VuZENvbG9yLCBpbmRleCwgaGVscGVycy5nZXRIb3ZlckNvbG9yKG1vZGVsLmJhY2tncm91bmRDb2xvcikpOw0KCQkJbW9kZWwuYm9yZGVyQ29sb3IgPSBjdXN0b20uaG92ZXJCb3JkZXJDb2xvciA/IGN1c3RvbS5ob3ZlckJvcmRlckNvbG9yIDogaGVscGVycy52YWx1ZUF0SW5kZXhPckRlZmF1bHQoZGF0YXNldC5ob3ZlckJvcmRlckNvbG9yLCBpbmRleCwgaGVscGVycy5nZXRIb3ZlckNvbG9yKG1vZGVsLmJvcmRlckNvbG9yKSk7DQoJCQltb2RlbC5ib3JkZXJXaWR0aCA9IGN1c3RvbS5ob3ZlckJvcmRlcldpZHRoID8gY3VzdG9tLmhvdmVyQm9yZGVyV2lkdGggOiBoZWxwZXJzLnZhbHVlQXRJbmRleE9yRGVmYXVsdChkYXRhc2V0LmhvdmVyQm9yZGVyV2lkdGgsIGluZGV4LCBtb2RlbC5ib3JkZXJXaWR0aCk7DQoJCX0sDQoNCgkJcmVtb3ZlSG92ZXJTdHlsZTogZnVuY3Rpb24ocmVjdGFuZ2xlKSB7DQoJCQl2YXIgZGF0YXNldCA9IHRoaXMuY2hhcnQuZGF0YS5kYXRhc2V0c1tyZWN0YW5nbGUuX2RhdGFzZXRJbmRleF07DQoJCQl2YXIgaW5kZXggPSByZWN0YW5nbGUuX2luZGV4Ow0KCQkJdmFyIGN1c3RvbSA9IHJlY3RhbmdsZS5jdXN0b20gfHwge307DQoJCQl2YXIgbW9kZWwgPSByZWN0YW5nbGUuX21vZGVsOw0KCQkJdmFyIHJlY3RhbmdsZUVsZW1lbnRPcHRpb25zID0gdGhpcy5jaGFydC5vcHRpb25zLmVsZW1lbnRzLnJlY3RhbmdsZTsNCg0KCQkJbW9kZWwuYmFja2dyb3VuZENvbG9yID0gY3VzdG9tLmJhY2tncm91bmRDb2xvciA/IGN1c3RvbS5iYWNrZ3JvdW5kQ29sb3IgOiBoZWxwZXJzLnZhbHVlQXRJbmRleE9yRGVmYXVsdChkYXRhc2V0LmJhY2tncm91bmRDb2xvciwgaW5kZXgsIHJlY3RhbmdsZUVsZW1lbnRPcHRpb25zLmJhY2tncm91bmRDb2xvcik7DQoJCQltb2RlbC5ib3JkZXJDb2xvciA9IGN1c3RvbS5ib3JkZXJDb2xvciA/IGN1c3RvbS5ib3JkZXJDb2xvciA6IGhlbHBlcnMudmFsdWVBdEluZGV4T3JEZWZhdWx0KGRhdGFzZXQuYm9yZGVyQ29sb3IsIGluZGV4LCByZWN0YW5nbGVFbGVtZW50T3B0aW9ucy5ib3JkZXJDb2xvcik7DQoJCQltb2RlbC5ib3JkZXJXaWR0aCA9IGN1c3RvbS5ib3JkZXJXaWR0aCA/IGN1c3RvbS5ib3JkZXJXaWR0aCA6IGhlbHBlcnMudmFsdWVBdEluZGV4T3JEZWZhdWx0KGRhdGFzZXQuYm9yZGVyV2lkdGgsIGluZGV4LCByZWN0YW5nbGVFbGVtZW50T3B0aW9ucy5ib3JkZXJXaWR0aCk7DQoJCX0NCgl9KTsNCg0KCUNoYXJ0LmNvbnRyb2xsZXJzLmhvcml6b250YWxCYXIgPSBDaGFydC5jb250cm9sbGVycy5iYXIuZXh0ZW5kKHsNCgkJLyoqDQoJCSAqIEBwcml2YXRlDQoJCSAqLw0KCQlnZXRWYWx1ZVNjYWxlSWQ6IGZ1bmN0aW9uKCkgew0KCQkJcmV0dXJuIHRoaXMuZ2V0TWV0YSgpLnhBeGlzSUQ7DQoJCX0sDQoNCgkJLyoqDQoJCSAqIEBwcml2YXRlDQoJCSAqLw0KCQlnZXRJbmRleFNjYWxlSWQ6IGZ1bmN0aW9uKCkgew0KCQkJcmV0dXJuIHRoaXMuZ2V0TWV0YSgpLnlBeGlzSUQ7DQoJCX0NCgl9KTsNCn07DQoNCn0seyIyNSI6MjUsIjQwIjo0MCwiNDUiOjQ1fV0sMTY6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpew0KJ3VzZSBzdHJpY3QnOw0KDQp2YXIgZGVmYXVsdHMgPSByZXF1aXJlKDI1KTsNCnZhciBlbGVtZW50cyA9IHJlcXVpcmUoNDApOw0KdmFyIGhlbHBlcnMgPSByZXF1aXJlKDQ1KTsNCg0KZGVmYXVsdHMuX3NldCgnYnViYmxlJywgew0KCWhvdmVyOiB7DQoJCW1vZGU6ICdzaW5nbGUnDQoJfSwNCg0KCXNjYWxlczogew0KCQl4QXhlczogW3sNCgkJCXR5cGU6ICdsaW5lYXInLCAvLyBidWJibGUgc2hvdWxkIHByb2JhYmx5IHVzZSBhIGxpbmVhciBzY2FsZSBieSBkZWZhdWx0DQoJCQlwb3NpdGlvbjogJ2JvdHRvbScsDQoJCQlpZDogJ3gtYXhpcy0wJyAvLyBuZWVkIGFuIElEIHNvIGRhdGFzZXRzIGNhbiByZWZlcmVuY2UgdGhlIHNjYWxlDQoJCX1dLA0KCQl5QXhlczogW3sNCgkJCXR5cGU6ICdsaW5lYXInLA0KCQkJcG9zaXRpb246ICdsZWZ0JywNCgkJCWlkOiAneS1heGlzLTAnDQoJCX1dDQoJfSwNCg0KCXRvb2x0aXBzOiB7DQoJCWNhbGxiYWNrczogew0KCQkJdGl0bGU6IGZ1bmN0aW9uKCkgew0KCQkJCS8vIFRpdGxlIGRvZXNuJ3QgbWFrZSBzZW5zZSBmb3Igc2NhdHRlciBzaW5jZSB3ZSBmb3JtYXQgdGhlIGRhdGEgYXMgYSBwb2ludA0KCQkJCXJldHVybiAnJzsNCgkJCX0sDQoJCQlsYWJlbDogZnVuY3Rpb24oaXRlbSwgZGF0YSkgew0KCQkJCXZhciBkYXRhc2V0TGFiZWwgPSBkYXRhLmRhdGFzZXRzW2l0ZW0uZGF0YXNldEluZGV4XS5sYWJlbCB8fCAnJzsNCgkJCQl2YXIgZGF0YVBvaW50ID0gZGF0YS5kYXRhc2V0c1tpdGVtLmRhdGFzZXRJbmRleF0uZGF0YVtpdGVtLmluZGV4XTsNCgkJCQlyZXR1cm4gZGF0YXNldExhYmVsICsgJzogKCcgKyBpdGVtLnhMYWJlbCArICcsICcgKyBpdGVtLnlMYWJlbCArICcsICcgKyBkYXRhUG9pbnQuciArICcpJzsNCgkJCX0NCgkJfQ0KCX0NCn0pOw0KDQoNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oQ2hhcnQpIHsNCg0KCUNoYXJ0LmNvbnRyb2xsZXJzLmJ1YmJsZSA9IENoYXJ0LkRhdGFzZXRDb250cm9sbGVyLmV4dGVuZCh7DQoJCS8qKg0KCQkgKiBAcHJvdGVjdGVkDQoJCSAqLw0KCQlkYXRhRWxlbWVudFR5cGU6IGVsZW1lbnRzLlBvaW50LA0KDQoJCS8qKg0KCQkgKiBAcHJvdGVjdGVkDQoJCSAqLw0KCQl1cGRhdGU6IGZ1bmN0aW9uKHJlc2V0KSB7DQoJCQl2YXIgbWUgPSB0aGlzOw0KCQkJdmFyIG1ldGEgPSBtZS5nZXRNZXRhKCk7DQoJCQl2YXIgcG9pbnRzID0gbWV0YS5kYXRhOw0KDQoJCQkvLyBVcGRhdGUgUG9pbnRzDQoJCQloZWxwZXJzLmVhY2gocG9pbnRzLCBmdW5jdGlvbihwb2ludCwgaW5kZXgpIHsNCgkJCQltZS51cGRhdGVFbGVtZW50KHBvaW50LCBpbmRleCwgcmVzZXQpOw0KCQkJfSk7DQoJCX0sDQoNCgkJLyoqDQoJCSAqIEBwcm90ZWN0ZWQNCgkJICovDQoJCXVwZGF0ZUVsZW1lbnQ6IGZ1bmN0aW9uKHBvaW50LCBpbmRleCwgcmVzZXQpIHsNCgkJCXZhciBtZSA9IHRoaXM7DQoJCQl2YXIgbWV0YSA9IG1lLmdldE1ldGEoKTsNCgkJCXZhciBjdXN0b20gPSBwb2ludC5jdXN0b20gfHwge307DQoJCQl2YXIgeFNjYWxlID0gbWUuZ2V0U2NhbGVGb3JJZChtZXRhLnhBeGlzSUQpOw0KCQkJdmFyIHlTY2FsZSA9IG1lLmdldFNjYWxlRm9ySWQobWV0YS55QXhpc0lEKTsNCgkJCXZhciBvcHRpb25zID0gbWUuX3Jlc29sdmVFbGVtZW50T3B0aW9ucyhwb2ludCwgaW5kZXgpOw0KCQkJdmFyIGRhdGEgPSBtZS5nZXREYXRhc2V0KCkuZGF0YVtpbmRleF07DQoJCQl2YXIgZHNJbmRleCA9IG1lLmluZGV4Ow0KDQoJCQl2YXIgeCA9IHJlc2V0ID8geFNjYWxlLmdldFBpeGVsRm9yRGVjaW1hbCgwLjUpIDogeFNjYWxlLmdldFBpeGVsRm9yVmFsdWUodHlwZW9mIGRhdGEgPT09ICdvYmplY3QnID8gZGF0YSA6IE5hTiwgaW5kZXgsIGRzSW5kZXgpOw0KCQkJdmFyIHkgPSByZXNldCA/IHlTY2FsZS5nZXRCYXNlUGl4ZWwoKSA6IHlTY2FsZS5nZXRQaXhlbEZvclZhbHVlKGRhdGEsIGluZGV4LCBkc0luZGV4KTsNCg0KCQkJcG9pbnQuX3hTY2FsZSA9IHhTY2FsZTsNCgkJCXBvaW50Ll95U2NhbGUgPSB5U2NhbGU7DQoJCQlwb2ludC5fb3B0aW9ucyA9IG9wdGlvbnM7DQoJCQlwb2ludC5fZGF0YXNldEluZGV4ID0gZHNJbmRleDsNCgkJCXBvaW50Ll9pbmRleCA9IGluZGV4Ow0KCQkJcG9pbnQuX21vZGVsID0gew0KCQkJCWJhY2tncm91bmRDb2xvcjogb3B0aW9ucy5iYWNrZ3JvdW5kQ29sb3IsDQoJCQkJYm9yZGVyQ29sb3I6IG9wdGlvbnMuYm9yZGVyQ29sb3IsDQoJCQkJYm9yZGVyV2lkdGg6IG9wdGlvbnMuYm9yZGVyV2lkdGgsDQoJCQkJaGl0UmFkaXVzOiBvcHRpb25zLmhpdFJhZGl1cywNCgkJCQlwb2ludFN0eWxlOiBvcHRpb25zLnBvaW50U3R5bGUsDQoJCQkJcmFkaXVzOiByZXNldCA/IDAgOiBvcHRpb25zLnJhZGl1cywNCgkJCQlza2lwOiBjdXN0b20uc2tpcCB8fCBpc05hTih4KSB8fCBpc05hTih5KSwNCgkJCQl4OiB4LA0KCQkJCXk6IHksDQoJCQl9Ow0KDQoJCQlwb2ludC5waXZvdCgpOw0KCQl9LA0KDQoJCS8qKg0KCQkgKiBAcHJvdGVjdGVkDQoJCSAqLw0KCQlzZXRIb3ZlclN0eWxlOiBmdW5jdGlvbihwb2ludCkgew0KCQkJdmFyIG1vZGVsID0gcG9pbnQuX21vZGVsOw0KCQkJdmFyIG9wdGlvbnMgPSBwb2ludC5fb3B0aW9uczsNCg0KCQkJbW9kZWwuYmFja2dyb3VuZENvbG9yID0gaGVscGVycy52YWx1ZU9yRGVmYXVsdChvcHRpb25zLmhvdmVyQmFja2dyb3VuZENvbG9yLCBoZWxwZXJzLmdldEhvdmVyQ29sb3Iob3B0aW9ucy5iYWNrZ3JvdW5kQ29sb3IpKTsNCgkJCW1vZGVsLmJvcmRlckNvbG9yID0gaGVscGVycy52YWx1ZU9yRGVmYXVsdChvcHRpb25zLmhvdmVyQm9yZGVyQ29sb3IsIGhlbHBlcnMuZ2V0SG92ZXJDb2xvcihvcHRpb25zLmJvcmRlckNvbG9yKSk7DQoJCQltb2RlbC5ib3JkZXJXaWR0aCA9IGhlbHBlcnMudmFsdWVPckRlZmF1bHQob3B0aW9ucy5ob3ZlckJvcmRlcldpZHRoLCBvcHRpb25zLmJvcmRlcldpZHRoKTsNCgkJCW1vZGVsLnJhZGl1cyA9IG9wdGlvbnMucmFkaXVzICsgb3B0aW9ucy5ob3ZlclJhZGl1czsNCgkJfSwNCg0KCQkvKioNCgkJICogQHByb3RlY3RlZA0KCQkgKi8NCgkJcmVtb3ZlSG92ZXJTdHlsZTogZnVuY3Rpb24ocG9pbnQpIHsNCgkJCXZhciBtb2RlbCA9IHBvaW50Ll9tb2RlbDsNCgkJCXZhciBvcHRpb25zID0gcG9pbnQuX29wdGlvbnM7DQoNCgkJCW1vZGVsLmJhY2tncm91bmRDb2xvciA9IG9wdGlvbnMuYmFja2dyb3VuZENvbG9yOw0KCQkJbW9kZWwuYm9yZGVyQ29sb3IgPSBvcHRpb25zLmJvcmRlckNvbG9yOw0KCQkJbW9kZWwuYm9yZGVyV2lkdGggPSBvcHRpb25zLmJvcmRlcldpZHRoOw0KCQkJbW9kZWwucmFkaXVzID0gb3B0aW9ucy5yYWRpdXM7DQoJCX0sDQoNCgkJLyoqDQoJCSAqIEBwcml2YXRlDQoJCSAqLw0KCQlfcmVzb2x2ZUVsZW1lbnRPcHRpb25zOiBmdW5jdGlvbihwb2ludCwgaW5kZXgpIHsNCgkJCXZhciBtZSA9IHRoaXM7DQoJCQl2YXIgY2hhcnQgPSBtZS5jaGFydDsNCgkJCXZhciBkYXRhc2V0cyA9IGNoYXJ0LmRhdGEuZGF0YXNldHM7DQoJCQl2YXIgZGF0YXNldCA9IGRhdGFzZXRzW21lLmluZGV4XTsNCgkJCXZhciBjdXN0b20gPSBwb2ludC5jdXN0b20gfHwge307DQoJCQl2YXIgb3B0aW9ucyA9IGNoYXJ0Lm9wdGlvbnMuZWxlbWVudHMucG9pbnQ7DQoJCQl2YXIgcmVzb2x2ZSA9IGhlbHBlcnMub3B0aW9ucy5yZXNvbHZlOw0KCQkJdmFyIGRhdGEgPSBkYXRhc2V0LmRhdGFbaW5kZXhdOw0KCQkJdmFyIHZhbHVlcyA9IHt9Ow0KCQkJdmFyIGksIGlsZW4sIGtleTsNCg0KCQkJLy8gU2NyaXB0YWJsZSBvcHRpb25zDQoJCQl2YXIgY29udGV4dCA9IHsNCgkJCQljaGFydDogY2hhcnQsDQoJCQkJZGF0YUluZGV4OiBpbmRleCwNCgkJCQlkYXRhc2V0OiBkYXRhc2V0LA0KCQkJCWRhdGFzZXRJbmRleDogbWUuaW5kZXgNCgkJCX07DQoNCgkJCXZhciBrZXlzID0gWw0KCQkJCSdiYWNrZ3JvdW5kQ29sb3InLA0KCQkJCSdib3JkZXJDb2xvcicsDQoJCQkJJ2JvcmRlcldpZHRoJywNCgkJCQknaG92ZXJCYWNrZ3JvdW5kQ29sb3InLA0KCQkJCSdob3ZlckJvcmRlckNvbG9yJywNCgkJCQknaG92ZXJCb3JkZXJXaWR0aCcsDQoJCQkJJ2hvdmVyUmFkaXVzJywNCgkJCQknaGl0UmFkaXVzJywNCgkJCQkncG9pbnRTdHlsZScNCgkJCV07DQoNCgkJCWZvciAoaSA9IDAsIGlsZW4gPSBrZXlzLmxlbmd0aDsgaSA8IGlsZW47ICsraSkgew0KCQkJCWtleSA9IGtleXNbaV07DQoJCQkJdmFsdWVzW2tleV0gPSByZXNvbHZlKFsNCgkJCQkJY3VzdG9tW2tleV0sDQoJCQkJCWRhdGFzZXRba2V5XSwNCgkJCQkJb3B0aW9uc1trZXldDQoJCQkJXSwgY29udGV4dCwgaW5kZXgpOw0KCQkJfQ0KDQoJCQkvLyBDdXN0b20gcmFkaXVzIHJlc29sdXRpb24NCgkJCXZhbHVlcy5yYWRpdXMgPSByZXNvbHZlKFsNCgkJCQljdXN0b20ucmFkaXVzLA0KCQkJCWRhdGEgPyBkYXRhLnIgOiB1bmRlZmluZWQsDQoJCQkJZGF0YXNldC5yYWRpdXMsDQoJCQkJb3B0aW9ucy5yYWRpdXMNCgkJCV0sIGNvbnRleHQsIGluZGV4KTsNCg0KCQkJcmV0dXJuIHZhbHVlczsNCgkJfQ0KCX0pOw0KfTsNCg0KfSx7IjI1IjoyNSwiNDAiOjQwLCI0NSI6NDV9XSwxNzpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7DQondXNlIHN0cmljdCc7DQoNCnZhciBkZWZhdWx0cyA9IHJlcXVpcmUoMjUpOw0KdmFyIGVsZW1lbnRzID0gcmVxdWlyZSg0MCk7DQp2YXIgaGVscGVycyA9IHJlcXVpcmUoNDUpOw0KDQpkZWZhdWx0cy5fc2V0KCdkb3VnaG51dCcsIHsNCglhbmltYXRpb246IHsNCgkJLy8gQm9vbGVhbiAtIFdoZXRoZXIgd2UgYW5pbWF0ZSB0aGUgcm90YXRpb24gb2YgdGhlIERvdWdobnV0DQoJCWFuaW1hdGVSb3RhdGU6IHRydWUsDQoJCS8vIEJvb2xlYW4gLSBXaGV0aGVyIHdlIGFuaW1hdGUgc2NhbGluZyB0aGUgRG91Z2hudXQgZnJvbSB0aGUgY2VudHJlDQoJCWFuaW1hdGVTY2FsZTogZmFsc2UNCgl9LA0KCWhvdmVyOiB7DQoJCW1vZGU6ICdzaW5nbGUnDQoJfSwNCglsZWdlbmRDYWxsYmFjazogZnVuY3Rpb24oY2hhcnQpIHsNCgkJdmFyIHRleHQgPSBbXTsNCgkJdGV4dC5wdXNoKCc8dWwgY2xhc3M9IicgKyBjaGFydC5pZCArICctbGVnZW5kIj4nKTsNCg0KCQl2YXIgZGF0YSA9IGNoYXJ0LmRhdGE7DQoJCXZhciBkYXRhc2V0cyA9IGRhdGEuZGF0YXNldHM7DQoJCXZhciBsYWJlbHMgPSBkYXRhLmxhYmVsczsNCg0KCQlpZiAoZGF0YXNldHMubGVuZ3RoKSB7DQoJCQlmb3IgKHZhciBpID0gMDsgaSA8IGRhdGFzZXRzWzBdLmRhdGEubGVuZ3RoOyArK2kpIHsNCgkJCQl0ZXh0LnB1c2goJzxsaT48c3BhbiBzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjonICsgZGF0YXNldHNbMF0uYmFja2dyb3VuZENvbG9yW2ldICsgJyI+PC9zcGFuPicpOw0KCQkJCWlmIChsYWJlbHNbaV0pIHsNCgkJCQkJdGV4dC5wdXNoKGxhYmVsc1tpXSk7DQoJCQkJfQ0KCQkJCXRleHQucHVzaCgnPC9saT4nKTsNCgkJCX0NCgkJfQ0KDQoJCXRleHQucHVzaCgnPC91bD4nKTsNCgkJcmV0dXJuIHRleHQuam9pbignJyk7DQoJfSwNCglsZWdlbmQ6IHsNCgkJbGFiZWxzOiB7DQoJCQlnZW5lcmF0ZUxhYmVsczogZnVuY3Rpb24oY2hhcnQpIHsNCgkJCQl2YXIgZGF0YSA9IGNoYXJ0LmRhdGE7DQoJCQkJaWYgKGRhdGEubGFiZWxzLmxlbmd0aCAmJiBkYXRhLmRhdGFzZXRzLmxlbmd0aCkgew0KCQkJCQlyZXR1cm4gZGF0YS5sYWJlbHMubWFwKGZ1bmN0aW9uKGxhYmVsLCBpKSB7DQoJCQkJCQl2YXIgbWV0YSA9IGNoYXJ0LmdldERhdGFzZXRNZXRhKDApOw0KCQkJCQkJdmFyIGRzID0gZGF0YS5kYXRhc2V0c1swXTsNCgkJCQkJCXZhciBhcmMgPSBtZXRhLmRhdGFbaV07DQoJCQkJCQl2YXIgY3VzdG9tID0gYXJjICYmIGFyYy5jdXN0b20gfHwge307DQoJCQkJCQl2YXIgdmFsdWVBdEluZGV4T3JEZWZhdWx0ID0gaGVscGVycy52YWx1ZUF0SW5kZXhPckRlZmF1bHQ7DQoJCQkJCQl2YXIgYXJjT3B0cyA9IGNoYXJ0Lm9wdGlvbnMuZWxlbWVudHMuYXJjOw0KCQkJCQkJdmFyIGZpbGwgPSBjdXN0b20uYmFja2dyb3VuZENvbG9yID8gY3VzdG9tLmJhY2tncm91bmRDb2xvciA6IHZhbHVlQXRJbmRleE9yRGVmYXVsdChkcy5iYWNrZ3JvdW5kQ29sb3IsIGksIGFyY09wdHMuYmFja2dyb3VuZENvbG9yKTsNCgkJCQkJCXZhciBzdHJva2UgPSBjdXN0b20uYm9yZGVyQ29sb3IgPyBjdXN0b20uYm9yZGVyQ29sb3IgOiB2YWx1ZUF0SW5kZXhPckRlZmF1bHQoZHMuYm9yZGVyQ29sb3IsIGksIGFyY09wdHMuYm9yZGVyQ29sb3IpOw0KCQkJCQkJdmFyIGJ3ID0gY3VzdG9tLmJvcmRlcldpZHRoID8gY3VzdG9tLmJvcmRlcldpZHRoIDogdmFsdWVBdEluZGV4T3JEZWZhdWx0KGRzLmJvcmRlcldpZHRoLCBpLCBhcmNPcHRzLmJvcmRlcldpZHRoKTsNCg0KCQkJCQkJcmV0dXJuIHsNCgkJCQkJCQl0ZXh0OiBsYWJlbCwNCgkJCQkJCQlmaWxsU3R5bGU6IGZpbGwsDQoJCQkJCQkJc3Ryb2tlU3R5bGU6IHN0cm9rZSwNCgkJCQkJCQlsaW5lV2lkdGg6IGJ3LA0KCQkJCQkJCWhpZGRlbjogaXNOYU4oZHMuZGF0YVtpXSkgfHwgbWV0YS5kYXRhW2ldLmhpZGRlbiwNCg0KCQkJCQkJCS8vIEV4dHJhIGRhdGEgdXNlZCBmb3IgdG9nZ2xpbmcgdGhlIGNvcnJlY3QgaXRlbQ0KCQkJCQkJCWluZGV4OiBpDQoJCQkJCQl9Ow0KCQkJCQl9KTsNCgkJCQl9DQoJCQkJcmV0dXJuIFtdOw0KCQkJfQ0KCQl9LA0KDQoJCW9uQ2xpY2s6IGZ1bmN0aW9uKGUsIGxlZ2VuZEl0ZW0pIHsNCgkJCXZhciBpbmRleCA9IGxlZ2VuZEl0ZW0uaW5kZXg7DQoJCQl2YXIgY2hhcnQgPSB0aGlzLmNoYXJ0Ow0KCQkJdmFyIGksIGlsZW4sIG1ldGE7DQoNCgkJCWZvciAoaSA9IDAsIGlsZW4gPSAoY2hhcnQuZGF0YS5kYXRhc2V0cyB8fCBbXSkubGVuZ3RoOyBpIDwgaWxlbjsgKytpKSB7DQoJCQkJbWV0YSA9IGNoYXJ0LmdldERhdGFzZXRNZXRhKGkpOw0KCQkJCS8vIHRvZ2dsZSB2aXNpYmlsaXR5IG9mIGluZGV4IGlmIGV4aXN0cw0KCQkJCWlmIChtZXRhLmRhdGFbaW5kZXhdKSB7DQoJCQkJCW1ldGEuZGF0YVtpbmRleF0uaGlkZGVuID0gIW1ldGEuZGF0YVtpbmRleF0uaGlkZGVuOw0KCQkJCX0NCgkJCX0NCg0KCQkJY2hhcnQudXBkYXRlKCk7DQoJCX0NCgl9LA0KDQoJLy8gVGhlIHBlcmNlbnRhZ2Ugb2YgdGhlIGNoYXJ0IHRoYXQgd2UgY3V0IG91dCBvZiB0aGUgbWlkZGxlLg0KCWN1dG91dFBlcmNlbnRhZ2U6IDUwLA0KDQoJLy8gVGhlIHJvdGF0aW9uIG9mIHRoZSBjaGFydCwgd2hlcmUgdGhlIGZpcnN0IGRhdGEgYXJjIGJlZ2lucy4NCglyb3RhdGlvbjogTWF0aC5QSSAqIC0wLjUsDQoNCgkvLyBUaGUgdG90YWwgY2lyY3VtZmVyZW5jZSBvZiB0aGUgY2hhcnQuDQoJY2lyY3VtZmVyZW5jZTogTWF0aC5QSSAqIDIuMCwNCg0KCS8vIE5lZWQgdG8gb3ZlcnJpZGUgdGhlc2UgdG8gZ2l2ZSBhIG5pY2UgZGVmYXVsdA0KCXRvb2x0aXBzOiB7DQoJCWNhbGxiYWNrczogew0KCQkJdGl0bGU6IGZ1bmN0aW9uKCkgew0KCQkJCXJldHVybiAnJzsNCgkJCX0sDQoJCQlsYWJlbDogZnVuY3Rpb24odG9vbHRpcEl0ZW0sIGRhdGEpIHsNCgkJCQl2YXIgZGF0YUxhYmVsID0gZGF0YS5sYWJlbHNbdG9vbHRpcEl0ZW0uaW5kZXhdOw0KCQkJCXZhciB2YWx1ZSA9ICc6ICcgKyBkYXRhLmRhdGFzZXRzW3Rvb2x0aXBJdGVtLmRhdGFzZXRJbmRleF0uZGF0YVt0b29sdGlwSXRlbS5pbmRleF07DQoNCgkJCQlpZiAoaGVscGVycy5pc0FycmF5KGRhdGFMYWJlbCkpIHsNCgkJCQkJLy8gc2hvdyB2YWx1ZSBvbiBmaXJzdCBsaW5lIG9mIG11bHRpbGluZSBsYWJlbA0KCQkJCQkvLyBuZWVkIHRvIGNsb25lIGJlY2F1c2Ugd2UgYXJlIGNoYW5naW5nIHRoZSB2YWx1ZQ0KCQkJCQlkYXRhTGFiZWwgPSBkYXRhTGFiZWwuc2xpY2UoKTsNCgkJCQkJZGF0YUxhYmVsWzBdICs9IHZhbHVlOw0KCQkJCX0gZWxzZSB7DQoJCQkJCWRhdGFMYWJlbCArPSB2YWx1ZTsNCgkJCQl9DQoNCgkJCQlyZXR1cm4gZGF0YUxhYmVsOw0KCQkJfQ0KCQl9DQoJfQ0KfSk7DQoNCmRlZmF1bHRzLl9zZXQoJ3BpZScsIGhlbHBlcnMuY2xvbmUoZGVmYXVsdHMuZG91Z2hudXQpKTsNCmRlZmF1bHRzLl9zZXQoJ3BpZScsIHsNCgljdXRvdXRQZXJjZW50YWdlOiAwDQp9KTsNCg0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihDaGFydCkgew0KDQoJQ2hhcnQuY29udHJvbGxlcnMuZG91Z2hudXQgPSBDaGFydC5jb250cm9sbGVycy5waWUgPSBDaGFydC5EYXRhc2V0Q29udHJvbGxlci5leHRlbmQoew0KDQoJCWRhdGFFbGVtZW50VHlwZTogZWxlbWVudHMuQXJjLA0KDQoJCWxpbmtTY2FsZXM6IGhlbHBlcnMubm9vcCwNCg0KCQkvLyBHZXQgaW5kZXggb2YgdGhlIGRhdGFzZXQgaW4gcmVsYXRpb24gdG8gdGhlIHZpc2libGUgZGF0YXNldHMuIFRoaXMgYWxsb3dzIGRldGVybWluaW5nIHRoZSBpbm5lciBhbmQgb3V0ZXIgcmFkaXVzIGNvcnJlY3RseQ0KCQlnZXRSaW5nSW5kZXg6IGZ1bmN0aW9uKGRhdGFzZXRJbmRleCkgew0KCQkJdmFyIHJpbmdJbmRleCA9IDA7DQoNCgkJCWZvciAodmFyIGogPSAwOyBqIDwgZGF0YXNldEluZGV4OyArK2opIHsNCgkJCQlpZiAodGhpcy5jaGFydC5pc0RhdGFzZXRWaXNpYmxlKGopKSB7DQoJCQkJCSsrcmluZ0luZGV4Ow0KCQkJCX0NCgkJCX0NCg0KCQkJcmV0dXJuIHJpbmdJbmRleDsNCgkJfSwNCg0KCQl1cGRhdGU6IGZ1bmN0aW9uKHJlc2V0KSB7DQoJCQl2YXIgbWUgPSB0aGlzOw0KCQkJdmFyIGNoYXJ0ID0gbWUuY2hhcnQ7DQoJCQl2YXIgY2hhcnRBcmVhID0gY2hhcnQuY2hhcnRBcmVhOw0KCQkJdmFyIG9wdHMgPSBjaGFydC5vcHRpb25zOw0KCQkJdmFyIGFyY09wdHMgPSBvcHRzLmVsZW1lbnRzLmFyYzsNCgkJCXZhciBhdmFpbGFibGVXaWR0aCA9IGNoYXJ0QXJlYS5yaWdodCAtIGNoYXJ0QXJlYS5sZWZ0IC0gYXJjT3B0cy5ib3JkZXJXaWR0aDsNCgkJCXZhciBhdmFpbGFibGVIZWlnaHQgPSBjaGFydEFyZWEuYm90dG9tIC0gY2hhcnRBcmVhLnRvcCAtIGFyY09wdHMuYm9yZGVyV2lkdGg7DQoJCQl2YXIgbWluU2l6ZSA9IE1hdGgubWluKGF2YWlsYWJsZVdpZHRoLCBhdmFpbGFibGVIZWlnaHQpOw0KCQkJdmFyIG9mZnNldCA9IHt4OiAwLCB5OiAwfTsNCgkJCXZhciBtZXRhID0gbWUuZ2V0TWV0YSgpOw0KCQkJdmFyIGN1dG91dFBlcmNlbnRhZ2UgPSBvcHRzLmN1dG91dFBlcmNlbnRhZ2U7DQoJCQl2YXIgY2lyY3VtZmVyZW5jZSA9IG9wdHMuY2lyY3VtZmVyZW5jZTsNCg0KCQkJLy8gSWYgdGhlIGNoYXJ0J3MgY2lyY3VtZmVyZW5jZSBpc24ndCBhIGZ1bGwgY2lyY2xlLCBjYWxjdWxhdGUgbWluU2l6ZSBhcyBhIHJhdGlvIG9mIHRoZSB3aWR0aC9oZWlnaHQgb2YgdGhlIGFyYw0KCQkJaWYgKGNpcmN1bWZlcmVuY2UgPCBNYXRoLlBJICogMi4wKSB7DQoJCQkJdmFyIHN0YXJ0QW5nbGUgPSBvcHRzLnJvdGF0aW9uICUgKE1hdGguUEkgKiAyLjApOw0KCQkJCXN0YXJ0QW5nbGUgKz0gTWF0aC5QSSAqIDIuMCAqIChzdGFydEFuZ2xlID49IE1hdGguUEkgPyAtMSA6IHN0YXJ0QW5nbGUgPCAtTWF0aC5QSSA/IDEgOiAwKTsNCgkJCQl2YXIgZW5kQW5nbGUgPSBzdGFydEFuZ2xlICsgY2lyY3VtZmVyZW5jZTsNCgkJCQl2YXIgc3RhcnQgPSB7eDogTWF0aC5jb3Moc3RhcnRBbmdsZSksIHk6IE1hdGguc2luKHN0YXJ0QW5nbGUpfTsNCgkJCQl2YXIgZW5kID0ge3g6IE1hdGguY29zKGVuZEFuZ2xlKSwgeTogTWF0aC5zaW4oZW5kQW5nbGUpfTsNCgkJCQl2YXIgY29udGFpbnMwID0gKHN0YXJ0QW5nbGUgPD0gMCAmJiBlbmRBbmdsZSA+PSAwKSB8fCAoc3RhcnRBbmdsZSA8PSBNYXRoLlBJICogMi4wICYmIE1hdGguUEkgKiAyLjAgPD0gZW5kQW5nbGUpOw0KCQkJCXZhciBjb250YWluczkwID0gKHN0YXJ0QW5nbGUgPD0gTWF0aC5QSSAqIDAuNSAmJiBNYXRoLlBJICogMC41IDw9IGVuZEFuZ2xlKSB8fCAoc3RhcnRBbmdsZSA8PSBNYXRoLlBJICogMi41ICYmIE1hdGguUEkgKiAyLjUgPD0gZW5kQW5nbGUpOw0KCQkJCXZhciBjb250YWluczE4MCA9IChzdGFydEFuZ2xlIDw9IC1NYXRoLlBJICYmIC1NYXRoLlBJIDw9IGVuZEFuZ2xlKSB8fCAoc3RhcnRBbmdsZSA8PSBNYXRoLlBJICYmIE1hdGguUEkgPD0gZW5kQW5nbGUpOw0KCQkJCXZhciBjb250YWluczI3MCA9IChzdGFydEFuZ2xlIDw9IC1NYXRoLlBJICogMC41ICYmIC1NYXRoLlBJICogMC41IDw9IGVuZEFuZ2xlKSB8fCAoc3RhcnRBbmdsZSA8PSBNYXRoLlBJICogMS41ICYmIE1hdGguUEkgKiAxLjUgPD0gZW5kQW5nbGUpOw0KCQkJCXZhciBjdXRvdXQgPSBjdXRvdXRQZXJjZW50YWdlIC8gMTAwLjA7DQoJCQkJdmFyIG1pbiA9IHt4OiBjb250YWluczE4MCA/IC0xIDogTWF0aC5taW4oc3RhcnQueCAqIChzdGFydC54IDwgMCA/IDEgOiBjdXRvdXQpLCBlbmQueCAqIChlbmQueCA8IDAgPyAxIDogY3V0b3V0KSksIHk6IGNvbnRhaW5zMjcwID8gLTEgOiBNYXRoLm1pbihzdGFydC55ICogKHN0YXJ0LnkgPCAwID8gMSA6IGN1dG91dCksIGVuZC55ICogKGVuZC55IDwgMCA/IDEgOiBjdXRvdXQpKX07DQoJCQkJdmFyIG1heCA9IHt4OiBjb250YWluczAgPyAxIDogTWF0aC5tYXgoc3RhcnQueCAqIChzdGFydC54ID4gMCA/IDEgOiBjdXRvdXQpLCBlbmQueCAqIChlbmQueCA+IDAgPyAxIDogY3V0b3V0KSksIHk6IGNvbnRhaW5zOTAgPyAxIDogTWF0aC5tYXgoc3RhcnQueSAqIChzdGFydC55ID4gMCA/IDEgOiBjdXRvdXQpLCBlbmQueSAqIChlbmQueSA+IDAgPyAxIDogY3V0b3V0KSl9Ow0KCQkJCXZhciBzaXplID0ge3dpZHRoOiAobWF4LnggLSBtaW4ueCkgKiAwLjUsIGhlaWdodDogKG1heC55IC0gbWluLnkpICogMC41fTsNCgkJCQltaW5TaXplID0gTWF0aC5taW4oYXZhaWxhYmxlV2lkdGggLyBzaXplLndpZHRoLCBhdmFpbGFibGVIZWlnaHQgLyBzaXplLmhlaWdodCk7DQoJCQkJb2Zmc2V0ID0ge3g6IChtYXgueCArIG1pbi54KSAqIC0wLjUsIHk6IChtYXgueSArIG1pbi55KSAqIC0wLjV9Ow0KCQkJfQ0KDQoJCQljaGFydC5ib3JkZXJXaWR0aCA9IG1lLmdldE1heEJvcmRlcldpZHRoKG1ldGEuZGF0YSk7DQoJCQljaGFydC5vdXRlclJhZGl1cyA9IE1hdGgubWF4KChtaW5TaXplIC0gY2hhcnQuYm9yZGVyV2lkdGgpIC8gMiwgMCk7DQoJCQljaGFydC5pbm5lclJhZGl1cyA9IE1hdGgubWF4KGN1dG91dFBlcmNlbnRhZ2UgPyAoY2hhcnQub3V0ZXJSYWRpdXMgLyAxMDApICogKGN1dG91dFBlcmNlbnRhZ2UpIDogMCwgMCk7DQoJCQljaGFydC5yYWRpdXNMZW5ndGggPSAoY2hhcnQub3V0ZXJSYWRpdXMgLSBjaGFydC5pbm5lclJhZGl1cykgLyBjaGFydC5nZXRWaXNpYmxlRGF0YXNldENvdW50KCk7DQoJCQljaGFydC5vZmZzZXRYID0gb2Zmc2V0LnggKiBjaGFydC5vdXRlclJhZGl1czsNCgkJCWNoYXJ0Lm9mZnNldFkgPSBvZmZzZXQueSAqIGNoYXJ0Lm91dGVyUmFkaXVzOw0KDQoJCQltZXRhLnRvdGFsID0gbWUuY2FsY3VsYXRlVG90YWwoKTsNCg0KCQkJbWUub3V0ZXJSYWRpdXMgPSBjaGFydC5vdXRlclJhZGl1cyAtIChjaGFydC5yYWRpdXNMZW5ndGggKiBtZS5nZXRSaW5nSW5kZXgobWUuaW5kZXgpKTsNCgkJCW1lLmlubmVyUmFkaXVzID0gTWF0aC5tYXgobWUub3V0ZXJSYWRpdXMgLSBjaGFydC5yYWRpdXNMZW5ndGgsIDApOw0KDQoJCQloZWxwZXJzLmVhY2gobWV0YS5kYXRhLCBmdW5jdGlvbihhcmMsIGluZGV4KSB7DQoJCQkJbWUudXBkYXRlRWxlbWVudChhcmMsIGluZGV4LCByZXNldCk7DQoJCQl9KTsNCgkJfSwNCg0KCQl1cGRhdGVFbGVtZW50OiBmdW5jdGlvbihhcmMsIGluZGV4LCByZXNldCkgew0KCQkJdmFyIG1lID0gdGhpczsNCgkJCXZhciBjaGFydCA9IG1lLmNoYXJ0Ow0KCQkJdmFyIGNoYXJ0QXJlYSA9IGNoYXJ0LmNoYXJ0QXJlYTsNCgkJCXZhciBvcHRzID0gY2hhcnQub3B0aW9uczsNCgkJCXZhciBhbmltYXRpb25PcHRzID0gb3B0cy5hbmltYXRpb247DQoJCQl2YXIgY2VudGVyWCA9IChjaGFydEFyZWEubGVmdCArIGNoYXJ0QXJlYS5yaWdodCkgLyAyOw0KCQkJdmFyIGNlbnRlclkgPSAoY2hhcnRBcmVhLnRvcCArIGNoYXJ0QXJlYS5ib3R0b20pIC8gMjsNCgkJCXZhciBzdGFydEFuZ2xlID0gb3B0cy5yb3RhdGlvbjsgLy8gbm9uIHJlc2V0IGNhc2UgaGFuZGxlZCBsYXRlcg0KCQkJdmFyIGVuZEFuZ2xlID0gb3B0cy5yb3RhdGlvbjsgLy8gbm9uIHJlc2V0IGNhc2UgaGFuZGxlZCBsYXRlcg0KCQkJdmFyIGRhdGFzZXQgPSBtZS5nZXREYXRhc2V0KCk7DQoJCQl2YXIgY2lyY3VtZmVyZW5jZSA9IHJlc2V0ICYmIGFuaW1hdGlvbk9wdHMuYW5pbWF0ZVJvdGF0ZSA/IDAgOiBhcmMuaGlkZGVuID8gMCA6IG1lLmNhbGN1bGF0ZUNpcmN1bWZlcmVuY2UoZGF0YXNldC5kYXRhW2luZGV4XSkgKiAob3B0cy5jaXJjdW1mZXJlbmNlIC8gKDIuMCAqIE1hdGguUEkpKTsNCgkJCXZhciBpbm5lclJhZGl1cyA9IHJlc2V0ICYmIGFuaW1hdGlvbk9wdHMuYW5pbWF0ZVNjYWxlID8gMCA6IG1lLmlubmVyUmFkaXVzOw0KCQkJdmFyIG91dGVyUmFkaXVzID0gcmVzZXQgJiYgYW5pbWF0aW9uT3B0cy5hbmltYXRlU2NhbGUgPyAwIDogbWUub3V0ZXJSYWRpdXM7DQoJCQl2YXIgdmFsdWVBdEluZGV4T3JEZWZhdWx0ID0gaGVscGVycy52YWx1ZUF0SW5kZXhPckRlZmF1bHQ7DQoNCgkJCWhlbHBlcnMuZXh0ZW5kKGFyYywgew0KCQkJCS8vIFV0aWxpdHkNCgkJCQlfZGF0YXNldEluZGV4OiBtZS5pbmRleCwNCgkJCQlfaW5kZXg6IGluZGV4LA0KDQoJCQkJLy8gRGVzaXJlZCB2aWV3IHByb3BlcnRpZXMNCgkJCQlfbW9kZWw6IHsNCgkJCQkJeDogY2VudGVyWCArIGNoYXJ0Lm9mZnNldFgsDQoJCQkJCXk6IGNlbnRlclkgKyBjaGFydC5vZmZzZXRZLA0KCQkJCQlzdGFydEFuZ2xlOiBzdGFydEFuZ2xlLA0KCQkJCQllbmRBbmdsZTogZW5kQW5nbGUsDQoJCQkJCWNpcmN1bWZlcmVuY2U6IGNpcmN1bWZlcmVuY2UsDQoJCQkJCW91dGVyUmFkaXVzOiBvdXRlclJhZGl1cywNCgkJCQkJaW5uZXJSYWRpdXM6IGlubmVyUmFkaXVzLA0KCQkJCQlsYWJlbDogdmFsdWVBdEluZGV4T3JEZWZhdWx0KGRhdGFzZXQubGFiZWwsIGluZGV4LCBjaGFydC5kYXRhLmxhYmVsc1tpbmRleF0pDQoJCQkJfQ0KCQkJfSk7DQoNCgkJCXZhciBtb2RlbCA9IGFyYy5fbW9kZWw7DQoJCQkvLyBSZXNldHMgdGhlIHZpc3VhbCBzdHlsZXMNCgkJCXRoaXMucmVtb3ZlSG92ZXJTdHlsZShhcmMpOw0KDQoJCQkvLyBTZXQgY29ycmVjdCBhbmdsZXMgaWYgbm90IHJlc2V0dGluZw0KCQkJaWYgKCFyZXNldCB8fCAhYW5pbWF0aW9uT3B0cy5hbmltYXRlUm90YXRlKSB7DQoJCQkJaWYgKGluZGV4ID09PSAwKSB7DQoJCQkJCW1vZGVsLnN0YXJ0QW5nbGUgPSBvcHRzLnJvdGF0aW9uOw0KCQkJCX0gZWxzZSB7DQoJCQkJCW1vZGVsLnN0YXJ0QW5nbGUgPSBtZS5nZXRNZXRhKCkuZGF0YVtpbmRleCAtIDFdLl9tb2RlbC5lbmRBbmdsZTsNCgkJCQl9DQoNCgkJCQltb2RlbC5lbmRBbmdsZSA9IG1vZGVsLnN0YXJ0QW5nbGUgKyBtb2RlbC5jaXJjdW1mZXJlbmNlOw0KCQkJfQ0KDQoJCQlhcmMucGl2b3QoKTsNCgkJfSwNCg0KCQlyZW1vdmVIb3ZlclN0eWxlOiBmdW5jdGlvbihhcmMpIHsNCgkJCUNoYXJ0LkRhdGFzZXRDb250cm9sbGVyLnByb3RvdHlwZS5yZW1vdmVIb3ZlclN0eWxlLmNhbGwodGhpcywgYXJjLCB0aGlzLmNoYXJ0Lm9wdGlvbnMuZWxlbWVudHMuYXJjKTsNCgkJfSwNCg0KCQljYWxjdWxhdGVUb3RhbDogZnVuY3Rpb24oKSB7DQoJCQl2YXIgZGF0YXNldCA9IHRoaXMuZ2V0RGF0YXNldCgpOw0KCQkJdmFyIG1ldGEgPSB0aGlzLmdldE1ldGEoKTsNCgkJCXZhciB0b3RhbCA9IDA7DQoJCQl2YXIgdmFsdWU7DQoNCgkJCWhlbHBlcnMuZWFjaChtZXRhLmRhdGEsIGZ1bmN0aW9uKGVsZW1lbnQsIGluZGV4KSB7DQoJCQkJdmFsdWUgPSBkYXRhc2V0LmRhdGFbaW5kZXhdOw0KCQkJCWlmICghaXNOYU4odmFsdWUpICYmICFlbGVtZW50LmhpZGRlbikgew0KCQkJCQl0b3RhbCArPSBNYXRoLmFicyh2YWx1ZSk7DQoJCQkJfQ0KCQkJfSk7DQoNCgkJCS8qIGlmICh0b3RhbCA9PT0gMCkgew0KCQkJCXRvdGFsID0gTmFOOw0KCQkJfSovDQoNCgkJCXJldHVybiB0b3RhbDsNCgkJfSwNCg0KCQljYWxjdWxhdGVDaXJjdW1mZXJlbmNlOiBmdW5jdGlvbih2YWx1ZSkgew0KCQkJdmFyIHRvdGFsID0gdGhpcy5nZXRNZXRhKCkudG90YWw7DQoJCQlpZiAodG90YWwgPiAwICYmICFpc05hTih2YWx1ZSkpIHsNCgkJCQlyZXR1cm4gKE1hdGguUEkgKiAyLjApICogKHZhbHVlIC8gdG90YWwpOw0KCQkJfQ0KCQkJcmV0dXJuIDA7DQoJCX0sDQoNCgkJLy8gZ2V0cyB0aGUgbWF4IGJvcmRlciBvciBob3ZlciB3aWR0aCB0byBwcm9wZXJseSBzY2FsZSBwaWUgY2hhcnRzDQoJCWdldE1heEJvcmRlcldpZHRoOiBmdW5jdGlvbihhcmNzKSB7DQoJCQl2YXIgbWF4ID0gMDsNCgkJCXZhciBpbmRleCA9IHRoaXMuaW5kZXg7DQoJCQl2YXIgbGVuZ3RoID0gYXJjcy5sZW5ndGg7DQoJCQl2YXIgYm9yZGVyV2lkdGg7DQoJCQl2YXIgaG92ZXJXaWR0aDsNCg0KCQkJZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgew0KCQkJCWJvcmRlcldpZHRoID0gYXJjc1tpXS5fbW9kZWwgPyBhcmNzW2ldLl9tb2RlbC5ib3JkZXJXaWR0aCA6IDA7DQoJCQkJaG92ZXJXaWR0aCA9IGFyY3NbaV0uX2NoYXJ0ID8gYXJjc1tpXS5fY2hhcnQuY29uZmlnLmRhdGEuZGF0YXNldHNbaW5kZXhdLmhvdmVyQm9yZGVyV2lkdGggOiAwOw0KDQoJCQkJbWF4ID0gYm9yZGVyV2lkdGggPiBtYXggPyBib3JkZXJXaWR0aCA6IG1heDsNCgkJCQltYXggPSBob3ZlcldpZHRoID4gbWF4ID8gaG92ZXJXaWR0aCA6IG1heDsNCgkJCX0NCgkJCXJldHVybiBtYXg7DQoJCX0NCgl9KTsNCn07DQoNCn0seyIyNSI6MjUsIjQwIjo0MCwiNDUiOjQ1fV0sMTg6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpew0KJ3VzZSBzdHJpY3QnOw0KDQp2YXIgZGVmYXVsdHMgPSByZXF1aXJlKDI1KTsNCnZhciBlbGVtZW50cyA9IHJlcXVpcmUoNDApOw0KdmFyIGhlbHBlcnMgPSByZXF1aXJlKDQ1KTsNCg0KZGVmYXVsdHMuX3NldCgnbGluZScsIHsNCglzaG93TGluZXM6IHRydWUsDQoJc3BhbkdhcHM6IGZhbHNlLA0KDQoJaG92ZXI6IHsNCgkJbW9kZTogJ2xhYmVsJw0KCX0sDQoNCglzY2FsZXM6IHsNCgkJeEF4ZXM6IFt7DQoJCQl0eXBlOiAnY2F0ZWdvcnknLA0KCQkJaWQ6ICd4LWF4aXMtMCcNCgkJfV0sDQoJCXlBeGVzOiBbew0KCQkJdHlwZTogJ2xpbmVhcicsDQoJCQlpZDogJ3ktYXhpcy0wJw0KCQl9XQ0KCX0NCn0pOw0KDQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKENoYXJ0KSB7DQoNCglmdW5jdGlvbiBsaW5lRW5hYmxlZChkYXRhc2V0LCBvcHRpb25zKSB7DQoJCXJldHVybiBoZWxwZXJzLnZhbHVlT3JEZWZhdWx0KGRhdGFzZXQuc2hvd0xpbmUsIG9wdGlvbnMuc2hvd0xpbmVzKTsNCgl9DQoNCglDaGFydC5jb250cm9sbGVycy5saW5lID0gQ2hhcnQuRGF0YXNldENvbnRyb2xsZXIuZXh0ZW5kKHsNCg0KCQlkYXRhc2V0RWxlbWVudFR5cGU6IGVsZW1lbnRzLkxpbmUsDQoNCgkJZGF0YUVsZW1lbnRUeXBlOiBlbGVtZW50cy5Qb2ludCwNCg0KCQl1cGRhdGU6IGZ1bmN0aW9uKHJlc2V0KSB7DQoJCQl2YXIgbWUgPSB0aGlzOw0KCQkJdmFyIG1ldGEgPSBtZS5nZXRNZXRhKCk7DQoJCQl2YXIgbGluZSA9IG1ldGEuZGF0YXNldDsNCgkJCXZhciBwb2ludHMgPSBtZXRhLmRhdGEgfHwgW107DQoJCQl2YXIgb3B0aW9ucyA9IG1lLmNoYXJ0Lm9wdGlvbnM7DQoJCQl2YXIgbGluZUVsZW1lbnRPcHRpb25zID0gb3B0aW9ucy5lbGVtZW50cy5saW5lOw0KCQkJdmFyIHNjYWxlID0gbWUuZ2V0U2NhbGVGb3JJZChtZXRhLnlBeGlzSUQpOw0KCQkJdmFyIGksIGlsZW4sIGN1c3RvbTsNCgkJCXZhciBkYXRhc2V0ID0gbWUuZ2V0RGF0YXNldCgpOw0KCQkJdmFyIHNob3dMaW5lID0gbGluZUVuYWJsZWQoZGF0YXNldCwgb3B0aW9ucyk7DQoNCgkJCS8vIFVwZGF0ZSBMaW5lDQoJCQlpZiAoc2hvd0xpbmUpIHsNCgkJCQljdXN0b20gPSBsaW5lLmN1c3RvbSB8fCB7fTsNCg0KCQkJCS8vIENvbXBhdGliaWxpdHk6IElmIHRoZSBwcm9wZXJ0aWVzIGFyZSBkZWZpbmVkIHdpdGggb25seSB0aGUgb2xkIG5hbWUsIHVzZSB0aG9zZSB2YWx1ZXMNCgkJCQlpZiAoKGRhdGFzZXQudGVuc2lvbiAhPT0gdW5kZWZpbmVkKSAmJiAoZGF0YXNldC5saW5lVGVuc2lvbiA9PT0gdW5kZWZpbmVkKSkgew0KCQkJCQlkYXRhc2V0LmxpbmVUZW5zaW9uID0gZGF0YXNldC50ZW5zaW9uOw0KCQkJCX0NCg0KCQkJCS8vIFV0aWxpdHkNCgkJCQlsaW5lLl9zY2FsZSA9IHNjYWxlOw0KCQkJCWxpbmUuX2RhdGFzZXRJbmRleCA9IG1lLmluZGV4Ow0KCQkJCS8vIERhdGENCgkJCQlsaW5lLl9jaGlsZHJlbiA9IHBvaW50czsNCgkJCQkvLyBNb2RlbA0KCQkJCWxpbmUuX21vZGVsID0gew0KCQkJCQkvLyBBcHBlYXJhbmNlDQoJCQkJCS8vIFRoZSBkZWZhdWx0IGJlaGF2aW9yIG9mIGxpbmVzIGlzIHRvIGJyZWFrIGF0IG51bGwgdmFsdWVzLCBhY2NvcmRpbmcNCgkJCQkJLy8gdG8gaHR0cHM6Ly9naXRodWIuY29tL2NoYXJ0anMvQ2hhcnQuanMvaXNzdWVzLzI0MzUjaXNzdWVjb21tZW50LTIxNjcxODE1OA0KCQkJCQkvLyBUaGlzIG9wdGlvbiBnaXZlcyBsaW5lcyB0aGUgYWJpbGl0eSB0byBzcGFuIGdhcHMNCgkJCQkJc3BhbkdhcHM6IGRhdGFzZXQuc3BhbkdhcHMgPyBkYXRhc2V0LnNwYW5HYXBzIDogb3B0aW9ucy5zcGFuR2FwcywNCgkJCQkJdGVuc2lvbjogY3VzdG9tLnRlbnNpb24gPyBjdXN0b20udGVuc2lvbiA6IGhlbHBlcnMudmFsdWVPckRlZmF1bHQoZGF0YXNldC5saW5lVGVuc2lvbiwgbGluZUVsZW1lbnRPcHRpb25zLnRlbnNpb24pLA0KCQkJCQliYWNrZ3JvdW5kQ29sb3I6IGN1c3RvbS5iYWNrZ3JvdW5kQ29sb3IgPyBjdXN0b20uYmFja2dyb3VuZENvbG9yIDogKGRhdGFzZXQuYmFja2dyb3VuZENvbG9yIHx8IGxpbmVFbGVtZW50T3B0aW9ucy5iYWNrZ3JvdW5kQ29sb3IpLA0KCQkJCQlib3JkZXJXaWR0aDogY3VzdG9tLmJvcmRlcldpZHRoID8gY3VzdG9tLmJvcmRlcldpZHRoIDogKGRhdGFzZXQuYm9yZGVyV2lkdGggfHwgbGluZUVsZW1lbnRPcHRpb25zLmJvcmRlcldpZHRoKSwNCgkJCQkJYm9yZGVyQ29sb3I6IGN1c3RvbS5ib3JkZXJDb2xvciA/IGN1c3RvbS5ib3JkZXJDb2xvciA6IChkYXRhc2V0LmJvcmRlckNvbG9yIHx8IGxpbmVFbGVtZW50T3B0aW9ucy5ib3JkZXJDb2xvciksDQoJCQkJCWJvcmRlckNhcFN0eWxlOiBjdXN0b20uYm9yZGVyQ2FwU3R5bGUgPyBjdXN0b20uYm9yZGVyQ2FwU3R5bGUgOiAoZGF0YXNldC5ib3JkZXJDYXBTdHlsZSB8fCBsaW5lRWxlbWVudE9wdGlvbnMuYm9yZGVyQ2FwU3R5bGUpLA0KCQkJCQlib3JkZXJEYXNoOiBjdXN0b20uYm9yZGVyRGFzaCA/IGN1c3RvbS5ib3JkZXJEYXNoIDogKGRhdGFzZXQuYm9yZGVyRGFzaCB8fCBsaW5lRWxlbWVudE9wdGlvbnMuYm9yZGVyRGFzaCksDQoJCQkJCWJvcmRlckRhc2hPZmZzZXQ6IGN1c3RvbS5ib3JkZXJEYXNoT2Zmc2V0ID8gY3VzdG9tLmJvcmRlckRhc2hPZmZzZXQgOiAoZGF0YXNldC5ib3JkZXJEYXNoT2Zmc2V0IHx8IGxpbmVFbGVtZW50T3B0aW9ucy5ib3JkZXJEYXNoT2Zmc2V0KSwNCgkJCQkJYm9yZGVySm9pblN0eWxlOiBjdXN0b20uYm9yZGVySm9pblN0eWxlID8gY3VzdG9tLmJvcmRlckpvaW5TdHlsZSA6IChkYXRhc2V0LmJvcmRlckpvaW5TdHlsZSB8fCBsaW5lRWxlbWVudE9wdGlvbnMuYm9yZGVySm9pblN0eWxlKSwNCgkJCQkJZmlsbDogY3VzdG9tLmZpbGwgPyBjdXN0b20uZmlsbCA6IChkYXRhc2V0LmZpbGwgIT09IHVuZGVmaW5lZCA/IGRhdGFzZXQuZmlsbCA6IGxpbmVFbGVtZW50T3B0aW9ucy5maWxsKSwNCgkJCQkJc3RlcHBlZExpbmU6IGN1c3RvbS5zdGVwcGVkTGluZSA/IGN1c3RvbS5zdGVwcGVkTGluZSA6IGhlbHBlcnMudmFsdWVPckRlZmF1bHQoZGF0YXNldC5zdGVwcGVkTGluZSwgbGluZUVsZW1lbnRPcHRpb25zLnN0ZXBwZWQpLA0KCQkJCQljdWJpY0ludGVycG9sYXRpb25Nb2RlOiBjdXN0b20uY3ViaWNJbnRlcnBvbGF0aW9uTW9kZSA/IGN1c3RvbS5jdWJpY0ludGVycG9sYXRpb25Nb2RlIDogaGVscGVycy52YWx1ZU9yRGVmYXVsdChkYXRhc2V0LmN1YmljSW50ZXJwb2xhdGlvbk1vZGUsIGxpbmVFbGVtZW50T3B0aW9ucy5jdWJpY0ludGVycG9sYXRpb25Nb2RlKSwNCgkJCQl9Ow0KDQoJCQkJbGluZS5waXZvdCgpOw0KCQkJfQ0KDQoJCQkvLyBVcGRhdGUgUG9pbnRzDQoJCQlmb3IgKGkgPSAwLCBpbGVuID0gcG9pbnRzLmxlbmd0aDsgaSA8IGlsZW47ICsraSkgew0KCQkJCW1lLnVwZGF0ZUVsZW1lbnQocG9pbnRzW2ldLCBpLCByZXNldCk7DQoJCQl9DQoNCgkJCWlmIChzaG93TGluZSAmJiBsaW5lLl9tb2RlbC50ZW5zaW9uICE9PSAwKSB7DQoJCQkJbWUudXBkYXRlQmV6aWVyQ29udHJvbFBvaW50cygpOw0KCQkJfQ0KDQoJCQkvLyBOb3cgcGl2b3QgdGhlIHBvaW50IGZvciBhbmltYXRpb24NCgkJCWZvciAoaSA9IDAsIGlsZW4gPSBwb2ludHMubGVuZ3RoOyBpIDwgaWxlbjsgKytpKSB7DQoJCQkJcG9pbnRzW2ldLnBpdm90KCk7DQoJCQl9DQoJCX0sDQoNCgkJZ2V0UG9pbnRCYWNrZ3JvdW5kQ29sb3I6IGZ1bmN0aW9uKHBvaW50LCBpbmRleCkgew0KCQkJdmFyIGJhY2tncm91bmRDb2xvciA9IHRoaXMuY2hhcnQub3B0aW9ucy5lbGVtZW50cy5wb2ludC5iYWNrZ3JvdW5kQ29sb3I7DQoJCQl2YXIgZGF0YXNldCA9IHRoaXMuZ2V0RGF0YXNldCgpOw0KCQkJdmFyIGN1c3RvbSA9IHBvaW50LmN1c3RvbSB8fCB7fTsNCg0KCQkJaWYgKGN1c3RvbS5iYWNrZ3JvdW5kQ29sb3IpIHsNCgkJCQliYWNrZ3JvdW5kQ29sb3IgPSBjdXN0b20uYmFja2dyb3VuZENvbG9yOw0KCQkJfSBlbHNlIGlmIChkYXRhc2V0LnBvaW50QmFja2dyb3VuZENvbG9yKSB7DQoJCQkJYmFja2dyb3VuZENvbG9yID0gaGVscGVycy52YWx1ZUF0SW5kZXhPckRlZmF1bHQoZGF0YXNldC5wb2ludEJhY2tncm91bmRDb2xvciwgaW5kZXgsIGJhY2tncm91bmRDb2xvcik7DQoJCQl9IGVsc2UgaWYgKGRhdGFzZXQuYmFja2dyb3VuZENvbG9yKSB7DQoJCQkJYmFja2dyb3VuZENvbG9yID0gZGF0YXNldC5iYWNrZ3JvdW5kQ29sb3I7DQoJCQl9DQoNCgkJCXJldHVybiBiYWNrZ3JvdW5kQ29sb3I7DQoJCX0sDQoNCgkJZ2V0UG9pbnRCb3JkZXJDb2xvcjogZnVuY3Rpb24ocG9pbnQsIGluZGV4KSB7DQoJCQl2YXIgYm9yZGVyQ29sb3IgPSB0aGlzLmNoYXJ0Lm9wdGlvbnMuZWxlbWVudHMucG9pbnQuYm9yZGVyQ29sb3I7DQoJCQl2YXIgZGF0YXNldCA9IHRoaXMuZ2V0RGF0YXNldCgpOw0KCQkJdmFyIGN1c3RvbSA9IHBvaW50LmN1c3RvbSB8fCB7fTsNCg0KCQkJaWYgKGN1c3RvbS5ib3JkZXJDb2xvcikgew0KCQkJCWJvcmRlckNvbG9yID0gY3VzdG9tLmJvcmRlckNvbG9yOw0KCQkJfSBlbHNlIGlmIChkYXRhc2V0LnBvaW50Qm9yZGVyQ29sb3IpIHsNCgkJCQlib3JkZXJDb2xvciA9IGhlbHBlcnMudmFsdWVBdEluZGV4T3JEZWZhdWx0KGRhdGFzZXQucG9pbnRCb3JkZXJDb2xvciwgaW5kZXgsIGJvcmRlckNvbG9yKTsNCgkJCX0gZWxzZSBpZiAoZGF0YXNldC5ib3JkZXJDb2xvcikgew0KCQkJCWJvcmRlckNvbG9yID0gZGF0YXNldC5ib3JkZXJDb2xvcjsNCgkJCX0NCg0KCQkJcmV0dXJuIGJvcmRlckNvbG9yOw0KCQl9LA0KDQoJCWdldFBvaW50Qm9yZGVyV2lkdGg6IGZ1bmN0aW9uKHBvaW50LCBpbmRleCkgew0KCQkJdmFyIGJvcmRlcldpZHRoID0gdGhpcy5jaGFydC5vcHRpb25zLmVsZW1lbnRzLnBvaW50LmJvcmRlcldpZHRoOw0KCQkJdmFyIGRhdGFzZXQgPSB0aGlzLmdldERhdGFzZXQoKTsNCgkJCXZhciBjdXN0b20gPSBwb2ludC5jdXN0b20gfHwge307DQoNCgkJCWlmICghaXNOYU4oY3VzdG9tLmJvcmRlcldpZHRoKSkgew0KCQkJCWJvcmRlcldpZHRoID0gY3VzdG9tLmJvcmRlcldpZHRoOw0KCQkJfSBlbHNlIGlmICghaXNOYU4oZGF0YXNldC5wb2ludEJvcmRlcldpZHRoKSB8fCBoZWxwZXJzLmlzQXJyYXkoZGF0YXNldC5wb2ludEJvcmRlcldpZHRoKSkgew0KCQkJCWJvcmRlcldpZHRoID0gaGVscGVycy52YWx1ZUF0SW5kZXhPckRlZmF1bHQoZGF0YXNldC5wb2ludEJvcmRlcldpZHRoLCBpbmRleCwgYm9yZGVyV2lkdGgpOw0KCQkJfSBlbHNlIGlmICghaXNOYU4oZGF0YXNldC5ib3JkZXJXaWR0aCkpIHsNCgkJCQlib3JkZXJXaWR0aCA9IGRhdGFzZXQuYm9yZGVyV2lkdGg7DQoJCQl9DQoNCgkJCXJldHVybiBib3JkZXJXaWR0aDsNCgkJfSwNCg0KCQl1cGRhdGVFbGVtZW50OiBmdW5jdGlvbihwb2ludCwgaW5kZXgsIHJlc2V0KSB7DQoJCQl2YXIgbWUgPSB0aGlzOw0KCQkJdmFyIG1ldGEgPSBtZS5nZXRNZXRhKCk7DQoJCQl2YXIgY3VzdG9tID0gcG9pbnQuY3VzdG9tIHx8IHt9Ow0KCQkJdmFyIGRhdGFzZXQgPSBtZS5nZXREYXRhc2V0KCk7DQoJCQl2YXIgZGF0YXNldEluZGV4ID0gbWUuaW5kZXg7DQoJCQl2YXIgdmFsdWUgPSBkYXRhc2V0LmRhdGFbaW5kZXhdOw0KCQkJdmFyIHlTY2FsZSA9IG1lLmdldFNjYWxlRm9ySWQobWV0YS55QXhpc0lEKTsNCgkJCXZhciB4U2NhbGUgPSBtZS5nZXRTY2FsZUZvcklkKG1ldGEueEF4aXNJRCk7DQoJCQl2YXIgcG9pbnRPcHRpb25zID0gbWUuY2hhcnQub3B0aW9ucy5lbGVtZW50cy5wb2ludDsNCgkJCXZhciB4LCB5Ow0KDQoJCQkvLyBDb21wYXRpYmlsaXR5OiBJZiB0aGUgcHJvcGVydGllcyBhcmUgZGVmaW5lZCB3aXRoIG9ubHkgdGhlIG9sZCBuYW1lLCB1c2UgdGhvc2UgdmFsdWVzDQoJCQlpZiAoKGRhdGFzZXQucmFkaXVzICE9PSB1bmRlZmluZWQpICYmIChkYXRhc2V0LnBvaW50UmFkaXVzID09PSB1bmRlZmluZWQpKSB7DQoJCQkJZGF0YXNldC5wb2ludFJhZGl1cyA9IGRhdGFzZXQucmFkaXVzOw0KCQkJfQ0KCQkJaWYgKChkYXRhc2V0LmhpdFJhZGl1cyAhPT0gdW5kZWZpbmVkKSAmJiAoZGF0YXNldC5wb2ludEhpdFJhZGl1cyA9PT0gdW5kZWZpbmVkKSkgew0KCQkJCWRhdGFzZXQucG9pbnRIaXRSYWRpdXMgPSBkYXRhc2V0LmhpdFJhZGl1czsNCgkJCX0NCg0KCQkJeCA9IHhTY2FsZS5nZXRQaXhlbEZvclZhbHVlKHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgPyB2YWx1ZSA6IE5hTiwgaW5kZXgsIGRhdGFzZXRJbmRleCk7DQoJCQl5ID0gcmVzZXQgPyB5U2NhbGUuZ2V0QmFzZVBpeGVsKCkgOiBtZS5jYWxjdWxhdGVQb2ludFkodmFsdWUsIGluZGV4LCBkYXRhc2V0SW5kZXgpOw0KDQoJCQkvLyBVdGlsaXR5DQoJCQlwb2ludC5feFNjYWxlID0geFNjYWxlOw0KCQkJcG9pbnQuX3lTY2FsZSA9IHlTY2FsZTsNCgkJCXBvaW50Ll9kYXRhc2V0SW5kZXggPSBkYXRhc2V0SW5kZXg7DQoJCQlwb2ludC5faW5kZXggPSBpbmRleDsNCg0KCQkJLy8gRGVzaXJlZCB2aWV3IHByb3BlcnRpZXMNCgkJCXBvaW50Ll9tb2RlbCA9IHsNCgkJCQl4OiB4LA0KCQkJCXk6IHksDQoJCQkJc2tpcDogY3VzdG9tLnNraXAgfHwgaXNOYU4oeCkgfHwgaXNOYU4oeSksDQoJCQkJLy8gQXBwZWFyYW5jZQ0KCQkJCXJhZGl1czogY3VzdG9tLnJhZGl1cyB8fCBoZWxwZXJzLnZhbHVlQXRJbmRleE9yRGVmYXVsdChkYXRhc2V0LnBvaW50UmFkaXVzLCBpbmRleCwgcG9pbnRPcHRpb25zLnJhZGl1cyksDQoJCQkJcG9pbnRTdHlsZTogY3VzdG9tLnBvaW50U3R5bGUgfHwgaGVscGVycy52YWx1ZUF0SW5kZXhPckRlZmF1bHQoZGF0YXNldC5wb2ludFN0eWxlLCBpbmRleCwgcG9pbnRPcHRpb25zLnBvaW50U3R5bGUpLA0KCQkJCWJhY2tncm91bmRDb2xvcjogbWUuZ2V0UG9pbnRCYWNrZ3JvdW5kQ29sb3IocG9pbnQsIGluZGV4KSwNCgkJCQlib3JkZXJDb2xvcjogbWUuZ2V0UG9pbnRCb3JkZXJDb2xvcihwb2ludCwgaW5kZXgpLA0KCQkJCWJvcmRlcldpZHRoOiBtZS5nZXRQb2ludEJvcmRlcldpZHRoKHBvaW50LCBpbmRleCksDQoJCQkJdGVuc2lvbjogbWV0YS5kYXRhc2V0Ll9tb2RlbCA/IG1ldGEuZGF0YXNldC5fbW9kZWwudGVuc2lvbiA6IDAsDQoJCQkJc3RlcHBlZExpbmU6IG1ldGEuZGF0YXNldC5fbW9kZWwgPyBtZXRhLmRhdGFzZXQuX21vZGVsLnN0ZXBwZWRMaW5lIDogZmFsc2UsDQoJCQkJLy8gVG9vbHRpcA0KCQkJCWhpdFJhZGl1czogY3VzdG9tLmhpdFJhZGl1cyB8fCBoZWxwZXJzLnZhbHVlQXRJbmRleE9yRGVmYXVsdChkYXRhc2V0LnBvaW50SGl0UmFkaXVzLCBpbmRleCwgcG9pbnRPcHRpb25zLmhpdFJhZGl1cykNCgkJCX07DQoJCX0sDQoNCgkJY2FsY3VsYXRlUG9pbnRZOiBmdW5jdGlvbih2YWx1ZSwgaW5kZXgsIGRhdGFzZXRJbmRleCkgew0KCQkJdmFyIG1lID0gdGhpczsNCgkJCXZhciBjaGFydCA9IG1lLmNoYXJ0Ow0KCQkJdmFyIG1ldGEgPSBtZS5nZXRNZXRhKCk7DQoJCQl2YXIgeVNjYWxlID0gbWUuZ2V0U2NhbGVGb3JJZChtZXRhLnlBeGlzSUQpOw0KCQkJdmFyIHN1bVBvcyA9IDA7DQoJCQl2YXIgc3VtTmVnID0gMDsNCgkJCXZhciBpLCBkcywgZHNNZXRhOw0KDQoJCQlpZiAoeVNjYWxlLm9wdGlvbnMuc3RhY2tlZCkgew0KCQkJCWZvciAoaSA9IDA7IGkgPCBkYXRhc2V0SW5kZXg7IGkrKykgew0KCQkJCQlkcyA9IGNoYXJ0LmRhdGEuZGF0YXNldHNbaV07DQoJCQkJCWRzTWV0YSA9IGNoYXJ0LmdldERhdGFzZXRNZXRhKGkpOw0KCQkJCQlpZiAoZHNNZXRhLnR5cGUgPT09ICdsaW5lJyAmJiBkc01ldGEueUF4aXNJRCA9PT0geVNjYWxlLmlkICYmIGNoYXJ0LmlzRGF0YXNldFZpc2libGUoaSkpIHsNCgkJCQkJCXZhciBzdGFja2VkUmlnaHRWYWx1ZSA9IE51bWJlcih5U2NhbGUuZ2V0UmlnaHRWYWx1ZShkcy5kYXRhW2luZGV4XSkpOw0KCQkJCQkJaWYgKHN0YWNrZWRSaWdodFZhbHVlIDwgMCkgew0KCQkJCQkJCXN1bU5lZyArPSBzdGFja2VkUmlnaHRWYWx1ZSB8fCAwOw0KCQkJCQkJfSBlbHNlIHsNCgkJCQkJCQlzdW1Qb3MgKz0gc3RhY2tlZFJpZ2h0VmFsdWUgfHwgMDsNCgkJCQkJCX0NCgkJCQkJfQ0KCQkJCX0NCg0KCQkJCXZhciByaWdodFZhbHVlID0gTnVtYmVyKHlTY2FsZS5nZXRSaWdodFZhbHVlKHZhbHVlKSk7DQoJCQkJaWYgKHJpZ2h0VmFsdWUgPCAwKSB7DQoJCQkJCXJldHVybiB5U2NhbGUuZ2V0UGl4ZWxGb3JWYWx1ZShzdW1OZWcgKyByaWdodFZhbHVlKTsNCgkJCQl9DQoJCQkJcmV0dXJuIHlTY2FsZS5nZXRQaXhlbEZvclZhbHVlKHN1bVBvcyArIHJpZ2h0VmFsdWUpOw0KCQkJfQ0KDQoJCQlyZXR1cm4geVNjYWxlLmdldFBpeGVsRm9yVmFsdWUodmFsdWUpOw0KCQl9LA0KDQoJCXVwZGF0ZUJlemllckNvbnRyb2xQb2ludHM6IGZ1bmN0aW9uKCkgew0KCQkJdmFyIG1lID0gdGhpczsNCgkJCXZhciBtZXRhID0gbWUuZ2V0TWV0YSgpOw0KCQkJdmFyIGFyZWEgPSBtZS5jaGFydC5jaGFydEFyZWE7DQoJCQl2YXIgcG9pbnRzID0gKG1ldGEuZGF0YSB8fCBbXSk7DQoJCQl2YXIgaSwgaWxlbiwgcG9pbnQsIG1vZGVsLCBjb250cm9sUG9pbnRzOw0KDQoJCQkvLyBPbmx5IGNvbnNpZGVyIHBvaW50cyB0aGF0IGFyZSBkcmF3biBpbiBjYXNlIHRoZSBzcGFuR2FwcyBvcHRpb24gaXMgdXNlZA0KCQkJaWYgKG1ldGEuZGF0YXNldC5fbW9kZWwuc3BhbkdhcHMpIHsNCgkJCQlwb2ludHMgPSBwb2ludHMuZmlsdGVyKGZ1bmN0aW9uKHB0KSB7DQoJCQkJCXJldHVybiAhcHQuX21vZGVsLnNraXA7DQoJCQkJfSk7DQoJCQl9DQoNCgkJCWZ1bmN0aW9uIGNhcENvbnRyb2xQb2ludChwdCwgbWluLCBtYXgpIHsNCgkJCQlyZXR1cm4gTWF0aC5tYXgoTWF0aC5taW4ocHQsIG1heCksIG1pbik7DQoJCQl9DQoNCgkJCWlmIChtZXRhLmRhdGFzZXQuX21vZGVsLmN1YmljSW50ZXJwb2xhdGlvbk1vZGUgPT09ICdtb25vdG9uZScpIHsNCgkJCQloZWxwZXJzLnNwbGluZUN1cnZlTW9ub3RvbmUocG9pbnRzKTsNCgkJCX0gZWxzZSB7DQoJCQkJZm9yIChpID0gMCwgaWxlbiA9IHBvaW50cy5sZW5ndGg7IGkgPCBpbGVuOyArK2kpIHsNCgkJCQkJcG9pbnQgPSBwb2ludHNbaV07DQoJCQkJCW1vZGVsID0gcG9pbnQuX21vZGVsOw0KCQkJCQljb250cm9sUG9pbnRzID0gaGVscGVycy5zcGxpbmVDdXJ2ZSgNCgkJCQkJCWhlbHBlcnMucHJldmlvdXNJdGVtKHBvaW50cywgaSkuX21vZGVsLA0KCQkJCQkJbW9kZWwsDQoJCQkJCQloZWxwZXJzLm5leHRJdGVtKHBvaW50cywgaSkuX21vZGVsLA0KCQkJCQkJbWV0YS5kYXRhc2V0Ll9tb2RlbC50ZW5zaW9uDQoJCQkJCSk7DQoJCQkJCW1vZGVsLmNvbnRyb2xQb2ludFByZXZpb3VzWCA9IGNvbnRyb2xQb2ludHMucHJldmlvdXMueDsNCgkJCQkJbW9kZWwuY29udHJvbFBvaW50UHJldmlvdXNZID0gY29udHJvbFBvaW50cy5wcmV2aW91cy55Ow0KCQkJCQltb2RlbC5jb250cm9sUG9pbnROZXh0WCA9IGNvbnRyb2xQb2ludHMubmV4dC54Ow0KCQkJCQltb2RlbC5jb250cm9sUG9pbnROZXh0WSA9IGNvbnRyb2xQb2ludHMubmV4dC55Ow0KCQkJCX0NCgkJCX0NCg0KCQkJaWYgKG1lLmNoYXJ0Lm9wdGlvbnMuZWxlbWVudHMubGluZS5jYXBCZXppZXJQb2ludHMpIHsNCgkJCQlmb3IgKGkgPSAwLCBpbGVuID0gcG9pbnRzLmxlbmd0aDsgaSA8IGlsZW47ICsraSkgew0KCQkJCQltb2RlbCA9IHBvaW50c1tpXS5fbW9kZWw7DQoJCQkJCW1vZGVsLmNvbnRyb2xQb2ludFByZXZpb3VzWCA9IGNhcENvbnRyb2xQb2ludChtb2RlbC5jb250cm9sUG9pbnRQcmV2aW91c1gsIGFyZWEubGVmdCwgYXJlYS5yaWdodCk7DQoJCQkJCW1vZGVsLmNvbnRyb2xQb2ludFByZXZpb3VzWSA9IGNhcENvbnRyb2xQb2ludChtb2RlbC5jb250cm9sUG9pbnRQcmV2aW91c1ksIGFyZWEudG9wLCBhcmVhLmJvdHRvbSk7DQoJCQkJCW1vZGVsLmNvbnRyb2xQb2ludE5leHRYID0gY2FwQ29udHJvbFBvaW50KG1vZGVsLmNvbnRyb2xQb2ludE5leHRYLCBhcmVhLmxlZnQsIGFyZWEucmlnaHQpOw0KCQkJCQltb2RlbC5jb250cm9sUG9pbnROZXh0WSA9IGNhcENvbnRyb2xQb2ludChtb2RlbC5jb250cm9sUG9pbnROZXh0WSwgYXJlYS50b3AsIGFyZWEuYm90dG9tKTsNCgkJCQl9DQoJCQl9DQoJCX0sDQoNCgkJZHJhdzogZnVuY3Rpb24oKSB7DQoJCQl2YXIgbWUgPSB0aGlzOw0KCQkJdmFyIGNoYXJ0ID0gbWUuY2hhcnQ7DQoJCQl2YXIgbWV0YSA9IG1lLmdldE1ldGEoKTsNCgkJCXZhciBwb2ludHMgPSBtZXRhLmRhdGEgfHwgW107DQoJCQl2YXIgYXJlYSA9IGNoYXJ0LmNoYXJ0QXJlYTsNCgkJCXZhciBpbGVuID0gcG9pbnRzLmxlbmd0aDsNCgkJCXZhciBpID0gMDsNCg0KCQkJaGVscGVycy5jYW52YXMuY2xpcEFyZWEoY2hhcnQuY3R4LCBhcmVhKTsNCg0KCQkJaWYgKGxpbmVFbmFibGVkKG1lLmdldERhdGFzZXQoKSwgY2hhcnQub3B0aW9ucykpIHsNCgkJCQltZXRhLmRhdGFzZXQuZHJhdygpOw0KCQkJfQ0KDQoJCQloZWxwZXJzLmNhbnZhcy51bmNsaXBBcmVhKGNoYXJ0LmN0eCk7DQoNCgkJCS8vIERyYXcgdGhlIHBvaW50cw0KCQkJZm9yICg7IGkgPCBpbGVuOyArK2kpIHsNCgkJCQlwb2ludHNbaV0uZHJhdyhhcmVhKTsNCgkJCX0NCgkJfSwNCg0KCQlzZXRIb3ZlclN0eWxlOiBmdW5jdGlvbihwb2ludCkgew0KCQkJLy8gUG9pbnQNCgkJCXZhciBkYXRhc2V0ID0gdGhpcy5jaGFydC5kYXRhLmRhdGFzZXRzW3BvaW50Ll9kYXRhc2V0SW5kZXhdOw0KCQkJdmFyIGluZGV4ID0gcG9pbnQuX2luZGV4Ow0KCQkJdmFyIGN1c3RvbSA9IHBvaW50LmN1c3RvbSB8fCB7fTsNCgkJCXZhciBtb2RlbCA9IHBvaW50Ll9tb2RlbDsNCg0KCQkJbW9kZWwucmFkaXVzID0gY3VzdG9tLmhvdmVyUmFkaXVzIHx8IGhlbHBlcnMudmFsdWVBdEluZGV4T3JEZWZhdWx0KGRhdGFzZXQucG9pbnRIb3ZlclJhZGl1cywgaW5kZXgsIHRoaXMuY2hhcnQub3B0aW9ucy5lbGVtZW50cy5wb2ludC5ob3ZlclJhZGl1cyk7DQoJCQltb2RlbC5iYWNrZ3JvdW5kQ29sb3IgPSBjdXN0b20uaG92ZXJCYWNrZ3JvdW5kQ29sb3IgfHwgaGVscGVycy52YWx1ZUF0SW5kZXhPckRlZmF1bHQoZGF0YXNldC5wb2ludEhvdmVyQmFja2dyb3VuZENvbG9yLCBpbmRleCwgaGVscGVycy5nZXRIb3ZlckNvbG9yKG1vZGVsLmJhY2tncm91bmRDb2xvcikpOw0KCQkJbW9kZWwuYm9yZGVyQ29sb3IgPSBjdXN0b20uaG92ZXJCb3JkZXJDb2xvciB8fCBoZWxwZXJzLnZhbHVlQXRJbmRleE9yRGVmYXVsdChkYXRhc2V0LnBvaW50SG92ZXJCb3JkZXJDb2xvciwgaW5kZXgsIGhlbHBlcnMuZ2V0SG92ZXJDb2xvcihtb2RlbC5ib3JkZXJDb2xvcikpOw0KCQkJbW9kZWwuYm9yZGVyV2lkdGggPSBjdXN0b20uaG92ZXJCb3JkZXJXaWR0aCB8fCBoZWxwZXJzLnZhbHVlQXRJbmRleE9yRGVmYXVsdChkYXRhc2V0LnBvaW50SG92ZXJCb3JkZXJXaWR0aCwgaW5kZXgsIG1vZGVsLmJvcmRlcldpZHRoKTsNCgkJfSwNCg0KCQlyZW1vdmVIb3ZlclN0eWxlOiBmdW5jdGlvbihwb2ludCkgew0KCQkJdmFyIG1lID0gdGhpczsNCgkJCXZhciBkYXRhc2V0ID0gbWUuY2hhcnQuZGF0YS5kYXRhc2V0c1twb2ludC5fZGF0YXNldEluZGV4XTsNCgkJCXZhciBpbmRleCA9IHBvaW50Ll9pbmRleDsNCgkJCXZhciBjdXN0b20gPSBwb2ludC5jdXN0b20gfHwge307DQoJCQl2YXIgbW9kZWwgPSBwb2ludC5fbW9kZWw7DQoNCgkJCS8vIENvbXBhdGliaWxpdHk6IElmIHRoZSBwcm9wZXJ0aWVzIGFyZSBkZWZpbmVkIHdpdGggb25seSB0aGUgb2xkIG5hbWUsIHVzZSB0aG9zZSB2YWx1ZXMNCgkJCWlmICgoZGF0YXNldC5yYWRpdXMgIT09IHVuZGVmaW5lZCkgJiYgKGRhdGFzZXQucG9pbnRSYWRpdXMgPT09IHVuZGVmaW5lZCkpIHsNCgkJCQlkYXRhc2V0LnBvaW50UmFkaXVzID0gZGF0YXNldC5yYWRpdXM7DQoJCQl9DQoNCgkJCW1vZGVsLnJhZGl1cyA9IGN1c3RvbS5yYWRpdXMgfHwgaGVscGVycy52YWx1ZUF0SW5kZXhPckRlZmF1bHQoZGF0YXNldC5wb2ludFJhZGl1cywgaW5kZXgsIG1lLmNoYXJ0Lm9wdGlvbnMuZWxlbWVudHMucG9pbnQucmFkaXVzKTsNCgkJCW1vZGVsLmJhY2tncm91bmRDb2xvciA9IG1lLmdldFBvaW50QmFja2dyb3VuZENvbG9yKHBvaW50LCBpbmRleCk7DQoJCQltb2RlbC5ib3JkZXJDb2xvciA9IG1lLmdldFBvaW50Qm9yZGVyQ29sb3IocG9pbnQsIGluZGV4KTsNCgkJCW1vZGVsLmJvcmRlcldpZHRoID0gbWUuZ2V0UG9pbnRCb3JkZXJXaWR0aChwb2ludCwgaW5kZXgpOw0KCQl9DQoJfSk7DQp9Ow0KDQp9LHsiMjUiOjI1LCI0MCI6NDAsIjQ1Ijo0NX1dLDE5OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsNCid1c2Ugc3RyaWN0JzsNCg0KdmFyIGRlZmF1bHRzID0gcmVxdWlyZSgyNSk7DQp2YXIgZWxlbWVudHMgPSByZXF1aXJlKDQwKTsNCnZhciBoZWxwZXJzID0gcmVxdWlyZSg0NSk7DQoNCmRlZmF1bHRzLl9zZXQoJ3BvbGFyQXJlYScsIHsNCglzY2FsZTogew0KCQl0eXBlOiAncmFkaWFsTGluZWFyJywNCgkJYW5nbGVMaW5lczogew0KCQkJZGlzcGxheTogZmFsc2UNCgkJfSwNCgkJZ3JpZExpbmVzOiB7DQoJCQljaXJjdWxhcjogdHJ1ZQ0KCQl9LA0KCQlwb2ludExhYmVsczogew0KCQkJZGlzcGxheTogZmFsc2UNCgkJfSwNCgkJdGlja3M6IHsNCgkJCWJlZ2luQXRaZXJvOiB0cnVlDQoJCX0NCgl9LA0KDQoJLy8gQm9vbGVhbiAtIFdoZXRoZXIgdG8gYW5pbWF0ZSB0aGUgcm90YXRpb24gb2YgdGhlIGNoYXJ0DQoJYW5pbWF0aW9uOiB7DQoJCWFuaW1hdGVSb3RhdGU6IHRydWUsDQoJCWFuaW1hdGVTY2FsZTogdHJ1ZQ0KCX0sDQoNCglzdGFydEFuZ2xlOiAtMC41ICogTWF0aC5QSSwNCglsZWdlbmRDYWxsYmFjazogZnVuY3Rpb24oY2hhcnQpIHsNCgkJdmFyIHRleHQgPSBbXTsNCgkJdGV4dC5wdXNoKCc8dWwgY2xhc3M9IicgKyBjaGFydC5pZCArICctbGVnZW5kIj4nKTsNCg0KCQl2YXIgZGF0YSA9IGNoYXJ0LmRhdGE7DQoJCXZhciBkYXRhc2V0cyA9IGRhdGEuZGF0YXNldHM7DQoJCXZhciBsYWJlbHMgPSBkYXRhLmxhYmVsczsNCg0KCQlpZiAoZGF0YXNldHMubGVuZ3RoKSB7DQoJCQlmb3IgKHZhciBpID0gMDsgaSA8IGRhdGFzZXRzWzBdLmRhdGEubGVuZ3RoOyArK2kpIHsNCgkJCQl0ZXh0LnB1c2goJzxsaT48c3BhbiBzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjonICsgZGF0YXNldHNbMF0uYmFja2dyb3VuZENvbG9yW2ldICsgJyI+PC9zcGFuPicpOw0KCQkJCWlmIChsYWJlbHNbaV0pIHsNCgkJCQkJdGV4dC5wdXNoKGxhYmVsc1tpXSk7DQoJCQkJfQ0KCQkJCXRleHQucHVzaCgnPC9saT4nKTsNCgkJCX0NCgkJfQ0KDQoJCXRleHQucHVzaCgnPC91bD4nKTsNCgkJcmV0dXJuIHRleHQuam9pbignJyk7DQoJfSwNCglsZWdlbmQ6IHsNCgkJbGFiZWxzOiB7DQoJCQlnZW5lcmF0ZUxhYmVsczogZnVuY3Rpb24oY2hhcnQpIHsNCgkJCQl2YXIgZGF0YSA9IGNoYXJ0LmRhdGE7DQoJCQkJaWYgKGRhdGEubGFiZWxzLmxlbmd0aCAmJiBkYXRhLmRhdGFzZXRzLmxlbmd0aCkgew0KCQkJCQlyZXR1cm4gZGF0YS5sYWJlbHMubWFwKGZ1bmN0aW9uKGxhYmVsLCBpKSB7DQoJCQkJCQl2YXIgbWV0YSA9IGNoYXJ0LmdldERhdGFzZXRNZXRhKDApOw0KCQkJCQkJdmFyIGRzID0gZGF0YS5kYXRhc2V0c1swXTsNCgkJCQkJCXZhciBhcmMgPSBtZXRhLmRhdGFbaV07DQoJCQkJCQl2YXIgY3VzdG9tID0gYXJjLmN1c3RvbSB8fCB7fTsNCgkJCQkJCXZhciB2YWx1ZUF0SW5kZXhPckRlZmF1bHQgPSBoZWxwZXJzLnZhbHVlQXRJbmRleE9yRGVmYXVsdDsNCgkJCQkJCXZhciBhcmNPcHRzID0gY2hhcnQub3B0aW9ucy5lbGVtZW50cy5hcmM7DQoJCQkJCQl2YXIgZmlsbCA9IGN1c3RvbS5iYWNrZ3JvdW5kQ29sb3IgPyBjdXN0b20uYmFja2dyb3VuZENvbG9yIDogdmFsdWVBdEluZGV4T3JEZWZhdWx0KGRzLmJhY2tncm91bmRDb2xvciwgaSwgYXJjT3B0cy5iYWNrZ3JvdW5kQ29sb3IpOw0KCQkJCQkJdmFyIHN0cm9rZSA9IGN1c3RvbS5ib3JkZXJDb2xvciA/IGN1c3RvbS5ib3JkZXJDb2xvciA6IHZhbHVlQXRJbmRleE9yRGVmYXVsdChkcy5ib3JkZXJDb2xvciwgaSwgYXJjT3B0cy5ib3JkZXJDb2xvcik7DQoJCQkJCQl2YXIgYncgPSBjdXN0b20uYm9yZGVyV2lkdGggPyBjdXN0b20uYm9yZGVyV2lkdGggOiB2YWx1ZUF0SW5kZXhPckRlZmF1bHQoZHMuYm9yZGVyV2lkdGgsIGksIGFyY09wdHMuYm9yZGVyV2lkdGgpOw0KDQoJCQkJCQlyZXR1cm4gew0KCQkJCQkJCXRleHQ6IGxhYmVsLA0KCQkJCQkJCWZpbGxTdHlsZTogZmlsbCwNCgkJCQkJCQlzdHJva2VTdHlsZTogc3Ryb2tlLA0KCQkJCQkJCWxpbmVXaWR0aDogYncsDQoJCQkJCQkJaGlkZGVuOiBpc05hTihkcy5kYXRhW2ldKSB8fCBtZXRhLmRhdGFbaV0uaGlkZGVuLA0KDQoJCQkJCQkJLy8gRXh0cmEgZGF0YSB1c2VkIGZvciB0b2dnbGluZyB0aGUgY29ycmVjdCBpdGVtDQoJCQkJCQkJaW5kZXg6IGkNCgkJCQkJCX07DQoJCQkJCX0pOw0KCQkJCX0NCgkJCQlyZXR1cm4gW107DQoJCQl9DQoJCX0sDQoNCgkJb25DbGljazogZnVuY3Rpb24oZSwgbGVnZW5kSXRlbSkgew0KCQkJdmFyIGluZGV4ID0gbGVnZW5kSXRlbS5pbmRleDsNCgkJCXZhciBjaGFydCA9IHRoaXMuY2hhcnQ7DQoJCQl2YXIgaSwgaWxlbiwgbWV0YTsNCg0KCQkJZm9yIChpID0gMCwgaWxlbiA9IChjaGFydC5kYXRhLmRhdGFzZXRzIHx8IFtdKS5sZW5ndGg7IGkgPCBpbGVuOyArK2kpIHsNCgkJCQltZXRhID0gY2hhcnQuZ2V0RGF0YXNldE1ldGEoaSk7DQoJCQkJbWV0YS5kYXRhW2luZGV4XS5oaWRkZW4gPSAhbWV0YS5kYXRhW2luZGV4XS5oaWRkZW47DQoJCQl9DQoNCgkJCWNoYXJ0LnVwZGF0ZSgpOw0KCQl9DQoJfSwNCg0KCS8vIE5lZWQgdG8gb3ZlcnJpZGUgdGhlc2UgdG8gZ2l2ZSBhIG5pY2UgZGVmYXVsdA0KCXRvb2x0aXBzOiB7DQoJCWNhbGxiYWNrczogew0KCQkJdGl0bGU6IGZ1bmN0aW9uKCkgew0KCQkJCXJldHVybiAnJzsNCgkJCX0sDQoJCQlsYWJlbDogZnVuY3Rpb24oaXRlbSwgZGF0YSkgew0KCQkJCXJldHVybiBkYXRhLmxhYmVsc1tpdGVtLmluZGV4XSArICc6ICcgKyBpdGVtLnlMYWJlbDsNCgkJCX0NCgkJfQ0KCX0NCn0pOw0KDQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKENoYXJ0KSB7DQoNCglDaGFydC5jb250cm9sbGVycy5wb2xhckFyZWEgPSBDaGFydC5EYXRhc2V0Q29udHJvbGxlci5leHRlbmQoew0KDQoJCWRhdGFFbGVtZW50VHlwZTogZWxlbWVudHMuQXJjLA0KDQoJCWxpbmtTY2FsZXM6IGhlbHBlcnMubm9vcCwNCg0KCQl1cGRhdGU6IGZ1bmN0aW9uKHJlc2V0KSB7DQoJCQl2YXIgbWUgPSB0aGlzOw0KCQkJdmFyIGNoYXJ0ID0gbWUuY2hhcnQ7DQoJCQl2YXIgY2hhcnRBcmVhID0gY2hhcnQuY2hhcnRBcmVhOw0KCQkJdmFyIG1ldGEgPSBtZS5nZXRNZXRhKCk7DQoJCQl2YXIgb3B0cyA9IGNoYXJ0Lm9wdGlvbnM7DQoJCQl2YXIgYXJjT3B0cyA9IG9wdHMuZWxlbWVudHMuYXJjOw0KCQkJdmFyIG1pblNpemUgPSBNYXRoLm1pbihjaGFydEFyZWEucmlnaHQgLSBjaGFydEFyZWEubGVmdCwgY2hhcnRBcmVhLmJvdHRvbSAtIGNoYXJ0QXJlYS50b3ApOw0KCQkJY2hhcnQub3V0ZXJSYWRpdXMgPSBNYXRoLm1heCgobWluU2l6ZSAtIGFyY09wdHMuYm9yZGVyV2lkdGggLyAyKSAvIDIsIDApOw0KCQkJY2hhcnQuaW5uZXJSYWRpdXMgPSBNYXRoLm1heChvcHRzLmN1dG91dFBlcmNlbnRhZ2UgPyAoY2hhcnQub3V0ZXJSYWRpdXMgLyAxMDApICogKG9wdHMuY3V0b3V0UGVyY2VudGFnZSkgOiAxLCAwKTsNCgkJCWNoYXJ0LnJhZGl1c0xlbmd0aCA9IChjaGFydC5vdXRlclJhZGl1cyAtIGNoYXJ0LmlubmVyUmFkaXVzKSAvIGNoYXJ0LmdldFZpc2libGVEYXRhc2V0Q291bnQoKTsNCg0KCQkJbWUub3V0ZXJSYWRpdXMgPSBjaGFydC5vdXRlclJhZGl1cyAtIChjaGFydC5yYWRpdXNMZW5ndGggKiBtZS5pbmRleCk7DQoJCQltZS5pbm5lclJhZGl1cyA9IG1lLm91dGVyUmFkaXVzIC0gY2hhcnQucmFkaXVzTGVuZ3RoOw0KDQoJCQltZXRhLmNvdW50ID0gbWUuY291bnRWaXNpYmxlRWxlbWVudHMoKTsNCg0KCQkJaGVscGVycy5lYWNoKG1ldGEuZGF0YSwgZnVuY3Rpb24oYXJjLCBpbmRleCkgew0KCQkJCW1lLnVwZGF0ZUVsZW1lbnQoYXJjLCBpbmRleCwgcmVzZXQpOw0KCQkJfSk7DQoJCX0sDQoNCgkJdXBkYXRlRWxlbWVudDogZnVuY3Rpb24oYXJjLCBpbmRleCwgcmVzZXQpIHsNCgkJCXZhciBtZSA9IHRoaXM7DQoJCQl2YXIgY2hhcnQgPSBtZS5jaGFydDsNCgkJCXZhciBkYXRhc2V0ID0gbWUuZ2V0RGF0YXNldCgpOw0KCQkJdmFyIG9wdHMgPSBjaGFydC5vcHRpb25zOw0KCQkJdmFyIGFuaW1hdGlvbk9wdHMgPSBvcHRzLmFuaW1hdGlvbjsNCgkJCXZhciBzY2FsZSA9IGNoYXJ0LnNjYWxlOw0KCQkJdmFyIGxhYmVscyA9IGNoYXJ0LmRhdGEubGFiZWxzOw0KDQoJCQl2YXIgY2lyY3VtZmVyZW5jZSA9IG1lLmNhbGN1bGF0ZUNpcmN1bWZlcmVuY2UoZGF0YXNldC5kYXRhW2luZGV4XSk7DQoJCQl2YXIgY2VudGVyWCA9IHNjYWxlLnhDZW50ZXI7DQoJCQl2YXIgY2VudGVyWSA9IHNjYWxlLnlDZW50ZXI7DQoNCgkJCS8vIElmIHRoZXJlIGlzIE5hTiBkYXRhIGJlZm9yZSB1cywgd2UgbmVlZCB0byBjYWxjdWxhdGUgdGhlIHN0YXJ0aW5nIGFuZ2xlIGNvcnJlY3RseS4NCgkJCS8vIFdlIGNvdWxkIGJlIHdheSBtb3JlIGVmZmljaWVudCBoZXJlLCBidXQgaXRzIHVubGlrZWx5IHRoYXQgdGhlIHBvbGFyIGFyZWEgY2hhcnQgd2lsbCBoYXZlIGEgbG90IG9mIGRhdGENCgkJCXZhciB2aXNpYmxlQ291bnQgPSAwOw0KCQkJdmFyIG1ldGEgPSBtZS5nZXRNZXRhKCk7DQoJCQlmb3IgKHZhciBpID0gMDsgaSA8IGluZGV4OyArK2kpIHsNCgkJCQlpZiAoIWlzTmFOKGRhdGFzZXQuZGF0YVtpXSkgJiYgIW1ldGEuZGF0YVtpXS5oaWRkZW4pIHsNCgkJCQkJKyt2aXNpYmxlQ291bnQ7DQoJCQkJfQ0KCQkJfQ0KDQoJCQkvLyB2YXIgbmVnSGFsZlBJID0gLTAuNSAqIE1hdGguUEk7DQoJCQl2YXIgZGF0YXNldFN0YXJ0QW5nbGUgPSBvcHRzLnN0YXJ0QW5nbGU7DQoJCQl2YXIgZGlzdGFuY2UgPSBhcmMuaGlkZGVuID8gMCA6IHNjYWxlLmdldERpc3RhbmNlRnJvbUNlbnRlckZvclZhbHVlKGRhdGFzZXQuZGF0YVtpbmRleF0pOw0KCQkJdmFyIHN0YXJ0QW5nbGUgPSBkYXRhc2V0U3RhcnRBbmdsZSArIChjaXJjdW1mZXJlbmNlICogdmlzaWJsZUNvdW50KTsNCgkJCXZhciBlbmRBbmdsZSA9IHN0YXJ0QW5nbGUgKyAoYXJjLmhpZGRlbiA/IDAgOiBjaXJjdW1mZXJlbmNlKTsNCg0KCQkJdmFyIHJlc2V0UmFkaXVzID0gYW5pbWF0aW9uT3B0cy5hbmltYXRlU2NhbGUgPyAwIDogc2NhbGUuZ2V0RGlzdGFuY2VGcm9tQ2VudGVyRm9yVmFsdWUoZGF0YXNldC5kYXRhW2luZGV4XSk7DQoNCgkJCWhlbHBlcnMuZXh0ZW5kKGFyYywgew0KCQkJCS8vIFV0aWxpdHkNCgkJCQlfZGF0YXNldEluZGV4OiBtZS5pbmRleCwNCgkJCQlfaW5kZXg6IGluZGV4LA0KCQkJCV9zY2FsZTogc2NhbGUsDQoNCgkJCQkvLyBEZXNpcmVkIHZpZXcgcHJvcGVydGllcw0KCQkJCV9tb2RlbDogew0KCQkJCQl4OiBjZW50ZXJYLA0KCQkJCQl5OiBjZW50ZXJZLA0KCQkJCQlpbm5lclJhZGl1czogMCwNCgkJCQkJb3V0ZXJSYWRpdXM6IHJlc2V0ID8gcmVzZXRSYWRpdXMgOiBkaXN0YW5jZSwNCgkJCQkJc3RhcnRBbmdsZTogcmVzZXQgJiYgYW5pbWF0aW9uT3B0cy5hbmltYXRlUm90YXRlID8gZGF0YXNldFN0YXJ0QW5nbGUgOiBzdGFydEFuZ2xlLA0KCQkJCQllbmRBbmdsZTogcmVzZXQgJiYgYW5pbWF0aW9uT3B0cy5hbmltYXRlUm90YXRlID8gZGF0YXNldFN0YXJ0QW5nbGUgOiBlbmRBbmdsZSwNCgkJCQkJbGFiZWw6IGhlbHBlcnMudmFsdWVBdEluZGV4T3JEZWZhdWx0KGxhYmVscywgaW5kZXgsIGxhYmVsc1tpbmRleF0pDQoJCQkJfQ0KCQkJfSk7DQoNCgkJCS8vIEFwcGx5IGJvcmRlciBhbmQgZmlsbCBzdHlsZQ0KCQkJbWUucmVtb3ZlSG92ZXJTdHlsZShhcmMpOw0KDQoJCQlhcmMucGl2b3QoKTsNCgkJfSwNCg0KCQlyZW1vdmVIb3ZlclN0eWxlOiBmdW5jdGlvbihhcmMpIHsNCgkJCUNoYXJ0LkRhdGFzZXRDb250cm9sbGVyLnByb3RvdHlwZS5yZW1vdmVIb3ZlclN0eWxlLmNhbGwodGhpcywgYXJjLCB0aGlzLmNoYXJ0Lm9wdGlvbnMuZWxlbWVudHMuYXJjKTsNCgkJfSwNCg0KCQljb3VudFZpc2libGVFbGVtZW50czogZnVuY3Rpb24oKSB7DQoJCQl2YXIgZGF0YXNldCA9IHRoaXMuZ2V0RGF0YXNldCgpOw0KCQkJdmFyIG1ldGEgPSB0aGlzLmdldE1ldGEoKTsNCgkJCXZhciBjb3VudCA9IDA7DQoNCgkJCWhlbHBlcnMuZWFjaChtZXRhLmRhdGEsIGZ1bmN0aW9uKGVsZW1lbnQsIGluZGV4KSB7DQoJCQkJaWYgKCFpc05hTihkYXRhc2V0LmRhdGFbaW5kZXhdKSAmJiAhZWxlbWVudC5oaWRkZW4pIHsNCgkJCQkJY291bnQrKzsNCgkJCQl9DQoJCQl9KTsNCg0KCQkJcmV0dXJuIGNvdW50Ow0KCQl9LA0KDQoJCWNhbGN1bGF0ZUNpcmN1bWZlcmVuY2U6IGZ1bmN0aW9uKHZhbHVlKSB7DQoJCQl2YXIgY291bnQgPSB0aGlzLmdldE1ldGEoKS5jb3VudDsNCgkJCWlmIChjb3VudCA+IDAgJiYgIWlzTmFOKHZhbHVlKSkgew0KCQkJCXJldHVybiAoMiAqIE1hdGguUEkpIC8gY291bnQ7DQoJCQl9DQoJCQlyZXR1cm4gMDsNCgkJfQ0KCX0pOw0KfTsNCg0KfSx7IjI1IjoyNSwiNDAiOjQwLCI0NSI6NDV9XSwyMDpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7DQondXNlIHN0cmljdCc7DQoNCnZhciBkZWZhdWx0cyA9IHJlcXVpcmUoMjUpOw0KdmFyIGVsZW1lbnRzID0gcmVxdWlyZSg0MCk7DQp2YXIgaGVscGVycyA9IHJlcXVpcmUoNDUpOw0KDQpkZWZhdWx0cy5fc2V0KCdyYWRhcicsIHsNCglzY2FsZTogew0KCQl0eXBlOiAncmFkaWFsTGluZWFyJw0KCX0sDQoJZWxlbWVudHM6IHsNCgkJbGluZTogew0KCQkJdGVuc2lvbjogMCAvLyBubyBiZXppZXIgaW4gcmFkYXINCgkJfQ0KCX0NCn0pOw0KDQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKENoYXJ0KSB7DQoNCglDaGFydC5jb250cm9sbGVycy5yYWRhciA9IENoYXJ0LkRhdGFzZXRDb250cm9sbGVyLmV4dGVuZCh7DQoNCgkJZGF0YXNldEVsZW1lbnRUeXBlOiBlbGVtZW50cy5MaW5lLA0KDQoJCWRhdGFFbGVtZW50VHlwZTogZWxlbWVudHMuUG9pbnQsDQoNCgkJbGlua1NjYWxlczogaGVscGVycy5ub29wLA0KDQoJCXVwZGF0ZTogZnVuY3Rpb24ocmVzZXQpIHsNCgkJCXZhciBtZSA9IHRoaXM7DQoJCQl2YXIgbWV0YSA9IG1lLmdldE1ldGEoKTsNCgkJCXZhciBsaW5lID0gbWV0YS5kYXRhc2V0Ow0KCQkJdmFyIHBvaW50cyA9IG1ldGEuZGF0YTsNCgkJCXZhciBjdXN0b20gPSBsaW5lLmN1c3RvbSB8fCB7fTsNCgkJCXZhciBkYXRhc2V0ID0gbWUuZ2V0RGF0YXNldCgpOw0KCQkJdmFyIGxpbmVFbGVtZW50T3B0aW9ucyA9IG1lLmNoYXJ0Lm9wdGlvbnMuZWxlbWVudHMubGluZTsNCgkJCXZhciBzY2FsZSA9IG1lLmNoYXJ0LnNjYWxlOw0KDQoJCQkvLyBDb21wYXRpYmlsaXR5OiBJZiB0aGUgcHJvcGVydGllcyBhcmUgZGVmaW5lZCB3aXRoIG9ubHkgdGhlIG9sZCBuYW1lLCB1c2UgdGhvc2UgdmFsdWVzDQoJCQlpZiAoKGRhdGFzZXQudGVuc2lvbiAhPT0gdW5kZWZpbmVkKSAmJiAoZGF0YXNldC5saW5lVGVuc2lvbiA9PT0gdW5kZWZpbmVkKSkgew0KCQkJCWRhdGFzZXQubGluZVRlbnNpb24gPSBkYXRhc2V0LnRlbnNpb247DQoJCQl9DQoNCgkJCWhlbHBlcnMuZXh0ZW5kKG1ldGEuZGF0YXNldCwgew0KCQkJCS8vIFV0aWxpdHkNCgkJCQlfZGF0YXNldEluZGV4OiBtZS5pbmRleCwNCgkJCQlfc2NhbGU6IHNjYWxlLA0KCQkJCS8vIERhdGENCgkJCQlfY2hpbGRyZW46IHBvaW50cywNCgkJCQlfbG9vcDogdHJ1ZSwNCgkJCQkvLyBNb2RlbA0KCQkJCV9tb2RlbDogew0KCQkJCQkvLyBBcHBlYXJhbmNlDQoJCQkJCXRlbnNpb246IGN1c3RvbS50ZW5zaW9uID8gY3VzdG9tLnRlbnNpb24gOiBoZWxwZXJzLnZhbHVlT3JEZWZhdWx0KGRhdGFzZXQubGluZVRlbnNpb24sIGxpbmVFbGVtZW50T3B0aW9ucy50ZW5zaW9uKSwNCgkJCQkJYmFja2dyb3VuZENvbG9yOiBjdXN0b20uYmFja2dyb3VuZENvbG9yID8gY3VzdG9tLmJhY2tncm91bmRDb2xvciA6IChkYXRhc2V0LmJhY2tncm91bmRDb2xvciB8fCBsaW5lRWxlbWVudE9wdGlvbnMuYmFja2dyb3VuZENvbG9yKSwNCgkJCQkJYm9yZGVyV2lkdGg6IGN1c3RvbS5ib3JkZXJXaWR0aCA/IGN1c3RvbS5ib3JkZXJXaWR0aCA6IChkYXRhc2V0LmJvcmRlcldpZHRoIHx8IGxpbmVFbGVtZW50T3B0aW9ucy5ib3JkZXJXaWR0aCksDQoJCQkJCWJvcmRlckNvbG9yOiBjdXN0b20uYm9yZGVyQ29sb3IgPyBjdXN0b20uYm9yZGVyQ29sb3IgOiAoZGF0YXNldC5ib3JkZXJDb2xvciB8fCBsaW5lRWxlbWVudE9wdGlvbnMuYm9yZGVyQ29sb3IpLA0KCQkJCQlmaWxsOiBjdXN0b20uZmlsbCA/IGN1c3RvbS5maWxsIDogKGRhdGFzZXQuZmlsbCAhPT0gdW5kZWZpbmVkID8gZGF0YXNldC5maWxsIDogbGluZUVsZW1lbnRPcHRpb25zLmZpbGwpLA0KCQkJCQlib3JkZXJDYXBTdHlsZTogY3VzdG9tLmJvcmRlckNhcFN0eWxlID8gY3VzdG9tLmJvcmRlckNhcFN0eWxlIDogKGRhdGFzZXQuYm9yZGVyQ2FwU3R5bGUgfHwgbGluZUVsZW1lbnRPcHRpb25zLmJvcmRlckNhcFN0eWxlKSwNCgkJCQkJYm9yZGVyRGFzaDogY3VzdG9tLmJvcmRlckRhc2ggPyBjdXN0b20uYm9yZGVyRGFzaCA6IChkYXRhc2V0LmJvcmRlckRhc2ggfHwgbGluZUVsZW1lbnRPcHRpb25zLmJvcmRlckRhc2gpLA0KCQkJCQlib3JkZXJEYXNoT2Zmc2V0OiBjdXN0b20uYm9yZGVyRGFzaE9mZnNldCA/IGN1c3RvbS5ib3JkZXJEYXNoT2Zmc2V0IDogKGRhdGFzZXQuYm9yZGVyRGFzaE9mZnNldCB8fCBsaW5lRWxlbWVudE9wdGlvbnMuYm9yZGVyRGFzaE9mZnNldCksDQoJCQkJCWJvcmRlckpvaW5TdHlsZTogY3VzdG9tLmJvcmRlckpvaW5TdHlsZSA/IGN1c3RvbS5ib3JkZXJKb2luU3R5bGUgOiAoZGF0YXNldC5ib3JkZXJKb2luU3R5bGUgfHwgbGluZUVsZW1lbnRPcHRpb25zLmJvcmRlckpvaW5TdHlsZSksDQoJCQkJfQ0KCQkJfSk7DQoNCgkJCW1ldGEuZGF0YXNldC5waXZvdCgpOw0KDQoJCQkvLyBVcGRhdGUgUG9pbnRzDQoJCQloZWxwZXJzLmVhY2gocG9pbnRzLCBmdW5jdGlvbihwb2ludCwgaW5kZXgpIHsNCgkJCQltZS51cGRhdGVFbGVtZW50KHBvaW50LCBpbmRleCwgcmVzZXQpOw0KCQkJfSwgbWUpOw0KDQoJCQkvLyBVcGRhdGUgYmV6aWVyIGNvbnRyb2wgcG9pbnRzDQoJCQltZS51cGRhdGVCZXppZXJDb250cm9sUG9pbnRzKCk7DQoJCX0sDQoJCXVwZGF0ZUVsZW1lbnQ6IGZ1bmN0aW9uKHBvaW50LCBpbmRleCwgcmVzZXQpIHsNCgkJCXZhciBtZSA9IHRoaXM7DQoJCQl2YXIgY3VzdG9tID0gcG9pbnQuY3VzdG9tIHx8IHt9Ow0KCQkJdmFyIGRhdGFzZXQgPSBtZS5nZXREYXRhc2V0KCk7DQoJCQl2YXIgc2NhbGUgPSBtZS5jaGFydC5zY2FsZTsNCgkJCXZhciBwb2ludEVsZW1lbnRPcHRpb25zID0gbWUuY2hhcnQub3B0aW9ucy5lbGVtZW50cy5wb2ludDsNCgkJCXZhciBwb2ludFBvc2l0aW9uID0gc2NhbGUuZ2V0UG9pbnRQb3NpdGlvbkZvclZhbHVlKGluZGV4LCBkYXRhc2V0LmRhdGFbaW5kZXhdKTsNCg0KCQkJLy8gQ29tcGF0aWJpbGl0eTogSWYgdGhlIHByb3BlcnRpZXMgYXJlIGRlZmluZWQgd2l0aCBvbmx5IHRoZSBvbGQgbmFtZSwgdXNlIHRob3NlIHZhbHVlcw0KCQkJaWYgKChkYXRhc2V0LnJhZGl1cyAhPT0gdW5kZWZpbmVkKSAmJiAoZGF0YXNldC5wb2ludFJhZGl1cyA9PT0gdW5kZWZpbmVkKSkgew0KCQkJCWRhdGFzZXQucG9pbnRSYWRpdXMgPSBkYXRhc2V0LnJhZGl1czsNCgkJCX0NCgkJCWlmICgoZGF0YXNldC5oaXRSYWRpdXMgIT09IHVuZGVmaW5lZCkgJiYgKGRhdGFzZXQucG9pbnRIaXRSYWRpdXMgPT09IHVuZGVmaW5lZCkpIHsNCgkJCQlkYXRhc2V0LnBvaW50SGl0UmFkaXVzID0gZGF0YXNldC5oaXRSYWRpdXM7DQoJCQl9DQoNCgkJCWhlbHBlcnMuZXh0ZW5kKHBvaW50LCB7DQoJCQkJLy8gVXRpbGl0eQ0KCQkJCV9kYXRhc2V0SW5kZXg6IG1lLmluZGV4LA0KCQkJCV9pbmRleDogaW5kZXgsDQoJCQkJX3NjYWxlOiBzY2FsZSwNCg0KCQkJCS8vIERlc2lyZWQgdmlldyBwcm9wZXJ0aWVzDQoJCQkJX21vZGVsOiB7DQoJCQkJCXg6IHJlc2V0ID8gc2NhbGUueENlbnRlciA6IHBvaW50UG9zaXRpb24ueCwgLy8gdmFsdWUgbm90IHVzZWQgaW4gZGF0YXNldCBzY2FsZSwgYnV0IHdlIHdhbnQgYSBjb25zaXN0ZW50IEFQSSBiZXR3ZWVuIHNjYWxlcw0KCQkJCQl5OiByZXNldCA/IHNjYWxlLnlDZW50ZXIgOiBwb2ludFBvc2l0aW9uLnksDQoNCgkJCQkJLy8gQXBwZWFyYW5jZQ0KCQkJCQl0ZW5zaW9uOiBjdXN0b20udGVuc2lvbiA/IGN1c3RvbS50ZW5zaW9uIDogaGVscGVycy52YWx1ZU9yRGVmYXVsdChkYXRhc2V0LmxpbmVUZW5zaW9uLCBtZS5jaGFydC5vcHRpb25zLmVsZW1lbnRzLmxpbmUudGVuc2lvbiksDQoJCQkJCXJhZGl1czogY3VzdG9tLnJhZGl1cyA/IGN1c3RvbS5yYWRpdXMgOiBoZWxwZXJzLnZhbHVlQXRJbmRleE9yRGVmYXVsdChkYXRhc2V0LnBvaW50UmFkaXVzLCBpbmRleCwgcG9pbnRFbGVtZW50T3B0aW9ucy5yYWRpdXMpLA0KCQkJCQliYWNrZ3JvdW5kQ29sb3I6IGN1c3RvbS5iYWNrZ3JvdW5kQ29sb3IgPyBjdXN0b20uYmFja2dyb3VuZENvbG9yIDogaGVscGVycy52YWx1ZUF0SW5kZXhPckRlZmF1bHQoZGF0YXNldC5wb2ludEJhY2tncm91bmRDb2xvciwgaW5kZXgsIHBvaW50RWxlbWVudE9wdGlvbnMuYmFja2dyb3VuZENvbG9yKSwNCgkJCQkJYm9yZGVyQ29sb3I6IGN1c3RvbS5ib3JkZXJDb2xvciA/IGN1c3RvbS5ib3JkZXJDb2xvciA6IGhlbHBlcnMudmFsdWVBdEluZGV4T3JEZWZhdWx0KGRhdGFzZXQucG9pbnRCb3JkZXJDb2xvciwgaW5kZXgsIHBvaW50RWxlbWVudE9wdGlvbnMuYm9yZGVyQ29sb3IpLA0KCQkJCQlib3JkZXJXaWR0aDogY3VzdG9tLmJvcmRlcldpZHRoID8gY3VzdG9tLmJvcmRlcldpZHRoIDogaGVscGVycy52YWx1ZUF0SW5kZXhPckRlZmF1bHQoZGF0YXNldC5wb2ludEJvcmRlcldpZHRoLCBpbmRleCwgcG9pbnRFbGVtZW50T3B0aW9ucy5ib3JkZXJXaWR0aCksDQoJCQkJCXBvaW50U3R5bGU6IGN1c3RvbS5wb2ludFN0eWxlID8gY3VzdG9tLnBvaW50U3R5bGUgOiBoZWxwZXJzLnZhbHVlQXRJbmRleE9yRGVmYXVsdChkYXRhc2V0LnBvaW50U3R5bGUsIGluZGV4LCBwb2ludEVsZW1lbnRPcHRpb25zLnBvaW50U3R5bGUpLA0KDQoJCQkJCS8vIFRvb2x0aXANCgkJCQkJaGl0UmFkaXVzOiBjdXN0b20uaGl0UmFkaXVzID8gY3VzdG9tLmhpdFJhZGl1cyA6IGhlbHBlcnMudmFsdWVBdEluZGV4T3JEZWZhdWx0KGRhdGFzZXQucG9pbnRIaXRSYWRpdXMsIGluZGV4LCBwb2ludEVsZW1lbnRPcHRpb25zLmhpdFJhZGl1cykNCgkJCQl9DQoJCQl9KTsNCg0KCQkJcG9pbnQuX21vZGVsLnNraXAgPSBjdXN0b20uc2tpcCA/IGN1c3RvbS5za2lwIDogKGlzTmFOKHBvaW50Ll9tb2RlbC54KSB8fCBpc05hTihwb2ludC5fbW9kZWwueSkpOw0KCQl9LA0KCQl1cGRhdGVCZXppZXJDb250cm9sUG9pbnRzOiBmdW5jdGlvbigpIHsNCgkJCXZhciBjaGFydEFyZWEgPSB0aGlzLmNoYXJ0LmNoYXJ0QXJlYTsNCgkJCXZhciBtZXRhID0gdGhpcy5nZXRNZXRhKCk7DQoNCgkJCWhlbHBlcnMuZWFjaChtZXRhLmRhdGEsIGZ1bmN0aW9uKHBvaW50LCBpbmRleCkgew0KCQkJCXZhciBtb2RlbCA9IHBvaW50Ll9tb2RlbDsNCgkJCQl2YXIgY29udHJvbFBvaW50cyA9IGhlbHBlcnMuc3BsaW5lQ3VydmUoDQoJCQkJCWhlbHBlcnMucHJldmlvdXNJdGVtKG1ldGEuZGF0YSwgaW5kZXgsIHRydWUpLl9tb2RlbCwNCgkJCQkJbW9kZWwsDQoJCQkJCWhlbHBlcnMubmV4dEl0ZW0obWV0YS5kYXRhLCBpbmRleCwgdHJ1ZSkuX21vZGVsLA0KCQkJCQltb2RlbC50ZW5zaW9uDQoJCQkJKTsNCg0KCQkJCS8vIFByZXZlbnQgdGhlIGJlemllciBnb2luZyBvdXRzaWRlIG9mIHRoZSBib3VuZHMgb2YgdGhlIGdyYXBoDQoJCQkJbW9kZWwuY29udHJvbFBvaW50UHJldmlvdXNYID0gTWF0aC5tYXgoTWF0aC5taW4oY29udHJvbFBvaW50cy5wcmV2aW91cy54LCBjaGFydEFyZWEucmlnaHQpLCBjaGFydEFyZWEubGVmdCk7DQoJCQkJbW9kZWwuY29udHJvbFBvaW50UHJldmlvdXNZID0gTWF0aC5tYXgoTWF0aC5taW4oY29udHJvbFBvaW50cy5wcmV2aW91cy55LCBjaGFydEFyZWEuYm90dG9tKSwgY2hhcnRBcmVhLnRvcCk7DQoNCgkJCQltb2RlbC5jb250cm9sUG9pbnROZXh0WCA9IE1hdGgubWF4KE1hdGgubWluKGNvbnRyb2xQb2ludHMubmV4dC54LCBjaGFydEFyZWEucmlnaHQpLCBjaGFydEFyZWEubGVmdCk7DQoJCQkJbW9kZWwuY29udHJvbFBvaW50TmV4dFkgPSBNYXRoLm1heChNYXRoLm1pbihjb250cm9sUG9pbnRzLm5leHQueSwgY2hhcnRBcmVhLmJvdHRvbSksIGNoYXJ0QXJlYS50b3ApOw0KDQoJCQkJLy8gTm93IHBpdm90IHRoZSBwb2ludCBmb3IgYW5pbWF0aW9uDQoJCQkJcG9pbnQucGl2b3QoKTsNCgkJCX0pOw0KCQl9LA0KDQoJCXNldEhvdmVyU3R5bGU6IGZ1bmN0aW9uKHBvaW50KSB7DQoJCQkvLyBQb2ludA0KCQkJdmFyIGRhdGFzZXQgPSB0aGlzLmNoYXJ0LmRhdGEuZGF0YXNldHNbcG9pbnQuX2RhdGFzZXRJbmRleF07DQoJCQl2YXIgY3VzdG9tID0gcG9pbnQuY3VzdG9tIHx8IHt9Ow0KCQkJdmFyIGluZGV4ID0gcG9pbnQuX2luZGV4Ow0KCQkJdmFyIG1vZGVsID0gcG9pbnQuX21vZGVsOw0KDQoJCQltb2RlbC5yYWRpdXMgPSBjdXN0b20uaG92ZXJSYWRpdXMgPyBjdXN0b20uaG92ZXJSYWRpdXMgOiBoZWxwZXJzLnZhbHVlQXRJbmRleE9yRGVmYXVsdChkYXRhc2V0LnBvaW50SG92ZXJSYWRpdXMsIGluZGV4LCB0aGlzLmNoYXJ0Lm9wdGlvbnMuZWxlbWVudHMucG9pbnQuaG92ZXJSYWRpdXMpOw0KCQkJbW9kZWwuYmFja2dyb3VuZENvbG9yID0gY3VzdG9tLmhvdmVyQmFja2dyb3VuZENvbG9yID8gY3VzdG9tLmhvdmVyQmFja2dyb3VuZENvbG9yIDogaGVscGVycy52YWx1ZUF0SW5kZXhPckRlZmF1bHQoZGF0YXNldC5wb2ludEhvdmVyQmFja2dyb3VuZENvbG9yLCBpbmRleCwgaGVscGVycy5nZXRIb3ZlckNvbG9yKG1vZGVsLmJhY2tncm91bmRDb2xvcikpOw0KCQkJbW9kZWwuYm9yZGVyQ29sb3IgPSBjdXN0b20uaG92ZXJCb3JkZXJDb2xvciA/IGN1c3RvbS5ob3ZlckJvcmRlckNvbG9yIDogaGVscGVycy52YWx1ZUF0SW5kZXhPckRlZmF1bHQoZGF0YXNldC5wb2ludEhvdmVyQm9yZGVyQ29sb3IsIGluZGV4LCBoZWxwZXJzLmdldEhvdmVyQ29sb3IobW9kZWwuYm9yZGVyQ29sb3IpKTsNCgkJCW1vZGVsLmJvcmRlcldpZHRoID0gY3VzdG9tLmhvdmVyQm9yZGVyV2lkdGggPyBjdXN0b20uaG92ZXJCb3JkZXJXaWR0aCA6IGhlbHBlcnMudmFsdWVBdEluZGV4T3JEZWZhdWx0KGRhdGFzZXQucG9pbnRIb3ZlckJvcmRlcldpZHRoLCBpbmRleCwgbW9kZWwuYm9yZGVyV2lkdGgpOw0KCQl9LA0KDQoJCXJlbW92ZUhvdmVyU3R5bGU6IGZ1bmN0aW9uKHBvaW50KSB7DQoJCQl2YXIgZGF0YXNldCA9IHRoaXMuY2hhcnQuZGF0YS5kYXRhc2V0c1twb2ludC5fZGF0YXNldEluZGV4XTsNCgkJCXZhciBjdXN0b20gPSBwb2ludC5jdXN0b20gfHwge307DQoJCQl2YXIgaW5kZXggPSBwb2ludC5faW5kZXg7DQoJCQl2YXIgbW9kZWwgPSBwb2ludC5fbW9kZWw7DQoJCQl2YXIgcG9pbnRFbGVtZW50T3B0aW9ucyA9IHRoaXMuY2hhcnQub3B0aW9ucy5lbGVtZW50cy5wb2ludDsNCg0KCQkJbW9kZWwucmFkaXVzID0gY3VzdG9tLnJhZGl1cyA/IGN1c3RvbS5yYWRpdXMgOiBoZWxwZXJzLnZhbHVlQXRJbmRleE9yRGVmYXVsdChkYXRhc2V0LnBvaW50UmFkaXVzLCBpbmRleCwgcG9pbnRFbGVtZW50T3B0aW9ucy5yYWRpdXMpOw0KCQkJbW9kZWwuYmFja2dyb3VuZENvbG9yID0gY3VzdG9tLmJhY2tncm91bmRDb2xvciA/IGN1c3RvbS5iYWNrZ3JvdW5kQ29sb3IgOiBoZWxwZXJzLnZhbHVlQXRJbmRleE9yRGVmYXVsdChkYXRhc2V0LnBvaW50QmFja2dyb3VuZENvbG9yLCBpbmRleCwgcG9pbnRFbGVtZW50T3B0aW9ucy5iYWNrZ3JvdW5kQ29sb3IpOw0KCQkJbW9kZWwuYm9yZGVyQ29sb3IgPSBjdXN0b20uYm9yZGVyQ29sb3IgPyBjdXN0b20uYm9yZGVyQ29sb3IgOiBoZWxwZXJzLnZhbHVlQXRJbmRleE9yRGVmYXVsdChkYXRhc2V0LnBvaW50Qm9yZGVyQ29sb3IsIGluZGV4LCBwb2ludEVsZW1lbnRPcHRpb25zLmJvcmRlckNvbG9yKTsNCgkJCW1vZGVsLmJvcmRlcldpZHRoID0gY3VzdG9tLmJvcmRlcldpZHRoID8gY3VzdG9tLmJvcmRlcldpZHRoIDogaGVscGVycy52YWx1ZUF0SW5kZXhPckRlZmF1bHQoZGF0YXNldC5wb2ludEJvcmRlcldpZHRoLCBpbmRleCwgcG9pbnRFbGVtZW50T3B0aW9ucy5ib3JkZXJXaWR0aCk7DQoJCX0NCgl9KTsNCn07DQoNCn0seyIyNSI6MjUsIjQwIjo0MCwiNDUiOjQ1fV0sMjE6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpew0KJ3VzZSBzdHJpY3QnOw0KDQp2YXIgZGVmYXVsdHMgPSByZXF1aXJlKDI1KTsNCg0KZGVmYXVsdHMuX3NldCgnc2NhdHRlcicsIHsNCglob3Zlcjogew0KCQltb2RlOiAnc2luZ2xlJw0KCX0sDQoNCglzY2FsZXM6IHsNCgkJeEF4ZXM6IFt7DQoJCQlpZDogJ3gtYXhpcy0xJywgICAgLy8gbmVlZCBhbiBJRCBzbyBkYXRhc2V0cyBjYW4gcmVmZXJlbmNlIHRoZSBzY2FsZQ0KCQkJdHlwZTogJ2xpbmVhcicsICAgIC8vIHNjYXR0ZXIgc2hvdWxkIG5vdCB1c2UgYSBjYXRlZ29yeSBheGlzDQoJCQlwb3NpdGlvbjogJ2JvdHRvbScNCgkJfV0sDQoJCXlBeGVzOiBbew0KCQkJaWQ6ICd5LWF4aXMtMScsDQoJCQl0eXBlOiAnbGluZWFyJywNCgkJCXBvc2l0aW9uOiAnbGVmdCcNCgkJfV0NCgl9LA0KDQoJc2hvd0xpbmVzOiBmYWxzZSwNCg0KCXRvb2x0aXBzOiB7DQoJCWNhbGxiYWNrczogew0KCQkJdGl0bGU6IGZ1bmN0aW9uKCkgew0KCQkJCXJldHVybiAnJzsgICAgIC8vIGRvZXNuJ3QgbWFrZSBzZW5zZSBmb3Igc2NhdHRlciBzaW5jZSBkYXRhIGFyZSBmb3JtYXR0ZWQgYXMgYSBwb2ludA0KCQkJfSwNCgkJCWxhYmVsOiBmdW5jdGlvbihpdGVtKSB7DQoJCQkJcmV0dXJuICcoJyArIGl0ZW0ueExhYmVsICsgJywgJyArIGl0ZW0ueUxhYmVsICsgJyknOw0KCQkJfQ0KCQl9DQoJfQ0KfSk7DQoNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oQ2hhcnQpIHsNCg0KCS8vIFNjYXR0ZXIgY2hhcnRzIHVzZSBsaW5lIGNvbnRyb2xsZXJzDQoJQ2hhcnQuY29udHJvbGxlcnMuc2NhdHRlciA9IENoYXJ0LmNvbnRyb2xsZXJzLmxpbmU7DQoNCn07DQoNCn0seyIyNSI6MjV9XSwyMjpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7DQovKiBnbG9iYWwgd2luZG93OiBmYWxzZSAqLw0KJ3VzZSBzdHJpY3QnOw0KDQp2YXIgZGVmYXVsdHMgPSByZXF1aXJlKDI1KTsNCnZhciBFbGVtZW50ID0gcmVxdWlyZSgyNik7DQp2YXIgaGVscGVycyA9IHJlcXVpcmUoNDUpOw0KDQpkZWZhdWx0cy5fc2V0KCdnbG9iYWwnLCB7DQoJYW5pbWF0aW9uOiB7DQoJCWR1cmF0aW9uOiAxMDAwLA0KCQllYXNpbmc6ICdlYXNlT3V0UXVhcnQnLA0KCQlvblByb2dyZXNzOiBoZWxwZXJzLm5vb3AsDQoJCW9uQ29tcGxldGU6IGhlbHBlcnMubm9vcA0KCX0NCn0pOw0KDQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKENoYXJ0KSB7DQoNCglDaGFydC5BbmltYXRpb24gPSBFbGVtZW50LmV4dGVuZCh7DQoJCWNoYXJ0OiBudWxsLCAvLyB0aGUgYW5pbWF0aW9uIGFzc29jaWF0ZWQgY2hhcnQgaW5zdGFuY2UNCgkJY3VycmVudFN0ZXA6IDAsIC8vIHRoZSBjdXJyZW50IGFuaW1hdGlvbiBzdGVwDQoJCW51bVN0ZXBzOiA2MCwgLy8gZGVmYXVsdCBudW1iZXIgb2Ygc3RlcHMNCgkJZWFzaW5nOiAnJywgLy8gdGhlIGVhc2luZyB0byB1c2UgZm9yIHRoaXMgYW5pbWF0aW9uDQoJCXJlbmRlcjogbnVsbCwgLy8gcmVuZGVyIGZ1bmN0aW9uIHVzZWQgYnkgdGhlIGFuaW1hdGlvbiBzZXJ2aWNlDQoNCgkJb25BbmltYXRpb25Qcm9ncmVzczogbnVsbCwgLy8gdXNlciBzcGVjaWZpZWQgY2FsbGJhY2sgdG8gZmlyZSBvbiBlYWNoIHN0ZXAgb2YgdGhlIGFuaW1hdGlvbg0KCQlvbkFuaW1hdGlvbkNvbXBsZXRlOiBudWxsLCAvLyB1c2VyIHNwZWNpZmllZCBjYWxsYmFjayB0byBmaXJlIHdoZW4gdGhlIGFuaW1hdGlvbiBmaW5pc2hlcw0KCX0pOw0KDQoJQ2hhcnQuYW5pbWF0aW9uU2VydmljZSA9IHsNCgkJZnJhbWVEdXJhdGlvbjogMTcsDQoJCWFuaW1hdGlvbnM6IFtdLA0KCQlkcm9wRnJhbWVzOiAwLA0KCQlyZXF1ZXN0OiBudWxsLA0KDQoJCS8qKg0KCQkgKiBAcGFyYW0ge0NoYXJ0fSBjaGFydCAtIFRoZSBjaGFydCB0byBhbmltYXRlLg0KCQkgKiBAcGFyYW0ge0NoYXJ0LkFuaW1hdGlvbn0gYW5pbWF0aW9uIC0gVGhlIGFuaW1hdGlvbiB0aGF0IHdlIHdpbGwgYW5pbWF0ZS4NCgkJICogQHBhcmFtIHtOdW1iZXJ9IGR1cmF0aW9uIC0gVGhlIGFuaW1hdGlvbiBkdXJhdGlvbiBpbiBtcy4NCgkJICogQHBhcmFtIHtCb29sZWFufSBsYXp5IC0gaWYgdHJ1ZSwgdGhlIGNoYXJ0IGlzIG5vdCBtYXJrZWQgYXMgYW5pbWF0aW5nIHRvIGVuYWJsZSBtb3JlIHJlc3BvbnNpdmUgaW50ZXJhY3Rpb25zDQoJCSAqLw0KCQlhZGRBbmltYXRpb246IGZ1bmN0aW9uKGNoYXJ0LCBhbmltYXRpb24sIGR1cmF0aW9uLCBsYXp5KSB7DQoJCQl2YXIgYW5pbWF0aW9ucyA9IHRoaXMuYW5pbWF0aW9uczsNCgkJCXZhciBpLCBpbGVuOw0KDQoJCQlhbmltYXRpb24uY2hhcnQgPSBjaGFydDsNCg0KCQkJaWYgKCFsYXp5KSB7DQoJCQkJY2hhcnQuYW5pbWF0aW5nID0gdHJ1ZTsNCgkJCX0NCg0KCQkJZm9yIChpID0gMCwgaWxlbiA9IGFuaW1hdGlvbnMubGVuZ3RoOyBpIDwgaWxlbjsgKytpKSB7DQoJCQkJaWYgKGFuaW1hdGlvbnNbaV0uY2hhcnQgPT09IGNoYXJ0KSB7DQoJCQkJCWFuaW1hdGlvbnNbaV0gPSBhbmltYXRpb247DQoJCQkJCXJldHVybjsNCgkJCQl9DQoJCQl9DQoNCgkJCWFuaW1hdGlvbnMucHVzaChhbmltYXRpb24pOw0KDQoJCQkvLyBJZiB0aGVyZSBhcmUgbm8gYW5pbWF0aW9ucyBxdWV1ZWQsIG1hbnVhbGx5IGtpY2tzdGFydCBhIGRpZ2VzdCwgZm9yIGxhY2sgb2YgYSBiZXR0ZXIgd29yZA0KCQkJaWYgKGFuaW1hdGlvbnMubGVuZ3RoID09PSAxKSB7DQoJCQkJdGhpcy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKTsNCgkJCX0NCgkJfSwNCg0KCQljYW5jZWxBbmltYXRpb246IGZ1bmN0aW9uKGNoYXJ0KSB7DQoJCQl2YXIgaW5kZXggPSBoZWxwZXJzLmZpbmRJbmRleCh0aGlzLmFuaW1hdGlvbnMsIGZ1bmN0aW9uKGFuaW1hdGlvbikgew0KCQkJCXJldHVybiBhbmltYXRpb24uY2hhcnQgPT09IGNoYXJ0Ow0KCQkJfSk7DQoNCgkJCWlmIChpbmRleCAhPT0gLTEpIHsNCgkJCQl0aGlzLmFuaW1hdGlvbnMuc3BsaWNlKGluZGV4LCAxKTsNCgkJCQljaGFydC5hbmltYXRpbmcgPSBmYWxzZTsNCgkJCX0NCgkJfSwNCg0KCQlyZXF1ZXN0QW5pbWF0aW9uRnJhbWU6IGZ1bmN0aW9uKCkgew0KCQkJdmFyIG1lID0gdGhpczsNCgkJCWlmIChtZS5yZXF1ZXN0ID09PSBudWxsKSB7DQoJCQkJLy8gU2tpcCBhbmltYXRpb24gZnJhbWUgcmVxdWVzdHMgdW50aWwgdGhlIGFjdGl2ZSBvbmUgaXMgZXhlY3V0ZWQuDQoJCQkJLy8gVGhpcyBjYW4gaGFwcGVuIHdoZW4gcHJvY2Vzc2luZyBtb3VzZSBldmVudHMsIGUuZy4gJ21vdXNlbW92ZScNCgkJCQkvLyBhbmQgJ21vdXNlb3V0JyBldmVudHMgd2lsbCB0cmlnZ2VyIG11bHRpcGxlIHJlbmRlcnMuDQoJCQkJbWUucmVxdWVzdCA9IGhlbHBlcnMucmVxdWVzdEFuaW1GcmFtZS5jYWxsKHdpbmRvdywgZnVuY3Rpb24oKSB7DQoJCQkJCW1lLnJlcXVlc3QgPSBudWxsOw0KCQkJCQltZS5zdGFydERpZ2VzdCgpOw0KCQkJCX0pOw0KCQkJfQ0KCQl9LA0KDQoJCS8qKg0KCQkgKiBAcHJpdmF0ZQ0KCQkgKi8NCgkJc3RhcnREaWdlc3Q6IGZ1bmN0aW9uKCkgew0KCQkJdmFyIG1lID0gdGhpczsNCgkJCXZhciBzdGFydFRpbWUgPSBEYXRlLm5vdygpOw0KCQkJdmFyIGZyYW1lc1RvRHJvcCA9IDA7DQoNCgkJCWlmIChtZS5kcm9wRnJhbWVzID4gMSkgew0KCQkJCWZyYW1lc1RvRHJvcCA9IE1hdGguZmxvb3IobWUuZHJvcEZyYW1lcyk7DQoJCQkJbWUuZHJvcEZyYW1lcyA9IG1lLmRyb3BGcmFtZXMgJSAxOw0KCQkJfQ0KDQoJCQltZS5hZHZhbmNlKDEgKyBmcmFtZXNUb0Ryb3ApOw0KDQoJCQl2YXIgZW5kVGltZSA9IERhdGUubm93KCk7DQoNCgkJCW1lLmRyb3BGcmFtZXMgKz0gKGVuZFRpbWUgLSBzdGFydFRpbWUpIC8gbWUuZnJhbWVEdXJhdGlvbjsNCg0KCQkJLy8gRG8gd2UgaGF2ZSBtb3JlIHN0dWZmIHRvIGFuaW1hdGU/DQoJCQlpZiAobWUuYW5pbWF0aW9ucy5sZW5ndGggPiAwKSB7DQoJCQkJbWUucmVxdWVzdEFuaW1hdGlvbkZyYW1lKCk7DQoJCQl9DQoJCX0sDQoNCgkJLyoqDQoJCSAqIEBwcml2YXRlDQoJCSAqLw0KCQlhZHZhbmNlOiBmdW5jdGlvbihjb3VudCkgew0KCQkJdmFyIGFuaW1hdGlvbnMgPSB0aGlzLmFuaW1hdGlvbnM7DQoJCQl2YXIgYW5pbWF0aW9uLCBjaGFydDsNCgkJCXZhciBpID0gMDsNCg0KCQkJd2hpbGUgKGkgPCBhbmltYXRpb25zLmxlbmd0aCkgew0KCQkJCWFuaW1hdGlvbiA9IGFuaW1hdGlvbnNbaV07DQoJCQkJY2hhcnQgPSBhbmltYXRpb24uY2hhcnQ7DQoNCgkJCQlhbmltYXRpb24uY3VycmVudFN0ZXAgPSAoYW5pbWF0aW9uLmN1cnJlbnRTdGVwIHx8IDApICsgY291bnQ7DQoJCQkJYW5pbWF0aW9uLmN1cnJlbnRTdGVwID0gTWF0aC5taW4oYW5pbWF0aW9uLmN1cnJlbnRTdGVwLCBhbmltYXRpb24ubnVtU3RlcHMpOw0KDQoJCQkJaGVscGVycy5jYWxsYmFjayhhbmltYXRpb24ucmVuZGVyLCBbY2hhcnQsIGFuaW1hdGlvbl0sIGNoYXJ0KTsNCgkJCQloZWxwZXJzLmNhbGxiYWNrKGFuaW1hdGlvbi5vbkFuaW1hdGlvblByb2dyZXNzLCBbYW5pbWF0aW9uXSwgY2hhcnQpOw0KDQoJCQkJaWYgKGFuaW1hdGlvbi5jdXJyZW50U3RlcCA+PSBhbmltYXRpb24ubnVtU3RlcHMpIHsNCgkJCQkJaGVscGVycy5jYWxsYmFjayhhbmltYXRpb24ub25BbmltYXRpb25Db21wbGV0ZSwgW2FuaW1hdGlvbl0sIGNoYXJ0KTsNCgkJCQkJY2hhcnQuYW5pbWF0aW5nID0gZmFsc2U7DQoJCQkJCWFuaW1hdGlvbnMuc3BsaWNlKGksIDEpOw0KCQkJCX0gZWxzZSB7DQoJCQkJCSsraTsNCgkJCQl9DQoJCQl9DQoJCX0NCgl9Ow0KDQoJLyoqDQoJICogUHJvdmlkZWQgZm9yIGJhY2t3YXJkIGNvbXBhdGliaWxpdHksIHVzZSBDaGFydC5BbmltYXRpb24gaW5zdGVhZA0KCSAqIEBwcm9wIENoYXJ0LkFuaW1hdGlvbiNhbmltYXRpb25PYmplY3QNCgkgKiBAZGVwcmVjYXRlZCBzaW5jZSB2ZXJzaW9uIDIuNi4wDQoJICogQHRvZG8gcmVtb3ZlIGF0IHZlcnNpb24gMw0KCSAqLw0KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShDaGFydC5BbmltYXRpb24ucHJvdG90eXBlLCAnYW5pbWF0aW9uT2JqZWN0Jywgew0KCQlnZXQ6IGZ1bmN0aW9uKCkgew0KCQkJcmV0dXJuIHRoaXM7DQoJCX0NCgl9KTsNCg0KCS8qKg0KCSAqIFByb3ZpZGVkIGZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5LCB1c2UgQ2hhcnQuQW5pbWF0aW9uI2NoYXJ0IGluc3RlYWQNCgkgKiBAcHJvcCBDaGFydC5BbmltYXRpb24jY2hhcnRJbnN0YW5jZQ0KCSAqIEBkZXByZWNhdGVkIHNpbmNlIHZlcnNpb24gMi42LjANCgkgKiBAdG9kbyByZW1vdmUgYXQgdmVyc2lvbiAzDQoJICovDQoJT2JqZWN0LmRlZmluZVByb3BlcnR5KENoYXJ0LkFuaW1hdGlvbi5wcm90b3R5cGUsICdjaGFydEluc3RhbmNlJywgew0KCQlnZXQ6IGZ1bmN0aW9uKCkgew0KCQkJcmV0dXJuIHRoaXMuY2hhcnQ7DQoJCX0sDQoJCXNldDogZnVuY3Rpb24odmFsdWUpIHsNCgkJCXRoaXMuY2hhcnQgPSB2YWx1ZTsNCgkJfQ0KCX0pOw0KDQp9Ow0KDQp9LHsiMjUiOjI1LCIyNiI6MjYsIjQ1Ijo0NX1dLDIzOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsNCid1c2Ugc3RyaWN0JzsNCg0KdmFyIGRlZmF1bHRzID0gcmVxdWlyZSgyNSk7DQp2YXIgaGVscGVycyA9IHJlcXVpcmUoNDUpOw0KdmFyIEludGVyYWN0aW9uID0gcmVxdWlyZSgyOCk7DQp2YXIgcGxhdGZvcm0gPSByZXF1aXJlKDQ4KTsNCg0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihDaGFydCkgew0KCXZhciBwbHVnaW5zID0gQ2hhcnQucGx1Z2luczsNCg0KCS8vIENyZWF0ZSBhIGRpY3Rpb25hcnkgb2YgY2hhcnQgdHlwZXMsIHRvIGFsbG93IGZvciBleHRlbnNpb24gb2YgZXhpc3RpbmcgdHlwZXMNCglDaGFydC50eXBlcyA9IHt9Ow0KDQoJLy8gU3RvcmUgYSByZWZlcmVuY2UgdG8gZWFjaCBpbnN0YW5jZSAtIGFsbG93aW5nIHVzIHRvIGdsb2JhbGx5IHJlc2l6ZSBjaGFydCBpbnN0YW5jZXMgb24gd2luZG93IHJlc2l6ZS4NCgkvLyBEZXN0cm95IG1ldGhvZCBvbiB0aGUgY2hhcnQgd2lsbCByZW1vdmUgdGhlIGluc3RhbmNlIG9mIHRoZSBjaGFydCBmcm9tIHRoaXMgcmVmZXJlbmNlLg0KCUNoYXJ0Lmluc3RhbmNlcyA9IHt9Ow0KDQoJLy8gQ29udHJvbGxlcnMgYXZhaWxhYmxlIGZvciBkYXRhc2V0IHZpc3VhbGl6YXRpb24gZWcuIGJhciwgbGluZSwgc2xpY2UsIGV0Yy4NCglDaGFydC5jb250cm9sbGVycyA9IHt9Ow0KDQoJLyoqDQoJICogSW5pdGlhbGl6ZXMgdGhlIGdpdmVuIGNvbmZpZyB3aXRoIGdsb2JhbCBhbmQgY2hhcnQgZGVmYXVsdCB2YWx1ZXMuDQoJICovDQoJZnVuY3Rpb24gaW5pdENvbmZpZyhjb25maWcpIHsNCgkJY29uZmlnID0gY29uZmlnIHx8IHt9Ow0KDQoJCS8vIERvIE5PVCB1c2UgY29uZmlnTWVyZ2UoKSBmb3IgdGhlIGRhdGEgb2JqZWN0IGJlY2F1c2UgdGhpcyBtZXRob2QgbWVyZ2VzIGFycmF5cw0KCQkvLyBhbmQgc28gd291bGQgY2hhbmdlIHJlZmVyZW5jZXMgdG8gbGFiZWxzIGFuZCBkYXRhc2V0cywgcHJldmVudGluZyBkYXRhIHVwZGF0ZXMuDQoJCXZhciBkYXRhID0gY29uZmlnLmRhdGEgPSBjb25maWcuZGF0YSB8fCB7fTsNCgkJZGF0YS5kYXRhc2V0cyA9IGRhdGEuZGF0YXNldHMgfHwgW107DQoJCWRhdGEubGFiZWxzID0gZGF0YS5sYWJlbHMgfHwgW107DQoNCgkJY29uZmlnLm9wdGlvbnMgPSBoZWxwZXJzLmNvbmZpZ01lcmdlKA0KCQkJZGVmYXVsdHMuZ2xvYmFsLA0KCQkJZGVmYXVsdHNbY29uZmlnLnR5cGVdLA0KCQkJY29uZmlnLm9wdGlvbnMgfHwge30pOw0KDQoJCXJldHVybiBjb25maWc7DQoJfQ0KDQoJLyoqDQoJICogVXBkYXRlcyB0aGUgY29uZmlnIG9mIHRoZSBjaGFydA0KCSAqIEBwYXJhbSBjaGFydCB7Q2hhcnR9IGNoYXJ0IHRvIHVwZGF0ZSB0aGUgb3B0aW9ucyBmb3INCgkgKi8NCglmdW5jdGlvbiB1cGRhdGVDb25maWcoY2hhcnQpIHsNCgkJdmFyIG5ld09wdGlvbnMgPSBjaGFydC5vcHRpb25zOw0KDQoJCS8vIFVwZGF0ZSBTY2FsZShzKSB3aXRoIG9wdGlvbnMNCgkJaWYgKG5ld09wdGlvbnMuc2NhbGUpIHsNCgkJCWNoYXJ0LnNjYWxlLm9wdGlvbnMgPSBuZXdPcHRpb25zLnNjYWxlOw0KCQl9IGVsc2UgaWYgKG5ld09wdGlvbnMuc2NhbGVzKSB7DQoJCQluZXdPcHRpb25zLnNjYWxlcy54QXhlcy5jb25jYXQobmV3T3B0aW9ucy5zY2FsZXMueUF4ZXMpLmZvckVhY2goZnVuY3Rpb24oc2NhbGVPcHRpb25zKSB7DQoJCQkJY2hhcnQuc2NhbGVzW3NjYWxlT3B0aW9ucy5pZF0ub3B0aW9ucyA9IHNjYWxlT3B0aW9uczsNCgkJCX0pOw0KCQl9DQoNCgkJLy8gVG9vbHRpcA0KCQljaGFydC50b29sdGlwLl9vcHRpb25zID0gbmV3T3B0aW9ucy50b29sdGlwczsNCgl9DQoNCglmdW5jdGlvbiBwb3NpdGlvbklzSG9yaXpvbnRhbChwb3NpdGlvbikgew0KCQlyZXR1cm4gcG9zaXRpb24gPT09ICd0b3AnIHx8IHBvc2l0aW9uID09PSAnYm90dG9tJzsNCgl9DQoNCgloZWxwZXJzLmV4dGVuZChDaGFydC5wcm90b3R5cGUsIC8qKiBAbGVuZHMgQ2hhcnQgKi8gew0KCQkvKioNCgkJICogQHByaXZhdGUNCgkJICovDQoJCWNvbnN0cnVjdDogZnVuY3Rpb24oaXRlbSwgY29uZmlnKSB7DQoJCQl2YXIgbWUgPSB0aGlzOw0KDQoJCQljb25maWcgPSBpbml0Q29uZmlnKGNvbmZpZyk7DQoNCgkJCXZhciBjb250ZXh0ID0gcGxhdGZvcm0uYWNxdWlyZUNvbnRleHQoaXRlbSwgY29uZmlnKTsNCgkJCXZhciBjYW52YXMgPSBjb250ZXh0ICYmIGNvbnRleHQuY2FudmFzOw0KCQkJdmFyIGhlaWdodCA9IGNhbnZhcyAmJiBjYW52YXMuaGVpZ2h0Ow0KCQkJdmFyIHdpZHRoID0gY2FudmFzICYmIGNhbnZhcy53aWR0aDsNCg0KCQkJbWUuaWQgPSBoZWxwZXJzLnVpZCgpOw0KCQkJbWUuY3R4ID0gY29udGV4dDsNCgkJCW1lLmNhbnZhcyA9IGNhbnZhczsNCgkJCW1lLmNvbmZpZyA9IGNvbmZpZzsNCgkJCW1lLndpZHRoID0gd2lkdGg7DQoJCQltZS5oZWlnaHQgPSBoZWlnaHQ7DQoJCQltZS5hc3BlY3RSYXRpbyA9IGhlaWdodCA/IHdpZHRoIC8gaGVpZ2h0IDogbnVsbDsNCgkJCW1lLm9wdGlvbnMgPSBjb25maWcub3B0aW9uczsNCgkJCW1lLl9idWZmZXJlZFJlbmRlciA9IGZhbHNlOw0KDQoJCQkvKioNCgkJCSAqIFByb3ZpZGVkIGZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5LCBDaGFydCBhbmQgQ2hhcnQuQ29udHJvbGxlciBoYXZlIGJlZW4gbWVyZ2VkLA0KCQkJICogdGhlICJpbnN0YW5jZSIgc3RpbGwgbmVlZCB0byBiZSBkZWZpbmVkIHNpbmNlIGl0IG1pZ2h0IGJlIGNhbGxlZCBmcm9tIHBsdWdpbnMuDQoJCQkgKiBAcHJvcCBDaGFydCNjaGFydA0KCQkJICogQGRlcHJlY2F0ZWQgc2luY2UgdmVyc2lvbiAyLjYuMA0KCQkJICogQHRvZG8gcmVtb3ZlIGF0IHZlcnNpb24gMw0KCQkJICogQHByaXZhdGUNCgkJCSAqLw0KCQkJbWUuY2hhcnQgPSBtZTsNCgkJCW1lLmNvbnRyb2xsZXIgPSBtZTsgLy8gY2hhcnQuY2hhcnQuY29udHJvbGxlciAjaW5jZXB0aW9uDQoNCgkJCS8vIEFkZCB0aGUgY2hhcnQgaW5zdGFuY2UgdG8gdGhlIGdsb2JhbCBuYW1lc3BhY2UNCgkJCUNoYXJ0Lmluc3RhbmNlc1ttZS5pZF0gPSBtZTsNCg0KCQkJLy8gRGVmaW5lIGFsaWFzIHRvIHRoZSBjb25maWcgZGF0YTogYGNoYXJ0LmRhdGEgPT09IGNoYXJ0LmNvbmZpZy5kYXRhYA0KCQkJT2JqZWN0LmRlZmluZVByb3BlcnR5KG1lLCAnZGF0YScsIHsNCgkJCQlnZXQ6IGZ1bmN0aW9uKCkgew0KCQkJCQlyZXR1cm4gbWUuY29uZmlnLmRhdGE7DQoJCQkJfSwNCgkJCQlzZXQ6IGZ1bmN0aW9uKHZhbHVlKSB7DQoJCQkJCW1lLmNvbmZpZy5kYXRhID0gdmFsdWU7DQoJCQkJfQ0KCQkJfSk7DQoNCgkJCWlmICghY29udGV4dCB8fCAhY2FudmFzKSB7DQoJCQkJLy8gVGhlIGdpdmVuIGl0ZW0gaXMgbm90IGEgY29tcGF0aWJsZSBjb250ZXh0MmQgZWxlbWVudCwgbGV0J3MgcmV0dXJuIGJlZm9yZSBmaW5hbGl6aW5nDQoJCQkJLy8gdGhlIGNoYXJ0IGluaXRpYWxpemF0aW9uIGJ1dCBhZnRlciBzZXR0aW5nIGJhc2ljIGNoYXJ0IC8gY29udHJvbGxlciBwcm9wZXJ0aWVzIHRoYXQNCgkJCQkvLyBjYW4gaGVscCB0byBmaWd1cmUgb3V0IHRoYXQgdGhlIGNoYXJ0IGlzIG5vdCB2YWxpZCAoZS5nIGNoYXJ0LmNhbnZhcyAhPT0gbnVsbCk7DQoJCQkJLy8gaHR0cHM6Ly9naXRodWIuY29tL2NoYXJ0anMvQ2hhcnQuanMvaXNzdWVzLzI4MDcNCgkJCQljb25zb2xlLmVycm9yKCJGYWlsZWQgdG8gY3JlYXRlIGNoYXJ0OiBjYW4ndCBhY3F1aXJlIGNvbnRleHQgZnJvbSB0aGUgZ2l2ZW4gaXRlbSIpOw0KCQkJCXJldHVybjsNCgkJCX0NCg0KCQkJbWUuaW5pdGlhbGl6ZSgpOw0KCQkJbWUudXBkYXRlKCk7DQoJCX0sDQoNCgkJLyoqDQoJCSAqIEBwcml2YXRlDQoJCSAqLw0KCQlpbml0aWFsaXplOiBmdW5jdGlvbigpIHsNCgkJCXZhciBtZSA9IHRoaXM7DQoNCgkJCS8vIEJlZm9yZSBpbml0IHBsdWdpbiBub3RpZmljYXRpb24NCgkJCXBsdWdpbnMubm90aWZ5KG1lLCAnYmVmb3JlSW5pdCcpOw0KDQoJCQloZWxwZXJzLnJldGluYVNjYWxlKG1lLCBtZS5vcHRpb25zLmRldmljZVBpeGVsUmF0aW8pOw0KDQoJCQltZS5iaW5kRXZlbnRzKCk7DQoNCgkJCWlmIChtZS5vcHRpb25zLnJlc3BvbnNpdmUpIHsNCgkJCQkvLyBJbml0aWFsIHJlc2l6ZSBiZWZvcmUgY2hhcnQgZHJhd3MgKG11c3QgYmUgc2lsZW50IHRvIHByZXNlcnZlIGluaXRpYWwgYW5pbWF0aW9ucykuDQoJCQkJbWUucmVzaXplKHRydWUpOw0KCQkJfQ0KDQoJCQkvLyBNYWtlIHN1cmUgc2NhbGVzIGhhdmUgSURzIGFuZCBhcmUgYnVpbHQgYmVmb3JlIHdlIGJ1aWxkIGFueSBjb250cm9sbGVycy4NCgkJCW1lLmVuc3VyZVNjYWxlc0hhdmVJRHMoKTsNCgkJCW1lLmJ1aWxkU2NhbGVzKCk7DQoJCQltZS5pbml0VG9vbFRpcCgpOw0KDQoJCQkvLyBBZnRlciBpbml0IHBsdWdpbiBub3RpZmljYXRpb24NCgkJCXBsdWdpbnMubm90aWZ5KG1lLCAnYWZ0ZXJJbml0Jyk7DQoNCgkJCXJldHVybiBtZTsNCgkJfSwNCg0KCQljbGVhcjogZnVuY3Rpb24oKSB7DQoJCQloZWxwZXJzLmNhbnZhcy5jbGVhcih0aGlzKTsNCgkJCXJldHVybiB0aGlzOw0KCQl9LA0KDQoJCXN0b3A6IGZ1bmN0aW9uKCkgew0KCQkJLy8gU3RvcHMgYW55IGN1cnJlbnQgYW5pbWF0aW9uIGxvb3Agb2NjdXJyaW5nDQoJCQlDaGFydC5hbmltYXRpb25TZXJ2aWNlLmNhbmNlbEFuaW1hdGlvbih0aGlzKTsNCgkJCXJldHVybiB0aGlzOw0KCQl9LA0KDQoJCXJlc2l6ZTogZnVuY3Rpb24oc2lsZW50KSB7DQoJCQl2YXIgbWUgPSB0aGlzOw0KCQkJdmFyIG9wdGlvbnMgPSBtZS5vcHRpb25zOw0KCQkJdmFyIGNhbnZhcyA9IG1lLmNhbnZhczsNCgkJCXZhciBhc3BlY3RSYXRpbyA9IChvcHRpb25zLm1haW50YWluQXNwZWN0UmF0aW8gJiYgbWUuYXNwZWN0UmF0aW8pIHx8IG51bGw7DQoNCgkJCS8vIHRoZSBjYW52YXMgcmVuZGVyIHdpZHRoIGFuZCBoZWlnaHQgd2lsbCBiZSBjYXN0ZWQgdG8gaW50ZWdlcnMgc28gbWFrZSBzdXJlIHRoYXQNCgkJCS8vIHRoZSBjYW52YXMgZGlzcGxheSBzdHlsZSB1c2VzIHRoZSBzYW1lIGludGVnZXIgdmFsdWVzIHRvIGF2b2lkIGJsdXJyaW5nIGVmZmVjdC4NCg0KCQkJLy8gU2V0IHRvIDAgaW5zdGVhZCBvZiBjYW52YXMuc2l6ZSBiZWNhdXNlIHRoZSBzaXplIGRlZmF1bHRzIHRvIDMwMHgxNTAgaWYgdGhlIGVsZW1lbnQgaXMgY29sbGFzZWQNCgkJCXZhciBuZXdXaWR0aCA9IE1hdGgubWF4KDAsIE1hdGguZmxvb3IoaGVscGVycy5nZXRNYXhpbXVtV2lkdGgoY2FudmFzKSkpOw0KCQkJdmFyIG5ld0hlaWdodCA9IE1hdGgubWF4KDAsIE1hdGguZmxvb3IoYXNwZWN0UmF0aW8gPyBuZXdXaWR0aCAvIGFzcGVjdFJhdGlvIDogaGVscGVycy5nZXRNYXhpbXVtSGVpZ2h0KGNhbnZhcykpKTsNCg0KCQkJaWYgKG1lLndpZHRoID09PSBuZXdXaWR0aCAmJiBtZS5oZWlnaHQgPT09IG5ld0hlaWdodCkgew0KCQkJCXJldHVybjsNCgkJCX0NCg0KCQkJY2FudmFzLndpZHRoID0gbWUud2lkdGggPSBuZXdXaWR0aDsNCgkJCWNhbnZhcy5oZWlnaHQgPSBtZS5oZWlnaHQgPSBuZXdIZWlnaHQ7DQoJCQljYW52YXMuc3R5bGUud2lkdGggPSBuZXdXaWR0aCArICdweCc7DQoJCQljYW52YXMuc3R5bGUuaGVpZ2h0ID0gbmV3SGVpZ2h0ICsgJ3B4JzsNCg0KCQkJaGVscGVycy5yZXRpbmFTY2FsZShtZSwgb3B0aW9ucy5kZXZpY2VQaXhlbFJhdGlvKTsNCg0KCQkJaWYgKCFzaWxlbnQpIHsNCgkJCQkvLyBOb3RpZnkgYW55IHBsdWdpbnMgYWJvdXQgdGhlIHJlc2l6ZQ0KCQkJCXZhciBuZXdTaXplID0ge3dpZHRoOiBuZXdXaWR0aCwgaGVpZ2h0OiBuZXdIZWlnaHR9Ow0KCQkJCXBsdWdpbnMubm90aWZ5KG1lLCAncmVzaXplJywgW25ld1NpemVdKTsNCg0KCQkJCS8vIE5vdGlmeSBvZiByZXNpemUNCgkJCQlpZiAobWUub3B0aW9ucy5vblJlc2l6ZSkgew0KCQkJCQltZS5vcHRpb25zLm9uUmVzaXplKG1lLCBuZXdTaXplKTsNCgkJCQl9DQoNCgkJCQltZS5zdG9wKCk7DQoJCQkJbWUudXBkYXRlKG1lLm9wdGlvbnMucmVzcG9uc2l2ZUFuaW1hdGlvbkR1cmF0aW9uKTsNCgkJCX0NCgkJfSwNCg0KCQllbnN1cmVTY2FsZXNIYXZlSURzOiBmdW5jdGlvbigpIHsNCgkJCXZhciBvcHRpb25zID0gdGhpcy5vcHRpb25zOw0KCQkJdmFyIHNjYWxlc09wdGlvbnMgPSBvcHRpb25zLnNjYWxlcyB8fCB7fTsNCgkJCXZhciBzY2FsZU9wdGlvbnMgPSBvcHRpb25zLnNjYWxlOw0KDQoJCQloZWxwZXJzLmVhY2goc2NhbGVzT3B0aW9ucy54QXhlcywgZnVuY3Rpb24oeEF4aXNPcHRpb25zLCBpbmRleCkgew0KCQkJCXhBeGlzT3B0aW9ucy5pZCA9IHhBeGlzT3B0aW9ucy5pZCB8fCAoJ3gtYXhpcy0nICsgaW5kZXgpOw0KCQkJfSk7DQoNCgkJCWhlbHBlcnMuZWFjaChzY2FsZXNPcHRpb25zLnlBeGVzLCBmdW5jdGlvbih5QXhpc09wdGlvbnMsIGluZGV4KSB7DQoJCQkJeUF4aXNPcHRpb25zLmlkID0geUF4aXNPcHRpb25zLmlkIHx8ICgneS1heGlzLScgKyBpbmRleCk7DQoJCQl9KTsNCg0KCQkJaWYgKHNjYWxlT3B0aW9ucykgew0KCQkJCXNjYWxlT3B0aW9ucy5pZCA9IHNjYWxlT3B0aW9ucy5pZCB8fCAnc2NhbGUnOw0KCQkJfQ0KCQl9LA0KDQoJCS8qKg0KCQkgKiBCdWlsZHMgYSBtYXAgb2Ygc2NhbGUgSUQgdG8gc2NhbGUgb2JqZWN0IGZvciBmdXR1cmUgbG9va3VwLg0KCQkgKi8NCgkJYnVpbGRTY2FsZXM6IGZ1bmN0aW9uKCkgew0KCQkJdmFyIG1lID0gdGhpczsNCgkJCXZhciBvcHRpb25zID0gbWUub3B0aW9uczsNCgkJCXZhciBzY2FsZXMgPSBtZS5zY2FsZXMgPSB7fTsNCgkJCXZhciBpdGVtcyA9IFtdOw0KDQoJCQlpZiAob3B0aW9ucy5zY2FsZXMpIHsNCgkJCQlpdGVtcyA9IGl0ZW1zLmNvbmNhdCgNCgkJCQkJKG9wdGlvbnMuc2NhbGVzLnhBeGVzIHx8IFtdKS5tYXAoZnVuY3Rpb24oeEF4aXNPcHRpb25zKSB7DQoJCQkJCQlyZXR1cm4ge29wdGlvbnM6IHhBeGlzT3B0aW9ucywgZHR5cGU6ICdjYXRlZ29yeScsIGRwb3NpdGlvbjogJ2JvdHRvbSd9Ow0KCQkJCQl9KSwNCgkJCQkJKG9wdGlvbnMuc2NhbGVzLnlBeGVzIHx8IFtdKS5tYXAoZnVuY3Rpb24oeUF4aXNPcHRpb25zKSB7DQoJCQkJCQlyZXR1cm4ge29wdGlvbnM6IHlBeGlzT3B0aW9ucywgZHR5cGU6ICdsaW5lYXInLCBkcG9zaXRpb246ICdsZWZ0J307DQoJCQkJCX0pDQoJCQkJKTsNCgkJCX0NCg0KCQkJaWYgKG9wdGlvbnMuc2NhbGUpIHsNCgkJCQlpdGVtcy5wdXNoKHsNCgkJCQkJb3B0aW9uczogb3B0aW9ucy5zY2FsZSwNCgkJCQkJZHR5cGU6ICdyYWRpYWxMaW5lYXInLA0KCQkJCQlpc0RlZmF1bHQ6IHRydWUsDQoJCQkJCWRwb3NpdGlvbjogJ2NoYXJ0QXJlYScNCgkJCQl9KTsNCgkJCX0NCg0KCQkJaGVscGVycy5lYWNoKGl0ZW1zLCBmdW5jdGlvbihpdGVtKSB7DQoJCQkJdmFyIHNjYWxlT3B0aW9ucyA9IGl0ZW0ub3B0aW9uczsNCgkJCQl2YXIgc2NhbGVUeXBlID0gaGVscGVycy52YWx1ZU9yRGVmYXVsdChzY2FsZU9wdGlvbnMudHlwZSwgaXRlbS5kdHlwZSk7DQoJCQkJdmFyIHNjYWxlQ2xhc3MgPSBDaGFydC5zY2FsZVNlcnZpY2UuZ2V0U2NhbGVDb25zdHJ1Y3RvcihzY2FsZVR5cGUpOw0KCQkJCWlmICghc2NhbGVDbGFzcykgew0KCQkJCQlyZXR1cm47DQoJCQkJfQ0KDQoJCQkJaWYgKHBvc2l0aW9uSXNIb3Jpem9udGFsKHNjYWxlT3B0aW9ucy5wb3NpdGlvbikgIT09IHBvc2l0aW9uSXNIb3Jpem9udGFsKGl0ZW0uZHBvc2l0aW9uKSkgew0KCQkJCQlzY2FsZU9wdGlvbnMucG9zaXRpb24gPSBpdGVtLmRwb3NpdGlvbjsNCgkJCQl9DQoNCgkJCQl2YXIgc2NhbGUgPSBuZXcgc2NhbGVDbGFzcyh7DQoJCQkJCWlkOiBzY2FsZU9wdGlvbnMuaWQsDQoJCQkJCW9wdGlvbnM6IHNjYWxlT3B0aW9ucywNCgkJCQkJY3R4OiBtZS5jdHgsDQoJCQkJCWNoYXJ0OiBtZQ0KCQkJCX0pOw0KDQoJCQkJc2NhbGVzW3NjYWxlLmlkXSA9IHNjYWxlOw0KCQkJCXNjYWxlLm1lcmdlVGlja3NPcHRpb25zKCk7DQoNCgkJCQkvLyBUT0RPKFNCKTogSSB0aGluayB3ZSBzaG91bGQgYmUgYWJsZSB0byByZW1vdmUgdGhpcyBjdXN0b20gY2FzZSAob3B0aW9ucy5zY2FsZSkNCgkJCQkvLyBhbmQgY29uc2lkZXIgaXQgYXMgYSByZWd1bGFyIHNjYWxlIHBhcnQgb2YgdGhlICJzY2FsZXMiIiBtYXAgb25seSEgVGhpcyB3b3VsZA0KCQkJCS8vIG1ha2UgdGhlIGxvZ2ljIGVhc2llciBhbmQgcmVtb3ZlIHNvbWUgdXNlbGVzcz8gY3VzdG9tIGNvZGUuDQoJCQkJaWYgKGl0ZW0uaXNEZWZhdWx0KSB7DQoJCQkJCW1lLnNjYWxlID0gc2NhbGU7DQoJCQkJfQ0KCQkJfSk7DQoNCgkJCUNoYXJ0LnNjYWxlU2VydmljZS5hZGRTY2FsZXNUb0xheW91dCh0aGlzKTsNCgkJfSwNCg0KCQlidWlsZE9yVXBkYXRlQ29udHJvbGxlcnM6IGZ1bmN0aW9uKCkgew0KCQkJdmFyIG1lID0gdGhpczsNCgkJCXZhciB0eXBlcyA9IFtdOw0KCQkJdmFyIG5ld0NvbnRyb2xsZXJzID0gW107DQoNCgkJCWhlbHBlcnMuZWFjaChtZS5kYXRhLmRhdGFzZXRzLCBmdW5jdGlvbihkYXRhc2V0LCBkYXRhc2V0SW5kZXgpIHsNCgkJCQl2YXIgbWV0YSA9IG1lLmdldERhdGFzZXRNZXRhKGRhdGFzZXRJbmRleCk7DQoJCQkJdmFyIHR5cGUgPSBkYXRhc2V0LnR5cGUgfHwgbWUuY29uZmlnLnR5cGU7DQoNCgkJCQlpZiAobWV0YS50eXBlICYmIG1ldGEudHlwZSAhPT0gdHlwZSkgew0KCQkJCQltZS5kZXN0cm95RGF0YXNldE1ldGEoZGF0YXNldEluZGV4KTsNCgkJCQkJbWV0YSA9IG1lLmdldERhdGFzZXRNZXRhKGRhdGFzZXRJbmRleCk7DQoJCQkJfQ0KCQkJCW1ldGEudHlwZSA9IHR5cGU7DQoNCgkJCQl0eXBlcy5wdXNoKG1ldGEudHlwZSk7DQoNCgkJCQlpZiAobWV0YS5jb250cm9sbGVyKSB7DQoJCQkJCW1ldGEuY29udHJvbGxlci51cGRhdGVJbmRleChkYXRhc2V0SW5kZXgpOw0KCQkJCX0gZWxzZSB7DQoJCQkJCXZhciBDb250cm9sbGVyQ2xhc3MgPSBDaGFydC5jb250cm9sbGVyc1ttZXRhLnR5cGVdOw0KCQkJCQlpZiAoQ29udHJvbGxlckNsYXNzID09PSB1bmRlZmluZWQpIHsNCgkJCQkJCXRocm93IG5ldyBFcnJvcignIicgKyBtZXRhLnR5cGUgKyAnIiBpcyBub3QgYSBjaGFydCB0eXBlLicpOw0KCQkJCQl9DQoNCgkJCQkJbWV0YS5jb250cm9sbGVyID0gbmV3IENvbnRyb2xsZXJDbGFzcyhtZSwgZGF0YXNldEluZGV4KTsNCgkJCQkJbmV3Q29udHJvbGxlcnMucHVzaChtZXRhLmNvbnRyb2xsZXIpOw0KCQkJCX0NCgkJCX0sIG1lKTsNCg0KCQkJcmV0dXJuIG5ld0NvbnRyb2xsZXJzOw0KCQl9LA0KDQoJCS8qKg0KCQkgKiBSZXNldCB0aGUgZWxlbWVudHMgb2YgYWxsIGRhdGFzZXRzDQoJCSAqIEBwcml2YXRlDQoJCSAqLw0KCQlyZXNldEVsZW1lbnRzOiBmdW5jdGlvbigpIHsNCgkJCXZhciBtZSA9IHRoaXM7DQoJCQloZWxwZXJzLmVhY2gobWUuZGF0YS5kYXRhc2V0cywgZnVuY3Rpb24oZGF0YXNldCwgZGF0YXNldEluZGV4KSB7DQoJCQkJbWUuZ2V0RGF0YXNldE1ldGEoZGF0YXNldEluZGV4KS5jb250cm9sbGVyLnJlc2V0KCk7DQoJCQl9LCBtZSk7DQoJCX0sDQoNCgkJLyoqDQoJCSogUmVzZXRzIHRoZSBjaGFydCBiYWNrIHRvIGl0J3Mgc3RhdGUgYmVmb3JlIHRoZSBpbml0aWFsIGFuaW1hdGlvbg0KCQkqLw0KCQlyZXNldDogZnVuY3Rpb24oKSB7DQoJCQl0aGlzLnJlc2V0RWxlbWVudHMoKTsNCgkJCXRoaXMudG9vbHRpcC5pbml0aWFsaXplKCk7DQoJCX0sDQoNCgkJdXBkYXRlOiBmdW5jdGlvbihjb25maWcpIHsNCgkJCXZhciBtZSA9IHRoaXM7DQoNCgkJCWlmICghY29uZmlnIHx8IHR5cGVvZiBjb25maWcgIT09ICdvYmplY3QnKSB7DQoJCQkJLy8gYmFja3dhcmRzIGNvbXBhdGliaWxpdHkNCgkJCQljb25maWcgPSB7DQoJCQkJCWR1cmF0aW9uOiBjb25maWcsDQoJCQkJCWxhenk6IGFyZ3VtZW50c1sxXQ0KCQkJCX07DQoJCQl9DQoNCgkJCXVwZGF0ZUNvbmZpZyhtZSk7DQoNCgkJCWlmIChwbHVnaW5zLm5vdGlmeShtZSwgJ2JlZm9yZVVwZGF0ZScpID09PSBmYWxzZSkgew0KCQkJCXJldHVybjsNCgkJCX0NCg0KCQkJLy8gSW4gY2FzZSB0aGUgZW50aXJlIGRhdGEgb2JqZWN0IGNoYW5nZWQNCgkJCW1lLnRvb2x0aXAuX2RhdGEgPSBtZS5kYXRhOw0KDQoJCQkvLyBNYWtlIHN1cmUgZGF0YXNldCBjb250cm9sbGVycyBhcmUgdXBkYXRlZCBhbmQgbmV3IGNvbnRyb2xsZXJzIGFyZSByZXNldA0KCQkJdmFyIG5ld0NvbnRyb2xsZXJzID0gbWUuYnVpbGRPclVwZGF0ZUNvbnRyb2xsZXJzKCk7DQoNCgkJCS8vIE1ha2Ugc3VyZSBhbGwgZGF0YXNldCBjb250cm9sbGVycyBoYXZlIGNvcnJlY3QgbWV0YSBkYXRhIGNvdW50cw0KCQkJaGVscGVycy5lYWNoKG1lLmRhdGEuZGF0YXNldHMsIGZ1bmN0aW9uKGRhdGFzZXQsIGRhdGFzZXRJbmRleCkgew0KCQkJCW1lLmdldERhdGFzZXRNZXRhKGRhdGFzZXRJbmRleCkuY29udHJvbGxlci5idWlsZE9yVXBkYXRlRWxlbWVudHMoKTsNCgkJCX0sIG1lKTsNCg0KCQkJbWUudXBkYXRlTGF5b3V0KCk7DQoNCgkJCS8vIENhbiBvbmx5IHJlc2V0IHRoZSBuZXcgY29udHJvbGxlcnMgYWZ0ZXIgdGhlIHNjYWxlcyBoYXZlIGJlZW4gdXBkYXRlZA0KCQkJaGVscGVycy5lYWNoKG5ld0NvbnRyb2xsZXJzLCBmdW5jdGlvbihjb250cm9sbGVyKSB7DQoJCQkJY29udHJvbGxlci5yZXNldCgpOw0KCQkJfSk7DQoNCgkJCW1lLnVwZGF0ZURhdGFzZXRzKCk7DQoNCgkJCS8vIE5lZWQgdG8gcmVzZXQgdG9vbHRpcCBpbiBjYXNlIGl0IGlzIGRpc3BsYXllZCB3aXRoIGVsZW1lbnRzIHRoYXQgYXJlIHJlbW92ZWQNCgkJCS8vIGFmdGVyIHVwZGF0ZS4NCgkJCW1lLnRvb2x0aXAuaW5pdGlhbGl6ZSgpOw0KDQoJCQkvLyBMYXN0IGFjdGl2ZSBjb250YWlucyBpdGVtcyB0aGF0IHdlcmUgcHJldmlvdXNseSBpbiB0aGUgdG9vbHRpcC4NCgkJCS8vIFdoZW4gd2UgcmVzZXQgdGhlIHRvb2x0aXAsIHdlIG5lZWQgdG8gY2xlYXIgaXQNCgkJCW1lLmxhc3RBY3RpdmUgPSBbXTsNCg0KCQkJLy8gRG8gdGhpcyBiZWZvcmUgcmVuZGVyIHNvIHRoYXQgYW55IHBsdWdpbnMgdGhhdCBuZWVkIGZpbmFsIHNjYWxlIHVwZGF0ZXMgY2FuIHVzZSBpdA0KCQkJcGx1Z2lucy5ub3RpZnkobWUsICdhZnRlclVwZGF0ZScpOw0KDQoJCQlpZiAobWUuX2J1ZmZlcmVkUmVuZGVyKSB7DQoJCQkJbWUuX2J1ZmZlcmVkUmVxdWVzdCA9IHsNCgkJCQkJZHVyYXRpb246IGNvbmZpZy5kdXJhdGlvbiwNCgkJCQkJZWFzaW5nOiBjb25maWcuZWFzaW5nLA0KCQkJCQlsYXp5OiBjb25maWcubGF6eQ0KCQkJCX07DQoJCQl9IGVsc2Ugew0KCQkJCW1lLnJlbmRlcihjb25maWcpOw0KCQkJfQ0KCQl9LA0KDQoJCS8qKg0KCQkgKiBVcGRhdGVzIHRoZSBjaGFydCBsYXlvdXQgdW5sZXNzIGEgcGx1Z2luIHJldHVybnMgYGZhbHNlYCB0byB0aGUgYGJlZm9yZUxheW91dGANCgkJICogaG9vaywgaW4gd2hpY2ggY2FzZSwgcGx1Z2lucyB3aWxsIG5vdCBiZSBjYWxsZWQgb24gYGFmdGVyTGF5b3V0YC4NCgkJICogQHByaXZhdGUNCgkJICovDQoJCXVwZGF0ZUxheW91dDogZnVuY3Rpb24oKSB7DQoJCQl2YXIgbWUgPSB0aGlzOw0KDQoJCQlpZiAocGx1Z2lucy5ub3RpZnkobWUsICdiZWZvcmVMYXlvdXQnKSA9PT0gZmFsc2UpIHsNCgkJCQlyZXR1cm47DQoJCQl9DQoNCgkJCUNoYXJ0LmxheW91dFNlcnZpY2UudXBkYXRlKHRoaXMsIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KTsNCg0KCQkJLyoqDQoJCQkgKiBQcm92aWRlZCBmb3IgYmFja3dhcmQgY29tcGF0aWJpbGl0eSwgdXNlIGBhZnRlckxheW91dGAgaW5zdGVhZC4NCgkJCSAqIEBtZXRob2QgSVBsdWdpbiNhZnRlclNjYWxlVXBkYXRlDQoJCQkgKiBAZGVwcmVjYXRlZCBzaW5jZSB2ZXJzaW9uIDIuNS4wDQoJCQkgKiBAdG9kbyByZW1vdmUgYXQgdmVyc2lvbiAzDQoJCQkgKiBAcHJpdmF0ZQ0KCQkJICovDQoJCQlwbHVnaW5zLm5vdGlmeShtZSwgJ2FmdGVyU2NhbGVVcGRhdGUnKTsNCgkJCXBsdWdpbnMubm90aWZ5KG1lLCAnYWZ0ZXJMYXlvdXQnKTsNCgkJfSwNCg0KCQkvKioNCgkJICogVXBkYXRlcyBhbGwgZGF0YXNldHMgdW5sZXNzIGEgcGx1Z2luIHJldHVybnMgYGZhbHNlYCB0byB0aGUgYGJlZm9yZURhdGFzZXRzVXBkYXRlYA0KCQkgKiBob29rLCBpbiB3aGljaCBjYXNlLCBwbHVnaW5zIHdpbGwgbm90IGJlIGNhbGxlZCBvbiBgYWZ0ZXJEYXRhc2V0c1VwZGF0ZWAuDQoJCSAqIEBwcml2YXRlDQoJCSAqLw0KCQl1cGRhdGVEYXRhc2V0czogZnVuY3Rpb24oKSB7DQoJCQl2YXIgbWUgPSB0aGlzOw0KDQoJCQlpZiAocGx1Z2lucy5ub3RpZnkobWUsICdiZWZvcmVEYXRhc2V0c1VwZGF0ZScpID09PSBmYWxzZSkgew0KCQkJCXJldHVybjsNCgkJCX0NCg0KCQkJZm9yICh2YXIgaSA9IDAsIGlsZW4gPSBtZS5kYXRhLmRhdGFzZXRzLmxlbmd0aDsgaSA8IGlsZW47ICsraSkgew0KCQkJCW1lLnVwZGF0ZURhdGFzZXQoaSk7DQoJCQl9DQoNCgkJCXBsdWdpbnMubm90aWZ5KG1lLCAnYWZ0ZXJEYXRhc2V0c1VwZGF0ZScpOw0KCQl9LA0KDQoJCS8qKg0KCQkgKiBVcGRhdGVzIGRhdGFzZXQgYXQgaW5kZXggdW5sZXNzIGEgcGx1Z2luIHJldHVybnMgYGZhbHNlYCB0byB0aGUgYGJlZm9yZURhdGFzZXRVcGRhdGVgDQoJCSAqIGhvb2ssIGluIHdoaWNoIGNhc2UsIHBsdWdpbnMgd2lsbCBub3QgYmUgY2FsbGVkIG9uIGBhZnRlckRhdGFzZXRVcGRhdGVgLg0KCQkgKiBAcHJpdmF0ZQ0KCQkgKi8NCgkJdXBkYXRlRGF0YXNldDogZnVuY3Rpb24oaW5kZXgpIHsNCgkJCXZhciBtZSA9IHRoaXM7DQoJCQl2YXIgbWV0YSA9IG1lLmdldERhdGFzZXRNZXRhKGluZGV4KTsNCgkJCXZhciBhcmdzID0gew0KCQkJCW1ldGE6IG1ldGEsDQoJCQkJaW5kZXg6IGluZGV4DQoJCQl9Ow0KDQoJCQlpZiAocGx1Z2lucy5ub3RpZnkobWUsICdiZWZvcmVEYXRhc2V0VXBkYXRlJywgW2FyZ3NdKSA9PT0gZmFsc2UpIHsNCgkJCQlyZXR1cm47DQoJCQl9DQoNCgkJCW1ldGEuY29udHJvbGxlci51cGRhdGUoKTsNCg0KCQkJcGx1Z2lucy5ub3RpZnkobWUsICdhZnRlckRhdGFzZXRVcGRhdGUnLCBbYXJnc10pOw0KCQl9LA0KDQoJCXJlbmRlcjogZnVuY3Rpb24oY29uZmlnKSB7DQoJCQl2YXIgbWUgPSB0aGlzOw0KDQoJCQlpZiAoIWNvbmZpZyB8fCB0eXBlb2YgY29uZmlnICE9PSAnb2JqZWN0Jykgew0KCQkJCS8vIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5DQoJCQkJY29uZmlnID0gew0KCQkJCQlkdXJhdGlvbjogY29uZmlnLA0KCQkJCQlsYXp5OiBhcmd1bWVudHNbMV0NCgkJCQl9Ow0KCQkJfQ0KDQoJCQl2YXIgZHVyYXRpb24gPSBjb25maWcuZHVyYXRpb247DQoJCQl2YXIgbGF6eSA9IGNvbmZpZy5sYXp5Ow0KDQoJCQlpZiAocGx1Z2lucy5ub3RpZnkobWUsICdiZWZvcmVSZW5kZXInKSA9PT0gZmFsc2UpIHsNCgkJCQlyZXR1cm47DQoJCQl9DQoNCgkJCXZhciBhbmltYXRpb25PcHRpb25zID0gbWUub3B0aW9ucy5hbmltYXRpb247DQoJCQl2YXIgb25Db21wbGV0ZSA9IGZ1bmN0aW9uKGFuaW1hdGlvbikgew0KCQkJCXBsdWdpbnMubm90aWZ5KG1lLCAnYWZ0ZXJSZW5kZXInKTsNCgkJCQloZWxwZXJzLmNhbGxiYWNrKGFuaW1hdGlvbk9wdGlvbnMgJiYgYW5pbWF0aW9uT3B0aW9ucy5vbkNvbXBsZXRlLCBbYW5pbWF0aW9uXSwgbWUpOw0KCQkJfTsNCg0KCQkJaWYgKGFuaW1hdGlvbk9wdGlvbnMgJiYgKCh0eXBlb2YgZHVyYXRpb24gIT09ICd1bmRlZmluZWQnICYmIGR1cmF0aW9uICE9PSAwKSB8fCAodHlwZW9mIGR1cmF0aW9uID09PSAndW5kZWZpbmVkJyAmJiBhbmltYXRpb25PcHRpb25zLmR1cmF0aW9uICE9PSAwKSkpIHsNCgkJCQl2YXIgYW5pbWF0aW9uID0gbmV3IENoYXJ0LkFuaW1hdGlvbih7DQoJCQkJCW51bVN0ZXBzOiAoZHVyYXRpb24gfHwgYW5pbWF0aW9uT3B0aW9ucy5kdXJhdGlvbikgLyAxNi42NiwgLy8gNjAgZnBzDQoJCQkJCWVhc2luZzogY29uZmlnLmVhc2luZyB8fCBhbmltYXRpb25PcHRpb25zLmVhc2luZywNCg0KCQkJCQlyZW5kZXI6IGZ1bmN0aW9uKGNoYXJ0LCBhbmltYXRpb25PYmplY3QpIHsNCgkJCQkJCXZhciBlYXNpbmdGdW5jdGlvbiA9IGhlbHBlcnMuZWFzaW5nLmVmZmVjdHNbYW5pbWF0aW9uT2JqZWN0LmVhc2luZ107DQoJCQkJCQl2YXIgY3VycmVudFN0ZXAgPSBhbmltYXRpb25PYmplY3QuY3VycmVudFN0ZXA7DQoJCQkJCQl2YXIgc3RlcERlY2ltYWwgPSBjdXJyZW50U3RlcCAvIGFuaW1hdGlvbk9iamVjdC5udW1TdGVwczsNCg0KCQkJCQkJY2hhcnQuZHJhdyhlYXNpbmdGdW5jdGlvbihzdGVwRGVjaW1hbCksIHN0ZXBEZWNpbWFsLCBjdXJyZW50U3RlcCk7DQoJCQkJCX0sDQoNCgkJCQkJb25BbmltYXRpb25Qcm9ncmVzczogYW5pbWF0aW9uT3B0aW9ucy5vblByb2dyZXNzLA0KCQkJCQlvbkFuaW1hdGlvbkNvbXBsZXRlOiBvbkNvbXBsZXRlDQoJCQkJfSk7DQoNCgkJCQlDaGFydC5hbmltYXRpb25TZXJ2aWNlLmFkZEFuaW1hdGlvbihtZSwgYW5pbWF0aW9uLCBkdXJhdGlvbiwgbGF6eSk7DQoJCQl9IGVsc2Ugew0KCQkJCW1lLmRyYXcoKTsNCg0KCQkJCS8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vY2hhcnRqcy9DaGFydC5qcy9pc3N1ZXMvMzc4MQ0KCQkJCW9uQ29tcGxldGUobmV3IENoYXJ0LkFuaW1hdGlvbih7bnVtU3RlcHM6IDAsIGNoYXJ0OiBtZX0pKTsNCgkJCX0NCg0KCQkJcmV0dXJuIG1lOw0KCQl9LA0KDQoJCWRyYXc6IGZ1bmN0aW9uKGVhc2luZ1ZhbHVlKSB7DQoJCQl2YXIgbWUgPSB0aGlzOw0KDQoJCQltZS5jbGVhcigpOw0KDQoJCQlpZiAoaGVscGVycy5pc051bGxPclVuZGVmKGVhc2luZ1ZhbHVlKSkgew0KCQkJCWVhc2luZ1ZhbHVlID0gMTsNCgkJCX0NCg0KCQkJbWUudHJhbnNpdGlvbihlYXNpbmdWYWx1ZSk7DQoNCgkJCWlmIChwbHVnaW5zLm5vdGlmeShtZSwgJ2JlZm9yZURyYXcnLCBbZWFzaW5nVmFsdWVdKSA9PT0gZmFsc2UpIHsNCgkJCQlyZXR1cm47DQoJCQl9DQoNCgkJCS8vIERyYXcgYWxsIHRoZSBzY2FsZXMNCgkJCWhlbHBlcnMuZWFjaChtZS5ib3hlcywgZnVuY3Rpb24oYm94KSB7DQoJCQkJYm94LmRyYXcobWUuY2hhcnRBcmVhKTsNCgkJCX0sIG1lKTsNCg0KCQkJaWYgKG1lLnNjYWxlKSB7DQoJCQkJbWUuc2NhbGUuZHJhdygpOw0KCQkJfQ0KDQoJCQltZS5kcmF3RGF0YXNldHMoZWFzaW5nVmFsdWUpOw0KCQkJbWUuX2RyYXdUb29sdGlwKGVhc2luZ1ZhbHVlKTsNCg0KCQkJcGx1Z2lucy5ub3RpZnkobWUsICdhZnRlckRyYXcnLCBbZWFzaW5nVmFsdWVdKTsNCgkJfSwNCg0KCQkvKioNCgkJICogQHByaXZhdGUNCgkJICovDQoJCXRyYW5zaXRpb246IGZ1bmN0aW9uKGVhc2luZ1ZhbHVlKSB7DQoJCQl2YXIgbWUgPSB0aGlzOw0KDQoJCQlmb3IgKHZhciBpID0gMCwgaWxlbiA9IChtZS5kYXRhLmRhdGFzZXRzIHx8IFtdKS5sZW5ndGg7IGkgPCBpbGVuOyArK2kpIHsNCgkJCQlpZiAobWUuaXNEYXRhc2V0VmlzaWJsZShpKSkgew0KCQkJCQltZS5nZXREYXRhc2V0TWV0YShpKS5jb250cm9sbGVyLnRyYW5zaXRpb24oZWFzaW5nVmFsdWUpOw0KCQkJCX0NCgkJCX0NCg0KCQkJbWUudG9vbHRpcC50cmFuc2l0aW9uKGVhc2luZ1ZhbHVlKTsNCgkJfSwNCg0KCQkvKioNCgkJICogRHJhd3MgYWxsIGRhdGFzZXRzIHVubGVzcyBhIHBsdWdpbiByZXR1cm5zIGBmYWxzZWAgdG8gdGhlIGBiZWZvcmVEYXRhc2V0c0RyYXdgDQoJCSAqIGhvb2ssIGluIHdoaWNoIGNhc2UsIHBsdWdpbnMgd2lsbCBub3QgYmUgY2FsbGVkIG9uIGBhZnRlckRhdGFzZXRzRHJhd2AuDQoJCSAqIEBwcml2YXRlDQoJCSAqLw0KCQlkcmF3RGF0YXNldHM6IGZ1bmN0aW9uKGVhc2luZ1ZhbHVlKSB7DQoJCQl2YXIgbWUgPSB0aGlzOw0KDQoJCQlpZiAocGx1Z2lucy5ub3RpZnkobWUsICdiZWZvcmVEYXRhc2V0c0RyYXcnLCBbZWFzaW5nVmFsdWVdKSA9PT0gZmFsc2UpIHsNCgkJCQlyZXR1cm47DQoJCQl9DQoNCgkJCS8vIERyYXcgZGF0YXNldHMgcmV2ZXJzZWQgdG8gc3VwcG9ydCBwcm9wZXIgbGluZSBzdGFja2luZw0KCQkJZm9yICh2YXIgaSA9IChtZS5kYXRhLmRhdGFzZXRzIHx8IFtdKS5sZW5ndGggLSAxOyBpID49IDA7IC0taSkgew0KCQkJCWlmIChtZS5pc0RhdGFzZXRWaXNpYmxlKGkpKSB7DQoJCQkJCW1lLmRyYXdEYXRhc2V0KGksIGVhc2luZ1ZhbHVlKTsNCgkJCQl9DQoJCQl9DQoNCgkJCXBsdWdpbnMubm90aWZ5KG1lLCAnYWZ0ZXJEYXRhc2V0c0RyYXcnLCBbZWFzaW5nVmFsdWVdKTsNCgkJfSwNCg0KCQkvKioNCgkJICogRHJhd3MgZGF0YXNldCBhdCBpbmRleCB1bmxlc3MgYSBwbHVnaW4gcmV0dXJucyBgZmFsc2VgIHRvIHRoZSBgYmVmb3JlRGF0YXNldERyYXdgDQoJCSAqIGhvb2ssIGluIHdoaWNoIGNhc2UsIHBsdWdpbnMgd2lsbCBub3QgYmUgY2FsbGVkIG9uIGBhZnRlckRhdGFzZXREcmF3YC4NCgkJICogQHByaXZhdGUNCgkJICovDQoJCWRyYXdEYXRhc2V0OiBmdW5jdGlvbihpbmRleCwgZWFzaW5nVmFsdWUpIHsNCgkJCXZhciBtZSA9IHRoaXM7DQoJCQl2YXIgbWV0YSA9IG1lLmdldERhdGFzZXRNZXRhKGluZGV4KTsNCgkJCXZhciBhcmdzID0gew0KCQkJCW1ldGE6IG1ldGEsDQoJCQkJaW5kZXg6IGluZGV4LA0KCQkJCWVhc2luZ1ZhbHVlOiBlYXNpbmdWYWx1ZQ0KCQkJfTsNCg0KCQkJaWYgKHBsdWdpbnMubm90aWZ5KG1lLCAnYmVmb3JlRGF0YXNldERyYXcnLCBbYXJnc10pID09PSBmYWxzZSkgew0KCQkJCXJldHVybjsNCgkJCX0NCg0KCQkJbWV0YS5jb250cm9sbGVyLmRyYXcoZWFzaW5nVmFsdWUpOw0KDQoJCQlwbHVnaW5zLm5vdGlmeShtZSwgJ2FmdGVyRGF0YXNldERyYXcnLCBbYXJnc10pOw0KCQl9LA0KDQoJCS8qKg0KCQkgKiBEcmF3cyB0b29sdGlwIHVubGVzcyBhIHBsdWdpbiByZXR1cm5zIGBmYWxzZWAgdG8gdGhlIGBiZWZvcmVUb29sdGlwRHJhd2ANCgkJICogaG9vaywgaW4gd2hpY2ggY2FzZSwgcGx1Z2lucyB3aWxsIG5vdCBiZSBjYWxsZWQgb24gYGFmdGVyVG9vbHRpcERyYXdgLg0KCQkgKiBAcHJpdmF0ZQ0KCQkgKi8NCgkJX2RyYXdUb29sdGlwOiBmdW5jdGlvbihlYXNpbmdWYWx1ZSkgew0KCQkJdmFyIG1lID0gdGhpczsNCgkJCXZhciB0b29sdGlwID0gbWUudG9vbHRpcDsNCgkJCXZhciBhcmdzID0gew0KCQkJCXRvb2x0aXA6IHRvb2x0aXAsDQoJCQkJZWFzaW5nVmFsdWU6IGVhc2luZ1ZhbHVlDQoJCQl9Ow0KDQoJCQlpZiAocGx1Z2lucy5ub3RpZnkobWUsICdiZWZvcmVUb29sdGlwRHJhdycsIFthcmdzXSkgPT09IGZhbHNlKSB7DQoJCQkJcmV0dXJuOw0KCQkJfQ0KDQoJCQl0b29sdGlwLmRyYXcoKTsNCg0KCQkJcGx1Z2lucy5ub3RpZnkobWUsICdhZnRlclRvb2x0aXBEcmF3JywgW2FyZ3NdKTsNCgkJfSwNCg0KCQkvLyBHZXQgdGhlIHNpbmdsZSBlbGVtZW50IHRoYXQgd2FzIGNsaWNrZWQgb24NCgkJLy8gQHJldHVybiA6IEFuIG9iamVjdCBjb250YWluaW5nIHRoZSBkYXRhc2V0IGluZGV4IGFuZCBlbGVtZW50IGluZGV4IG9mIHRoZSBtYXRjaGluZyBlbGVtZW50LiBBbHNvIGNvbnRhaW5zIHRoZSByZWN0YW5nbGUgdGhhdCB3YXMgZHJhdw0KCQlnZXRFbGVtZW50QXRFdmVudDogZnVuY3Rpb24oZSkgew0KCQkJcmV0dXJuIEludGVyYWN0aW9uLm1vZGVzLnNpbmdsZSh0aGlzLCBlKTsNCgkJfSwNCg0KCQlnZXRFbGVtZW50c0F0RXZlbnQ6IGZ1bmN0aW9uKGUpIHsNCgkJCXJldHVybiBJbnRlcmFjdGlvbi5tb2Rlcy5sYWJlbCh0aGlzLCBlLCB7aW50ZXJzZWN0OiB0cnVlfSk7DQoJCX0sDQoNCgkJZ2V0RWxlbWVudHNBdFhBeGlzOiBmdW5jdGlvbihlKSB7DQoJCQlyZXR1cm4gSW50ZXJhY3Rpb24ubW9kZXNbJ3gtYXhpcyddKHRoaXMsIGUsIHtpbnRlcnNlY3Q6IHRydWV9KTsNCgkJfSwNCg0KCQlnZXRFbGVtZW50c0F0RXZlbnRGb3JNb2RlOiBmdW5jdGlvbihlLCBtb2RlLCBvcHRpb25zKSB7DQoJCQl2YXIgbWV0aG9kID0gSW50ZXJhY3Rpb24ubW9kZXNbbW9kZV07DQoJCQlpZiAodHlwZW9mIG1ldGhvZCA9PT0gJ2Z1bmN0aW9uJykgew0KCQkJCXJldHVybiBtZXRob2QodGhpcywgZSwgb3B0aW9ucyk7DQoJCQl9DQoNCgkJCXJldHVybiBbXTsNCgkJfSwNCg0KCQlnZXREYXRhc2V0QXRFdmVudDogZnVuY3Rpb24oZSkgew0KCQkJcmV0dXJuIEludGVyYWN0aW9uLm1vZGVzLmRhdGFzZXQodGhpcywgZSwge2ludGVyc2VjdDogdHJ1ZX0pOw0KCQl9LA0KDQoJCWdldERhdGFzZXRNZXRhOiBmdW5jdGlvbihkYXRhc2V0SW5kZXgpIHsNCgkJCXZhciBtZSA9IHRoaXM7DQoJCQl2YXIgZGF0YXNldCA9IG1lLmRhdGEuZGF0YXNldHNbZGF0YXNldEluZGV4XTsNCgkJCWlmICghZGF0YXNldC5fbWV0YSkgew0KCQkJCWRhdGFzZXQuX21ldGEgPSB7fTsNCgkJCX0NCg0KCQkJdmFyIG1ldGEgPSBkYXRhc2V0Ll9tZXRhW21lLmlkXTsNCgkJCWlmICghbWV0YSkgew0KCQkJCW1ldGEgPSBkYXRhc2V0Ll9tZXRhW21lLmlkXSA9IHsNCgkJCQkJdHlwZTogbnVsbCwNCgkJCQkJZGF0YTogW10sDQoJCQkJCWRhdGFzZXQ6IG51bGwsDQoJCQkJCWNvbnRyb2xsZXI6IG51bGwsDQoJCQkJCWhpZGRlbjogbnVsbCwJCQkvLyBTZWUgaXNEYXRhc2V0VmlzaWJsZSgpIGNvbW1lbnQNCgkJCQkJeEF4aXNJRDogbnVsbCwNCgkJCQkJeUF4aXNJRDogbnVsbA0KCQkJCX07DQoJCQl9DQoNCgkJCXJldHVybiBtZXRhOw0KCQl9LA0KDQoJCWdldFZpc2libGVEYXRhc2V0Q291bnQ6IGZ1bmN0aW9uKCkgew0KCQkJdmFyIGNvdW50ID0gMDsNCgkJCWZvciAodmFyIGkgPSAwLCBpbGVuID0gdGhpcy5kYXRhLmRhdGFzZXRzLmxlbmd0aDsgaSA8IGlsZW47ICsraSkgew0KCQkJCWlmICh0aGlzLmlzRGF0YXNldFZpc2libGUoaSkpIHsNCgkJCQkJY291bnQrKzsNCgkJCQl9DQoJCQl9DQoJCQlyZXR1cm4gY291bnQ7DQoJCX0sDQoNCgkJaXNEYXRhc2V0VmlzaWJsZTogZnVuY3Rpb24oZGF0YXNldEluZGV4KSB7DQoJCQl2YXIgbWV0YSA9IHRoaXMuZ2V0RGF0YXNldE1ldGEoZGF0YXNldEluZGV4KTsNCg0KCQkJLy8gbWV0YS5oaWRkZW4gaXMgYSBwZXIgY2hhcnQgZGF0YXNldCBoaWRkZW4gZmxhZyBvdmVycmlkZSB3aXRoIDMgc3RhdGVzOiBpZiB0cnVlIG9yIGZhbHNlLA0KCQkJLy8gdGhlIGRhdGFzZXQuaGlkZGVuIHZhbHVlIGlzIGlnbm9yZWQsIGVsc2UgaWYgbnVsbCwgdGhlIGRhdGFzZXQgaGlkZGVuIHN0YXRlIGlzIHJldHVybmVkLg0KCQkJcmV0dXJuIHR5cGVvZiBtZXRhLmhpZGRlbiA9PT0gJ2Jvb2xlYW4nID8gIW1ldGEuaGlkZGVuIDogIXRoaXMuZGF0YS5kYXRhc2V0c1tkYXRhc2V0SW5kZXhdLmhpZGRlbjsNCgkJfSwNCg0KCQlnZW5lcmF0ZUxlZ2VuZDogZnVuY3Rpb24oKSB7DQoJCQlyZXR1cm4gdGhpcy5vcHRpb25zLmxlZ2VuZENhbGxiYWNrKHRoaXMpOw0KCQl9LA0KDQoJCS8qKg0KCQkgKiBAcHJpdmF0ZQ0KCQkgKi8NCgkJZGVzdHJveURhdGFzZXRNZXRhOiBmdW5jdGlvbihkYXRhc2V0SW5kZXgpIHsNCgkJCXZhciBpZCA9IHRoaXMuaWQ7DQoJCQl2YXIgZGF0YXNldCA9IHRoaXMuZGF0YS5kYXRhc2V0c1tkYXRhc2V0SW5kZXhdOw0KCQkJdmFyIG1ldGEgPSBkYXRhc2V0Ll9tZXRhICYmIGRhdGFzZXQuX21ldGFbaWRdOw0KDQoJCQlpZiAobWV0YSkgew0KCQkJCW1ldGEuY29udHJvbGxlci5kZXN0cm95KCk7DQoJCQkJZGVsZXRlIGRhdGFzZXQuX21ldGFbaWRdOw0KCQkJfQ0KCQl9LA0KDQoJCWRlc3Ryb3k6IGZ1bmN0aW9uKCkgew0KCQkJdmFyIG1lID0gdGhpczsNCgkJCXZhciBjYW52YXMgPSBtZS5jYW52YXM7DQoJCQl2YXIgaSwgaWxlbjsNCg0KCQkJbWUuc3RvcCgpOw0KDQoJCQkvLyBkYXRhc2V0IGNvbnRyb2xsZXJzIG5lZWQgdG8gY2xlYW51cCBhc3NvY2lhdGVkIGRhdGENCgkJCWZvciAoaSA9IDAsIGlsZW4gPSBtZS5kYXRhLmRhdGFzZXRzLmxlbmd0aDsgaSA8IGlsZW47ICsraSkgew0KCQkJCW1lLmRlc3Ryb3lEYXRhc2V0TWV0YShpKTsNCgkJCX0NCg0KCQkJaWYgKGNhbnZhcykgew0KCQkJCW1lLnVuYmluZEV2ZW50cygpOw0KCQkJCWhlbHBlcnMuY2FudmFzLmNsZWFyKG1lKTsNCgkJCQlwbGF0Zm9ybS5yZWxlYXNlQ29udGV4dChtZS5jdHgpOw0KCQkJCW1lLmNhbnZhcyA9IG51bGw7DQoJCQkJbWUuY3R4ID0gbnVsbDsNCgkJCX0NCg0KCQkJcGx1Z2lucy5ub3RpZnkobWUsICdkZXN0cm95Jyk7DQoNCgkJCWRlbGV0ZSBDaGFydC5pbnN0YW5jZXNbbWUuaWRdOw0KCQl9LA0KDQoJCXRvQmFzZTY0SW1hZ2U6IGZ1bmN0aW9uKCkgew0KCQkJcmV0dXJuIHRoaXMuY2FudmFzLnRvRGF0YVVSTC5hcHBseSh0aGlzLmNhbnZhcywgYXJndW1lbnRzKTsNCgkJfSwNCg0KCQlpbml0VG9vbFRpcDogZnVuY3Rpb24oKSB7DQoJCQl2YXIgbWUgPSB0aGlzOw0KCQkJbWUudG9vbHRpcCA9IG5ldyBDaGFydC5Ub29sdGlwKHsNCgkJCQlfY2hhcnQ6IG1lLA0KCQkJCV9jaGFydEluc3RhbmNlOiBtZSwgLy8gZGVwcmVjYXRlZCwgYmFja3dhcmQgY29tcGF0aWJpbGl0eQ0KCQkJCV9kYXRhOiBtZS5kYXRhLA0KCQkJCV9vcHRpb25zOiBtZS5vcHRpb25zLnRvb2x0aXBzDQoJCQl9LCBtZSk7DQoJCX0sDQoNCgkJLyoqDQoJCSAqIEBwcml2YXRlDQoJCSAqLw0KCQliaW5kRXZlbnRzOiBmdW5jdGlvbigpIHsNCgkJCXZhciBtZSA9IHRoaXM7DQoJCQl2YXIgbGlzdGVuZXJzID0gbWUuX2xpc3RlbmVycyA9IHt9Ow0KCQkJdmFyIGxpc3RlbmVyID0gZnVuY3Rpb24oKSB7DQoJCQkJbWUuZXZlbnRIYW5kbGVyLmFwcGx5KG1lLCBhcmd1bWVudHMpOw0KCQkJfTsNCg0KCQkJaGVscGVycy5lYWNoKG1lLm9wdGlvbnMuZXZlbnRzLCBmdW5jdGlvbih0eXBlKSB7DQoJCQkJcGxhdGZvcm0uYWRkRXZlbnRMaXN0ZW5lcihtZSwgdHlwZSwgbGlzdGVuZXIpOw0KCQkJCWxpc3RlbmVyc1t0eXBlXSA9IGxpc3RlbmVyOw0KCQkJfSk7DQoNCgkJCS8vIEVsZW1lbnRzIHVzZWQgdG8gZGV0ZWN0IHNpemUgY2hhbmdlIHNob3VsZCBub3QgYmUgaW5qZWN0ZWQgZm9yIG5vbiByZXNwb25zaXZlIGNoYXJ0cy4NCgkJCS8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vY2hhcnRqcy9DaGFydC5qcy9pc3N1ZXMvMjIxMA0KCQkJaWYgKG1lLm9wdGlvbnMucmVzcG9uc2l2ZSkgew0KCQkJCWxpc3RlbmVyID0gZnVuY3Rpb24oKSB7DQoJCQkJCW1lLnJlc2l6ZSgpOw0KCQkJCX07DQoNCgkJCQlwbGF0Zm9ybS5hZGRFdmVudExpc3RlbmVyKG1lLCAncmVzaXplJywgbGlzdGVuZXIpOw0KCQkJCWxpc3RlbmVycy5yZXNpemUgPSBsaXN0ZW5lcjsNCgkJCX0NCgkJfSwNCg0KCQkvKioNCgkJICogQHByaXZhdGUNCgkJICovDQoJCXVuYmluZEV2ZW50czogZnVuY3Rpb24oKSB7DQoJCQl2YXIgbWUgPSB0aGlzOw0KCQkJdmFyIGxpc3RlbmVycyA9IG1lLl9saXN0ZW5lcnM7DQoJCQlpZiAoIWxpc3RlbmVycykgew0KCQkJCXJldHVybjsNCgkJCX0NCg0KCQkJZGVsZXRlIG1lLl9saXN0ZW5lcnM7DQoJCQloZWxwZXJzLmVhY2gobGlzdGVuZXJzLCBmdW5jdGlvbihsaXN0ZW5lciwgdHlwZSkgew0KCQkJCXBsYXRmb3JtLnJlbW92ZUV2ZW50TGlzdGVuZXIobWUsIHR5cGUsIGxpc3RlbmVyKTsNCgkJCX0pOw0KCQl9LA0KDQoJCXVwZGF0ZUhvdmVyU3R5bGU6IGZ1bmN0aW9uKGVsZW1lbnRzLCBtb2RlLCBlbmFibGVkKSB7DQoJCQl2YXIgbWV0aG9kID0gZW5hYmxlZCA/ICdzZXRIb3ZlclN0eWxlJyA6ICdyZW1vdmVIb3ZlclN0eWxlJzsNCgkJCXZhciBlbGVtZW50LCBpLCBpbGVuOw0KDQoJCQlmb3IgKGkgPSAwLCBpbGVuID0gZWxlbWVudHMubGVuZ3RoOyBpIDwgaWxlbjsgKytpKSB7DQoJCQkJZWxlbWVudCA9IGVsZW1lbnRzW2ldOw0KCQkJCWlmIChlbGVtZW50KSB7DQoJCQkJCXRoaXMuZ2V0RGF0YXNldE1ldGEoZWxlbWVudC5fZGF0YXNldEluZGV4KS5jb250cm9sbGVyW21ldGhvZF0oZWxlbWVudCk7DQoJCQkJfQ0KCQkJfQ0KCQl9LA0KDQoJCS8qKg0KCQkgKiBAcHJpdmF0ZQ0KCQkgKi8NCgkJZXZlbnRIYW5kbGVyOiBmdW5jdGlvbihlKSB7DQoJCQl2YXIgbWUgPSB0aGlzOw0KCQkJdmFyIHRvb2x0aXAgPSBtZS50b29sdGlwOw0KDQoJCQlpZiAocGx1Z2lucy5ub3RpZnkobWUsICdiZWZvcmVFdmVudCcsIFtlXSkgPT09IGZhbHNlKSB7DQoJCQkJcmV0dXJuOw0KCQkJfQ0KDQoJCQkvLyBCdWZmZXIgYW55IHVwZGF0ZSBjYWxscyBzbyB0aGF0IHJlbmRlcnMgZG8gbm90IG9jY3VyDQoJCQltZS5fYnVmZmVyZWRSZW5kZXIgPSB0cnVlOw0KCQkJbWUuX2J1ZmZlcmVkUmVxdWVzdCA9IG51bGw7DQoNCgkJCXZhciBjaGFuZ2VkID0gbWUuaGFuZGxlRXZlbnQoZSk7DQoJCQljaGFuZ2VkIHw9IHRvb2x0aXAgJiYgdG9vbHRpcC5oYW5kbGVFdmVudChlKTsNCg0KCQkJcGx1Z2lucy5ub3RpZnkobWUsICdhZnRlckV2ZW50JywgW2VdKTsNCg0KCQkJdmFyIGJ1ZmZlcmVkUmVxdWVzdCA9IG1lLl9idWZmZXJlZFJlcXVlc3Q7DQoJCQlpZiAoYnVmZmVyZWRSZXF1ZXN0KSB7DQoJCQkJLy8gSWYgd2UgaGF2ZSBhbiB1cGRhdGUgdGhhdCB3YXMgdHJpZ2dlcmVkLCB3ZSBuZWVkIHRvIGRvIGEgbm9ybWFsIHJlbmRlcg0KCQkJCW1lLnJlbmRlcihidWZmZXJlZFJlcXVlc3QpOw0KCQkJfSBlbHNlIGlmIChjaGFuZ2VkICYmICFtZS5hbmltYXRpbmcpIHsNCgkJCQkvLyBJZiBlbnRlcmluZywgbGVhdmluZywgb3IgY2hhbmdpbmcgZWxlbWVudHMsIGFuaW1hdGUgdGhlIGNoYW5nZSB2aWEgcGl2b3QNCgkJCQltZS5zdG9wKCk7DQoNCgkJCQkvLyBXZSBvbmx5IG5lZWQgdG8gcmVuZGVyIGF0IHRoaXMgcG9pbnQuIFVwZGF0aW5nIHdpbGwgY2F1c2Ugc2NhbGVzIHRvIGJlDQoJCQkJLy8gcmVjb21wdXRlZCBnZW5lcmF0aW5nIGZsaWNrZXIgJiB1c2luZyBtb3JlIG1lbW9yeSB0aGFuIG5lY2Vzc2FyeS4NCgkJCQltZS5yZW5kZXIobWUub3B0aW9ucy5ob3Zlci5hbmltYXRpb25EdXJhdGlvbiwgdHJ1ZSk7DQoJCQl9DQoNCgkJCW1lLl9idWZmZXJlZFJlbmRlciA9IGZhbHNlOw0KCQkJbWUuX2J1ZmZlcmVkUmVxdWVzdCA9IG51bGw7DQoNCgkJCXJldHVybiBtZTsNCgkJfSwNCg0KCQkvKioNCgkJICogSGFuZGxlIGFuIGV2ZW50DQoJCSAqIEBwcml2YXRlDQoJCSAqIEBwYXJhbSB7SUV2ZW50fSBldmVudCB0aGUgZXZlbnQgdG8gaGFuZGxlDQoJCSAqIEByZXR1cm4ge0Jvb2xlYW59IHRydWUgaWYgdGhlIGNoYXJ0IG5lZWRzIHRvIHJlLXJlbmRlcg0KCQkgKi8NCgkJaGFuZGxlRXZlbnQ6IGZ1bmN0aW9uKGUpIHsNCgkJCXZhciBtZSA9IHRoaXM7DQoJCQl2YXIgb3B0aW9ucyA9IG1lLm9wdGlvbnMgfHwge307DQoJCQl2YXIgaG92ZXJPcHRpb25zID0gb3B0aW9ucy5ob3ZlcjsNCgkJCXZhciBjaGFuZ2VkID0gZmFsc2U7DQoNCgkJCW1lLmxhc3RBY3RpdmUgPSBtZS5sYXN0QWN0aXZlIHx8IFtdOw0KDQoJCQkvLyBGaW5kIEFjdGl2ZSBFbGVtZW50cyBmb3IgaG92ZXIgYW5kIHRvb2x0aXBzDQoJCQlpZiAoZS50eXBlID09PSAnbW91c2VvdXQnKSB7DQoJCQkJbWUuYWN0aXZlID0gW107DQoJCQl9IGVsc2Ugew0KCQkJCW1lLmFjdGl2ZSA9IG1lLmdldEVsZW1lbnRzQXRFdmVudEZvck1vZGUoZSwgaG92ZXJPcHRpb25zLm1vZGUsIGhvdmVyT3B0aW9ucyk7DQoJCQl9DQoNCgkJCS8vIEludm9rZSBvbkhvdmVyIGhvb2sNCgkJCS8vIE5lZWQgdG8gY2FsbCB3aXRoIG5hdGl2ZSBldmVudCBoZXJlIHRvIG5vdCBicmVhayBiYWNrd2FyZHMgY29tcGF0aWJpbGl0eQ0KCQkJaGVscGVycy5jYWxsYmFjayhvcHRpb25zLm9uSG92ZXIgfHwgb3B0aW9ucy5ob3Zlci5vbkhvdmVyLCBbZS5uYXRpdmUsIG1lLmFjdGl2ZV0sIG1lKTsNCg0KCQkJaWYgKGUudHlwZSA9PT0gJ21vdXNldXAnIHx8IGUudHlwZSA9PT0gJ2NsaWNrJykgew0KCQkJCWlmIChvcHRpb25zLm9uQ2xpY2spIHsNCgkJCQkJLy8gVXNlIGUubmF0aXZlIGhlcmUgZm9yIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5DQoJCQkJCW9wdGlvbnMub25DbGljay5jYWxsKG1lLCBlLm5hdGl2ZSwgbWUuYWN0aXZlKTsNCgkJCQl9DQoJCQl9DQoNCgkJCS8vIFJlbW92ZSBzdHlsaW5nIGZvciBsYXN0IGFjdGl2ZSAoZXZlbiBpZiBpdCBtYXkgc3RpbGwgYmUgYWN0aXZlKQ0KCQkJaWYgKG1lLmxhc3RBY3RpdmUubGVuZ3RoKSB7DQoJCQkJbWUudXBkYXRlSG92ZXJTdHlsZShtZS5sYXN0QWN0aXZlLCBob3Zlck9wdGlvbnMubW9kZSwgZmFsc2UpOw0KCQkJfQ0KDQoJCQkvLyBCdWlsdCBpbiBob3ZlciBzdHlsaW5nDQoJCQlpZiAobWUuYWN0aXZlLmxlbmd0aCAmJiBob3Zlck9wdGlvbnMubW9kZSkgew0KCQkJCW1lLnVwZGF0ZUhvdmVyU3R5bGUobWUuYWN0aXZlLCBob3Zlck9wdGlvbnMubW9kZSwgdHJ1ZSk7DQoJCQl9DQoNCgkJCWNoYW5nZWQgPSAhaGVscGVycy5hcnJheUVxdWFscyhtZS5hY3RpdmUsIG1lLmxhc3RBY3RpdmUpOw0KDQoJCQkvLyBSZW1lbWJlciBMYXN0IEFjdGl2ZXMNCgkJCW1lLmxhc3RBY3RpdmUgPSBtZS5hY3RpdmU7DQoNCgkJCXJldHVybiBjaGFuZ2VkOw0KCQl9DQoJfSk7DQoNCgkvKioNCgkgKiBQcm92aWRlZCBmb3IgYmFja3dhcmQgY29tcGF0aWJpbGl0eSwgdXNlIENoYXJ0IGluc3RlYWQuDQoJICogQGNsYXNzIENoYXJ0LkNvbnRyb2xsZXINCgkgKiBAZGVwcmVjYXRlZCBzaW5jZSB2ZXJzaW9uIDIuNi4wDQoJICogQHRvZG8gcmVtb3ZlIGF0IHZlcnNpb24gMw0KCSAqIEBwcml2YXRlDQoJICovDQoJQ2hhcnQuQ29udHJvbGxlciA9IENoYXJ0Ow0KfTsNCg0KfSx7IjI1IjoyNSwiMjgiOjI4LCI0NSI6NDUsIjQ4Ijo0OH1dLDI0OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsNCid1c2Ugc3RyaWN0JzsNCg0KdmFyIGhlbHBlcnMgPSByZXF1aXJlKDQ1KTsNCg0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihDaGFydCkgew0KDQoJdmFyIGFycmF5RXZlbnRzID0gWydwdXNoJywgJ3BvcCcsICdzaGlmdCcsICdzcGxpY2UnLCAndW5zaGlmdCddOw0KDQoJLyoqDQoJICogSG9va3MgdGhlIGFycmF5IG1ldGhvZHMgdGhhdCBhZGQgb3IgcmVtb3ZlIHZhbHVlcyAoJ3B1c2gnLCBwb3AnLCAnc2hpZnQnLCAnc3BsaWNlJywNCgkgKiAndW5zaGlmdCcpIGFuZCBub3RpZnkgdGhlIGxpc3RlbmVyIEFGVEVSIHRoZSBhcnJheSBoYXMgYmVlbiBhbHRlcmVkLiBMaXN0ZW5lcnMgYXJlDQoJICogY2FsbGVkIG9uIHRoZSAnb25EYXRhKicgY2FsbGJhY2tzIChlLmcuIG9uRGF0YVB1c2gsIGV0Yy4pIHdpdGggc2FtZSBhcmd1bWVudHMuDQoJICovDQoJZnVuY3Rpb24gbGlzdGVuQXJyYXlFdmVudHMoYXJyYXksIGxpc3RlbmVyKSB7DQoJCWlmIChhcnJheS5fY2hhcnRqcykgew0KCQkJYXJyYXkuX2NoYXJ0anMubGlzdGVuZXJzLnB1c2gobGlzdGVuZXIpOw0KCQkJcmV0dXJuOw0KCQl9DQoNCgkJT2JqZWN0LmRlZmluZVByb3BlcnR5KGFycmF5LCAnX2NoYXJ0anMnLCB7DQoJCQljb25maWd1cmFibGU6IHRydWUsDQoJCQllbnVtZXJhYmxlOiBmYWxzZSwNCgkJCXZhbHVlOiB7DQoJCQkJbGlzdGVuZXJzOiBbbGlzdGVuZXJdDQoJCQl9DQoJCX0pOw0KDQoJCWFycmF5RXZlbnRzLmZvckVhY2goZnVuY3Rpb24oa2V5KSB7DQoJCQl2YXIgbWV0aG9kID0gJ29uRGF0YScgKyBrZXkuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBrZXkuc2xpY2UoMSk7DQoJCQl2YXIgYmFzZSA9IGFycmF5W2tleV07DQoNCgkJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShhcnJheSwga2V5LCB7DQoJCQkJY29uZmlndXJhYmxlOiB0cnVlLA0KCQkJCWVudW1lcmFibGU6IGZhbHNlLA0KCQkJCXZhbHVlOiBmdW5jdGlvbigpIHsNCgkJCQkJdmFyIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpOw0KCQkJCQl2YXIgcmVzID0gYmFzZS5hcHBseSh0aGlzLCBhcmdzKTsNCg0KCQkJCQloZWxwZXJzLmVhY2goYXJyYXkuX2NoYXJ0anMubGlzdGVuZXJzLCBmdW5jdGlvbihvYmplY3QpIHsNCgkJCQkJCWlmICh0eXBlb2Ygb2JqZWN0W21ldGhvZF0gPT09ICdmdW5jdGlvbicpIHsNCgkJCQkJCQlvYmplY3RbbWV0aG9kXS5hcHBseShvYmplY3QsIGFyZ3MpOw0KCQkJCQkJfQ0KCQkJCQl9KTsNCg0KCQkJCQlyZXR1cm4gcmVzOw0KCQkJCX0NCgkJCX0pOw0KCQl9KTsNCgl9DQoNCgkvKioNCgkgKiBSZW1vdmVzIHRoZSBnaXZlbiBhcnJheSBldmVudCBsaXN0ZW5lciBhbmQgY2xlYW51cCBleHRyYSBhdHRhY2hlZCBwcm9wZXJ0aWVzIChzdWNoIGFzDQoJICogdGhlIF9jaGFydGpzIHN0dWIgYW5kIG92ZXJyaWRkZW4gbWV0aG9kcykgaWYgYXJyYXkgZG9lc24ndCBoYXZlIGFueSBtb3JlIGxpc3RlbmVycy4NCgkgKi8NCglmdW5jdGlvbiB1bmxpc3RlbkFycmF5RXZlbnRzKGFycmF5LCBsaXN0ZW5lcikgew0KCQl2YXIgc3R1YiA9IGFycmF5Ll9jaGFydGpzOw0KCQlpZiAoIXN0dWIpIHsNCgkJCXJldHVybjsNCgkJfQ0KDQoJCXZhciBsaXN0ZW5lcnMgPSBzdHViLmxpc3RlbmVyczsNCgkJdmFyIGluZGV4ID0gbGlzdGVuZXJzLmluZGV4T2YobGlzdGVuZXIpOw0KCQlpZiAoaW5kZXggIT09IC0xKSB7DQoJCQlsaXN0ZW5lcnMuc3BsaWNlKGluZGV4LCAxKTsNCgkJfQ0KDQoJCWlmIChsaXN0ZW5lcnMubGVuZ3RoID4gMCkgew0KCQkJcmV0dXJuOw0KCQl9DQoNCgkJYXJyYXlFdmVudHMuZm9yRWFjaChmdW5jdGlvbihrZXkpIHsNCgkJCWRlbGV0ZSBhcnJheVtrZXldOw0KCQl9KTsNCg0KCQlkZWxldGUgYXJyYXkuX2NoYXJ0anM7DQoJfQ0KDQoJLy8gQmFzZSBjbGFzcyBmb3IgYWxsIGRhdGFzZXQgY29udHJvbGxlcnMgKGxpbmUsIGJhciwgZXRjKQ0KCUNoYXJ0LkRhdGFzZXRDb250cm9sbGVyID0gZnVuY3Rpb24oY2hhcnQsIGRhdGFzZXRJbmRleCkgew0KCQl0aGlzLmluaXRpYWxpemUoY2hhcnQsIGRhdGFzZXRJbmRleCk7DQoJfTsNCg0KCWhlbHBlcnMuZXh0ZW5kKENoYXJ0LkRhdGFzZXRDb250cm9sbGVyLnByb3RvdHlwZSwgew0KDQoJCS8qKg0KCQkgKiBFbGVtZW50IHR5cGUgdXNlZCB0byBnZW5lcmF0ZSBhIG1ldGEgZGF0YXNldCAoZS5nLiBDaGFydC5lbGVtZW50LkxpbmUpLg0KCQkgKiBAdHlwZSB7Q2hhcnQuY29yZS5lbGVtZW50fQ0KCQkgKi8NCgkJZGF0YXNldEVsZW1lbnRUeXBlOiBudWxsLA0KDQoJCS8qKg0KCQkgKiBFbGVtZW50IHR5cGUgdXNlZCB0byBnZW5lcmF0ZSBhIG1ldGEgZGF0YSAoZS5nLiBDaGFydC5lbGVtZW50LlBvaW50KS4NCgkJICogQHR5cGUge0NoYXJ0LmNvcmUuZWxlbWVudH0NCgkJICovDQoJCWRhdGFFbGVtZW50VHlwZTogbnVsbCwNCg0KCQlpbml0aWFsaXplOiBmdW5jdGlvbihjaGFydCwgZGF0YXNldEluZGV4KSB7DQoJCQl2YXIgbWUgPSB0aGlzOw0KCQkJbWUuY2hhcnQgPSBjaGFydDsNCgkJCW1lLmluZGV4ID0gZGF0YXNldEluZGV4Ow0KCQkJbWUubGlua1NjYWxlcygpOw0KCQkJbWUuYWRkRWxlbWVudHMoKTsNCgkJfSwNCg0KCQl1cGRhdGVJbmRleDogZnVuY3Rpb24oZGF0YXNldEluZGV4KSB7DQoJCQl0aGlzLmluZGV4ID0gZGF0YXNldEluZGV4Ow0KCQl9LA0KDQoJCWxpbmtTY2FsZXM6IGZ1bmN0aW9uKCkgew0KCQkJdmFyIG1lID0gdGhpczsNCgkJCXZhciBtZXRhID0gbWUuZ2V0TWV0YSgpOw0KCQkJdmFyIGRhdGFzZXQgPSBtZS5nZXREYXRhc2V0KCk7DQoNCgkJCWlmIChtZXRhLnhBeGlzSUQgPT09IG51bGwpIHsNCgkJCQltZXRhLnhBeGlzSUQgPSBkYXRhc2V0LnhBeGlzSUQgfHwgbWUuY2hhcnQub3B0aW9ucy5zY2FsZXMueEF4ZXNbMF0uaWQ7DQoJCQl9DQoJCQlpZiAobWV0YS55QXhpc0lEID09PSBudWxsKSB7DQoJCQkJbWV0YS55QXhpc0lEID0gZGF0YXNldC55QXhpc0lEIHx8IG1lLmNoYXJ0Lm9wdGlvbnMuc2NhbGVzLnlBeGVzWzBdLmlkOw0KCQkJfQ0KCQl9LA0KDQoJCWdldERhdGFzZXQ6IGZ1bmN0aW9uKCkgew0KCQkJcmV0dXJuIHRoaXMuY2hhcnQuZGF0YS5kYXRhc2V0c1t0aGlzLmluZGV4XTsNCgkJfSwNCg0KCQlnZXRNZXRhOiBmdW5jdGlvbigpIHsNCgkJCXJldHVybiB0aGlzLmNoYXJ0LmdldERhdGFzZXRNZXRhKHRoaXMuaW5kZXgpOw0KCQl9LA0KDQoJCWdldFNjYWxlRm9ySWQ6IGZ1bmN0aW9uKHNjYWxlSUQpIHsNCgkJCXJldHVybiB0aGlzLmNoYXJ0LnNjYWxlc1tzY2FsZUlEXTsNCgkJfSwNCg0KCQlyZXNldDogZnVuY3Rpb24oKSB7DQoJCQl0aGlzLnVwZGF0ZSh0cnVlKTsNCgkJfSwNCg0KCQkvKioNCgkJICogQHByaXZhdGUNCgkJICovDQoJCWRlc3Ryb3k6IGZ1bmN0aW9uKCkgew0KCQkJaWYgKHRoaXMuX2RhdGEpIHsNCgkJCQl1bmxpc3RlbkFycmF5RXZlbnRzKHRoaXMuX2RhdGEsIHRoaXMpOw0KCQkJfQ0KCQl9LA0KDQoJCWNyZWF0ZU1ldGFEYXRhc2V0OiBmdW5jdGlvbigpIHsNCgkJCXZhciBtZSA9IHRoaXM7DQoJCQl2YXIgdHlwZSA9IG1lLmRhdGFzZXRFbGVtZW50VHlwZTsNCgkJCXJldHVybiB0eXBlICYmIG5ldyB0eXBlKHsNCgkJCQlfY2hhcnQ6IG1lLmNoYXJ0LA0KCQkJCV9kYXRhc2V0SW5kZXg6IG1lLmluZGV4DQoJCQl9KTsNCgkJfSwNCg0KCQljcmVhdGVNZXRhRGF0YTogZnVuY3Rpb24oaW5kZXgpIHsNCgkJCXZhciBtZSA9IHRoaXM7DQoJCQl2YXIgdHlwZSA9IG1lLmRhdGFFbGVtZW50VHlwZTsNCgkJCXJldHVybiB0eXBlICYmIG5ldyB0eXBlKHsNCgkJCQlfY2hhcnQ6IG1lLmNoYXJ0LA0KCQkJCV9kYXRhc2V0SW5kZXg6IG1lLmluZGV4LA0KCQkJCV9pbmRleDogaW5kZXgNCgkJCX0pOw0KCQl9LA0KDQoJCWFkZEVsZW1lbnRzOiBmdW5jdGlvbigpIHsNCgkJCXZhciBtZSA9IHRoaXM7DQoJCQl2YXIgbWV0YSA9IG1lLmdldE1ldGEoKTsNCgkJCXZhciBkYXRhID0gbWUuZ2V0RGF0YXNldCgpLmRhdGEgfHwgW107DQoJCQl2YXIgbWV0YURhdGEgPSBtZXRhLmRhdGE7DQoJCQl2YXIgaSwgaWxlbjsNCg0KCQkJZm9yIChpID0gMCwgaWxlbiA9IGRhdGEubGVuZ3RoOyBpIDwgaWxlbjsgKytpKSB7DQoJCQkJbWV0YURhdGFbaV0gPSBtZXRhRGF0YVtpXSB8fCBtZS5jcmVhdGVNZXRhRGF0YShpKTsNCgkJCX0NCg0KCQkJbWV0YS5kYXRhc2V0ID0gbWV0YS5kYXRhc2V0IHx8IG1lLmNyZWF0ZU1ldGFEYXRhc2V0KCk7DQoJCX0sDQoNCgkJYWRkRWxlbWVudEFuZFJlc2V0OiBmdW5jdGlvbihpbmRleCkgew0KCQkJdmFyIGVsZW1lbnQgPSB0aGlzLmNyZWF0ZU1ldGFEYXRhKGluZGV4KTsNCgkJCXRoaXMuZ2V0TWV0YSgpLmRhdGEuc3BsaWNlKGluZGV4LCAwLCBlbGVtZW50KTsNCgkJCXRoaXMudXBkYXRlRWxlbWVudChlbGVtZW50LCBpbmRleCwgdHJ1ZSk7DQoJCX0sDQoNCgkJYnVpbGRPclVwZGF0ZUVsZW1lbnRzOiBmdW5jdGlvbigpIHsNCgkJCXZhciBtZSA9IHRoaXM7DQoJCQl2YXIgZGF0YXNldCA9IG1lLmdldERhdGFzZXQoKTsNCgkJCXZhciBkYXRhID0gZGF0YXNldC5kYXRhIHx8IChkYXRhc2V0LmRhdGEgPSBbXSk7DQoNCgkJCS8vIEluIG9yZGVyIHRvIGNvcnJlY3RseSBoYW5kbGUgZGF0YSBhZGRpdGlvbi9kZWxldGlvbiBhbmltYXRpb24gKGFuIHRodXMgc2ltdWxhdGUNCgkJCS8vIHJlYWwtdGltZSBjaGFydHMpLCB3ZSBuZWVkIHRvIG1vbml0b3IgdGhlc2UgZGF0YSBtb2RpZmljYXRpb25zIGFuZCBzeW5jaHJvbml6ZQ0KCQkJLy8gdGhlIGludGVybmFsIG1ldGEgZGF0YSBhY2NvcmRpbmdseS4NCgkJCWlmIChtZS5fZGF0YSAhPT0gZGF0YSkgew0KCQkJCWlmIChtZS5fZGF0YSkgew0KCQkJCQkvLyBUaGlzIGNhc2UgaGFwcGVucyB3aGVuIHRoZSB1c2VyIHJlcGxhY2VkIHRoZSBkYXRhIGFycmF5IGluc3RhbmNlLg0KCQkJCQl1bmxpc3RlbkFycmF5RXZlbnRzKG1lLl9kYXRhLCBtZSk7DQoJCQkJfQ0KDQoJCQkJbGlzdGVuQXJyYXlFdmVudHMoZGF0YSwgbWUpOw0KCQkJCW1lLl9kYXRhID0gZGF0YTsNCgkJCX0NCg0KCQkJLy8gUmUtc3luYyBtZXRhIGRhdGEgaW4gY2FzZSB0aGUgdXNlciByZXBsYWNlZCB0aGUgZGF0YSBhcnJheSBvciBpZiB3ZSBtaXNzZWQNCgkJCS8vIGFueSB1cGRhdGVzIGFuZCBzbyBtYWtlIHN1cmUgdGhhdCB3ZSBoYW5kbGUgbnVtYmVyIG9mIGRhdGFwb2ludHMgY2hhbmdpbmcuDQoJCQltZS5yZXN5bmNFbGVtZW50cygpOw0KCQl9LA0KDQoJCXVwZGF0ZTogaGVscGVycy5ub29wLA0KDQoJCXRyYW5zaXRpb246IGZ1bmN0aW9uKGVhc2luZ1ZhbHVlKSB7DQoJCQl2YXIgbWV0YSA9IHRoaXMuZ2V0TWV0YSgpOw0KCQkJdmFyIGVsZW1lbnRzID0gbWV0YS5kYXRhIHx8IFtdOw0KCQkJdmFyIGlsZW4gPSBlbGVtZW50cy5sZW5ndGg7DQoJCQl2YXIgaSA9IDA7DQoNCgkJCWZvciAoOyBpIDwgaWxlbjsgKytpKSB7DQoJCQkJZWxlbWVudHNbaV0udHJhbnNpdGlvbihlYXNpbmdWYWx1ZSk7DQoJCQl9DQoNCgkJCWlmIChtZXRhLmRhdGFzZXQpIHsNCgkJCQltZXRhLmRhdGFzZXQudHJhbnNpdGlvbihlYXNpbmdWYWx1ZSk7DQoJCQl9DQoJCX0sDQoNCgkJZHJhdzogZnVuY3Rpb24oKSB7DQoJCQl2YXIgbWV0YSA9IHRoaXMuZ2V0TWV0YSgpOw0KCQkJdmFyIGVsZW1lbnRzID0gbWV0YS5kYXRhIHx8IFtdOw0KCQkJdmFyIGlsZW4gPSBlbGVtZW50cy5sZW5ndGg7DQoJCQl2YXIgaSA9IDA7DQoNCgkJCWlmIChtZXRhLmRhdGFzZXQpIHsNCgkJCQltZXRhLmRhdGFzZXQuZHJhdygpOw0KCQkJfQ0KDQoJCQlmb3IgKDsgaSA8IGlsZW47ICsraSkgew0KCQkJCWVsZW1lbnRzW2ldLmRyYXcoKTsNCgkJCX0NCgkJfSwNCg0KCQlyZW1vdmVIb3ZlclN0eWxlOiBmdW5jdGlvbihlbGVtZW50LCBlbGVtZW50T3B0cykgew0KCQkJdmFyIGRhdGFzZXQgPSB0aGlzLmNoYXJ0LmRhdGEuZGF0YXNldHNbZWxlbWVudC5fZGF0YXNldEluZGV4XTsNCgkJCXZhciBpbmRleCA9IGVsZW1lbnQuX2luZGV4Ow0KCQkJdmFyIGN1c3RvbSA9IGVsZW1lbnQuY3VzdG9tIHx8IHt9Ow0KCQkJdmFyIHZhbHVlT3JEZWZhdWx0ID0gaGVscGVycy52YWx1ZUF0SW5kZXhPckRlZmF1bHQ7DQoJCQl2YXIgbW9kZWwgPSBlbGVtZW50Ll9tb2RlbDsNCg0KCQkJbW9kZWwuYmFja2dyb3VuZENvbG9yID0gY3VzdG9tLmJhY2tncm91bmRDb2xvciA/IGN1c3RvbS5iYWNrZ3JvdW5kQ29sb3IgOiB2YWx1ZU9yRGVmYXVsdChkYXRhc2V0LmJhY2tncm91bmRDb2xvciwgaW5kZXgsIGVsZW1lbnRPcHRzLmJhY2tncm91bmRDb2xvcik7DQoJCQltb2RlbC5ib3JkZXJDb2xvciA9IGN1c3RvbS5ib3JkZXJDb2xvciA/IGN1c3RvbS5ib3JkZXJDb2xvciA6IHZhbHVlT3JEZWZhdWx0KGRhdGFzZXQuYm9yZGVyQ29sb3IsIGluZGV4LCBlbGVtZW50T3B0cy5ib3JkZXJDb2xvcik7DQoJCQltb2RlbC5ib3JkZXJXaWR0aCA9IGN1c3RvbS5ib3JkZXJXaWR0aCA/IGN1c3RvbS5ib3JkZXJXaWR0aCA6IHZhbHVlT3JEZWZhdWx0KGRhdGFzZXQuYm9yZGVyV2lkdGgsIGluZGV4LCBlbGVtZW50T3B0cy5ib3JkZXJXaWR0aCk7DQoJCX0sDQoNCgkJc2V0SG92ZXJTdHlsZTogZnVuY3Rpb24oZWxlbWVudCkgew0KCQkJdmFyIGRhdGFzZXQgPSB0aGlzLmNoYXJ0LmRhdGEuZGF0YXNldHNbZWxlbWVudC5fZGF0YXNldEluZGV4XTsNCgkJCXZhciBpbmRleCA9IGVsZW1lbnQuX2luZGV4Ow0KCQkJdmFyIGN1c3RvbSA9IGVsZW1lbnQuY3VzdG9tIHx8IHt9Ow0KCQkJdmFyIHZhbHVlT3JEZWZhdWx0ID0gaGVscGVycy52YWx1ZUF0SW5kZXhPckRlZmF1bHQ7DQoJCQl2YXIgZ2V0SG92ZXJDb2xvciA9IGhlbHBlcnMuZ2V0SG92ZXJDb2xvcjsNCgkJCXZhciBtb2RlbCA9IGVsZW1lbnQuX21vZGVsOw0KDQoJCQltb2RlbC5iYWNrZ3JvdW5kQ29sb3IgPSBjdXN0b20uaG92ZXJCYWNrZ3JvdW5kQ29sb3IgPyBjdXN0b20uaG92ZXJCYWNrZ3JvdW5kQ29sb3IgOiB2YWx1ZU9yRGVmYXVsdChkYXRhc2V0LmhvdmVyQmFja2dyb3VuZENvbG9yLCBpbmRleCwgZ2V0SG92ZXJDb2xvcihtb2RlbC5iYWNrZ3JvdW5kQ29sb3IpKTsNCgkJCW1vZGVsLmJvcmRlckNvbG9yID0gY3VzdG9tLmhvdmVyQm9yZGVyQ29sb3IgPyBjdXN0b20uaG92ZXJCb3JkZXJDb2xvciA6IHZhbHVlT3JEZWZhdWx0KGRhdGFzZXQuaG92ZXJCb3JkZXJDb2xvciwgaW5kZXgsIGdldEhvdmVyQ29sb3IobW9kZWwuYm9yZGVyQ29sb3IpKTsNCgkJCW1vZGVsLmJvcmRlcldpZHRoID0gY3VzdG9tLmhvdmVyQm9yZGVyV2lkdGggPyBjdXN0b20uaG92ZXJCb3JkZXJXaWR0aCA6IHZhbHVlT3JEZWZhdWx0KGRhdGFzZXQuaG92ZXJCb3JkZXJXaWR0aCwgaW5kZXgsIG1vZGVsLmJvcmRlcldpZHRoKTsNCgkJfSwNCg0KCQkvKioNCgkJICogQHByaXZhdGUNCgkJICovDQoJCXJlc3luY0VsZW1lbnRzOiBmdW5jdGlvbigpIHsNCgkJCXZhciBtZSA9IHRoaXM7DQoJCQl2YXIgbWV0YSA9IG1lLmdldE1ldGEoKTsNCgkJCXZhciBkYXRhID0gbWUuZ2V0RGF0YXNldCgpLmRhdGE7DQoJCQl2YXIgbnVtTWV0YSA9IG1ldGEuZGF0YS5sZW5ndGg7DQoJCQl2YXIgbnVtRGF0YSA9IGRhdGEubGVuZ3RoOw0KDQoJCQlpZiAobnVtRGF0YSA8IG51bU1ldGEpIHsNCgkJCQltZXRhLmRhdGEuc3BsaWNlKG51bURhdGEsIG51bU1ldGEgLSBudW1EYXRhKTsNCgkJCX0gZWxzZSBpZiAobnVtRGF0YSA+IG51bU1ldGEpIHsNCgkJCQltZS5pbnNlcnRFbGVtZW50cyhudW1NZXRhLCBudW1EYXRhIC0gbnVtTWV0YSk7DQoJCQl9DQoJCX0sDQoNCgkJLyoqDQoJCSAqIEBwcml2YXRlDQoJCSAqLw0KCQlpbnNlcnRFbGVtZW50czogZnVuY3Rpb24oc3RhcnQsIGNvdW50KSB7DQoJCQlmb3IgKHZhciBpID0gMDsgaSA8IGNvdW50OyArK2kpIHsNCgkJCQl0aGlzLmFkZEVsZW1lbnRBbmRSZXNldChzdGFydCArIGkpOw0KCQkJfQ0KCQl9LA0KDQoJCS8qKg0KCQkgKiBAcHJpdmF0ZQ0KCQkgKi8NCgkJb25EYXRhUHVzaDogZnVuY3Rpb24oKSB7DQoJCQl0aGlzLmluc2VydEVsZW1lbnRzKHRoaXMuZ2V0RGF0YXNldCgpLmRhdGEubGVuZ3RoIC0gMSwgYXJndW1lbnRzLmxlbmd0aCk7DQoJCX0sDQoNCgkJLyoqDQoJCSAqIEBwcml2YXRlDQoJCSAqLw0KCQlvbkRhdGFQb3A6IGZ1bmN0aW9uKCkgew0KCQkJdGhpcy5nZXRNZXRhKCkuZGF0YS5wb3AoKTsNCgkJfSwNCg0KCQkvKioNCgkJICogQHByaXZhdGUNCgkJICovDQoJCW9uRGF0YVNoaWZ0OiBmdW5jdGlvbigpIHsNCgkJCXRoaXMuZ2V0TWV0YSgpLmRhdGEuc2hpZnQoKTsNCgkJfSwNCg0KCQkvKioNCgkJICogQHByaXZhdGUNCgkJICovDQoJCW9uRGF0YVNwbGljZTogZnVuY3Rpb24oc3RhcnQsIGNvdW50KSB7DQoJCQl0aGlzLmdldE1ldGEoKS5kYXRhLnNwbGljZShzdGFydCwgY291bnQpOw0KCQkJdGhpcy5pbnNlcnRFbGVtZW50cyhzdGFydCwgYXJndW1lbnRzLmxlbmd0aCAtIDIpOw0KCQl9LA0KDQoJCS8qKg0KCQkgKiBAcHJpdmF0ZQ0KCQkgKi8NCgkJb25EYXRhVW5zaGlmdDogZnVuY3Rpb24oKSB7DQoJCQl0aGlzLmluc2VydEVsZW1lbnRzKDAsIGFyZ3VtZW50cy5sZW5ndGgpOw0KCQl9DQoJfSk7DQoNCglDaGFydC5EYXRhc2V0Q29udHJvbGxlci5leHRlbmQgPSBoZWxwZXJzLmluaGVyaXRzOw0KfTsNCg0KfSx7IjQ1Ijo0NX1dLDI1OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsNCid1c2Ugc3RyaWN0JzsNCg0KdmFyIGhlbHBlcnMgPSByZXF1aXJlKDQ1KTsNCg0KbW9kdWxlLmV4cG9ydHMgPSB7DQoJLyoqDQoJICogQHByaXZhdGUNCgkgKi8NCglfc2V0OiBmdW5jdGlvbihzY29wZSwgdmFsdWVzKSB7DQoJCXJldHVybiBoZWxwZXJzLm1lcmdlKHRoaXNbc2NvcGVdIHx8ICh0aGlzW3Njb3BlXSA9IHt9KSwgdmFsdWVzKTsNCgl9DQp9Ow0KDQp9LHsiNDUiOjQ1fV0sMjY6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpew0KJ3VzZSBzdHJpY3QnOw0KDQp2YXIgY29sb3IgPSByZXF1aXJlKDIpOw0KdmFyIGhlbHBlcnMgPSByZXF1aXJlKDQ1KTsNCg0KZnVuY3Rpb24gaW50ZXJwb2xhdGUoc3RhcnQsIHZpZXcsIG1vZGVsLCBlYXNlKSB7DQoJdmFyIGtleXMgPSBPYmplY3Qua2V5cyhtb2RlbCk7DQoJdmFyIGksIGlsZW4sIGtleSwgYWN0dWFsLCBvcmlnaW4sIHRhcmdldCwgdHlwZSwgYzAsIGMxOw0KDQoJZm9yIChpID0gMCwgaWxlbiA9IGtleXMubGVuZ3RoOyBpIDwgaWxlbjsgKytpKSB7DQoJCWtleSA9IGtleXNbaV07DQoNCgkJdGFyZ2V0ID0gbW9kZWxba2V5XTsNCg0KCQkvLyBpZiBhIHZhbHVlIGlzIGFkZGVkIHRvIHRoZSBtb2RlbCBhZnRlciBwaXZvdCgpIGhhcyBiZWVuIGNhbGxlZCwgdGhlIHZpZXcNCgkJLy8gZG9lc24ndCBjb250YWluIGl0LCBzbyBsZXQncyBpbml0aWFsaXplIHRoZSB2aWV3IHRvIHRoZSB0YXJnZXQgdmFsdWUuDQoJCWlmICghdmlldy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7DQoJCQl2aWV3W2tleV0gPSB0YXJnZXQ7DQoJCX0NCg0KCQlhY3R1YWwgPSB2aWV3W2tleV07DQoNCgkJaWYgKGFjdHVhbCA9PT0gdGFyZ2V0IHx8IGtleVswXSA9PT0gJ18nKSB7DQoJCQljb250aW51ZTsNCgkJfQ0KDQoJCWlmICghc3RhcnQuaGFzT3duUHJvcGVydHkoa2V5KSkgew0KCQkJc3RhcnRba2V5XSA9IGFjdHVhbDsNCgkJfQ0KDQoJCW9yaWdpbiA9IHN0YXJ0W2tleV07DQoNCgkJdHlwZSA9IHR5cGVvZiB0YXJnZXQ7DQoNCgkJaWYgKHR5cGUgPT09IHR5cGVvZiBvcmlnaW4pIHsNCgkJCWlmICh0eXBlID09PSAnc3RyaW5nJykgew0KCQkJCWMwID0gY29sb3Iob3JpZ2luKTsNCgkJCQlpZiAoYzAudmFsaWQpIHsNCgkJCQkJYzEgPSBjb2xvcih0YXJnZXQpOw0KCQkJCQlpZiAoYzEudmFsaWQpIHsNCgkJCQkJCXZpZXdba2V5XSA9IGMxLm1peChjMCwgZWFzZSkucmdiU3RyaW5nKCk7DQoJCQkJCQljb250aW51ZTsNCgkJCQkJfQ0KCQkJCX0NCgkJCX0gZWxzZSBpZiAodHlwZSA9PT0gJ251bWJlcicgJiYgaXNGaW5pdGUob3JpZ2luKSAmJiBpc0Zpbml0ZSh0YXJnZXQpKSB7DQoJCQkJdmlld1trZXldID0gb3JpZ2luICsgKHRhcmdldCAtIG9yaWdpbikgKiBlYXNlOw0KCQkJCWNvbnRpbnVlOw0KCQkJfQ0KCQl9DQoNCgkJdmlld1trZXldID0gdGFyZ2V0Ow0KCX0NCn0NCg0KdmFyIEVsZW1lbnQgPSBmdW5jdGlvbihjb25maWd1cmF0aW9uKSB7DQoJaGVscGVycy5leHRlbmQodGhpcywgY29uZmlndXJhdGlvbik7DQoJdGhpcy5pbml0aWFsaXplLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7DQp9Ow0KDQpoZWxwZXJzLmV4dGVuZChFbGVtZW50LnByb3RvdHlwZSwgew0KDQoJaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7DQoJCXRoaXMuaGlkZGVuID0gZmFsc2U7DQoJfSwNCg0KCXBpdm90OiBmdW5jdGlvbigpIHsNCgkJdmFyIG1lID0gdGhpczsNCgkJaWYgKCFtZS5fdmlldykgew0KCQkJbWUuX3ZpZXcgPSBoZWxwZXJzLmNsb25lKG1lLl9tb2RlbCk7DQoJCX0NCgkJbWUuX3N0YXJ0ID0ge307DQoJCXJldHVybiBtZTsNCgl9LA0KDQoJdHJhbnNpdGlvbjogZnVuY3Rpb24oZWFzZSkgew0KCQl2YXIgbWUgPSB0aGlzOw0KCQl2YXIgbW9kZWwgPSBtZS5fbW9kZWw7DQoJCXZhciBzdGFydCA9IG1lLl9zdGFydDsNCgkJdmFyIHZpZXcgPSBtZS5fdmlldzsNCg0KCQkvLyBObyBhbmltYXRpb24gLT4gTm8gVHJhbnNpdGlvbg0KCQlpZiAoIW1vZGVsIHx8IGVhc2UgPT09IDEpIHsNCgkJCW1lLl92aWV3ID0gbW9kZWw7DQoJCQltZS5fc3RhcnQgPSBudWxsOw0KCQkJcmV0dXJuIG1lOw0KCQl9DQoNCgkJaWYgKCF2aWV3KSB7DQoJCQl2aWV3ID0gbWUuX3ZpZXcgPSB7fTsNCgkJfQ0KDQoJCWlmICghc3RhcnQpIHsNCgkJCXN0YXJ0ID0gbWUuX3N0YXJ0ID0ge307DQoJCX0NCg0KCQlpbnRlcnBvbGF0ZShzdGFydCwgdmlldywgbW9kZWwsIGVhc2UpOw0KDQoJCXJldHVybiBtZTsNCgl9LA0KDQoJdG9vbHRpcFBvc2l0aW9uOiBmdW5jdGlvbigpIHsNCgkJcmV0dXJuIHsNCgkJCXg6IHRoaXMuX21vZGVsLngsDQoJCQl5OiB0aGlzLl9tb2RlbC55DQoJCX07DQoJfSwNCg0KCWhhc1ZhbHVlOiBmdW5jdGlvbigpIHsNCgkJcmV0dXJuIGhlbHBlcnMuaXNOdW1iZXIodGhpcy5fbW9kZWwueCkgJiYgaGVscGVycy5pc051bWJlcih0aGlzLl9tb2RlbC55KTsNCgl9DQp9KTsNCg0KRWxlbWVudC5leHRlbmQgPSBoZWxwZXJzLmluaGVyaXRzOw0KDQptb2R1bGUuZXhwb3J0cyA9IEVsZW1lbnQ7DQoNCn0seyIyIjoyLCI0NSI6NDV9XSwyNzpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7DQovKiBnbG9iYWwgd2luZG93OiBmYWxzZSAqLw0KLyogZ2xvYmFsIGRvY3VtZW50OiBmYWxzZSAqLw0KJ3VzZSBzdHJpY3QnOw0KDQp2YXIgY29sb3IgPSByZXF1aXJlKDIpOw0KdmFyIGRlZmF1bHRzID0gcmVxdWlyZSgyNSk7DQp2YXIgaGVscGVycyA9IHJlcXVpcmUoNDUpOw0KDQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKENoYXJ0KSB7DQoNCgkvLyAtLSBCYXNpYyBqcyB1dGlsaXR5IG1ldGhvZHMNCg0KCWhlbHBlcnMuY29uZmlnTWVyZ2UgPSBmdW5jdGlvbigvKiBvYmplY3RzIC4uLiAqLykgew0KCQlyZXR1cm4gaGVscGVycy5tZXJnZShoZWxwZXJzLmNsb25lKGFyZ3VtZW50c1swXSksIFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSwgew0KCQkJbWVyZ2VyOiBmdW5jdGlvbihrZXksIHRhcmdldCwgc291cmNlLCBvcHRpb25zKSB7DQoJCQkJdmFyIHR2YWwgPSB0YXJnZXRba2V5XSB8fCB7fTsNCgkJCQl2YXIgc3ZhbCA9IHNvdXJjZVtrZXldOw0KDQoJCQkJaWYgKGtleSA9PT0gJ3NjYWxlcycpIHsNCgkJCQkJLy8gc2NhbGUgY29uZmlnIG1lcmdpbmcgaXMgY29tcGxleC4gQWRkIG91ciBvd24gZnVuY3Rpb24gaGVyZSBmb3IgdGhhdA0KCQkJCQl0YXJnZXRba2V5XSA9IGhlbHBlcnMuc2NhbGVNZXJnZSh0dmFsLCBzdmFsKTsNCgkJCQl9IGVsc2UgaWYgKGtleSA9PT0gJ3NjYWxlJykgew0KCQkJCQkvLyB1c2VkIGluIHBvbGFyIGFyZWEgJiByYWRhciBjaGFydHMgc2luY2UgdGhlcmUgaXMgb25seSBvbmUgc2NhbGUNCgkJCQkJdGFyZ2V0W2tleV0gPSBoZWxwZXJzLm1lcmdlKHR2YWwsIFtDaGFydC5zY2FsZVNlcnZpY2UuZ2V0U2NhbGVEZWZhdWx0cyhzdmFsLnR5cGUpLCBzdmFsXSk7DQoJCQkJfSBlbHNlIHsNCgkJCQkJaGVscGVycy5fbWVyZ2VyKGtleSwgdGFyZ2V0LCBzb3VyY2UsIG9wdGlvbnMpOw0KCQkJCX0NCgkJCX0NCgkJfSk7DQoJfTsNCg0KCWhlbHBlcnMuc2NhbGVNZXJnZSA9IGZ1bmN0aW9uKC8qIG9iamVjdHMgLi4uICovKSB7DQoJCXJldHVybiBoZWxwZXJzLm1lcmdlKGhlbHBlcnMuY2xvbmUoYXJndW1lbnRzWzBdKSwgW10uc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpLCB7DQoJCQltZXJnZXI6IGZ1bmN0aW9uKGtleSwgdGFyZ2V0LCBzb3VyY2UsIG9wdGlvbnMpIHsNCgkJCQlpZiAoa2V5ID09PSAneEF4ZXMnIHx8IGtleSA9PT0gJ3lBeGVzJykgew0KCQkJCQl2YXIgc2xlbiA9IHNvdXJjZVtrZXldLmxlbmd0aDsNCgkJCQkJdmFyIGksIHR5cGUsIHNjYWxlOw0KDQoJCQkJCWlmICghdGFyZ2V0W2tleV0pIHsNCgkJCQkJCXRhcmdldFtrZXldID0gW107DQoJCQkJCX0NCg0KCQkJCQlmb3IgKGkgPSAwOyBpIDwgc2xlbjsgKytpKSB7DQoJCQkJCQlzY2FsZSA9IHNvdXJjZVtrZXldW2ldOw0KCQkJCQkJdHlwZSA9IGhlbHBlcnMudmFsdWVPckRlZmF1bHQoc2NhbGUudHlwZSwga2V5ID09PSAneEF4ZXMnID8gJ2NhdGVnb3J5JyA6ICdsaW5lYXInKTsNCg0KCQkJCQkJaWYgKGkgPj0gdGFyZ2V0W2tleV0ubGVuZ3RoKSB7DQoJCQkJCQkJdGFyZ2V0W2tleV0ucHVzaCh7fSk7DQoJCQkJCQl9DQoNCgkJCQkJCWlmICghdGFyZ2V0W2tleV1baV0udHlwZSB8fCAoc2NhbGUudHlwZSAmJiBzY2FsZS50eXBlICE9PSB0YXJnZXRba2V5XVtpXS50eXBlKSkgew0KCQkJCQkJCS8vIG5ldy91bnR5cGVkIHNjYWxlIG9yIHR5cGUgY2hhbmdlZDogbGV0J3MgYXBwbHkgdGhlIG5ldyBkZWZhdWx0cw0KCQkJCQkJCS8vIHRoZW4gbWVyZ2Ugc291cmNlIHNjYWxlIHRvIGNvcnJlY3RseSBvdmVyd3JpdGUgdGhlIGRlZmF1bHRzLg0KCQkJCQkJCWhlbHBlcnMubWVyZ2UodGFyZ2V0W2tleV1baV0sIFtDaGFydC5zY2FsZVNlcnZpY2UuZ2V0U2NhbGVEZWZhdWx0cyh0eXBlKSwgc2NhbGVdKTsNCgkJCQkJCX0gZWxzZSB7DQoJCQkJCQkJLy8gc2NhbGVzIHR5cGUgYXJlIHRoZSBzYW1lDQoJCQkJCQkJaGVscGVycy5tZXJnZSh0YXJnZXRba2V5XVtpXSwgc2NhbGUpOw0KCQkJCQkJfQ0KCQkJCQl9DQoJCQkJfSBlbHNlIHsNCgkJCQkJaGVscGVycy5fbWVyZ2VyKGtleSwgdGFyZ2V0LCBzb3VyY2UsIG9wdGlvbnMpOw0KCQkJCX0NCgkJCX0NCgkJfSk7DQoJfTsNCg0KCWhlbHBlcnMud2hlcmUgPSBmdW5jdGlvbihjb2xsZWN0aW9uLCBmaWx0ZXJDYWxsYmFjaykgew0KCQlpZiAoaGVscGVycy5pc0FycmF5KGNvbGxlY3Rpb24pICYmIEFycmF5LnByb3RvdHlwZS5maWx0ZXIpIHsNCgkJCXJldHVybiBjb2xsZWN0aW9uLmZpbHRlcihmaWx0ZXJDYWxsYmFjayk7DQoJCX0NCgkJdmFyIGZpbHRlcmVkID0gW107DQoNCgkJaGVscGVycy5lYWNoKGNvbGxlY3Rpb24sIGZ1bmN0aW9uKGl0ZW0pIHsNCgkJCWlmIChmaWx0ZXJDYWxsYmFjayhpdGVtKSkgew0KCQkJCWZpbHRlcmVkLnB1c2goaXRlbSk7DQoJCQl9DQoJCX0pOw0KDQoJCXJldHVybiBmaWx0ZXJlZDsNCgl9Ow0KCWhlbHBlcnMuZmluZEluZGV4ID0gQXJyYXkucHJvdG90eXBlLmZpbmRJbmRleCA/DQoJCWZ1bmN0aW9uKGFycmF5LCBjYWxsYmFjaywgc2NvcGUpIHsNCgkJCXJldHVybiBhcnJheS5maW5kSW5kZXgoY2FsbGJhY2ssIHNjb3BlKTsNCgkJfSA6DQoJCWZ1bmN0aW9uKGFycmF5LCBjYWxsYmFjaywgc2NvcGUpIHsNCgkJCXNjb3BlID0gc2NvcGUgPT09IHVuZGVmaW5lZCA/IGFycmF5IDogc2NvcGU7DQoJCQlmb3IgKHZhciBpID0gMCwgaWxlbiA9IGFycmF5Lmxlbmd0aDsgaSA8IGlsZW47ICsraSkgew0KCQkJCWlmIChjYWxsYmFjay5jYWxsKHNjb3BlLCBhcnJheVtpXSwgaSwgYXJyYXkpKSB7DQoJCQkJCXJldHVybiBpOw0KCQkJCX0NCgkJCX0NCgkJCXJldHVybiAtMTsNCgkJfTsNCgloZWxwZXJzLmZpbmROZXh0V2hlcmUgPSBmdW5jdGlvbihhcnJheVRvU2VhcmNoLCBmaWx0ZXJDYWxsYmFjaywgc3RhcnRJbmRleCkgew0KCQkvLyBEZWZhdWx0IHRvIHN0YXJ0IG9mIHRoZSBhcnJheQ0KCQlpZiAoaGVscGVycy5pc051bGxPclVuZGVmKHN0YXJ0SW5kZXgpKSB7DQoJCQlzdGFydEluZGV4ID0gLTE7DQoJCX0NCgkJZm9yICh2YXIgaSA9IHN0YXJ0SW5kZXggKyAxOyBpIDwgYXJyYXlUb1NlYXJjaC5sZW5ndGg7IGkrKykgew0KCQkJdmFyIGN1cnJlbnRJdGVtID0gYXJyYXlUb1NlYXJjaFtpXTsNCgkJCWlmIChmaWx0ZXJDYWxsYmFjayhjdXJyZW50SXRlbSkpIHsNCgkJCQlyZXR1cm4gY3VycmVudEl0ZW07DQoJCQl9DQoJCX0NCgl9Ow0KCWhlbHBlcnMuZmluZFByZXZpb3VzV2hlcmUgPSBmdW5jdGlvbihhcnJheVRvU2VhcmNoLCBmaWx0ZXJDYWxsYmFjaywgc3RhcnRJbmRleCkgew0KCQkvLyBEZWZhdWx0IHRvIGVuZCBvZiB0aGUgYXJyYXkNCgkJaWYgKGhlbHBlcnMuaXNOdWxsT3JVbmRlZihzdGFydEluZGV4KSkgew0KCQkJc3RhcnRJbmRleCA9IGFycmF5VG9TZWFyY2gubGVuZ3RoOw0KCQl9DQoJCWZvciAodmFyIGkgPSBzdGFydEluZGV4IC0gMTsgaSA+PSAwOyBpLS0pIHsNCgkJCXZhciBjdXJyZW50SXRlbSA9IGFycmF5VG9TZWFyY2hbaV07DQoJCQlpZiAoZmlsdGVyQ2FsbGJhY2soY3VycmVudEl0ZW0pKSB7DQoJCQkJcmV0dXJuIGN1cnJlbnRJdGVtOw0KCQkJfQ0KCQl9DQoJfTsNCg0KCS8vIC0tIE1hdGggbWV0aG9kcw0KCWhlbHBlcnMuaXNOdW1iZXIgPSBmdW5jdGlvbihuKSB7DQoJCXJldHVybiAhaXNOYU4ocGFyc2VGbG9hdChuKSkgJiYgaXNGaW5pdGUobik7DQoJfTsNCgloZWxwZXJzLmFsbW9zdEVxdWFscyA9IGZ1bmN0aW9uKHgsIHksIGVwc2lsb24pIHsNCgkJcmV0dXJuIE1hdGguYWJzKHggLSB5KSA8IGVwc2lsb247DQoJfTsNCgloZWxwZXJzLmFsbW9zdFdob2xlID0gZnVuY3Rpb24oeCwgZXBzaWxvbikgew0KCQl2YXIgcm91bmRlZCA9IE1hdGgucm91bmQoeCk7DQoJCXJldHVybiAoKChyb3VuZGVkIC0gZXBzaWxvbikgPCB4KSAmJiAoKHJvdW5kZWQgKyBlcHNpbG9uKSA+IHgpKTsNCgl9Ow0KCWhlbHBlcnMubWF4ID0gZnVuY3Rpb24oYXJyYXkpIHsNCgkJcmV0dXJuIGFycmF5LnJlZHVjZShmdW5jdGlvbihtYXgsIHZhbHVlKSB7DQoJCQlpZiAoIWlzTmFOKHZhbHVlKSkgew0KCQkJCXJldHVybiBNYXRoLm1heChtYXgsIHZhbHVlKTsNCgkJCX0NCgkJCXJldHVybiBtYXg7DQoJCX0sIE51bWJlci5ORUdBVElWRV9JTkZJTklUWSk7DQoJfTsNCgloZWxwZXJzLm1pbiA9IGZ1bmN0aW9uKGFycmF5KSB7DQoJCXJldHVybiBhcnJheS5yZWR1Y2UoZnVuY3Rpb24obWluLCB2YWx1ZSkgew0KCQkJaWYgKCFpc05hTih2YWx1ZSkpIHsNCgkJCQlyZXR1cm4gTWF0aC5taW4obWluLCB2YWx1ZSk7DQoJCQl9DQoJCQlyZXR1cm4gbWluOw0KCQl9LCBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFkpOw0KCX07DQoJaGVscGVycy5zaWduID0gTWF0aC5zaWduID8NCgkJZnVuY3Rpb24oeCkgew0KCQkJcmV0dXJuIE1hdGguc2lnbih4KTsNCgkJfSA6DQoJCWZ1bmN0aW9uKHgpIHsNCgkJCXggPSAreDsgLy8gY29udmVydCB0byBhIG51bWJlcg0KCQkJaWYgKHggPT09IDAgfHwgaXNOYU4oeCkpIHsNCgkJCQlyZXR1cm4geDsNCgkJCX0NCgkJCXJldHVybiB4ID4gMCA/IDEgOiAtMTsNCgkJfTsNCgloZWxwZXJzLmxvZzEwID0gTWF0aC5sb2cxMCA/DQoJCWZ1bmN0aW9uKHgpIHsNCgkJCXJldHVybiBNYXRoLmxvZzEwKHgpOw0KCQl9IDoNCgkJZnVuY3Rpb24oeCkgew0KCQkJcmV0dXJuIE1hdGgubG9nKHgpIC8gTWF0aC5MTjEwOw0KCQl9Ow0KCWhlbHBlcnMudG9SYWRpYW5zID0gZnVuY3Rpb24oZGVncmVlcykgew0KCQlyZXR1cm4gZGVncmVlcyAqIChNYXRoLlBJIC8gMTgwKTsNCgl9Ow0KCWhlbHBlcnMudG9EZWdyZWVzID0gZnVuY3Rpb24ocmFkaWFucykgew0KCQlyZXR1cm4gcmFkaWFucyAqICgxODAgLyBNYXRoLlBJKTsNCgl9Ow0KCS8vIEdldHMgdGhlIGFuZ2xlIGZyb20gdmVydGljYWwgdXByaWdodCB0byB0aGUgcG9pbnQgYWJvdXQgYSBjZW50cmUuDQoJaGVscGVycy5nZXRBbmdsZUZyb21Qb2ludCA9IGZ1bmN0aW9uKGNlbnRyZVBvaW50LCBhbmdsZVBvaW50KSB7DQoJCXZhciBkaXN0YW5jZUZyb21YQ2VudGVyID0gYW5nbGVQb2ludC54IC0gY2VudHJlUG9pbnQueDsNCgkJdmFyIGRpc3RhbmNlRnJvbVlDZW50ZXIgPSBhbmdsZVBvaW50LnkgLSBjZW50cmVQb2ludC55Ow0KCQl2YXIgcmFkaWFsRGlzdGFuY2VGcm9tQ2VudGVyID0gTWF0aC5zcXJ0KGRpc3RhbmNlRnJvbVhDZW50ZXIgKiBkaXN0YW5jZUZyb21YQ2VudGVyICsgZGlzdGFuY2VGcm9tWUNlbnRlciAqIGRpc3RhbmNlRnJvbVlDZW50ZXIpOw0KDQoJCXZhciBhbmdsZSA9IE1hdGguYXRhbjIoZGlzdGFuY2VGcm9tWUNlbnRlciwgZGlzdGFuY2VGcm9tWENlbnRlcik7DQoNCgkJaWYgKGFuZ2xlIDwgKC0wLjUgKiBNYXRoLlBJKSkgew0KCQkJYW5nbGUgKz0gMi4wICogTWF0aC5QSTsgLy8gbWFrZSBzdXJlIHRoZSByZXR1cm5lZCBhbmdsZSBpcyBpbiB0aGUgcmFuZ2Ugb2YgKC1QSS8yLCAzUEkvMl0NCgkJfQ0KDQoJCXJldHVybiB7DQoJCQlhbmdsZTogYW5nbGUsDQoJCQlkaXN0YW5jZTogcmFkaWFsRGlzdGFuY2VGcm9tQ2VudGVyDQoJCX07DQoJfTsNCgloZWxwZXJzLmRpc3RhbmNlQmV0d2VlblBvaW50cyA9IGZ1bmN0aW9uKHB0MSwgcHQyKSB7DQoJCXJldHVybiBNYXRoLnNxcnQoTWF0aC5wb3cocHQyLnggLSBwdDEueCwgMikgKyBNYXRoLnBvdyhwdDIueSAtIHB0MS55LCAyKSk7DQoJfTsNCgloZWxwZXJzLmFsaWFzUGl4ZWwgPSBmdW5jdGlvbihwaXhlbFdpZHRoKSB7DQoJCXJldHVybiAocGl4ZWxXaWR0aCAlIDIgPT09IDApID8gMCA6IDAuNTsNCgl9Ow0KCWhlbHBlcnMuc3BsaW5lQ3VydmUgPSBmdW5jdGlvbihmaXJzdFBvaW50LCBtaWRkbGVQb2ludCwgYWZ0ZXJQb2ludCwgdCkgew0KCQkvLyBQcm9wcyB0byBSb2IgU3BlbmNlciBhdCBzY2FsZWQgaW5ub3ZhdGlvbiBmb3IgaGlzIHBvc3Qgb24gc3BsaW5pbmcgYmV0d2VlbiBwb2ludHMNCgkJLy8gaHR0cDovL3NjYWxlZGlubm92YXRpb24uY29tL2FuYWx5dGljcy9zcGxpbmVzL2Fib3V0U3BsaW5lcy5odG1sDQoNCgkJLy8gVGhpcyBmdW5jdGlvbiBtdXN0IGFsc28gcmVzcGVjdCAic2tpcHBlZCIgcG9pbnRzDQoNCgkJdmFyIHByZXZpb3VzID0gZmlyc3RQb2ludC5za2lwID8gbWlkZGxlUG9pbnQgOiBmaXJzdFBvaW50Ow0KCQl2YXIgY3VycmVudCA9IG1pZGRsZVBvaW50Ow0KCQl2YXIgbmV4dCA9IGFmdGVyUG9pbnQuc2tpcCA/IG1pZGRsZVBvaW50IDogYWZ0ZXJQb2ludDsNCg0KCQl2YXIgZDAxID0gTWF0aC5zcXJ0KE1hdGgucG93KGN1cnJlbnQueCAtIHByZXZpb3VzLngsIDIpICsgTWF0aC5wb3coY3VycmVudC55IC0gcHJldmlvdXMueSwgMikpOw0KCQl2YXIgZDEyID0gTWF0aC5zcXJ0KE1hdGgucG93KG5leHQueCAtIGN1cnJlbnQueCwgMikgKyBNYXRoLnBvdyhuZXh0LnkgLSBjdXJyZW50LnksIDIpKTsNCg0KCQl2YXIgczAxID0gZDAxIC8gKGQwMSArIGQxMik7DQoJCXZhciBzMTIgPSBkMTIgLyAoZDAxICsgZDEyKTsNCg0KCQkvLyBJZiBhbGwgcG9pbnRzIGFyZSB0aGUgc2FtZSwgczAxICYgczAyIHdpbGwgYmUgaW5mDQoJCXMwMSA9IGlzTmFOKHMwMSkgPyAwIDogczAxOw0KCQlzMTIgPSBpc05hTihzMTIpID8gMCA6IHMxMjsNCg0KCQl2YXIgZmEgPSB0ICogczAxOyAvLyBzY2FsaW5nIGZhY3RvciBmb3IgdHJpYW5nbGUgVGENCgkJdmFyIGZiID0gdCAqIHMxMjsNCg0KCQlyZXR1cm4gew0KCQkJcHJldmlvdXM6IHsNCgkJCQl4OiBjdXJyZW50LnggLSBmYSAqIChuZXh0LnggLSBwcmV2aW91cy54KSwNCgkJCQl5OiBjdXJyZW50LnkgLSBmYSAqIChuZXh0LnkgLSBwcmV2aW91cy55KQ0KCQkJfSwNCgkJCW5leHQ6IHsNCgkJCQl4OiBjdXJyZW50LnggKyBmYiAqIChuZXh0LnggLSBwcmV2aW91cy54KSwNCgkJCQl5OiBjdXJyZW50LnkgKyBmYiAqIChuZXh0LnkgLSBwcmV2aW91cy55KQ0KCQkJfQ0KCQl9Ow0KCX07DQoJaGVscGVycy5FUFNJTE9OID0gTnVtYmVyLkVQU0lMT04gfHwgMWUtMTQ7DQoJaGVscGVycy5zcGxpbmVDdXJ2ZU1vbm90b25lID0gZnVuY3Rpb24ocG9pbnRzKSB7DQoJCS8vIFRoaXMgZnVuY3Rpb24gY2FsY3VsYXRlcyBCw6l6aWVyIGNvbnRyb2wgcG9pbnRzIGluIGEgc2ltaWxhciB3YXkgdGhhbiB8c3BsaW5lQ3VydmV8LA0KCQkvLyBidXQgcHJlc2VydmVzIG1vbm90b25pY2l0eSBvZiB0aGUgcHJvdmlkZWQgZGF0YSBhbmQgZW5zdXJlcyBubyBsb2NhbCBleHRyZW11bXMgYXJlIGFkZGVkDQoJCS8vIGJldHdlZW4gdGhlIGRhdGFzZXQgZGlzY3JldGUgcG9pbnRzIGR1ZSB0byB0aGUgaW50ZXJwb2xhdGlvbi4NCgkJLy8gU2VlIDogaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvTW9ub3RvbmVfY3ViaWNfaW50ZXJwb2xhdGlvbg0KDQoJCXZhciBwb2ludHNXaXRoVGFuZ2VudHMgPSAocG9pbnRzIHx8IFtdKS5tYXAoZnVuY3Rpb24ocG9pbnQpIHsNCgkJCXJldHVybiB7DQoJCQkJbW9kZWw6IHBvaW50Ll9tb2RlbCwNCgkJCQlkZWx0YUs6IDAsDQoJCQkJbUs6IDANCgkJCX07DQoJCX0pOw0KDQoJCS8vIENhbGN1bGF0ZSBzbG9wZXMgKGRlbHRhSykgYW5kIGluaXRpYWxpemUgdGFuZ2VudHMgKG1LKQ0KCQl2YXIgcG9pbnRzTGVuID0gcG9pbnRzV2l0aFRhbmdlbnRzLmxlbmd0aDsNCgkJdmFyIGksIHBvaW50QmVmb3JlLCBwb2ludEN1cnJlbnQsIHBvaW50QWZ0ZXI7DQoJCWZvciAoaSA9IDA7IGkgPCBwb2ludHNMZW47ICsraSkgew0KCQkJcG9pbnRDdXJyZW50ID0gcG9pbnRzV2l0aFRhbmdlbnRzW2ldOw0KCQkJaWYgKHBvaW50Q3VycmVudC5tb2RlbC5za2lwKSB7DQoJCQkJY29udGludWU7DQoJCQl9DQoNCgkJCXBvaW50QmVmb3JlID0gaSA+IDAgPyBwb2ludHNXaXRoVGFuZ2VudHNbaSAtIDFdIDogbnVsbDsNCgkJCXBvaW50QWZ0ZXIgPSBpIDwgcG9pbnRzTGVuIC0gMSA/IHBvaW50c1dpdGhUYW5nZW50c1tpICsgMV0gOiBudWxsOw0KCQkJaWYgKHBvaW50QWZ0ZXIgJiYgIXBvaW50QWZ0ZXIubW9kZWwuc2tpcCkgew0KCQkJCXZhciBzbG9wZURlbHRhWCA9IChwb2ludEFmdGVyLm1vZGVsLnggLSBwb2ludEN1cnJlbnQubW9kZWwueCk7DQoNCgkJCQkvLyBJbiB0aGUgY2FzZSBvZiB0d28gcG9pbnRzIHRoYXQgYXBwZWFyIGF0IHRoZSBzYW1lIHggcGl4ZWwsIHNsb3BlRGVsdGFYIGlzIDANCgkJCQlwb2ludEN1cnJlbnQuZGVsdGFLID0gc2xvcGVEZWx0YVggIT09IDAgPyAocG9pbnRBZnRlci5tb2RlbC55IC0gcG9pbnRDdXJyZW50Lm1vZGVsLnkpIC8gc2xvcGVEZWx0YVggOiAwOw0KCQkJfQ0KDQoJCQlpZiAoIXBvaW50QmVmb3JlIHx8IHBvaW50QmVmb3JlLm1vZGVsLnNraXApIHsNCgkJCQlwb2ludEN1cnJlbnQubUsgPSBwb2ludEN1cnJlbnQuZGVsdGFLOw0KCQkJfSBlbHNlIGlmICghcG9pbnRBZnRlciB8fCBwb2ludEFmdGVyLm1vZGVsLnNraXApIHsNCgkJCQlwb2ludEN1cnJlbnQubUsgPSBwb2ludEJlZm9yZS5kZWx0YUs7DQoJCQl9IGVsc2UgaWYgKHRoaXMuc2lnbihwb2ludEJlZm9yZS5kZWx0YUspICE9PSB0aGlzLnNpZ24ocG9pbnRDdXJyZW50LmRlbHRhSykpIHsNCgkJCQlwb2ludEN1cnJlbnQubUsgPSAwOw0KCQkJfSBlbHNlIHsNCgkJCQlwb2ludEN1cnJlbnQubUsgPSAocG9pbnRCZWZvcmUuZGVsdGFLICsgcG9pbnRDdXJyZW50LmRlbHRhSykgLyAyOw0KCQkJfQ0KCQl9DQoNCgkJLy8gQWRqdXN0IHRhbmdlbnRzIHRvIGVuc3VyZSBtb25vdG9uaWMgcHJvcGVydGllcw0KCQl2YXIgYWxwaGFLLCBiZXRhSywgdGF1Sywgc3F1YXJlZE1hZ25pdHVkZTsNCgkJZm9yIChpID0gMDsgaSA8IHBvaW50c0xlbiAtIDE7ICsraSkgew0KCQkJcG9pbnRDdXJyZW50ID0gcG9pbnRzV2l0aFRhbmdlbnRzW2ldOw0KCQkJcG9pbnRBZnRlciA9IHBvaW50c1dpdGhUYW5nZW50c1tpICsgMV07DQoJCQlpZiAocG9pbnRDdXJyZW50Lm1vZGVsLnNraXAgfHwgcG9pbnRBZnRlci5tb2RlbC5za2lwKSB7DQoJCQkJY29udGludWU7DQoJCQl9DQoNCgkJCWlmIChoZWxwZXJzLmFsbW9zdEVxdWFscyhwb2ludEN1cnJlbnQuZGVsdGFLLCAwLCB0aGlzLkVQU0lMT04pKSB7DQoJCQkJcG9pbnRDdXJyZW50Lm1LID0gcG9pbnRBZnRlci5tSyA9IDA7DQoJCQkJY29udGludWU7DQoJCQl9DQoNCgkJCWFscGhhSyA9IHBvaW50Q3VycmVudC5tSyAvIHBvaW50Q3VycmVudC5kZWx0YUs7DQoJCQliZXRhSyA9IHBvaW50QWZ0ZXIubUsgLyBwb2ludEN1cnJlbnQuZGVsdGFLOw0KCQkJc3F1YXJlZE1hZ25pdHVkZSA9IE1hdGgucG93KGFscGhhSywgMikgKyBNYXRoLnBvdyhiZXRhSywgMik7DQoJCQlpZiAoc3F1YXJlZE1hZ25pdHVkZSA8PSA5KSB7DQoJCQkJY29udGludWU7DQoJCQl9DQoNCgkJCXRhdUsgPSAzIC8gTWF0aC5zcXJ0KHNxdWFyZWRNYWduaXR1ZGUpOw0KCQkJcG9pbnRDdXJyZW50Lm1LID0gYWxwaGFLICogdGF1SyAqIHBvaW50Q3VycmVudC5kZWx0YUs7DQoJCQlwb2ludEFmdGVyLm1LID0gYmV0YUsgKiB0YXVLICogcG9pbnRDdXJyZW50LmRlbHRhSzsNCgkJfQ0KDQoJCS8vIENvbXB1dGUgY29udHJvbCBwb2ludHMNCgkJdmFyIGRlbHRhWDsNCgkJZm9yIChpID0gMDsgaSA8IHBvaW50c0xlbjsgKytpKSB7DQoJCQlwb2ludEN1cnJlbnQgPSBwb2ludHNXaXRoVGFuZ2VudHNbaV07DQoJCQlpZiAocG9pbnRDdXJyZW50Lm1vZGVsLnNraXApIHsNCgkJCQljb250aW51ZTsNCgkJCX0NCg0KCQkJcG9pbnRCZWZvcmUgPSBpID4gMCA/IHBvaW50c1dpdGhUYW5nZW50c1tpIC0gMV0gOiBudWxsOw0KCQkJcG9pbnRBZnRlciA9IGkgPCBwb2ludHNMZW4gLSAxID8gcG9pbnRzV2l0aFRhbmdlbnRzW2kgKyAxXSA6IG51bGw7DQoJCQlpZiAocG9pbnRCZWZvcmUgJiYgIXBvaW50QmVmb3JlLm1vZGVsLnNraXApIHsNCgkJCQlkZWx0YVggPSAocG9pbnRDdXJyZW50Lm1vZGVsLnggLSBwb2ludEJlZm9yZS5tb2RlbC54KSAvIDM7DQoJCQkJcG9pbnRDdXJyZW50Lm1vZGVsLmNvbnRyb2xQb2ludFByZXZpb3VzWCA9IHBvaW50Q3VycmVudC5tb2RlbC54IC0gZGVsdGFYOw0KCQkJCXBvaW50Q3VycmVudC5tb2RlbC5jb250cm9sUG9pbnRQcmV2aW91c1kgPSBwb2ludEN1cnJlbnQubW9kZWwueSAtIGRlbHRhWCAqIHBvaW50Q3VycmVudC5tSzsNCgkJCX0NCgkJCWlmIChwb2ludEFmdGVyICYmICFwb2ludEFmdGVyLm1vZGVsLnNraXApIHsNCgkJCQlkZWx0YVggPSAocG9pbnRBZnRlci5tb2RlbC54IC0gcG9pbnRDdXJyZW50Lm1vZGVsLngpIC8gMzsNCgkJCQlwb2ludEN1cnJlbnQubW9kZWwuY29udHJvbFBvaW50TmV4dFggPSBwb2ludEN1cnJlbnQubW9kZWwueCArIGRlbHRhWDsNCgkJCQlwb2ludEN1cnJlbnQubW9kZWwuY29udHJvbFBvaW50TmV4dFkgPSBwb2ludEN1cnJlbnQubW9kZWwueSArIGRlbHRhWCAqIHBvaW50Q3VycmVudC5tSzsNCgkJCX0NCgkJfQ0KCX07DQoJaGVscGVycy5uZXh0SXRlbSA9IGZ1bmN0aW9uKGNvbGxlY3Rpb24sIGluZGV4LCBsb29wKSB7DQoJCWlmIChsb29wKSB7DQoJCQlyZXR1cm4gaW5kZXggPj0gY29sbGVjdGlvbi5sZW5ndGggLSAxID8gY29sbGVjdGlvblswXSA6IGNvbGxlY3Rpb25baW5kZXggKyAxXTsNCgkJfQ0KCQlyZXR1cm4gaW5kZXggPj0gY29sbGVjdGlvbi5sZW5ndGggLSAxID8gY29sbGVjdGlvbltjb2xsZWN0aW9uLmxlbmd0aCAtIDFdIDogY29sbGVjdGlvbltpbmRleCArIDFdOw0KCX07DQoJaGVscGVycy5wcmV2aW91c0l0ZW0gPSBmdW5jdGlvbihjb2xsZWN0aW9uLCBpbmRleCwgbG9vcCkgew0KCQlpZiAobG9vcCkgew0KCQkJcmV0dXJuIGluZGV4IDw9IDAgPyBjb2xsZWN0aW9uW2NvbGxlY3Rpb24ubGVuZ3RoIC0gMV0gOiBjb2xsZWN0aW9uW2luZGV4IC0gMV07DQoJCX0NCgkJcmV0dXJuIGluZGV4IDw9IDAgPyBjb2xsZWN0aW9uWzBdIDogY29sbGVjdGlvbltpbmRleCAtIDFdOw0KCX07DQoJLy8gSW1wbGVtZW50YXRpb24gb2YgdGhlIG5pY2UgbnVtYmVyIGFsZ29yaXRobSB1c2VkIGluIGRldGVybWluaW5nIHdoZXJlIGF4aXMgbGFiZWxzIHdpbGwgZ28NCgloZWxwZXJzLm5pY2VOdW0gPSBmdW5jdGlvbihyYW5nZSwgcm91bmQpIHsNCgkJdmFyIGV4cG9uZW50ID0gTWF0aC5mbG9vcihoZWxwZXJzLmxvZzEwKHJhbmdlKSk7DQoJCXZhciBmcmFjdGlvbiA9IHJhbmdlIC8gTWF0aC5wb3coMTAsIGV4cG9uZW50KTsNCgkJdmFyIG5pY2VGcmFjdGlvbjsNCg0KCQlpZiAocm91bmQpIHsNCgkJCWlmIChmcmFjdGlvbiA8IDEuNSkgew0KCQkJCW5pY2VGcmFjdGlvbiA9IDE7DQoJCQl9IGVsc2UgaWYgKGZyYWN0aW9uIDwgMykgew0KCQkJCW5pY2VGcmFjdGlvbiA9IDI7DQoJCQl9IGVsc2UgaWYgKGZyYWN0aW9uIDwgNykgew0KCQkJCW5pY2VGcmFjdGlvbiA9IDU7DQoJCQl9IGVsc2Ugew0KCQkJCW5pY2VGcmFjdGlvbiA9IDEwOw0KCQkJfQ0KCQl9IGVsc2UgaWYgKGZyYWN0aW9uIDw9IDEuMCkgew0KCQkJbmljZUZyYWN0aW9uID0gMTsNCgkJfSBlbHNlIGlmIChmcmFjdGlvbiA8PSAyKSB7DQoJCQluaWNlRnJhY3Rpb24gPSAyOw0KCQl9IGVsc2UgaWYgKGZyYWN0aW9uIDw9IDUpIHsNCgkJCW5pY2VGcmFjdGlvbiA9IDU7DQoJCX0gZWxzZSB7DQoJCQluaWNlRnJhY3Rpb24gPSAxMDsNCgkJfQ0KDQoJCXJldHVybiBuaWNlRnJhY3Rpb24gKiBNYXRoLnBvdygxMCwgZXhwb25lbnQpOw0KCX07DQoJLy8gUmVxdWVzdCBhbmltYXRpb24gcG9seWZpbGwgLSBodHRwOi8vd3d3LnBhdWxpcmlzaC5jb20vMjAxMS9yZXF1ZXN0YW5pbWF0aW9uZnJhbWUtZm9yLXNtYXJ0LWFuaW1hdGluZy8NCgloZWxwZXJzLnJlcXVlc3RBbmltRnJhbWUgPSAoZnVuY3Rpb24oKSB7DQoJCWlmICh0eXBlb2Ygd2luZG93ID09PSAndW5kZWZpbmVkJykgew0KCQkJcmV0dXJuIGZ1bmN0aW9uKGNhbGxiYWNrKSB7DQoJCQkJY2FsbGJhY2soKTsNCgkJCX07DQoJCX0NCgkJcmV0dXJuIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHwNCgkJCXdpbmRvdy53ZWJraXRSZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHwNCgkJCXdpbmRvdy5tb3pSZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHwNCgkJCXdpbmRvdy5vUmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8DQoJCQl3aW5kb3cubXNSZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHwNCgkJCWZ1bmN0aW9uKGNhbGxiYWNrKSB7DQoJCQkJcmV0dXJuIHdpbmRvdy5zZXRUaW1lb3V0KGNhbGxiYWNrLCAxMDAwIC8gNjApOw0KCQkJfTsNCgl9KCkpOw0KCS8vIC0tIERPTSBtZXRob2RzDQoJaGVscGVycy5nZXRSZWxhdGl2ZVBvc2l0aW9uID0gZnVuY3Rpb24oZXZ0LCBjaGFydCkgew0KCQl2YXIgbW91c2VYLCBtb3VzZVk7DQoJCXZhciBlID0gZXZ0Lm9yaWdpbmFsRXZlbnQgfHwgZXZ0Ow0KCQl2YXIgY2FudmFzID0gZXZ0LmN1cnJlbnRUYXJnZXQgfHwgZXZ0LnNyY0VsZW1lbnQ7DQoJCXZhciBib3VuZGluZ1JlY3QgPSBjYW52YXMuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7DQoNCgkJdmFyIHRvdWNoZXMgPSBlLnRvdWNoZXM7DQoJCWlmICh0b3VjaGVzICYmIHRvdWNoZXMubGVuZ3RoID4gMCkgew0KCQkJbW91c2VYID0gdG91Y2hlc1swXS5jbGllbnRYOw0KCQkJbW91c2VZID0gdG91Y2hlc1swXS5jbGllbnRZOw0KDQoJCX0gZWxzZSB7DQoJCQltb3VzZVggPSBlLmNsaWVudFg7DQoJCQltb3VzZVkgPSBlLmNsaWVudFk7DQoJCX0NCg0KCQkvLyBTY2FsZSBtb3VzZSBjb29yZGluYXRlcyBpbnRvIGNhbnZhcyBjb29yZGluYXRlcw0KCQkvLyBieSBmb2xsb3dpbmcgdGhlIHBhdHRlcm4gbGFpZCBvdXQgYnkgJ2plcnJ5aicgaW4gdGhlIGNvbW1lbnRzIG9mDQoJCS8vIGh0dHA6Ly93d3cuaHRtbDVjYW52YXN0dXRvcmlhbHMuY29tL2FkdmFuY2VkL2h0bWw1LWNhbnZhcy1tb3VzZS1jb29yZGluYXRlcy8NCgkJdmFyIHBhZGRpbmdMZWZ0ID0gcGFyc2VGbG9hdChoZWxwZXJzLmdldFN0eWxlKGNhbnZhcywgJ3BhZGRpbmctbGVmdCcpKTsNCgkJdmFyIHBhZGRpbmdUb3AgPSBwYXJzZUZsb2F0KGhlbHBlcnMuZ2V0U3R5bGUoY2FudmFzLCAncGFkZGluZy10b3AnKSk7DQoJCXZhciBwYWRkaW5nUmlnaHQgPSBwYXJzZUZsb2F0KGhlbHBlcnMuZ2V0U3R5bGUoY2FudmFzLCAncGFkZGluZy1yaWdodCcpKTsNCgkJdmFyIHBhZGRpbmdCb3R0b20gPSBwYXJzZUZsb2F0KGhlbHBlcnMuZ2V0U3R5bGUoY2FudmFzLCAncGFkZGluZy1ib3R0b20nKSk7DQoJCXZhciB3aWR0aCA9IGJvdW5kaW5nUmVjdC5yaWdodCAtIGJvdW5kaW5nUmVjdC5sZWZ0IC0gcGFkZGluZ0xlZnQgLSBwYWRkaW5nUmlnaHQ7DQoJCXZhciBoZWlnaHQgPSBib3VuZGluZ1JlY3QuYm90dG9tIC0gYm91bmRpbmdSZWN0LnRvcCAtIHBhZGRpbmdUb3AgLSBwYWRkaW5nQm90dG9tOw0KDQoJCS8vIFdlIGRpdmlkZSBieSB0aGUgY3VycmVudCBkZXZpY2UgcGl4ZWwgcmF0aW8sIGJlY2F1c2UgdGhlIGNhbnZhcyBpcyBzY2FsZWQgdXAgYnkgdGhhdCBhbW91bnQgaW4gZWFjaCBkaXJlY3Rpb24uIEhvd2V2ZXINCgkJLy8gdGhlIGJhY2tlbmQgbW9kZWwgaXMgaW4gdW5zY2FsZWQgY29vcmRpbmF0ZXMuIFNpbmNlIHdlIGFyZSBnb2luZyB0byBkZWFsIHdpdGggb3VyIG1vZGVsIGNvb3JkaW5hdGVzLCB3ZSBnbyBiYWNrIGhlcmUNCgkJbW91c2VYID0gTWF0aC5yb3VuZCgobW91c2VYIC0gYm91bmRpbmdSZWN0LmxlZnQgLSBwYWRkaW5nTGVmdCkgLyAod2lkdGgpICogY2FudmFzLndpZHRoIC8gY2hhcnQuY3VycmVudERldmljZVBpeGVsUmF0aW8pOw0KCQltb3VzZVkgPSBNYXRoLnJvdW5kKChtb3VzZVkgLSBib3VuZGluZ1JlY3QudG9wIC0gcGFkZGluZ1RvcCkgLyAoaGVpZ2h0KSAqIGNhbnZhcy5oZWlnaHQgLyBjaGFydC5jdXJyZW50RGV2aWNlUGl4ZWxSYXRpbyk7DQoNCgkJcmV0dXJuIHsNCgkJCXg6IG1vdXNlWCwNCgkJCXk6IG1vdXNlWQ0KCQl9Ow0KDQoJfTsNCg0KCS8vIFByaXZhdGUgaGVscGVyIGZ1bmN0aW9uIHRvIGNvbnZlcnQgbWF4LXdpZHRoL21heC1oZWlnaHQgdmFsdWVzIHRoYXQgbWF5IGJlIHBlcmNlbnRhZ2VzIGludG8gYSBudW1iZXINCglmdW5jdGlvbiBwYXJzZU1heFN0eWxlKHN0eWxlVmFsdWUsIG5vZGUsIHBhcmVudFByb3BlcnR5KSB7DQoJCXZhciB2YWx1ZUluUGl4ZWxzOw0KCQlpZiAodHlwZW9mIHN0eWxlVmFsdWUgPT09ICdzdHJpbmcnKSB7DQoJCQl2YWx1ZUluUGl4ZWxzID0gcGFyc2VJbnQoc3R5bGVWYWx1ZSwgMTApOw0KDQoJCQlpZiAoc3R5bGVWYWx1ZS5pbmRleE9mKCclJykgIT09IC0xKSB7DQoJCQkJLy8gcGVyY2VudGFnZSAqIHNpemUgaW4gZGltZW5zaW9uDQoJCQkJdmFsdWVJblBpeGVscyA9IHZhbHVlSW5QaXhlbHMgLyAxMDAgKiBub2RlLnBhcmVudE5vZGVbcGFyZW50UHJvcGVydHldOw0KCQkJfQ0KCQl9IGVsc2Ugew0KCQkJdmFsdWVJblBpeGVscyA9IHN0eWxlVmFsdWU7DQoJCX0NCg0KCQlyZXR1cm4gdmFsdWVJblBpeGVsczsNCgl9DQoNCgkvKioNCgkgKiBSZXR1cm5zIGlmIHRoZSBnaXZlbiB2YWx1ZSBjb250YWlucyBhbiBlZmZlY3RpdmUgY29uc3RyYWludC4NCgkgKiBAcHJpdmF0ZQ0KCSAqLw0KCWZ1bmN0aW9uIGlzQ29uc3RyYWluZWRWYWx1ZSh2YWx1ZSkgew0KCQlyZXR1cm4gdmFsdWUgIT09IHVuZGVmaW5lZCAmJiB2YWx1ZSAhPT0gbnVsbCAmJiB2YWx1ZSAhPT0gJ25vbmUnOw0KCX0NCg0KCS8vIFByaXZhdGUgaGVscGVyIHRvIGdldCBhIGNvbnN0cmFpbnQgZGltZW5zaW9uDQoJLy8gQHBhcmFtIGRvbU5vZGUgOiB0aGUgbm9kZSB0byBjaGVjayB0aGUgY29uc3RyYWludCBvbg0KCS8vIEBwYXJhbSBtYXhTdHlsZSA6IHRoZSBzdHlsZSB0aGF0IGRlZmluZXMgdGhlIG1heGltdW0gZm9yIHRoZSBkaXJlY3Rpb24gd2UgYXJlIHVzaW5nIChtYXhXaWR0aCAvIG1heEhlaWdodCkNCgkvLyBAcGFyYW0gcGVyY2VudGFnZVByb3BlcnR5IDogcHJvcGVydHkgb2YgcGFyZW50IHRvIHVzZSB3aGVuIGNhbGN1bGF0aW5nIHdpZHRoIGFzIGEgcGVyY2VudGFnZQ0KCS8vIEBzZWUgaHR0cDovL3d3dy5uYXRoYW5hZWxqb25lcy5jb20vYmxvZy8yMDEzL3JlYWRpbmctbWF4LXdpZHRoLWNyb3NzLWJyb3dzZXINCglmdW5jdGlvbiBnZXRDb25zdHJhaW50RGltZW5zaW9uKGRvbU5vZGUsIG1heFN0eWxlLCBwZXJjZW50YWdlUHJvcGVydHkpIHsNCgkJdmFyIHZpZXcgPSBkb2N1bWVudC5kZWZhdWx0VmlldzsNCgkJdmFyIHBhcmVudE5vZGUgPSBkb21Ob2RlLnBhcmVudE5vZGU7DQoJCXZhciBjb25zdHJhaW5lZE5vZGUgPSB2aWV3LmdldENvbXB1dGVkU3R5bGUoZG9tTm9kZSlbbWF4U3R5bGVdOw0KCQl2YXIgY29uc3RyYWluZWRDb250YWluZXIgPSB2aWV3LmdldENvbXB1dGVkU3R5bGUocGFyZW50Tm9kZSlbbWF4U3R5bGVdOw0KCQl2YXIgaGFzQ05vZGUgPSBpc0NvbnN0cmFpbmVkVmFsdWUoY29uc3RyYWluZWROb2RlKTsNCgkJdmFyIGhhc0NDb250YWluZXIgPSBpc0NvbnN0cmFpbmVkVmFsdWUoY29uc3RyYWluZWRDb250YWluZXIpOw0KCQl2YXIgaW5maW5pdHkgPSBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFk7DQoNCgkJaWYgKGhhc0NOb2RlIHx8IGhhc0NDb250YWluZXIpIHsNCgkJCXJldHVybiBNYXRoLm1pbigNCgkJCQloYXNDTm9kZSA/IHBhcnNlTWF4U3R5bGUoY29uc3RyYWluZWROb2RlLCBkb21Ob2RlLCBwZXJjZW50YWdlUHJvcGVydHkpIDogaW5maW5pdHksDQoJCQkJaGFzQ0NvbnRhaW5lciA/IHBhcnNlTWF4U3R5bGUoY29uc3RyYWluZWRDb250YWluZXIsIHBhcmVudE5vZGUsIHBlcmNlbnRhZ2VQcm9wZXJ0eSkgOiBpbmZpbml0eSk7DQoJCX0NCg0KCQlyZXR1cm4gJ25vbmUnOw0KCX0NCgkvLyByZXR1cm5zIE51bWJlciBvciB1bmRlZmluZWQgaWYgbm8gY29uc3RyYWludA0KCWhlbHBlcnMuZ2V0Q29uc3RyYWludFdpZHRoID0gZnVuY3Rpb24oZG9tTm9kZSkgew0KCQlyZXR1cm4gZ2V0Q29uc3RyYWludERpbWVuc2lvbihkb21Ob2RlLCAnbWF4LXdpZHRoJywgJ2NsaWVudFdpZHRoJyk7DQoJfTsNCgkvLyByZXR1cm5zIE51bWJlciBvciB1bmRlZmluZWQgaWYgbm8gY29uc3RyYWludA0KCWhlbHBlcnMuZ2V0Q29uc3RyYWludEhlaWdodCA9IGZ1bmN0aW9uKGRvbU5vZGUpIHsNCgkJcmV0dXJuIGdldENvbnN0cmFpbnREaW1lbnNpb24oZG9tTm9kZSwgJ21heC1oZWlnaHQnLCAnY2xpZW50SGVpZ2h0Jyk7DQoJfTsNCgloZWxwZXJzLmdldE1heGltdW1XaWR0aCA9IGZ1bmN0aW9uKGRvbU5vZGUpIHsNCgkJdmFyIGNvbnRhaW5lciA9IGRvbU5vZGUucGFyZW50Tm9kZTsNCgkJaWYgKCFjb250YWluZXIpIHsNCgkJCXJldHVybiBkb21Ob2RlLmNsaWVudFdpZHRoOw0KCQl9DQoNCgkJdmFyIHBhZGRpbmdMZWZ0ID0gcGFyc2VJbnQoaGVscGVycy5nZXRTdHlsZShjb250YWluZXIsICdwYWRkaW5nLWxlZnQnKSwgMTApOw0KCQl2YXIgcGFkZGluZ1JpZ2h0ID0gcGFyc2VJbnQoaGVscGVycy5nZXRTdHlsZShjb250YWluZXIsICdwYWRkaW5nLXJpZ2h0JyksIDEwKTsNCgkJdmFyIHcgPSBjb250YWluZXIuY2xpZW50V2lkdGggLSBwYWRkaW5nTGVmdCAtIHBhZGRpbmdSaWdodDsNCgkJdmFyIGN3ID0gaGVscGVycy5nZXRDb25zdHJhaW50V2lkdGgoZG9tTm9kZSk7DQoJCXJldHVybiBpc05hTihjdykgPyB3IDogTWF0aC5taW4odywgY3cpOw0KCX07DQoJaGVscGVycy5nZXRNYXhpbXVtSGVpZ2h0ID0gZnVuY3Rpb24oZG9tTm9kZSkgew0KCQl2YXIgY29udGFpbmVyID0gZG9tTm9kZS5wYXJlbnROb2RlOw0KCQlpZiAoIWNvbnRhaW5lcikgew0KCQkJcmV0dXJuIGRvbU5vZGUuY2xpZW50SGVpZ2h0Ow0KCQl9DQoNCgkJdmFyIHBhZGRpbmdUb3AgPSBwYXJzZUludChoZWxwZXJzLmdldFN0eWxlKGNvbnRhaW5lciwgJ3BhZGRpbmctdG9wJyksIDEwKTsNCgkJdmFyIHBhZGRpbmdCb3R0b20gPSBwYXJzZUludChoZWxwZXJzLmdldFN0eWxlKGNvbnRhaW5lciwgJ3BhZGRpbmctYm90dG9tJyksIDEwKTsNCgkJdmFyIGggPSBjb250YWluZXIuY2xpZW50SGVpZ2h0IC0gcGFkZGluZ1RvcCAtIHBhZGRpbmdCb3R0b207DQoJCXZhciBjaCA9IGhlbHBlcnMuZ2V0Q29uc3RyYWludEhlaWdodChkb21Ob2RlKTsNCgkJcmV0dXJuIGlzTmFOKGNoKSA/IGggOiBNYXRoLm1pbihoLCBjaCk7DQoJfTsNCgloZWxwZXJzLmdldFN0eWxlID0gZnVuY3Rpb24oZWwsIHByb3BlcnR5KSB7DQoJCXJldHVybiBlbC5jdXJyZW50U3R5bGUgPw0KCQkJZWwuY3VycmVudFN0eWxlW3Byb3BlcnR5XSA6DQoJCQlkb2N1bWVudC5kZWZhdWx0Vmlldy5nZXRDb21wdXRlZFN0eWxlKGVsLCBudWxsKS5nZXRQcm9wZXJ0eVZhbHVlKHByb3BlcnR5KTsNCgl9Ow0KCWhlbHBlcnMucmV0aW5hU2NhbGUgPSBmdW5jdGlvbihjaGFydCwgZm9yY2VSYXRpbykgew0KCQl2YXIgcGl4ZWxSYXRpbyA9IGNoYXJ0LmN1cnJlbnREZXZpY2VQaXhlbFJhdGlvID0gZm9yY2VSYXRpbyB8fCB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyB8fCAxOw0KCQlpZiAocGl4ZWxSYXRpbyA9PT0gMSkgew0KCQkJcmV0dXJuOw0KCQl9DQoNCgkJdmFyIGNhbnZhcyA9IGNoYXJ0LmNhbnZhczsNCgkJdmFyIGhlaWdodCA9IGNoYXJ0LmhlaWdodDsNCgkJdmFyIHdpZHRoID0gY2hhcnQud2lkdGg7DQoNCgkJY2FudmFzLmhlaWdodCA9IGhlaWdodCAqIHBpeGVsUmF0aW87DQoJCWNhbnZhcy53aWR0aCA9IHdpZHRoICogcGl4ZWxSYXRpbzsNCgkJY2hhcnQuY3R4LnNjYWxlKHBpeGVsUmF0aW8sIHBpeGVsUmF0aW8pOw0KDQoJCS8vIElmIG5vIHN0eWxlIGhhcyBiZWVuIHNldCBvbiB0aGUgY2FudmFzLCB0aGUgcmVuZGVyIHNpemUgaXMgdXNlZCBhcyBkaXNwbGF5IHNpemUsDQoJCS8vIG1ha2luZyB0aGUgY2hhcnQgdmlzdWFsbHkgYmlnZ2VyLCBzbyBsZXQncyBlbmZvcmNlIGl0IHRvIHRoZSAiY29ycmVjdCIgdmFsdWVzLg0KCQkvLyBTZWUgaHR0cHM6Ly9naXRodWIuY29tL2NoYXJ0anMvQ2hhcnQuanMvaXNzdWVzLzM1NzUNCgkJY2FudmFzLnN0eWxlLmhlaWdodCA9IGhlaWdodCArICdweCc7DQoJCWNhbnZhcy5zdHlsZS53aWR0aCA9IHdpZHRoICsgJ3B4JzsNCgl9Ow0KCS8vIC0tIENhbnZhcyBtZXRob2RzDQoJaGVscGVycy5mb250U3RyaW5nID0gZnVuY3Rpb24ocGl4ZWxTaXplLCBmb250U3R5bGUsIGZvbnRGYW1pbHkpIHsNCgkJcmV0dXJuIGZvbnRTdHlsZSArICcgJyArIHBpeGVsU2l6ZSArICdweCAnICsgZm9udEZhbWlseTsNCgl9Ow0KCWhlbHBlcnMubG9uZ2VzdFRleHQgPSBmdW5jdGlvbihjdHgsIGZvbnQsIGFycmF5T2ZUaGluZ3MsIGNhY2hlKSB7DQoJCWNhY2hlID0gY2FjaGUgfHwge307DQoJCXZhciBkYXRhID0gY2FjaGUuZGF0YSA9IGNhY2hlLmRhdGEgfHwge307DQoJCXZhciBnYyA9IGNhY2hlLmdhcmJhZ2VDb2xsZWN0ID0gY2FjaGUuZ2FyYmFnZUNvbGxlY3QgfHwgW107DQoNCgkJaWYgKGNhY2hlLmZvbnQgIT09IGZvbnQpIHsNCgkJCWRhdGEgPSBjYWNoZS5kYXRhID0ge307DQoJCQlnYyA9IGNhY2hlLmdhcmJhZ2VDb2xsZWN0ID0gW107DQoJCQljYWNoZS5mb250ID0gZm9udDsNCgkJfQ0KDQoJCWN0eC5mb250ID0gZm9udDsNCgkJdmFyIGxvbmdlc3QgPSAwOw0KCQloZWxwZXJzLmVhY2goYXJyYXlPZlRoaW5ncywgZnVuY3Rpb24odGhpbmcpIHsNCgkJCS8vIFVuZGVmaW5lZCBzdHJpbmdzIGFuZCBhcnJheXMgc2hvdWxkIG5vdCBiZSBtZWFzdXJlZA0KCQkJaWYgKHRoaW5nICE9PSB1bmRlZmluZWQgJiYgdGhpbmcgIT09IG51bGwgJiYgaGVscGVycy5pc0FycmF5KHRoaW5nKSAhPT0gdHJ1ZSkgew0KCQkJCWxvbmdlc3QgPSBoZWxwZXJzLm1lYXN1cmVUZXh0KGN0eCwgZGF0YSwgZ2MsIGxvbmdlc3QsIHRoaW5nKTsNCgkJCX0gZWxzZSBpZiAoaGVscGVycy5pc0FycmF5KHRoaW5nKSkgew0KCQkJCS8vIGlmIGl0IGlzIGFuIGFycmF5IGxldHMgbWVhc3VyZSBlYWNoIGVsZW1lbnQNCgkJCQkvLyB0byBkbyBtYXliZSBzaW1wbGlmeSB0aGlzIGZ1bmN0aW9uIGEgYml0IHNvIHdlIGNhbiBkbyB0aGlzIG1vcmUgcmVjdXJzaXZlbHk/DQoJCQkJaGVscGVycy5lYWNoKHRoaW5nLCBmdW5jdGlvbihuZXN0ZWRUaGluZykgew0KCQkJCQkvLyBVbmRlZmluZWQgc3RyaW5ncyBhbmQgYXJyYXlzIHNob3VsZCBub3QgYmUgbWVhc3VyZWQNCgkJCQkJaWYgKG5lc3RlZFRoaW5nICE9PSB1bmRlZmluZWQgJiYgbmVzdGVkVGhpbmcgIT09IG51bGwgJiYgIWhlbHBlcnMuaXNBcnJheShuZXN0ZWRUaGluZykpIHsNCgkJCQkJCWxvbmdlc3QgPSBoZWxwZXJzLm1lYXN1cmVUZXh0KGN0eCwgZGF0YSwgZ2MsIGxvbmdlc3QsIG5lc3RlZFRoaW5nKTsNCgkJCQkJfQ0KCQkJCX0pOw0KCQkJfQ0KCQl9KTsNCg0KCQl2YXIgZ2NMZW4gPSBnYy5sZW5ndGggLyAyOw0KCQlpZiAoZ2NMZW4gPiBhcnJheU9mVGhpbmdzLmxlbmd0aCkgew0KCQkJZm9yICh2YXIgaSA9IDA7IGkgPCBnY0xlbjsgaSsrKSB7DQoJCQkJZGVsZXRlIGRhdGFbZ2NbaV1dOw0KCQkJfQ0KCQkJZ2Muc3BsaWNlKDAsIGdjTGVuKTsNCgkJfQ0KCQlyZXR1cm4gbG9uZ2VzdDsNCgl9Ow0KCWhlbHBlcnMubWVhc3VyZVRleHQgPSBmdW5jdGlvbihjdHgsIGRhdGEsIGdjLCBsb25nZXN0LCBzdHJpbmcpIHsNCgkJdmFyIHRleHRXaWR0aCA9IGRhdGFbc3RyaW5nXTsNCgkJaWYgKCF0ZXh0V2lkdGgpIHsNCgkJCXRleHRXaWR0aCA9IGRhdGFbc3RyaW5nXSA9IGN0eC5tZWFzdXJlVGV4dChzdHJpbmcpLndpZHRoOw0KCQkJZ2MucHVzaChzdHJpbmcpOw0KCQl9DQoJCWlmICh0ZXh0V2lkdGggPiBsb25nZXN0KSB7DQoJCQlsb25nZXN0ID0gdGV4dFdpZHRoOw0KCQl9DQoJCXJldHVybiBsb25nZXN0Ow0KCX07DQoJaGVscGVycy5udW1iZXJPZkxhYmVsTGluZXMgPSBmdW5jdGlvbihhcnJheU9mVGhpbmdzKSB7DQoJCXZhciBudW1iZXJPZkxpbmVzID0gMTsNCgkJaGVscGVycy5lYWNoKGFycmF5T2ZUaGluZ3MsIGZ1bmN0aW9uKHRoaW5nKSB7DQoJCQlpZiAoaGVscGVycy5pc0FycmF5KHRoaW5nKSkgew0KCQkJCWlmICh0aGluZy5sZW5ndGggPiBudW1iZXJPZkxpbmVzKSB7DQoJCQkJCW51bWJlck9mTGluZXMgPSB0aGluZy5sZW5ndGg7DQoJCQkJfQ0KCQkJfQ0KCQl9KTsNCgkJcmV0dXJuIG51bWJlck9mTGluZXM7DQoJfTsNCg0KCWhlbHBlcnMuY29sb3IgPSAhY29sb3IgPw0KCQlmdW5jdGlvbih2YWx1ZSkgew0KCQkJY29uc29sZS5lcnJvcignQ29sb3IuanMgbm90IGZvdW5kIScpOw0KCQkJcmV0dXJuIHZhbHVlOw0KCQl9IDoNCgkJZnVuY3Rpb24odmFsdWUpIHsNCgkJCS8qIGdsb2JhbCBDYW52YXNHcmFkaWVudCAqLw0KCQkJaWYgKHZhbHVlIGluc3RhbmNlb2YgQ2FudmFzR3JhZGllbnQpIHsNCgkJCQl2YWx1ZSA9IGRlZmF1bHRzLmdsb2JhbC5kZWZhdWx0Q29sb3I7DQoJCQl9DQoNCgkJCXJldHVybiBjb2xvcih2YWx1ZSk7DQoJCX07DQoNCgloZWxwZXJzLmdldEhvdmVyQ29sb3IgPSBmdW5jdGlvbihjb2xvclZhbHVlKSB7DQoJCS8qIGdsb2JhbCBDYW52YXNQYXR0ZXJuICovDQoJCXJldHVybiAoY29sb3JWYWx1ZSBpbnN0YW5jZW9mIENhbnZhc1BhdHRlcm4pID8NCgkJCWNvbG9yVmFsdWUgOg0KCQkJaGVscGVycy5jb2xvcihjb2xvclZhbHVlKS5zYXR1cmF0ZSgwLjUpLmRhcmtlbigwLjEpLnJnYlN0cmluZygpOw0KCX07DQp9Ow0KDQp9LHsiMiI6MiwiMjUiOjI1LCI0NSI6NDV9XSwyODpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7DQondXNlIHN0cmljdCc7DQoNCnZhciBoZWxwZXJzID0gcmVxdWlyZSg0NSk7DQoNCi8qKg0KICogSGVscGVyIGZ1bmN0aW9uIHRvIGdldCByZWxhdGl2ZSBwb3NpdGlvbiBmb3IgYW4gZXZlbnQNCiAqIEBwYXJhbSB7RXZlbnR8SUV2ZW50fSBldmVudCAtIFRoZSBldmVudCB0byBnZXQgdGhlIHBvc2l0aW9uIGZvcg0KICogQHBhcmFtIHtDaGFydH0gY2hhcnQgLSBUaGUgY2hhcnQNCiAqIEByZXR1cm5zIHtQb2ludH0gdGhlIGV2ZW50IHBvc2l0aW9uDQogKi8NCmZ1bmN0aW9uIGdldFJlbGF0aXZlUG9zaXRpb24oZSwgY2hhcnQpIHsNCglpZiAoZS5uYXRpdmUpIHsNCgkJcmV0dXJuIHsNCgkJCXg6IGUueCwNCgkJCXk6IGUueQ0KCQl9Ow0KCX0NCg0KCXJldHVybiBoZWxwZXJzLmdldFJlbGF0aXZlUG9zaXRpb24oZSwgY2hhcnQpOw0KfQ0KDQovKioNCiAqIEhlbHBlciBmdW5jdGlvbiB0byB0cmF2ZXJzZSBhbGwgb2YgdGhlIHZpc2libGUgZWxlbWVudHMgaW4gdGhlIGNoYXJ0DQogKiBAcGFyYW0gY2hhcnQge2NoYXJ0fSB0aGUgY2hhcnQNCiAqIEBwYXJhbSBoYW5kbGVyIHtGdW5jdGlvbn0gdGhlIGNhbGxiYWNrIHRvIGV4ZWN1dGUgZm9yIGVhY2ggdmlzaWJsZSBpdGVtDQogKi8NCmZ1bmN0aW9uIHBhcnNlVmlzaWJsZUl0ZW1zKGNoYXJ0LCBoYW5kbGVyKSB7DQoJdmFyIGRhdGFzZXRzID0gY2hhcnQuZGF0YS5kYXRhc2V0czsNCgl2YXIgbWV0YSwgaSwgaiwgaWxlbiwgamxlbjsNCg0KCWZvciAoaSA9IDAsIGlsZW4gPSBkYXRhc2V0cy5sZW5ndGg7IGkgPCBpbGVuOyArK2kpIHsNCgkJaWYgKCFjaGFydC5pc0RhdGFzZXRWaXNpYmxlKGkpKSB7DQoJCQljb250aW51ZTsNCgkJfQ0KDQoJCW1ldGEgPSBjaGFydC5nZXREYXRhc2V0TWV0YShpKTsNCgkJZm9yIChqID0gMCwgamxlbiA9IG1ldGEuZGF0YS5sZW5ndGg7IGogPCBqbGVuOyArK2opIHsNCgkJCXZhciBlbGVtZW50ID0gbWV0YS5kYXRhW2pdOw0KCQkJaWYgKCFlbGVtZW50Ll92aWV3LnNraXApIHsNCgkJCQloYW5kbGVyKGVsZW1lbnQpOw0KCQkJfQ0KCQl9DQoJfQ0KfQ0KDQovKioNCiAqIEhlbHBlciBmdW5jdGlvbiB0byBnZXQgdGhlIGl0ZW1zIHRoYXQgaW50ZXJzZWN0IHRoZSBldmVudCBwb3NpdGlvbg0KICogQHBhcmFtIGl0ZW1zIHtDaGFydEVsZW1lbnRbXX0gZWxlbWVudHMgdG8gZmlsdGVyDQogKiBAcGFyYW0gcG9zaXRpb24ge1BvaW50fSB0aGUgcG9pbnQgdG8gYmUgbmVhcmVzdCB0bw0KICogQHJldHVybiB7Q2hhcnRFbGVtZW50W119IHRoZSBuZWFyZXN0IGl0ZW1zDQogKi8NCmZ1bmN0aW9uIGdldEludGVyc2VjdEl0ZW1zKGNoYXJ0LCBwb3NpdGlvbikgew0KCXZhciBlbGVtZW50cyA9IFtdOw0KDQoJcGFyc2VWaXNpYmxlSXRlbXMoY2hhcnQsIGZ1bmN0aW9uKGVsZW1lbnQpIHsNCgkJaWYgKGVsZW1lbnQuaW5SYW5nZShwb3NpdGlvbi54LCBwb3NpdGlvbi55KSkgew0KCQkJZWxlbWVudHMucHVzaChlbGVtZW50KTsNCgkJfQ0KCX0pOw0KDQoJcmV0dXJuIGVsZW1lbnRzOw0KfQ0KDQovKioNCiAqIEhlbHBlciBmdW5jdGlvbiB0byBnZXQgdGhlIGl0ZW1zIG5lYXJlc3QgdG8gdGhlIGV2ZW50IHBvc2l0aW9uIGNvbnNpZGVyaW5nIGFsbCB2aXNpYmxlIGl0ZW1zIGluIHRlaCBjaGFydA0KICogQHBhcmFtIGNoYXJ0IHtDaGFydH0gdGhlIGNoYXJ0IHRvIGxvb2sgYXQgZWxlbWVudHMgZnJvbQ0KICogQHBhcmFtIHBvc2l0aW9uIHtQb2ludH0gdGhlIHBvaW50IHRvIGJlIG5lYXJlc3QgdG8NCiAqIEBwYXJhbSBpbnRlcnNlY3Qge0Jvb2xlYW59IGlmIHRydWUsIG9ubHkgY29uc2lkZXIgaXRlbXMgdGhhdCBpbnRlcnNlY3QgdGhlIHBvc2l0aW9uDQogKiBAcGFyYW0gZGlzdGFuY2VNZXRyaWMge0Z1bmN0aW9ufSBmdW5jdGlvbiB0byBwcm92aWRlIHRoZSBkaXN0YW5jZSBiZXR3ZWVuIHBvaW50cw0KICogQHJldHVybiB7Q2hhcnRFbGVtZW50W119IHRoZSBuZWFyZXN0IGl0ZW1zDQogKi8NCmZ1bmN0aW9uIGdldE5lYXJlc3RJdGVtcyhjaGFydCwgcG9zaXRpb24sIGludGVyc2VjdCwgZGlzdGFuY2VNZXRyaWMpIHsNCgl2YXIgbWluRGlzdGFuY2UgPSBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFk7DQoJdmFyIG5lYXJlc3RJdGVtcyA9IFtdOw0KDQoJcGFyc2VWaXNpYmxlSXRlbXMoY2hhcnQsIGZ1bmN0aW9uKGVsZW1lbnQpIHsNCgkJaWYgKGludGVyc2VjdCAmJiAhZWxlbWVudC5pblJhbmdlKHBvc2l0aW9uLngsIHBvc2l0aW9uLnkpKSB7DQoJCQlyZXR1cm47DQoJCX0NCg0KCQl2YXIgY2VudGVyID0gZWxlbWVudC5nZXRDZW50ZXJQb2ludCgpOw0KCQl2YXIgZGlzdGFuY2UgPSBkaXN0YW5jZU1ldHJpYyhwb3NpdGlvbiwgY2VudGVyKTsNCg0KCQlpZiAoZGlzdGFuY2UgPCBtaW5EaXN0YW5jZSkgew0KCQkJbmVhcmVzdEl0ZW1zID0gW2VsZW1lbnRdOw0KCQkJbWluRGlzdGFuY2UgPSBkaXN0YW5jZTsNCgkJfSBlbHNlIGlmIChkaXN0YW5jZSA9PT0gbWluRGlzdGFuY2UpIHsNCgkJCS8vIENhbiBoYXZlIG11bHRpcGxlIGl0ZW1zIGF0IHRoZSBzYW1lIGRpc3RhbmNlIGluIHdoaWNoIGNhc2Ugd2Ugc29ydCBieSBzaXplDQoJCQluZWFyZXN0SXRlbXMucHVzaChlbGVtZW50KTsNCgkJfQ0KCX0pOw0KDQoJcmV0dXJuIG5lYXJlc3RJdGVtczsNCn0NCg0KLyoqDQogKiBHZXQgYSBkaXN0YW5jZSBtZXRyaWMgZnVuY3Rpb24gZm9yIHR3byBwb2ludHMgYmFzZWQgb24gdGhlDQogKiBheGlzIG1vZGUgc2V0dGluZw0KICogQHBhcmFtIHtTdHJpbmd9IGF4aXMgdGhlIGF4aXMgbW9kZS4geHx5fHh5DQogKi8NCmZ1bmN0aW9uIGdldERpc3RhbmNlTWV0cmljRm9yQXhpcyhheGlzKSB7DQoJdmFyIHVzZVggPSBheGlzLmluZGV4T2YoJ3gnKSAhPT0gLTE7DQoJdmFyIHVzZVkgPSBheGlzLmluZGV4T2YoJ3knKSAhPT0gLTE7DQoNCglyZXR1cm4gZnVuY3Rpb24ocHQxLCBwdDIpIHsNCgkJdmFyIGRlbHRhWCA9IHVzZVggPyBNYXRoLmFicyhwdDEueCAtIHB0Mi54KSA6IDA7DQoJCXZhciBkZWx0YVkgPSB1c2VZID8gTWF0aC5hYnMocHQxLnkgLSBwdDIueSkgOiAwOw0KCQlyZXR1cm4gTWF0aC5zcXJ0KE1hdGgucG93KGRlbHRhWCwgMikgKyBNYXRoLnBvdyhkZWx0YVksIDIpKTsNCgl9Ow0KfQ0KDQpmdW5jdGlvbiBpbmRleE1vZGUoY2hhcnQsIGUsIG9wdGlvbnMpIHsNCgl2YXIgcG9zaXRpb24gPSBnZXRSZWxhdGl2ZVBvc2l0aW9uKGUsIGNoYXJ0KTsNCgkvLyBEZWZhdWx0IGF4aXMgZm9yIGluZGV4IG1vZGUgaXMgJ3gnIHRvIG1hdGNoIG9sZCBiZWhhdmlvdXINCglvcHRpb25zLmF4aXMgPSBvcHRpb25zLmF4aXMgfHwgJ3gnOw0KCXZhciBkaXN0YW5jZU1ldHJpYyA9IGdldERpc3RhbmNlTWV0cmljRm9yQXhpcyhvcHRpb25zLmF4aXMpOw0KCXZhciBpdGVtcyA9IG9wdGlvbnMuaW50ZXJzZWN0ID8gZ2V0SW50ZXJzZWN0SXRlbXMoY2hhcnQsIHBvc2l0aW9uKSA6IGdldE5lYXJlc3RJdGVtcyhjaGFydCwgcG9zaXRpb24sIGZhbHNlLCBkaXN0YW5jZU1ldHJpYyk7DQoJdmFyIGVsZW1lbnRzID0gW107DQoNCglpZiAoIWl0ZW1zLmxlbmd0aCkgew0KCQlyZXR1cm4gW107DQoJfQ0KDQoJY2hhcnQuZGF0YS5kYXRhc2V0cy5mb3JFYWNoKGZ1bmN0aW9uKGRhdGFzZXQsIGRhdGFzZXRJbmRleCkgew0KCQlpZiAoY2hhcnQuaXNEYXRhc2V0VmlzaWJsZShkYXRhc2V0SW5kZXgpKSB7DQoJCQl2YXIgbWV0YSA9IGNoYXJ0LmdldERhdGFzZXRNZXRhKGRhdGFzZXRJbmRleCk7DQoJCQl2YXIgZWxlbWVudCA9IG1ldGEuZGF0YVtpdGVtc1swXS5faW5kZXhdOw0KDQoJCQkvLyBkb24ndCBjb3VudCBpdGVtcyB0aGF0IGFyZSBza2lwcGVkIChudWxsIGRhdGEpDQoJCQlpZiAoZWxlbWVudCAmJiAhZWxlbWVudC5fdmlldy5za2lwKSB7DQoJCQkJZWxlbWVudHMucHVzaChlbGVtZW50KTsNCgkJCX0NCgkJfQ0KCX0pOw0KDQoJcmV0dXJuIGVsZW1lbnRzOw0KfQ0KDQovKioNCiAqIEBpbnRlcmZhY2UgSUludGVyYWN0aW9uT3B0aW9ucw0KICovDQovKioNCiAqIElmIHRydWUsIG9ubHkgY29uc2lkZXIgaXRlbXMgdGhhdCBpbnRlcnNlY3QgdGhlIHBvaW50DQogKiBAbmFtZSBJSW50ZXJmYWNlT3B0aW9ucyNib29sZWFuDQogKiBAdHlwZSBCb29sZWFuDQogKi8NCg0KLyoqDQogKiBDb250YWlucyBpbnRlcmFjdGlvbiByZWxhdGVkIGZ1bmN0aW9ucw0KICogQG5hbWVzcGFjZSBDaGFydC5JbnRlcmFjdGlvbg0KICovDQptb2R1bGUuZXhwb3J0cyA9IHsNCgkvLyBIZWxwZXIgZnVuY3Rpb24gZm9yIGRpZmZlcmVudCBtb2Rlcw0KCW1vZGVzOiB7DQoJCXNpbmdsZTogZnVuY3Rpb24oY2hhcnQsIGUpIHsNCgkJCXZhciBwb3NpdGlvbiA9IGdldFJlbGF0aXZlUG9zaXRpb24oZSwgY2hhcnQpOw0KCQkJdmFyIGVsZW1lbnRzID0gW107DQoNCgkJCXBhcnNlVmlzaWJsZUl0ZW1zKGNoYXJ0LCBmdW5jdGlvbihlbGVtZW50KSB7DQoJCQkJaWYgKGVsZW1lbnQuaW5SYW5nZShwb3NpdGlvbi54LCBwb3NpdGlvbi55KSkgew0KCQkJCQllbGVtZW50cy5wdXNoKGVsZW1lbnQpOw0KCQkJCQlyZXR1cm4gZWxlbWVudHM7DQoJCQkJfQ0KCQkJfSk7DQoNCgkJCXJldHVybiBlbGVtZW50cy5zbGljZSgwLCAxKTsNCgkJfSwNCg0KCQkvKioNCgkJICogQGZ1bmN0aW9uIENoYXJ0LkludGVyYWN0aW9uLm1vZGVzLmxhYmVsDQoJCSAqIEBkZXByZWNhdGVkIHNpbmNlIHZlcnNpb24gMi40LjANCgkJICogQHRvZG8gcmVtb3ZlIGF0IHZlcnNpb24gMw0KCQkgKiBAcHJpdmF0ZQ0KCQkgKi8NCgkJbGFiZWw6IGluZGV4TW9kZSwNCg0KCQkvKioNCgkJICogUmV0dXJucyBpdGVtcyBhdCB0aGUgc2FtZSBpbmRleC4gSWYgdGhlIG9wdGlvbnMuaW50ZXJzZWN0IHBhcmFtZXRlciBpcyB0cnVlLCB3ZSBvbmx5IHJldHVybiBpdGVtcyBpZiB3ZSBpbnRlcnNlY3Qgc29tZXRoaW5nDQoJCSAqIElmIHRoZSBvcHRpb25zLmludGVyc2VjdCBtb2RlIGlzIGZhbHNlLCB3ZSBmaW5kIHRoZSBuZWFyZXN0IGl0ZW0gYW5kIHJldHVybiB0aGUgaXRlbXMgYXQgdGhlIHNhbWUgaW5kZXggYXMgdGhhdCBpdGVtDQoJCSAqIEBmdW5jdGlvbiBDaGFydC5JbnRlcmFjdGlvbi5tb2Rlcy5pbmRleA0KCQkgKiBAc2luY2UgdjIuNC4wDQoJCSAqIEBwYXJhbSBjaGFydCB7Y2hhcnR9IHRoZSBjaGFydCB3ZSBhcmUgcmV0dXJuaW5nIGl0ZW1zIGZyb20NCgkJICogQHBhcmFtIGUge0V2ZW50fSB0aGUgZXZlbnQgd2UgYXJlIGZpbmQgdGhpbmdzIGF0DQoJCSAqIEBwYXJhbSBvcHRpb25zIHtJSW50ZXJhY3Rpb25PcHRpb25zfSBvcHRpb25zIHRvIHVzZSBkdXJpbmcgaW50ZXJhY3Rpb24NCgkJICogQHJldHVybiB7Q2hhcnQuRWxlbWVudFtdfSBBcnJheSBvZiBlbGVtZW50cyB0aGF0IGFyZSB1bmRlciB0aGUgcG9pbnQuIElmIG5vbmUgYXJlIGZvdW5kLCBhbiBlbXB0eSBhcnJheSBpcyByZXR1cm5lZA0KCQkgKi8NCgkJaW5kZXg6IGluZGV4TW9kZSwNCg0KCQkvKioNCgkJICogUmV0dXJucyBpdGVtcyBpbiB0aGUgc2FtZSBkYXRhc2V0LiBJZiB0aGUgb3B0aW9ucy5pbnRlcnNlY3QgcGFyYW1ldGVyIGlzIHRydWUsIHdlIG9ubHkgcmV0dXJuIGl0ZW1zIGlmIHdlIGludGVyc2VjdCBzb21ldGhpbmcNCgkJICogSWYgdGhlIG9wdGlvbnMuaW50ZXJzZWN0IGlzIGZhbHNlLCB3ZSBmaW5kIHRoZSBuZWFyZXN0IGl0ZW0gYW5kIHJldHVybiB0aGUgaXRlbXMgaW4gdGhhdCBkYXRhc2V0DQoJCSAqIEBmdW5jdGlvbiBDaGFydC5JbnRlcmFjdGlvbi5tb2Rlcy5kYXRhc2V0DQoJCSAqIEBwYXJhbSBjaGFydCB7Y2hhcnR9IHRoZSBjaGFydCB3ZSBhcmUgcmV0dXJuaW5nIGl0ZW1zIGZyb20NCgkJICogQHBhcmFtIGUge0V2ZW50fSB0aGUgZXZlbnQgd2UgYXJlIGZpbmQgdGhpbmdzIGF0DQoJCSAqIEBwYXJhbSBvcHRpb25zIHtJSW50ZXJhY3Rpb25PcHRpb25zfSBvcHRpb25zIHRvIHVzZSBkdXJpbmcgaW50ZXJhY3Rpb24NCgkJICogQHJldHVybiB7Q2hhcnQuRWxlbWVudFtdfSBBcnJheSBvZiBlbGVtZW50cyB0aGF0IGFyZSB1bmRlciB0aGUgcG9pbnQuIElmIG5vbmUgYXJlIGZvdW5kLCBhbiBlbXB0eSBhcnJheSBpcyByZXR1cm5lZA0KCQkgKi8NCgkJZGF0YXNldDogZnVuY3Rpb24oY2hhcnQsIGUsIG9wdGlvbnMpIHsNCgkJCXZhciBwb3NpdGlvbiA9IGdldFJlbGF0aXZlUG9zaXRpb24oZSwgY2hhcnQpOw0KCQkJb3B0aW9ucy5heGlzID0gb3B0aW9ucy5heGlzIHx8ICd4eSc7DQoJCQl2YXIgZGlzdGFuY2VNZXRyaWMgPSBnZXREaXN0YW5jZU1ldHJpY0ZvckF4aXMob3B0aW9ucy5heGlzKTsNCgkJCXZhciBpdGVtcyA9IG9wdGlvbnMuaW50ZXJzZWN0ID8gZ2V0SW50ZXJzZWN0SXRlbXMoY2hhcnQsIHBvc2l0aW9uKSA6IGdldE5lYXJlc3RJdGVtcyhjaGFydCwgcG9zaXRpb24sIGZhbHNlLCBkaXN0YW5jZU1ldHJpYyk7DQoNCgkJCWlmIChpdGVtcy5sZW5ndGggPiAwKSB7DQoJCQkJaXRlbXMgPSBjaGFydC5nZXREYXRhc2V0TWV0YShpdGVtc1swXS5fZGF0YXNldEluZGV4KS5kYXRhOw0KCQkJfQ0KDQoJCQlyZXR1cm4gaXRlbXM7DQoJCX0sDQoNCgkJLyoqDQoJCSAqIEBmdW5jdGlvbiBDaGFydC5JbnRlcmFjdGlvbi5tb2Rlcy54LWF4aXMNCgkJICogQGRlcHJlY2F0ZWQgc2luY2UgdmVyc2lvbiAyLjQuMC4gVXNlIGluZGV4IG1vZGUgYW5kIGludGVyc2VjdCA9PSB0cnVlDQoJCSAqIEB0b2RvIHJlbW92ZSBhdCB2ZXJzaW9uIDMNCgkJICogQHByaXZhdGUNCgkJICovDQoJCSd4LWF4aXMnOiBmdW5jdGlvbihjaGFydCwgZSkgew0KCQkJcmV0dXJuIGluZGV4TW9kZShjaGFydCwgZSwge2ludGVyc2VjdDogZmFsc2V9KTsNCgkJfSwNCg0KCQkvKioNCgkJICogUG9pbnQgbW9kZSByZXR1cm5zIGFsbCBlbGVtZW50cyB0aGF0IGhpdCB0ZXN0IGJhc2VkIG9uIHRoZSBldmVudCBwb3NpdGlvbg0KCQkgKiBvZiB0aGUgZXZlbnQNCgkJICogQGZ1bmN0aW9uIENoYXJ0LkludGVyYWN0aW9uLm1vZGVzLmludGVyc2VjdA0KCQkgKiBAcGFyYW0gY2hhcnQge2NoYXJ0fSB0aGUgY2hhcnQgd2UgYXJlIHJldHVybmluZyBpdGVtcyBmcm9tDQoJCSAqIEBwYXJhbSBlIHtFdmVudH0gdGhlIGV2ZW50IHdlIGFyZSBmaW5kIHRoaW5ncyBhdA0KCQkgKiBAcmV0dXJuIHtDaGFydC5FbGVtZW50W119IEFycmF5IG9mIGVsZW1lbnRzIHRoYXQgYXJlIHVuZGVyIHRoZSBwb2ludC4gSWYgbm9uZSBhcmUgZm91bmQsIGFuIGVtcHR5IGFycmF5IGlzIHJldHVybmVkDQoJCSAqLw0KCQlwb2ludDogZnVuY3Rpb24oY2hhcnQsIGUpIHsNCgkJCXZhciBwb3NpdGlvbiA9IGdldFJlbGF0aXZlUG9zaXRpb24oZSwgY2hhcnQpOw0KCQkJcmV0dXJuIGdldEludGVyc2VjdEl0ZW1zKGNoYXJ0LCBwb3NpdGlvbik7DQoJCX0sDQoNCgkJLyoqDQoJCSAqIG5lYXJlc3QgbW9kZSByZXR1cm5zIHRoZSBlbGVtZW50IGNsb3Nlc3QgdG8gdGhlIHBvaW50DQoJCSAqIEBmdW5jdGlvbiBDaGFydC5JbnRlcmFjdGlvbi5tb2Rlcy5pbnRlcnNlY3QNCgkJICogQHBhcmFtIGNoYXJ0IHtjaGFydH0gdGhlIGNoYXJ0IHdlIGFyZSByZXR1cm5pbmcgaXRlbXMgZnJvbQ0KCQkgKiBAcGFyYW0gZSB7RXZlbnR9IHRoZSBldmVudCB3ZSBhcmUgZmluZCB0aGluZ3MgYXQNCgkJICogQHBhcmFtIG9wdGlvbnMge0lJbnRlcmFjdGlvbk9wdGlvbnN9IG9wdGlvbnMgdG8gdXNlDQoJCSAqIEByZXR1cm4ge0NoYXJ0LkVsZW1lbnRbXX0gQXJyYXkgb2YgZWxlbWVudHMgdGhhdCBhcmUgdW5kZXIgdGhlIHBvaW50LiBJZiBub25lIGFyZSBmb3VuZCwgYW4gZW1wdHkgYXJyYXkgaXMgcmV0dXJuZWQNCgkJICovDQoJCW5lYXJlc3Q6IGZ1bmN0aW9uKGNoYXJ0LCBlLCBvcHRpb25zKSB7DQoJCQl2YXIgcG9zaXRpb24gPSBnZXRSZWxhdGl2ZVBvc2l0aW9uKGUsIGNoYXJ0KTsNCgkJCW9wdGlvbnMuYXhpcyA9IG9wdGlvbnMuYXhpcyB8fCAneHknOw0KCQkJdmFyIGRpc3RhbmNlTWV0cmljID0gZ2V0RGlzdGFuY2VNZXRyaWNGb3JBeGlzKG9wdGlvbnMuYXhpcyk7DQoJCQl2YXIgbmVhcmVzdEl0ZW1zID0gZ2V0TmVhcmVzdEl0ZW1zKGNoYXJ0LCBwb3NpdGlvbiwgb3B0aW9ucy5pbnRlcnNlY3QsIGRpc3RhbmNlTWV0cmljKTsNCg0KCQkJLy8gV2UgaGF2ZSBtdWx0aXBsZSBpdGVtcyBhdCB0aGUgc2FtZSBkaXN0YW5jZSBmcm9tIHRoZSBldmVudC4gTm93IHNvcnQgYnkgc21hbGxlc3QNCgkJCWlmIChuZWFyZXN0SXRlbXMubGVuZ3RoID4gMSkgew0KCQkJCW5lYXJlc3RJdGVtcy5zb3J0KGZ1bmN0aW9uKGEsIGIpIHsNCgkJCQkJdmFyIHNpemVBID0gYS5nZXRBcmVhKCk7DQoJCQkJCXZhciBzaXplQiA9IGIuZ2V0QXJlYSgpOw0KCQkJCQl2YXIgcmV0ID0gc2l6ZUEgLSBzaXplQjsNCg0KCQkJCQlpZiAocmV0ID09PSAwKSB7DQoJCQkJCQkvLyBpZiBlcXVhbCBzb3J0IGJ5IGRhdGFzZXQgaW5kZXgNCgkJCQkJCXJldCA9IGEuX2RhdGFzZXRJbmRleCAtIGIuX2RhdGFzZXRJbmRleDsNCgkJCQkJfQ0KDQoJCQkJCXJldHVybiByZXQ7DQoJCQkJfSk7DQoJCQl9DQoNCgkJCS8vIFJldHVybiBvbmx5IDEgaXRlbQ0KCQkJcmV0dXJuIG5lYXJlc3RJdGVtcy5zbGljZSgwLCAxKTsNCgkJfSwNCg0KCQkvKioNCgkJICogeCBtb2RlIHJldHVybnMgdGhlIGVsZW1lbnRzIHRoYXQgaGl0LXRlc3QgYXQgdGhlIGN1cnJlbnQgeCBjb29yZGluYXRlDQoJCSAqIEBmdW5jdGlvbiBDaGFydC5JbnRlcmFjdGlvbi5tb2Rlcy54DQoJCSAqIEBwYXJhbSBjaGFydCB7Y2hhcnR9IHRoZSBjaGFydCB3ZSBhcmUgcmV0dXJuaW5nIGl0ZW1zIGZyb20NCgkJICogQHBhcmFtIGUge0V2ZW50fSB0aGUgZXZlbnQgd2UgYXJlIGZpbmQgdGhpbmdzIGF0DQoJCSAqIEBwYXJhbSBvcHRpb25zIHtJSW50ZXJhY3Rpb25PcHRpb25zfSBvcHRpb25zIHRvIHVzZQ0KCQkgKiBAcmV0dXJuIHtDaGFydC5FbGVtZW50W119IEFycmF5IG9mIGVsZW1lbnRzIHRoYXQgYXJlIHVuZGVyIHRoZSBwb2ludC4gSWYgbm9uZSBhcmUgZm91bmQsIGFuIGVtcHR5IGFycmF5IGlzIHJldHVybmVkDQoJCSAqLw0KCQl4OiBmdW5jdGlvbihjaGFydCwgZSwgb3B0aW9ucykgew0KCQkJdmFyIHBvc2l0aW9uID0gZ2V0UmVsYXRpdmVQb3NpdGlvbihlLCBjaGFydCk7DQoJCQl2YXIgaXRlbXMgPSBbXTsNCgkJCXZhciBpbnRlcnNlY3RzSXRlbSA9IGZhbHNlOw0KDQoJCQlwYXJzZVZpc2libGVJdGVtcyhjaGFydCwgZnVuY3Rpb24oZWxlbWVudCkgew0KCQkJCWlmIChlbGVtZW50LmluWFJhbmdlKHBvc2l0aW9uLngpKSB7DQoJCQkJCWl0ZW1zLnB1c2goZWxlbWVudCk7DQoJCQkJfQ0KDQoJCQkJaWYgKGVsZW1lbnQuaW5SYW5nZShwb3NpdGlvbi54LCBwb3NpdGlvbi55KSkgew0KCQkJCQlpbnRlcnNlY3RzSXRlbSA9IHRydWU7DQoJCQkJfQ0KCQkJfSk7DQoNCgkJCS8vIElmIHdlIHdhbnQgdG8gdHJpZ2dlciBvbiBhbiBpbnRlcnNlY3QgYW5kIHdlIGRvbid0IGhhdmUgYW55IGl0ZW1zDQoJCQkvLyB0aGF0IGludGVyc2VjdCB0aGUgcG9zaXRpb24sIHJldHVybiBub3RoaW5nDQoJCQlpZiAob3B0aW9ucy5pbnRlcnNlY3QgJiYgIWludGVyc2VjdHNJdGVtKSB7DQoJCQkJaXRlbXMgPSBbXTsNCgkJCX0NCgkJCXJldHVybiBpdGVtczsNCgkJfSwNCg0KCQkvKioNCgkJICogeSBtb2RlIHJldHVybnMgdGhlIGVsZW1lbnRzIHRoYXQgaGl0LXRlc3QgYXQgdGhlIGN1cnJlbnQgeSBjb29yZGluYXRlDQoJCSAqIEBmdW5jdGlvbiBDaGFydC5JbnRlcmFjdGlvbi5tb2Rlcy55DQoJCSAqIEBwYXJhbSBjaGFydCB7Y2hhcnR9IHRoZSBjaGFydCB3ZSBhcmUgcmV0dXJuaW5nIGl0ZW1zIGZyb20NCgkJICogQHBhcmFtIGUge0V2ZW50fSB0aGUgZXZlbnQgd2UgYXJlIGZpbmQgdGhpbmdzIGF0DQoJCSAqIEBwYXJhbSBvcHRpb25zIHtJSW50ZXJhY3Rpb25PcHRpb25zfSBvcHRpb25zIHRvIHVzZQ0KCQkgKiBAcmV0dXJuIHtDaGFydC5FbGVtZW50W119IEFycmF5IG9mIGVsZW1lbnRzIHRoYXQgYXJlIHVuZGVyIHRoZSBwb2ludC4gSWYgbm9uZSBhcmUgZm91bmQsIGFuIGVtcHR5IGFycmF5IGlzIHJldHVybmVkDQoJCSAqLw0KCQl5OiBmdW5jdGlvbihjaGFydCwgZSwgb3B0aW9ucykgew0KCQkJdmFyIHBvc2l0aW9uID0gZ2V0UmVsYXRpdmVQb3NpdGlvbihlLCBjaGFydCk7DQoJCQl2YXIgaXRlbXMgPSBbXTsNCgkJCXZhciBpbnRlcnNlY3RzSXRlbSA9IGZhbHNlOw0KDQoJCQlwYXJzZVZpc2libGVJdGVtcyhjaGFydCwgZnVuY3Rpb24oZWxlbWVudCkgew0KCQkJCWlmIChlbGVtZW50LmluWVJhbmdlKHBvc2l0aW9uLnkpKSB7DQoJCQkJCWl0ZW1zLnB1c2goZWxlbWVudCk7DQoJCQkJfQ0KDQoJCQkJaWYgKGVsZW1lbnQuaW5SYW5nZShwb3NpdGlvbi54LCBwb3NpdGlvbi55KSkgew0KCQkJCQlpbnRlcnNlY3RzSXRlbSA9IHRydWU7DQoJCQkJfQ0KCQkJfSk7DQoNCgkJCS8vIElmIHdlIHdhbnQgdG8gdHJpZ2dlciBvbiBhbiBpbnRlcnNlY3QgYW5kIHdlIGRvbid0IGhhdmUgYW55IGl0ZW1zDQoJCQkvLyB0aGF0IGludGVyc2VjdCB0aGUgcG9zaXRpb24sIHJldHVybiBub3RoaW5nDQoJCQlpZiAob3B0aW9ucy5pbnRlcnNlY3QgJiYgIWludGVyc2VjdHNJdGVtKSB7DQoJCQkJaXRlbXMgPSBbXTsNCgkJCX0NCgkJCXJldHVybiBpdGVtczsNCgkJfQ0KCX0NCn07DQoNCn0seyI0NSI6NDV9XSwyOTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7DQondXNlIHN0cmljdCc7DQoNCnZhciBkZWZhdWx0cyA9IHJlcXVpcmUoMjUpOw0KDQpkZWZhdWx0cy5fc2V0KCdnbG9iYWwnLCB7DQoJcmVzcG9uc2l2ZTogdHJ1ZSwNCglyZXNwb25zaXZlQW5pbWF0aW9uRHVyYXRpb246IDAsDQoJbWFpbnRhaW5Bc3BlY3RSYXRpbzogdHJ1ZSwNCglldmVudHM6IFsnbW91c2Vtb3ZlJywgJ21vdXNlb3V0JywgJ2NsaWNrJywgJ3RvdWNoc3RhcnQnLCAndG91Y2htb3ZlJ10sDQoJaG92ZXI6IHsNCgkJb25Ib3ZlcjogbnVsbCwNCgkJbW9kZTogJ25lYXJlc3QnLA0KCQlpbnRlcnNlY3Q6IHRydWUsDQoJCWFuaW1hdGlvbkR1cmF0aW9uOiA0MDANCgl9LA0KCW9uQ2xpY2s6IG51bGwsDQoJZGVmYXVsdENvbG9yOiAncmdiYSgwLDAsMCwwLjEpJywNCglkZWZhdWx0Rm9udENvbG9yOiAnIzY2NicsDQoJZGVmYXVsdEZvbnRGYW1pbHk6ICInSGVsdmV0aWNhIE5ldWUnLCAnSGVsdmV0aWNhJywgJ0FyaWFsJywgc2Fucy1zZXJpZiIsDQoJZGVmYXVsdEZvbnRTaXplOiAxMiwNCglkZWZhdWx0Rm9udFN0eWxlOiAnbm9ybWFsJywNCglzaG93TGluZXM6IHRydWUsDQoNCgkvLyBFbGVtZW50IGRlZmF1bHRzIGRlZmluZWQgaW4gZWxlbWVudCBleHRlbnNpb25zDQoJZWxlbWVudHM6IHt9LA0KDQoJLy8gTGF5b3V0IG9wdGlvbnMgc3VjaCBhcyBwYWRkaW5nDQoJbGF5b3V0OiB7DQoJCXBhZGRpbmc6IHsNCgkJCXRvcDogMCwNCgkJCXJpZ2h0OiAwLA0KCQkJYm90dG9tOiAwLA0KCQkJbGVmdDogMA0KCQl9DQoJfQ0KfSk7DQoNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oKSB7DQoNCgkvLyBPY2N1cHkgdGhlIGdsb2JhbCB2YXJpYWJsZSBvZiBDaGFydCwgYW5kIGNyZWF0ZSBhIHNpbXBsZSBiYXNlIGNsYXNzDQoJdmFyIENoYXJ0ID0gZnVuY3Rpb24oaXRlbSwgY29uZmlnKSB7DQoJCXRoaXMuY29uc3RydWN0KGl0ZW0sIGNvbmZpZyk7DQoJCXJldHVybiB0aGlzOw0KCX07DQoNCglDaGFydC5DaGFydCA9IENoYXJ0Ow0KDQoJcmV0dXJuIENoYXJ0Ow0KfTsNCg0KfSx7IjI1IjoyNX1dLDMwOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsNCid1c2Ugc3RyaWN0JzsNCg0KdmFyIGhlbHBlcnMgPSByZXF1aXJlKDQ1KTsNCg0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihDaGFydCkgew0KDQoJZnVuY3Rpb24gZmlsdGVyQnlQb3NpdGlvbihhcnJheSwgcG9zaXRpb24pIHsNCgkJcmV0dXJuIGhlbHBlcnMud2hlcmUoYXJyYXksIGZ1bmN0aW9uKHYpIHsNCgkJCXJldHVybiB2LnBvc2l0aW9uID09PSBwb3NpdGlvbjsNCgkJfSk7DQoJfQ0KDQoJZnVuY3Rpb24gc29ydEJ5V2VpZ2h0KGFycmF5LCByZXZlcnNlKSB7DQoJCWFycmF5LmZvckVhY2goZnVuY3Rpb24odiwgaSkgew0KCQkJdi5fdG1wSW5kZXhfID0gaTsNCgkJCXJldHVybiB2Ow0KCQl9KTsNCgkJYXJyYXkuc29ydChmdW5jdGlvbihhLCBiKSB7DQoJCQl2YXIgdjAgPSByZXZlcnNlID8gYiA6IGE7DQoJCQl2YXIgdjEgPSByZXZlcnNlID8gYSA6IGI7DQoJCQlyZXR1cm4gdjAud2VpZ2h0ID09PSB2MS53ZWlnaHQgPw0KCQkJCXYwLl90bXBJbmRleF8gLSB2MS5fdG1wSW5kZXhfIDoNCgkJCQl2MC53ZWlnaHQgLSB2MS53ZWlnaHQ7DQoJCX0pOw0KCQlhcnJheS5mb3JFYWNoKGZ1bmN0aW9uKHYpIHsNCgkJCWRlbGV0ZSB2Ll90bXBJbmRleF87DQoJCX0pOw0KCX0NCg0KCS8qKg0KCSAqIEBpbnRlcmZhY2UgSUxheW91dEl0ZW0NCgkgKiBAcHJvcCB7U3RyaW5nfSBwb3NpdGlvbiAtIFRoZSBwb3NpdGlvbiBvZiB0aGUgaXRlbSBpbiB0aGUgY2hhcnQgbGF5b3V0LiBQb3NzaWJsZSB2YWx1ZXMgYXJlDQoJICogJ2xlZnQnLCAndG9wJywgJ3JpZ2h0JywgJ2JvdHRvbScsIGFuZCAnY2hhcnRBcmVhJw0KCSAqIEBwcm9wIHtOdW1iZXJ9IHdlaWdodCAtIFRoZSB3ZWlnaHQgdXNlZCB0byBzb3J0IHRoZSBpdGVtLiBIaWdoZXIgd2VpZ2h0cyBhcmUgZnVydGhlciBhd2F5IGZyb20gdGhlIGNoYXJ0IGFyZWENCgkgKiBAcHJvcCB7Qm9vbGVhbn0gZnVsbFdpZHRoIC0gaWYgdHJ1ZSwgYW5kIHRoZSBpdGVtIGlzIGhvcml6b250YWwsIHRoZW4gcHVzaCB2ZXJ0aWNhbCBib3hlcyBkb3duDQoJICogQHByb3Age0Z1bmN0aW9ufSBpc0hvcml6b250YWwgLSByZXR1cm5zIHRydWUgaWYgdGhlIGxheW91dCBpdGVtIGlzIGhvcml6b250YWwgKGllLiB0b3Agb3IgYm90dG9tKQ0KCSAqIEBwcm9wIHtGdW5jdGlvbn0gdXBkYXRlIC0gVGFrZXMgdHdvIHBhcmFtZXRlcnM6IHdpZHRoIGFuZCBoZWlnaHQuIFJldHVybnMgc2l6ZSBvZiBpdGVtDQoJICogQHByb3Age0Z1bmN0aW9ufSBnZXRQYWRkaW5nIC0gIFJldHVybnMgYW4gb2JqZWN0IHdpdGggcGFkZGluZyBvbiB0aGUgZWRnZXMNCgkgKiBAcHJvcCB7TnVtYmVyfSB3aWR0aCAtIFdpZHRoIG9mIGl0ZW0uIE11c3QgYmUgdmFsaWQgYWZ0ZXIgdXBkYXRlKCkNCgkgKiBAcHJvcCB7TnVtYmVyfSBoZWlnaHQgLSBIZWlnaHQgb2YgaXRlbS4gTXVzdCBiZSB2YWxpZCBhZnRlciB1cGRhdGUoKQ0KCSAqIEBwcm9wIHtOdW1iZXJ9IGxlZnQgLSBMZWZ0IGVkZ2Ugb2YgdGhlIGl0ZW0uIFNldCBieSBsYXlvdXQgc3lzdGVtIGFuZCBjYW5ub3QgYmUgdXNlZCBpbiB1cGRhdGUNCgkgKiBAcHJvcCB7TnVtYmVyfSB0b3AgLSBUb3AgZWRnZSBvZiB0aGUgaXRlbS4gU2V0IGJ5IGxheW91dCBzeXN0ZW0gYW5kIGNhbm5vdCBiZSB1c2VkIGluIHVwZGF0ZQ0KCSAqIEBwcm9wIHtOdW1iZXJ9IHJpZ2h0IC0gUmlnaHQgZWRnZSBvZiB0aGUgaXRlbS4gU2V0IGJ5IGxheW91dCBzeXN0ZW0gYW5kIGNhbm5vdCBiZSB1c2VkIGluIHVwZGF0ZQ0KCSAqIEBwcm9wIHtOdW1iZXJ9IGJvdHRvbSAtIEJvdHRvbSBlZGdlIG9mIHRoZSBpdGVtLiBTZXQgYnkgbGF5b3V0IHN5c3RlbSBhbmQgY2Fubm90IGJlIHVzZWQgaW4gdXBkYXRlDQoJICovDQoNCgkvLyBUaGUgbGF5b3V0IHNlcnZpY2UgaXMgdmVyeSBzZWxmIGV4cGxhbmF0b3J5LiAgSXQncyByZXNwb25zaWJsZSBmb3IgdGhlIGxheW91dCB3aXRoaW4gYSBjaGFydC4NCgkvLyBTY2FsZXMsIExlZ2VuZHMgYW5kIFBsdWdpbnMgYWxsIHJlbHkgb24gdGhlIGxheW91dCBzZXJ2aWNlIGFuZCBjYW4gZWFzaWx5IHJlZ2lzdGVyIHRvIGJlIHBsYWNlZCBhbnl3aGVyZSB0aGV5IG5lZWQNCgkvLyBJdCBpcyB0aGlzIHNlcnZpY2UncyByZXNwb25zaWJpbGl0eSBvZiBjYXJyeWluZyBvdXQgdGhhdCBsYXlvdXQuDQoJQ2hhcnQubGF5b3V0U2VydmljZSA9IHsNCgkJZGVmYXVsdHM6IHt9LA0KDQoJCS8qKg0KCQkgKiBSZWdpc3RlciBhIGJveCB0byBhIGNoYXJ0Lg0KCQkgKiBBIGJveCBpcyBzaW1wbHkgYSByZWZlcmVuY2UgdG8gYW4gb2JqZWN0IHRoYXQgcmVxdWlyZXMgbGF5b3V0LiBlZy4gU2NhbGVzLCBMZWdlbmQsIFRpdGxlLg0KCQkgKiBAcGFyYW0ge0NoYXJ0fSBjaGFydCAtIHRoZSBjaGFydCB0byB1c2UNCgkJICogQHBhcmFtIHtJTGF5b3V0SXRlbX0gaXRlbSAtIHRoZSBpdGVtIHRvIGFkZCB0byBiZSBsYXllZCBvdXQNCgkJICovDQoJCWFkZEJveDogZnVuY3Rpb24oY2hhcnQsIGl0ZW0pIHsNCgkJCWlmICghY2hhcnQuYm94ZXMpIHsNCgkJCQljaGFydC5ib3hlcyA9IFtdOw0KCQkJfQ0KDQoJCQkvLyBpbml0aWFsaXplIGl0ZW0gd2l0aCBkZWZhdWx0IHZhbHVlcw0KCQkJaXRlbS5mdWxsV2lkdGggPSBpdGVtLmZ1bGxXaWR0aCB8fCBmYWxzZTsNCgkJCWl0ZW0ucG9zaXRpb24gPSBpdGVtLnBvc2l0aW9uIHx8ICd0b3AnOw0KCQkJaXRlbS53ZWlnaHQgPSBpdGVtLndlaWdodCB8fCAwOw0KDQoJCQljaGFydC5ib3hlcy5wdXNoKGl0ZW0pOw0KCQl9LA0KDQoJCS8qKg0KCQkgKiBSZW1vdmUgYSBsYXlvdXRJdGVtIGZyb20gYSBjaGFydA0KCQkgKiBAcGFyYW0ge0NoYXJ0fSBjaGFydCAtIHRoZSBjaGFydCB0byByZW1vdmUgdGhlIGJveCBmcm9tDQoJCSAqIEBwYXJhbSB7T2JqZWN0fSBsYXlvdXRJdGVtIC0gdGhlIGl0ZW0gdG8gcmVtb3ZlIGZyb20gdGhlIGxheW91dA0KCQkgKi8NCgkJcmVtb3ZlQm94OiBmdW5jdGlvbihjaGFydCwgbGF5b3V0SXRlbSkgew0KCQkJdmFyIGluZGV4ID0gY2hhcnQuYm94ZXMgPyBjaGFydC5ib3hlcy5pbmRleE9mKGxheW91dEl0ZW0pIDogLTE7DQoJCQlpZiAoaW5kZXggIT09IC0xKSB7DQoJCQkJY2hhcnQuYm94ZXMuc3BsaWNlKGluZGV4LCAxKTsNCgkJCX0NCgkJfSwNCg0KCQkvKioNCgkJICogU2V0cyAob3IgdXBkYXRlcykgb3B0aW9ucyBvbiB0aGUgZ2l2ZW4gYGl0ZW1gLg0KCQkgKiBAcGFyYW0ge0NoYXJ0fSBjaGFydCAtIHRoZSBjaGFydCBpbiB3aGljaCB0aGUgaXRlbSBsaXZlcyAob3Igd2lsbCBiZSBhZGRlZCB0bykNCgkJICogQHBhcmFtIHtPYmplY3R9IGl0ZW0gLSB0aGUgaXRlbSB0byBjb25maWd1cmUgd2l0aCB0aGUgZ2l2ZW4gb3B0aW9ucw0KCQkgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyAtIHRoZSBuZXcgaXRlbSBvcHRpb25zLg0KCQkgKi8NCgkJY29uZmlndXJlOiBmdW5jdGlvbihjaGFydCwgaXRlbSwgb3B0aW9ucykgew0KCQkJdmFyIHByb3BzID0gWydmdWxsV2lkdGgnLCAncG9zaXRpb24nLCAnd2VpZ2h0J107DQoJCQl2YXIgaWxlbiA9IHByb3BzLmxlbmd0aDsNCgkJCXZhciBpID0gMDsNCgkJCXZhciBwcm9wOw0KDQoJCQlmb3IgKDsgaSA8IGlsZW47ICsraSkgew0KCQkJCXByb3AgPSBwcm9wc1tpXTsNCgkJCQlpZiAob3B0aW9ucy5oYXNPd25Qcm9wZXJ0eShwcm9wKSkgew0KCQkJCQlpdGVtW3Byb3BdID0gb3B0aW9uc1twcm9wXTsNCgkJCQl9DQoJCQl9DQoJCX0sDQoNCgkJLyoqDQoJCSAqIEZpdHMgYm94ZXMgb2YgdGhlIGdpdmVuIGNoYXJ0IGludG8gdGhlIGdpdmVuIHNpemUgYnkgaGF2aW5nIGVhY2ggYm94IG1lYXN1cmUgaXRzZWxmDQoJCSAqIHRoZW4gcnVubmluZyBhIGZpdHRpbmcgYWxnb3JpdGhtDQoJCSAqIEBwYXJhbSB7Q2hhcnR9IGNoYXJ0IC0gdGhlIGNoYXJ0DQoJCSAqIEBwYXJhbSB7TnVtYmVyfSB3aWR0aCAtIHRoZSB3aWR0aCB0byBmaXQgaW50bw0KCQkgKiBAcGFyYW0ge051bWJlcn0gaGVpZ2h0IC0gdGhlIGhlaWdodCB0byBmaXQgaW50bw0KCQkgKi8NCgkJdXBkYXRlOiBmdW5jdGlvbihjaGFydCwgd2lkdGgsIGhlaWdodCkgew0KCQkJaWYgKCFjaGFydCkgew0KCQkJCXJldHVybjsNCgkJCX0NCg0KCQkJdmFyIGxheW91dE9wdGlvbnMgPSBjaGFydC5vcHRpb25zLmxheW91dCB8fCB7fTsNCgkJCXZhciBwYWRkaW5nID0gaGVscGVycy5vcHRpb25zLnRvUGFkZGluZyhsYXlvdXRPcHRpb25zLnBhZGRpbmcpOw0KCQkJdmFyIGxlZnRQYWRkaW5nID0gcGFkZGluZy5sZWZ0Ow0KCQkJdmFyIHJpZ2h0UGFkZGluZyA9IHBhZGRpbmcucmlnaHQ7DQoJCQl2YXIgdG9wUGFkZGluZyA9IHBhZGRpbmcudG9wOw0KCQkJdmFyIGJvdHRvbVBhZGRpbmcgPSBwYWRkaW5nLmJvdHRvbTsNCg0KCQkJdmFyIGxlZnRCb3hlcyA9IGZpbHRlckJ5UG9zaXRpb24oY2hhcnQuYm94ZXMsICdsZWZ0Jyk7DQoJCQl2YXIgcmlnaHRCb3hlcyA9IGZpbHRlckJ5UG9zaXRpb24oY2hhcnQuYm94ZXMsICdyaWdodCcpOw0KCQkJdmFyIHRvcEJveGVzID0gZmlsdGVyQnlQb3NpdGlvbihjaGFydC5ib3hlcywgJ3RvcCcpOw0KCQkJdmFyIGJvdHRvbUJveGVzID0gZmlsdGVyQnlQb3NpdGlvbihjaGFydC5ib3hlcywgJ2JvdHRvbScpOw0KCQkJdmFyIGNoYXJ0QXJlYUJveGVzID0gZmlsdGVyQnlQb3NpdGlvbihjaGFydC5ib3hlcywgJ2NoYXJ0QXJlYScpOw0KDQoJCQkvLyBTb3J0IGJveGVzIGJ5IHdlaWdodC4gQSBoaWdoZXIgd2VpZ2h0IGlzIGZ1cnRoZXIgYXdheSBmcm9tIHRoZSBjaGFydCBhcmVhDQoJCQlzb3J0QnlXZWlnaHQobGVmdEJveGVzLCB0cnVlKTsNCgkJCXNvcnRCeVdlaWdodChyaWdodEJveGVzLCBmYWxzZSk7DQoJCQlzb3J0QnlXZWlnaHQodG9wQm94ZXMsIHRydWUpOw0KCQkJc29ydEJ5V2VpZ2h0KGJvdHRvbUJveGVzLCBmYWxzZSk7DQoNCgkJCS8vIEVzc2VudGlhbGx5IHdlIG5vdyBoYXZlIGFueSBudW1iZXIgb2YgYm94ZXMgb24gZWFjaCBvZiB0aGUgNCBzaWRlcy4NCgkJCS8vIE91ciBjYW52YXMgbG9va3MgbGlrZSB0aGUgZm9sbG93aW5nLg0KCQkJLy8gVGhlIGFyZWFzIEwxIGFuZCBMMiBhcmUgdGhlIGxlZnQgYXhlcy4gUjEgaXMgdGhlIHJpZ2h0IGF4aXMsIFQxIGlzIHRoZSB0b3AgYXhpcyBhbmQNCgkJCS8vIEIxIGlzIHRoZSBib3R0b20gYXhpcw0KCQkJLy8gVGhlcmUgYXJlIGFsc28gNCBxdWFkcmFudC1saWtlIGxvY2F0aW9ucyAobGVmdCB0byByaWdodCBpbnN0ZWFkIG9mIGNsb2Nrd2lzZSkgcmVzZXJ2ZWQgZm9yIGNoYXJ0IG92ZXJsYXlzDQoJCQkvLyBUaGVzZSBsb2NhdGlvbnMgYXJlIHNpbmdsZS1ib3ggbG9jYXRpb25zIG9ubHksIHdoZW4gdHJ5aW5nIHRvIHJlZ2lzdGVyIGEgY2hhcnRBcmVhIGxvY2F0aW9uIHRoYXQgaXMgYWxyZWFkeSB0YWtlbiwNCgkJCS8vIGFuIGVycm9yIHdpbGwgYmUgdGhyb3duLg0KCQkJLy8NCgkJCS8vIHwtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tfA0KCQkJLy8gfCAgICAgICAgICAgICAgICAgIFQxIChGdWxsIFdpZHRoKSAgICAgICAgICAgICAgICAgICB8DQoJCQkvLyB8LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLXwNCgkJCS8vIHwgICAgfCAgICB8ICAgICAgICAgICAgICAgICBUMiAgICAgICAgICAgICAgICAgIHwgICAgfA0KCQkJLy8gfCAgICB8LS0tLXwtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tfC0tLS18DQoJCQkvLyB8ICAgIHwgICAgfCBDMSB8ICAgICAgICAgICAgICAgICAgICAgICAgICAgfCBDMiB8ICAgIHwNCgkJCS8vIHwgICAgfCAgICB8LS0tLXwgICAgICAgICAgICAgICAgICAgICAgICAgICB8LS0tLXwgICAgfA0KCQkJLy8gfCAgICB8ICAgIHwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfCAgICB8DQoJCQkvLyB8IEwxIHwgTDIgfCAgICAgICAgICAgQ2hhcnRBcmVhIChDMCkgICAgICAgICAgICB8IFIxIHwNCgkJCS8vIHwgICAgfCAgICB8ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgICAgfA0KCQkJLy8gfCAgICB8ICAgIHwtLS0tfCAgICAgICAgICAgICAgICAgICAgICAgICAgIHwtLS0tfCAgICB8DQoJCQkvLyB8ICAgIHwgICAgfCBDMyB8ICAgICAgICAgICAgICAgICAgICAgICAgICAgfCBDNCB8ICAgIHwNCgkJCS8vIHwgICAgfC0tLS18LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLXwtLS0tfA0KCQkJLy8gfCAgICB8ICAgIHwgICAgICAgICAgICAgICAgIEIxICAgICAgICAgICAgICAgICAgfCAgICB8DQoJCQkvLyB8LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLXwNCgkJCS8vIHwgICAgICAgICAgICAgICAgICBCMiAoRnVsbCBXaWR0aCkgICAgICAgICAgICAgICAgICAgfA0KCQkJLy8gfC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS18DQoJCQkvLw0KCQkJLy8gV2hhdCB3ZSBkbyB0byBmaW5kIHRoZSBiZXN0IHNpemluZywgd2UgZG8gdGhlIGZvbGxvd2luZw0KCQkJLy8gMS4gRGV0ZXJtaW5lIHRoZSBtaW5pbXVtIHNpemUgb2YgdGhlIGNoYXJ0IGFyZWEuDQoJCQkvLyAyLiBTcGxpdCB0aGUgcmVtYWluaW5nIHdpZHRoIGVxdWFsbHkgYmV0d2VlbiBlYWNoIHZlcnRpY2FsIGF4aXMNCgkJCS8vIDMuIFNwbGl0IHRoZSByZW1haW5pbmcgaGVpZ2h0IGVxdWFsbHkgYmV0d2VlbiBlYWNoIGhvcml6b250YWwgYXhpcw0KCQkJLy8gNC4gR2l2ZSBlYWNoIGxheW91dCB0aGUgbWF4aW11bSBzaXplIGl0IGNhbiBiZS4gVGhlIGxheW91dCB3aWxsIHJldHVybiBpdCdzIG1pbmltdW0gc2l6ZQ0KCQkJLy8gNS4gQWRqdXN0IHRoZSBzaXplcyBvZiBlYWNoIGF4aXMgYmFzZWQgb24gaXQncyBtaW5pbXVtIHJlcG9ydGVkIHNpemUuDQoJCQkvLyA2LiBSZWZpdCBlYWNoIGF4aXMNCgkJCS8vIDcuIFBvc2l0aW9uIGVhY2ggYXhpcyBpbiB0aGUgZmluYWwgbG9jYXRpb24NCgkJCS8vIDguIFRlbGwgdGhlIGNoYXJ0IHRoZSBmaW5hbCBsb2NhdGlvbiBvZiB0aGUgY2hhcnQgYXJlYQ0KCQkJLy8gOS4gVGVsbCBhbnkgYXhlcyB0aGF0IG92ZXJsYXkgdGhlIGNoYXJ0IGFyZWEgdGhlIHBvc2l0aW9ucyBvZiB0aGUgY2hhcnQgYXJlYQ0KDQoJCQkvLyBTdGVwIDENCgkJCXZhciBjaGFydFdpZHRoID0gd2lkdGggLSBsZWZ0UGFkZGluZyAtIHJpZ2h0UGFkZGluZzsNCgkJCXZhciBjaGFydEhlaWdodCA9IGhlaWdodCAtIHRvcFBhZGRpbmcgLSBib3R0b21QYWRkaW5nOw0KCQkJdmFyIGNoYXJ0QXJlYVdpZHRoID0gY2hhcnRXaWR0aCAvIDI7IC8vIG1pbiA1MCUNCgkJCXZhciBjaGFydEFyZWFIZWlnaHQgPSBjaGFydEhlaWdodCAvIDI7IC8vIG1pbiA1MCUNCg0KCQkJLy8gU3RlcCAyDQoJCQl2YXIgdmVydGljYWxCb3hXaWR0aCA9ICh3aWR0aCAtIGNoYXJ0QXJlYVdpZHRoKSAvIChsZWZ0Qm94ZXMubGVuZ3RoICsgcmlnaHRCb3hlcy5sZW5ndGgpOw0KDQoJCQkvLyBTdGVwIDMNCgkJCXZhciBob3Jpem9udGFsQm94SGVpZ2h0ID0gKGhlaWdodCAtIGNoYXJ0QXJlYUhlaWdodCkgLyAodG9wQm94ZXMubGVuZ3RoICsgYm90dG9tQm94ZXMubGVuZ3RoKTsNCg0KCQkJLy8gU3RlcCA0DQoJCQl2YXIgbWF4Q2hhcnRBcmVhV2lkdGggPSBjaGFydFdpZHRoOw0KCQkJdmFyIG1heENoYXJ0QXJlYUhlaWdodCA9IGNoYXJ0SGVpZ2h0Ow0KCQkJdmFyIG1pbkJveFNpemVzID0gW107DQoNCgkJCWZ1bmN0aW9uIGdldE1pbmltdW1Cb3hTaXplKGJveCkgew0KCQkJCXZhciBtaW5TaXplOw0KCQkJCXZhciBpc0hvcml6b250YWwgPSBib3guaXNIb3Jpem9udGFsKCk7DQoNCgkJCQlpZiAoaXNIb3Jpem9udGFsKSB7DQoJCQkJCW1pblNpemUgPSBib3gudXBkYXRlKGJveC5mdWxsV2lkdGggPyBjaGFydFdpZHRoIDogbWF4Q2hhcnRBcmVhV2lkdGgsIGhvcml6b250YWxCb3hIZWlnaHQpOw0KCQkJCQltYXhDaGFydEFyZWFIZWlnaHQgLT0gbWluU2l6ZS5oZWlnaHQ7DQoJCQkJfSBlbHNlIHsNCgkJCQkJbWluU2l6ZSA9IGJveC51cGRhdGUodmVydGljYWxCb3hXaWR0aCwgY2hhcnRBcmVhSGVpZ2h0KTsNCgkJCQkJbWF4Q2hhcnRBcmVhV2lkdGggLT0gbWluU2l6ZS53aWR0aDsNCgkJCQl9DQoNCgkJCQltaW5Cb3hTaXplcy5wdXNoKHsNCgkJCQkJaG9yaXpvbnRhbDogaXNIb3Jpem9udGFsLA0KCQkJCQltaW5TaXplOiBtaW5TaXplLA0KCQkJCQlib3g6IGJveCwNCgkJCQl9KTsNCgkJCX0NCg0KCQkJaGVscGVycy5lYWNoKGxlZnRCb3hlcy5jb25jYXQocmlnaHRCb3hlcywgdG9wQm94ZXMsIGJvdHRvbUJveGVzKSwgZ2V0TWluaW11bUJveFNpemUpOw0KDQoJCQkvLyBJZiBhIGhvcml6b250YWwgYm94IGhhcyBwYWRkaW5nLCB3ZSBtb3ZlIHRoZSBsZWZ0IGJveGVzIG92ZXIgdG8gYXZvaWQgdWdseSBjaGFydHMgKHNlZSBpc3N1ZSAjMjQ3OCkNCgkJCXZhciBtYXhIb3Jpem9udGFsTGVmdFBhZGRpbmcgPSAwOw0KCQkJdmFyIG1heEhvcml6b250YWxSaWdodFBhZGRpbmcgPSAwOw0KCQkJdmFyIG1heFZlcnRpY2FsVG9wUGFkZGluZyA9IDA7DQoJCQl2YXIgbWF4VmVydGljYWxCb3R0b21QYWRkaW5nID0gMDsNCg0KCQkJaGVscGVycy5lYWNoKHRvcEJveGVzLmNvbmNhdChib3R0b21Cb3hlcyksIGZ1bmN0aW9uKGhvcml6b250YWxCb3gpIHsNCgkJCQlpZiAoaG9yaXpvbnRhbEJveC5nZXRQYWRkaW5nKSB7DQoJCQkJCXZhciBib3hQYWRkaW5nID0gaG9yaXpvbnRhbEJveC5nZXRQYWRkaW5nKCk7DQoJCQkJCW1heEhvcml6b250YWxMZWZ0UGFkZGluZyA9IE1hdGgubWF4KG1heEhvcml6b250YWxMZWZ0UGFkZGluZywgYm94UGFkZGluZy5sZWZ0KTsNCgkJCQkJbWF4SG9yaXpvbnRhbFJpZ2h0UGFkZGluZyA9IE1hdGgubWF4KG1heEhvcml6b250YWxSaWdodFBhZGRpbmcsIGJveFBhZGRpbmcucmlnaHQpOw0KCQkJCX0NCgkJCX0pOw0KDQoJCQloZWxwZXJzLmVhY2gobGVmdEJveGVzLmNvbmNhdChyaWdodEJveGVzKSwgZnVuY3Rpb24odmVydGljYWxCb3gpIHsNCgkJCQlpZiAodmVydGljYWxCb3guZ2V0UGFkZGluZykgew0KCQkJCQl2YXIgYm94UGFkZGluZyA9IHZlcnRpY2FsQm94LmdldFBhZGRpbmcoKTsNCgkJCQkJbWF4VmVydGljYWxUb3BQYWRkaW5nID0gTWF0aC5tYXgobWF4VmVydGljYWxUb3BQYWRkaW5nLCBib3hQYWRkaW5nLnRvcCk7DQoJCQkJCW1heFZlcnRpY2FsQm90dG9tUGFkZGluZyA9IE1hdGgubWF4KG1heFZlcnRpY2FsQm90dG9tUGFkZGluZywgYm94UGFkZGluZy5ib3R0b20pOw0KCQkJCX0NCgkJCX0pOw0KDQoJCQkvLyBBdCB0aGlzIHBvaW50LCBtYXhDaGFydEFyZWFIZWlnaHQgYW5kIG1heENoYXJ0QXJlYVdpZHRoIGFyZSB0aGUgc2l6ZSB0aGUgY2hhcnQgYXJlYSBjb3VsZA0KCQkJLy8gYmUgaWYgdGhlIGF4ZXMgYXJlIGRyYXduIGF0IHRoZWlyIG1pbmltdW0gc2l6ZXMuDQoJCQkvLyBTdGVwcyA1ICYgNg0KCQkJdmFyIHRvdGFsTGVmdEJveGVzV2lkdGggPSBsZWZ0UGFkZGluZzsNCgkJCXZhciB0b3RhbFJpZ2h0Qm94ZXNXaWR0aCA9IHJpZ2h0UGFkZGluZzsNCgkJCXZhciB0b3RhbFRvcEJveGVzSGVpZ2h0ID0gdG9wUGFkZGluZzsNCgkJCXZhciB0b3RhbEJvdHRvbUJveGVzSGVpZ2h0ID0gYm90dG9tUGFkZGluZzsNCg0KCQkJLy8gRnVuY3Rpb24gdG8gZml0IGEgYm94DQoJCQlmdW5jdGlvbiBmaXRCb3goYm94KSB7DQoJCQkJdmFyIG1pbkJveFNpemUgPSBoZWxwZXJzLmZpbmROZXh0V2hlcmUobWluQm94U2l6ZXMsIGZ1bmN0aW9uKG1pbkJveCkgew0KCQkJCQlyZXR1cm4gbWluQm94LmJveCA9PT0gYm94Ow0KCQkJCX0pOw0KDQoJCQkJaWYgKG1pbkJveFNpemUpIHsNCgkJCQkJaWYgKGJveC5pc0hvcml6b250YWwoKSkgew0KCQkJCQkJdmFyIHNjYWxlTWFyZ2luID0gew0KCQkJCQkJCWxlZnQ6IE1hdGgubWF4KHRvdGFsTGVmdEJveGVzV2lkdGgsIG1heEhvcml6b250YWxMZWZ0UGFkZGluZyksDQoJCQkJCQkJcmlnaHQ6IE1hdGgubWF4KHRvdGFsUmlnaHRCb3hlc1dpZHRoLCBtYXhIb3Jpem9udGFsUmlnaHRQYWRkaW5nKSwNCgkJCQkJCQl0b3A6IDAsDQoJCQkJCQkJYm90dG9tOiAwDQoJCQkJCQl9Ow0KDQoJCQkJCQkvLyBEb24ndCB1c2UgbWluIHNpemUgaGVyZSBiZWNhdXNlIG9mIGxhYmVsIHJvdGF0aW9uLiBXaGVuIHRoZSBsYWJlbHMgYXJlIHJvdGF0ZWQsIHRoZWlyIHJvdGF0aW9uIGhpZ2hseSBkZXBlbmRzDQoJCQkJCQkvLyBvbiB0aGUgbWFyZ2luLiBTb21ldGltZXMgdGhleSBuZWVkIHRvIGluY3JlYXNlIGluIHNpemUgc2xpZ2h0bHkNCgkJCQkJCWJveC51cGRhdGUoYm94LmZ1bGxXaWR0aCA/IGNoYXJ0V2lkdGggOiBtYXhDaGFydEFyZWFXaWR0aCwgY2hhcnRIZWlnaHQgLyAyLCBzY2FsZU1hcmdpbik7DQoJCQkJCX0gZWxzZSB7DQoJCQkJCQlib3gudXBkYXRlKG1pbkJveFNpemUubWluU2l6ZS53aWR0aCwgbWF4Q2hhcnRBcmVhSGVpZ2h0KTsNCgkJCQkJfQ0KCQkJCX0NCgkJCX0NCg0KCQkJLy8gVXBkYXRlLCBhbmQgY2FsY3VsYXRlIHRoZSBsZWZ0IGFuZCByaWdodCBtYXJnaW5zIGZvciB0aGUgaG9yaXpvbnRhbCBib3hlcw0KCQkJaGVscGVycy5lYWNoKGxlZnRCb3hlcy5jb25jYXQocmlnaHRCb3hlcyksIGZpdEJveCk7DQoNCgkJCWhlbHBlcnMuZWFjaChsZWZ0Qm94ZXMsIGZ1bmN0aW9uKGJveCkgew0KCQkJCXRvdGFsTGVmdEJveGVzV2lkdGggKz0gYm94LndpZHRoOw0KCQkJfSk7DQoNCgkJCWhlbHBlcnMuZWFjaChyaWdodEJveGVzLCBmdW5jdGlvbihib3gpIHsNCgkJCQl0b3RhbFJpZ2h0Qm94ZXNXaWR0aCArPSBib3gud2lkdGg7DQoJCQl9KTsNCg0KCQkJLy8gU2V0IHRoZSBMZWZ0IGFuZCBSaWdodCBtYXJnaW5zIGZvciB0aGUgaG9yaXpvbnRhbCBib3hlcw0KCQkJaGVscGVycy5lYWNoKHRvcEJveGVzLmNvbmNhdChib3R0b21Cb3hlcyksIGZpdEJveCk7DQoNCgkJCS8vIEZpZ3VyZSBvdXQgaG93IG11Y2ggbWFyZ2luIGlzIG9uIHRoZSB0b3AgYW5kIGJvdHRvbSBvZiB0aGUgdmVydGljYWwgYm94ZXMNCgkJCWhlbHBlcnMuZWFjaCh0b3BCb3hlcywgZnVuY3Rpb24oYm94KSB7DQoJCQkJdG90YWxUb3BCb3hlc0hlaWdodCArPSBib3guaGVpZ2h0Ow0KCQkJfSk7DQoNCgkJCWhlbHBlcnMuZWFjaChib3R0b21Cb3hlcywgZnVuY3Rpb24oYm94KSB7DQoJCQkJdG90YWxCb3R0b21Cb3hlc0hlaWdodCArPSBib3guaGVpZ2h0Ow0KCQkJfSk7DQoNCgkJCWZ1bmN0aW9uIGZpbmFsRml0VmVydGljYWxCb3goYm94KSB7DQoJCQkJdmFyIG1pbkJveFNpemUgPSBoZWxwZXJzLmZpbmROZXh0V2hlcmUobWluQm94U2l6ZXMsIGZ1bmN0aW9uKG1pblNpemUpIHsNCgkJCQkJcmV0dXJuIG1pblNpemUuYm94ID09PSBib3g7DQoJCQkJfSk7DQoNCgkJCQl2YXIgc2NhbGVNYXJnaW4gPSB7DQoJCQkJCWxlZnQ6IDAsDQoJCQkJCXJpZ2h0OiAwLA0KCQkJCQl0b3A6IHRvdGFsVG9wQm94ZXNIZWlnaHQsDQoJCQkJCWJvdHRvbTogdG90YWxCb3R0b21Cb3hlc0hlaWdodA0KCQkJCX07DQoNCgkJCQlpZiAobWluQm94U2l6ZSkgew0KCQkJCQlib3gudXBkYXRlKG1pbkJveFNpemUubWluU2l6ZS53aWR0aCwgbWF4Q2hhcnRBcmVhSGVpZ2h0LCBzY2FsZU1hcmdpbik7DQoJCQkJfQ0KCQkJfQ0KDQoJCQkvLyBMZXQgdGhlIGxlZnQgbGF5b3V0IGtub3cgdGhlIGZpbmFsIG1hcmdpbg0KCQkJaGVscGVycy5lYWNoKGxlZnRCb3hlcy5jb25jYXQocmlnaHRCb3hlcyksIGZpbmFsRml0VmVydGljYWxCb3gpOw0KDQoJCQkvLyBSZWNhbGN1bGF0ZSBiZWNhdXNlIHRoZSBzaXplIG9mIGVhY2ggbGF5b3V0IG1pZ2h0IGhhdmUgY2hhbmdlZCBzbGlnaHRseSBkdWUgdG8gdGhlIG1hcmdpbnMgKGxhYmVsIHJvdGF0aW9uIGZvciBpbnN0YW5jZSkNCgkJCXRvdGFsTGVmdEJveGVzV2lkdGggPSBsZWZ0UGFkZGluZzsNCgkJCXRvdGFsUmlnaHRCb3hlc1dpZHRoID0gcmlnaHRQYWRkaW5nOw0KCQkJdG90YWxUb3BCb3hlc0hlaWdodCA9IHRvcFBhZGRpbmc7DQoJCQl0b3RhbEJvdHRvbUJveGVzSGVpZ2h0ID0gYm90dG9tUGFkZGluZzsNCg0KCQkJaGVscGVycy5lYWNoKGxlZnRCb3hlcywgZnVuY3Rpb24oYm94KSB7DQoJCQkJdG90YWxMZWZ0Qm94ZXNXaWR0aCArPSBib3gud2lkdGg7DQoJCQl9KTsNCg0KCQkJaGVscGVycy5lYWNoKHJpZ2h0Qm94ZXMsIGZ1bmN0aW9uKGJveCkgew0KCQkJCXRvdGFsUmlnaHRCb3hlc1dpZHRoICs9IGJveC53aWR0aDsNCgkJCX0pOw0KDQoJCQloZWxwZXJzLmVhY2godG9wQm94ZXMsIGZ1bmN0aW9uKGJveCkgew0KCQkJCXRvdGFsVG9wQm94ZXNIZWlnaHQgKz0gYm94LmhlaWdodDsNCgkJCX0pOw0KCQkJaGVscGVycy5lYWNoKGJvdHRvbUJveGVzLCBmdW5jdGlvbihib3gpIHsNCgkJCQl0b3RhbEJvdHRvbUJveGVzSGVpZ2h0ICs9IGJveC5oZWlnaHQ7DQoJCQl9KTsNCg0KCQkJLy8gV2UgbWF5IGJlIGFkZGluZyBzb21lIHBhZGRpbmcgdG8gYWNjb3VudCBmb3Igcm90YXRlZCB4IGF4aXMgbGFiZWxzDQoJCQl2YXIgbGVmdFBhZGRpbmdBZGRpdGlvbiA9IE1hdGgubWF4KG1heEhvcml6b250YWxMZWZ0UGFkZGluZyAtIHRvdGFsTGVmdEJveGVzV2lkdGgsIDApOw0KCQkJdG90YWxMZWZ0Qm94ZXNXaWR0aCArPSBsZWZ0UGFkZGluZ0FkZGl0aW9uOw0KCQkJdG90YWxSaWdodEJveGVzV2lkdGggKz0gTWF0aC5tYXgobWF4SG9yaXpvbnRhbFJpZ2h0UGFkZGluZyAtIHRvdGFsUmlnaHRCb3hlc1dpZHRoLCAwKTsNCg0KCQkJdmFyIHRvcFBhZGRpbmdBZGRpdGlvbiA9IE1hdGgubWF4KG1heFZlcnRpY2FsVG9wUGFkZGluZyAtIHRvdGFsVG9wQm94ZXNIZWlnaHQsIDApOw0KCQkJdG90YWxUb3BCb3hlc0hlaWdodCArPSB0b3BQYWRkaW5nQWRkaXRpb247DQoJCQl0b3RhbEJvdHRvbUJveGVzSGVpZ2h0ICs9IE1hdGgubWF4KG1heFZlcnRpY2FsQm90dG9tUGFkZGluZyAtIHRvdGFsQm90dG9tQm94ZXNIZWlnaHQsIDApOw0KDQoJCQkvLyBGaWd1cmUgb3V0IGlmIG91ciBjaGFydCBhcmVhIGNoYW5nZWQuIFRoaXMgd291bGQgb2NjdXIgaWYgdGhlIGRhdGFzZXQgbGF5b3V0IGxhYmVsIHJvdGF0aW9uDQoJCQkvLyBjaGFuZ2VkIGR1ZSB0byB0aGUgYXBwbGljYXRpb24gb2YgdGhlIG1hcmdpbnMgaW4gc3RlcCA2LiBTaW5jZSB3ZSBjYW4gb25seSBnZXQgYmlnZ2VyLCB0aGlzIGlzIHNhZmUgdG8gZG8NCgkJCS8vIHdpdGhvdXQgY2FsbGluZyBgZml0YCBhZ2Fpbg0KCQkJdmFyIG5ld01heENoYXJ0QXJlYUhlaWdodCA9IGhlaWdodCAtIHRvdGFsVG9wQm94ZXNIZWlnaHQgLSB0b3RhbEJvdHRvbUJveGVzSGVpZ2h0Ow0KCQkJdmFyIG5ld01heENoYXJ0QXJlYVdpZHRoID0gd2lkdGggLSB0b3RhbExlZnRCb3hlc1dpZHRoIC0gdG90YWxSaWdodEJveGVzV2lkdGg7DQoNCgkJCWlmIChuZXdNYXhDaGFydEFyZWFXaWR0aCAhPT0gbWF4Q2hhcnRBcmVhV2lkdGggfHwgbmV3TWF4Q2hhcnRBcmVhSGVpZ2h0ICE9PSBtYXhDaGFydEFyZWFIZWlnaHQpIHsNCgkJCQloZWxwZXJzLmVhY2gobGVmdEJveGVzLCBmdW5jdGlvbihib3gpIHsNCgkJCQkJYm94LmhlaWdodCA9IG5ld01heENoYXJ0QXJlYUhlaWdodDsNCgkJCQl9KTsNCg0KCQkJCWhlbHBlcnMuZWFjaChyaWdodEJveGVzLCBmdW5jdGlvbihib3gpIHsNCgkJCQkJYm94LmhlaWdodCA9IG5ld01heENoYXJ0QXJlYUhlaWdodDsNCgkJCQl9KTsNCg0KCQkJCWhlbHBlcnMuZWFjaCh0b3BCb3hlcywgZnVuY3Rpb24oYm94KSB7DQoJCQkJCWlmICghYm94LmZ1bGxXaWR0aCkgew0KCQkJCQkJYm94LndpZHRoID0gbmV3TWF4Q2hhcnRBcmVhV2lkdGg7DQoJCQkJCX0NCgkJCQl9KTsNCg0KCQkJCWhlbHBlcnMuZWFjaChib3R0b21Cb3hlcywgZnVuY3Rpb24oYm94KSB7DQoJCQkJCWlmICghYm94LmZ1bGxXaWR0aCkgew0KCQkJCQkJYm94LndpZHRoID0gbmV3TWF4Q2hhcnRBcmVhV2lkdGg7DQoJCQkJCX0NCgkJCQl9KTsNCg0KCQkJCW1heENoYXJ0QXJlYUhlaWdodCA9IG5ld01heENoYXJ0QXJlYUhlaWdodDsNCgkJCQltYXhDaGFydEFyZWFXaWR0aCA9IG5ld01heENoYXJ0QXJlYVdpZHRoOw0KCQkJfQ0KDQoJCQkvLyBTdGVwIDcgLSBQb3NpdGlvbiB0aGUgYm94ZXMNCgkJCXZhciBsZWZ0ID0gbGVmdFBhZGRpbmcgKyBsZWZ0UGFkZGluZ0FkZGl0aW9uOw0KCQkJdmFyIHRvcCA9IHRvcFBhZGRpbmcgKyB0b3BQYWRkaW5nQWRkaXRpb247DQoNCgkJCWZ1bmN0aW9uIHBsYWNlQm94KGJveCkgew0KCQkJCWlmIChib3guaXNIb3Jpem9udGFsKCkpIHsNCgkJCQkJYm94LmxlZnQgPSBib3guZnVsbFdpZHRoID8gbGVmdFBhZGRpbmcgOiB0b3RhbExlZnRCb3hlc1dpZHRoOw0KCQkJCQlib3gucmlnaHQgPSBib3guZnVsbFdpZHRoID8gd2lkdGggLSByaWdodFBhZGRpbmcgOiB0b3RhbExlZnRCb3hlc1dpZHRoICsgbWF4Q2hhcnRBcmVhV2lkdGg7DQoJCQkJCWJveC50b3AgPSB0b3A7DQoJCQkJCWJveC5ib3R0b20gPSB0b3AgKyBib3guaGVpZ2h0Ow0KDQoJCQkJCS8vIE1vdmUgdG8gbmV4dCBwb2ludA0KCQkJCQl0b3AgPSBib3guYm90dG9tOw0KDQoJCQkJfSBlbHNlIHsNCg0KCQkJCQlib3gubGVmdCA9IGxlZnQ7DQoJCQkJCWJveC5yaWdodCA9IGxlZnQgKyBib3gud2lkdGg7DQoJCQkJCWJveC50b3AgPSB0b3RhbFRvcEJveGVzSGVpZ2h0Ow0KCQkJCQlib3guYm90dG9tID0gdG90YWxUb3BCb3hlc0hlaWdodCArIG1heENoYXJ0QXJlYUhlaWdodDsNCg0KCQkJCQkvLyBNb3ZlIHRvIG5leHQgcG9pbnQNCgkJCQkJbGVmdCA9IGJveC5yaWdodDsNCgkJCQl9DQoJCQl9DQoNCgkJCWhlbHBlcnMuZWFjaChsZWZ0Qm94ZXMuY29uY2F0KHRvcEJveGVzKSwgcGxhY2VCb3gpOw0KDQoJCQkvLyBBY2NvdW50IGZvciBjaGFydCB3aWR0aCBhbmQgaGVpZ2h0DQoJCQlsZWZ0ICs9IG1heENoYXJ0QXJlYVdpZHRoOw0KCQkJdG9wICs9IG1heENoYXJ0QXJlYUhlaWdodDsNCg0KCQkJaGVscGVycy5lYWNoKHJpZ2h0Qm94ZXMsIHBsYWNlQm94KTsNCgkJCWhlbHBlcnMuZWFjaChib3R0b21Cb3hlcywgcGxhY2VCb3gpOw0KDQoJCQkvLyBTdGVwIDgNCgkJCWNoYXJ0LmNoYXJ0QXJlYSA9IHsNCgkJCQlsZWZ0OiB0b3RhbExlZnRCb3hlc1dpZHRoLA0KCQkJCXRvcDogdG90YWxUb3BCb3hlc0hlaWdodCwNCgkJCQlyaWdodDogdG90YWxMZWZ0Qm94ZXNXaWR0aCArIG1heENoYXJ0QXJlYVdpZHRoLA0KCQkJCWJvdHRvbTogdG90YWxUb3BCb3hlc0hlaWdodCArIG1heENoYXJ0QXJlYUhlaWdodA0KCQkJfTsNCg0KCQkJLy8gU3RlcCA5DQoJCQloZWxwZXJzLmVhY2goY2hhcnRBcmVhQm94ZXMsIGZ1bmN0aW9uKGJveCkgew0KCQkJCWJveC5sZWZ0ID0gY2hhcnQuY2hhcnRBcmVhLmxlZnQ7DQoJCQkJYm94LnRvcCA9IGNoYXJ0LmNoYXJ0QXJlYS50b3A7DQoJCQkJYm94LnJpZ2h0ID0gY2hhcnQuY2hhcnRBcmVhLnJpZ2h0Ow0KCQkJCWJveC5ib3R0b20gPSBjaGFydC5jaGFydEFyZWEuYm90dG9tOw0KDQoJCQkJYm94LnVwZGF0ZShtYXhDaGFydEFyZWFXaWR0aCwgbWF4Q2hhcnRBcmVhSGVpZ2h0KTsNCgkJCX0pOw0KCQl9DQoJfTsNCn07DQoNCn0seyI0NSI6NDV9XSwzMTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7DQondXNlIHN0cmljdCc7DQoNCnZhciBkZWZhdWx0cyA9IHJlcXVpcmUoMjUpOw0KdmFyIEVsZW1lbnQgPSByZXF1aXJlKDI2KTsNCnZhciBoZWxwZXJzID0gcmVxdWlyZSg0NSk7DQoNCmRlZmF1bHRzLl9zZXQoJ2dsb2JhbCcsIHsNCglwbHVnaW5zOiB7fQ0KfSk7DQoNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oQ2hhcnQpIHsNCg0KCS8qKg0KCSAqIFRoZSBwbHVnaW4gc2VydmljZSBzaW5nbGV0b24NCgkgKiBAbmFtZXNwYWNlIENoYXJ0LnBsdWdpbnMNCgkgKiBAc2luY2UgMi4xLjANCgkgKi8NCglDaGFydC5wbHVnaW5zID0gew0KCQkvKioNCgkJICogR2xvYmFsbHkgcmVnaXN0ZXJlZCBwbHVnaW5zLg0KCQkgKiBAcHJpdmF0ZQ0KCQkgKi8NCgkJX3BsdWdpbnM6IFtdLA0KDQoJCS8qKg0KCQkgKiBUaGlzIGlkZW50aWZpZXIgaXMgdXNlZCB0byBpbnZhbGlkYXRlIHRoZSBkZXNjcmlwdG9ycyBjYWNoZSBhdHRhY2hlZCB0byBlYWNoIGNoYXJ0DQoJCSAqIHdoZW4gYSBnbG9iYWwgcGx1Z2luIGlzIHJlZ2lzdGVyZWQgb3IgdW5yZWdpc3RlcmVkLiBJbiB0aGlzIGNhc2UsIHRoZSBjYWNoZSBJRCBpcw0KCQkgKiBpbmNyZW1lbnRlZCBhbmQgZGVzY3JpcHRvcnMgYXJlIHJlZ2VuZXJhdGVkIGR1cmluZyBmb2xsb3dpbmcgQVBJIGNhbGxzLg0KCQkgKiBAcHJpdmF0ZQ0KCQkgKi8NCgkJX2NhY2hlSWQ6IDAsDQoNCgkJLyoqDQoJCSAqIFJlZ2lzdGVycyB0aGUgZ2l2ZW4gcGx1Z2luKHMpIGlmIG5vdCBhbHJlYWR5IHJlZ2lzdGVyZWQuDQoJCSAqIEBwYXJhbSB7QXJyYXl8T2JqZWN0fSBwbHVnaW5zIHBsdWdpbiBpbnN0YW5jZShzKS4NCgkJICovDQoJCXJlZ2lzdGVyOiBmdW5jdGlvbihwbHVnaW5zKSB7DQoJCQl2YXIgcCA9IHRoaXMuX3BsdWdpbnM7DQoJCQkoW10pLmNvbmNhdChwbHVnaW5zKS5mb3JFYWNoKGZ1bmN0aW9uKHBsdWdpbikgew0KCQkJCWlmIChwLmluZGV4T2YocGx1Z2luKSA9PT0gLTEpIHsNCgkJCQkJcC5wdXNoKHBsdWdpbik7DQoJCQkJfQ0KCQkJfSk7DQoNCgkJCXRoaXMuX2NhY2hlSWQrKzsNCgkJfSwNCg0KCQkvKioNCgkJICogVW5yZWdpc3RlcnMgdGhlIGdpdmVuIHBsdWdpbihzKSBvbmx5IGlmIHJlZ2lzdGVyZWQuDQoJCSAqIEBwYXJhbSB7QXJyYXl8T2JqZWN0fSBwbHVnaW5zIHBsdWdpbiBpbnN0YW5jZShzKS4NCgkJICovDQoJCXVucmVnaXN0ZXI6IGZ1bmN0aW9uKHBsdWdpbnMpIHsNCgkJCXZhciBwID0gdGhpcy5fcGx1Z2luczsNCgkJCShbXSkuY29uY2F0KHBsdWdpbnMpLmZvckVhY2goZnVuY3Rpb24ocGx1Z2luKSB7DQoJCQkJdmFyIGlkeCA9IHAuaW5kZXhPZihwbHVnaW4pOw0KCQkJCWlmIChpZHggIT09IC0xKSB7DQoJCQkJCXAuc3BsaWNlKGlkeCwgMSk7DQoJCQkJfQ0KCQkJfSk7DQoNCgkJCXRoaXMuX2NhY2hlSWQrKzsNCgkJfSwNCg0KCQkvKioNCgkJICogUmVtb3ZlIGFsbCByZWdpc3RlcmVkIHBsdWdpbnMuDQoJCSAqIEBzaW5jZSAyLjEuNQ0KCQkgKi8NCgkJY2xlYXI6IGZ1bmN0aW9uKCkgew0KCQkJdGhpcy5fcGx1Z2lucyA9IFtdOw0KCQkJdGhpcy5fY2FjaGVJZCsrOw0KCQl9LA0KDQoJCS8qKg0KCQkgKiBSZXR1cm5zIHRoZSBudW1iZXIgb2YgcmVnaXN0ZXJlZCBwbHVnaW5zPw0KCQkgKiBAcmV0dXJucyB7TnVtYmVyfQ0KCQkgKiBAc2luY2UgMi4xLjUNCgkJICovDQoJCWNvdW50OiBmdW5jdGlvbigpIHsNCgkJCXJldHVybiB0aGlzLl9wbHVnaW5zLmxlbmd0aDsNCgkJfSwNCg0KCQkvKioNCgkJICogUmV0dXJucyBhbGwgcmVnaXN0ZXJlZCBwbHVnaW4gaW5zdGFuY2VzLg0KCQkgKiBAcmV0dXJucyB7QXJyYXl9IGFycmF5IG9mIHBsdWdpbiBvYmplY3RzLg0KCQkgKiBAc2luY2UgMi4xLjUNCgkJICovDQoJCWdldEFsbDogZnVuY3Rpb24oKSB7DQoJCQlyZXR1cm4gdGhpcy5fcGx1Z2luczsNCgkJfSwNCg0KCQkvKioNCgkJICogQ2FsbHMgZW5hYmxlZCBwbHVnaW5zIGZvciBgY2hhcnRgIG9uIHRoZSBzcGVjaWZpZWQgaG9vayBhbmQgd2l0aCB0aGUgZ2l2ZW4gYXJncy4NCgkJICogVGhpcyBtZXRob2QgaW1tZWRpYXRlbHkgcmV0dXJucyBhcyBzb29uIGFzIGEgcGx1Z2luIGV4cGxpY2l0bHkgcmV0dXJucyBmYWxzZS4gVGhlDQoJCSAqIHJldHVybmVkIHZhbHVlIGNhbiBiZSB1c2VkLCBmb3IgaW5zdGFuY2UsIHRvIGludGVycnVwdCB0aGUgY3VycmVudCBhY3Rpb24uDQoJCSAqIEBwYXJhbSB7T2JqZWN0fSBjaGFydCAtIFRoZSBjaGFydCBpbnN0YW5jZSBmb3Igd2hpY2ggcGx1Z2lucyBzaG91bGQgYmUgY2FsbGVkLg0KCQkgKiBAcGFyYW0ge1N0cmluZ30gaG9vayAtIFRoZSBuYW1lIG9mIHRoZSBwbHVnaW4gbWV0aG9kIHRvIGNhbGwgKGUuZy4gJ2JlZm9yZVVwZGF0ZScpLg0KCQkgKiBAcGFyYW0ge0FycmF5fSBbYXJnc10gLSBFeHRyYSBhcmd1bWVudHMgdG8gYXBwbHkgdG8gdGhlIGhvb2sgY2FsbC4NCgkJICogQHJldHVybnMge0Jvb2xlYW59IGZhbHNlIGlmIGFueSBvZiB0aGUgcGx1Z2lucyByZXR1cm4gZmFsc2UsIGVsc2UgcmV0dXJucyB0cnVlLg0KCQkgKi8NCgkJbm90aWZ5OiBmdW5jdGlvbihjaGFydCwgaG9vaywgYXJncykgew0KCQkJdmFyIGRlc2NyaXB0b3JzID0gdGhpcy5kZXNjcmlwdG9ycyhjaGFydCk7DQoJCQl2YXIgaWxlbiA9IGRlc2NyaXB0b3JzLmxlbmd0aDsNCgkJCXZhciBpLCBkZXNjcmlwdG9yLCBwbHVnaW4sIHBhcmFtcywgbWV0aG9kOw0KDQoJCQlmb3IgKGkgPSAwOyBpIDwgaWxlbjsgKytpKSB7DQoJCQkJZGVzY3JpcHRvciA9IGRlc2NyaXB0b3JzW2ldOw0KCQkJCXBsdWdpbiA9IGRlc2NyaXB0b3IucGx1Z2luOw0KCQkJCW1ldGhvZCA9IHBsdWdpbltob29rXTsNCgkJCQlpZiAodHlwZW9mIG1ldGhvZCA9PT0gJ2Z1bmN0aW9uJykgew0KCQkJCQlwYXJhbXMgPSBbY2hhcnRdLmNvbmNhdChhcmdzIHx8IFtdKTsNCgkJCQkJcGFyYW1zLnB1c2goZGVzY3JpcHRvci5vcHRpb25zKTsNCgkJCQkJaWYgKG1ldGhvZC5hcHBseShwbHVnaW4sIHBhcmFtcykgPT09IGZhbHNlKSB7DQoJCQkJCQlyZXR1cm4gZmFsc2U7DQoJCQkJCX0NCgkJCQl9DQoJCQl9DQoNCgkJCXJldHVybiB0cnVlOw0KCQl9LA0KDQoJCS8qKg0KCQkgKiBSZXR1cm5zIGRlc2NyaXB0b3JzIG9mIGVuYWJsZWQgcGx1Z2lucyBmb3IgdGhlIGdpdmVuIGNoYXJ0Lg0KCQkgKiBAcmV0dXJucyB7QXJyYXl9IFt7IHBsdWdpbiwgb3B0aW9ucyB9XQ0KCQkgKiBAcHJpdmF0ZQ0KCQkgKi8NCgkJZGVzY3JpcHRvcnM6IGZ1bmN0aW9uKGNoYXJ0KSB7DQoJCQl2YXIgY2FjaGUgPSBjaGFydC5fcGx1Z2lucyB8fCAoY2hhcnQuX3BsdWdpbnMgPSB7fSk7DQoJCQlpZiAoY2FjaGUuaWQgPT09IHRoaXMuX2NhY2hlSWQpIHsNCgkJCQlyZXR1cm4gY2FjaGUuZGVzY3JpcHRvcnM7DQoJCQl9DQoNCgkJCXZhciBwbHVnaW5zID0gW107DQoJCQl2YXIgZGVzY3JpcHRvcnMgPSBbXTsNCgkJCXZhciBjb25maWcgPSAoY2hhcnQgJiYgY2hhcnQuY29uZmlnKSB8fCB7fTsNCgkJCXZhciBvcHRpb25zID0gKGNvbmZpZy5vcHRpb25zICYmIGNvbmZpZy5vcHRpb25zLnBsdWdpbnMpIHx8IHt9Ow0KDQoJCQl0aGlzLl9wbHVnaW5zLmNvbmNhdChjb25maWcucGx1Z2lucyB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbihwbHVnaW4pIHsNCgkJCQl2YXIgaWR4ID0gcGx1Z2lucy5pbmRleE9mKHBsdWdpbik7DQoJCQkJaWYgKGlkeCAhPT0gLTEpIHsNCgkJCQkJcmV0dXJuOw0KCQkJCX0NCg0KCQkJCXZhciBpZCA9IHBsdWdpbi5pZDsNCgkJCQl2YXIgb3B0cyA9IG9wdGlvbnNbaWRdOw0KCQkJCWlmIChvcHRzID09PSBmYWxzZSkgew0KCQkJCQlyZXR1cm47DQoJCQkJfQ0KDQoJCQkJaWYgKG9wdHMgPT09IHRydWUpIHsNCgkJCQkJb3B0cyA9IGhlbHBlcnMuY2xvbmUoZGVmYXVsdHMuZ2xvYmFsLnBsdWdpbnNbaWRdKTsNCgkJCQl9DQoNCgkJCQlwbHVnaW5zLnB1c2gocGx1Z2luKTsNCgkJCQlkZXNjcmlwdG9ycy5wdXNoKHsNCgkJCQkJcGx1Z2luOiBwbHVnaW4sDQoJCQkJCW9wdGlvbnM6IG9wdHMgfHwge30NCgkJCQl9KTsNCgkJCX0pOw0KDQoJCQljYWNoZS5kZXNjcmlwdG9ycyA9IGRlc2NyaXB0b3JzOw0KCQkJY2FjaGUuaWQgPSB0aGlzLl9jYWNoZUlkOw0KCQkJcmV0dXJuIGRlc2NyaXB0b3JzOw0KCQl9DQoJfTsNCg0KCS8qKg0KCSAqIFBsdWdpbiBleHRlbnNpb24gaG9va3MuDQoJICogQGludGVyZmFjZSBJUGx1Z2luDQoJICogQHNpbmNlIDIuMS4wDQoJICovDQoJLyoqDQoJICogQG1ldGhvZCBJUGx1Z2luI2JlZm9yZUluaXQNCgkgKiBAZGVzYyBDYWxsZWQgYmVmb3JlIGluaXRpYWxpemluZyBgY2hhcnRgLg0KCSAqIEBwYXJhbSB7Q2hhcnQuQ29udHJvbGxlcn0gY2hhcnQgLSBUaGUgY2hhcnQgaW5zdGFuY2UuDQoJICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgLSBUaGUgcGx1Z2luIG9wdGlvbnMuDQoJICovDQoJLyoqDQoJICogQG1ldGhvZCBJUGx1Z2luI2FmdGVySW5pdA0KCSAqIEBkZXNjIENhbGxlZCBhZnRlciBgY2hhcnRgIGhhcyBiZWVuIGluaXRpYWxpemVkIGFuZCBiZWZvcmUgdGhlIGZpcnN0IHVwZGF0ZS4NCgkgKiBAcGFyYW0ge0NoYXJ0LkNvbnRyb2xsZXJ9IGNoYXJ0IC0gVGhlIGNoYXJ0IGluc3RhbmNlLg0KCSAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIC0gVGhlIHBsdWdpbiBvcHRpb25zLg0KCSAqLw0KCS8qKg0KCSAqIEBtZXRob2QgSVBsdWdpbiNiZWZvcmVVcGRhdGUNCgkgKiBAZGVzYyBDYWxsZWQgYmVmb3JlIHVwZGF0aW5nIGBjaGFydGAuIElmIGFueSBwbHVnaW4gcmV0dXJucyBgZmFsc2VgLCB0aGUgdXBkYXRlDQoJICogaXMgY2FuY2VsbGVkIChhbmQgdGh1cyBzdWJzZXF1ZW50IHJlbmRlcihzKSkgdW50aWwgYW5vdGhlciBgdXBkYXRlYCBpcyB0cmlnZ2VyZWQuDQoJICogQHBhcmFtIHtDaGFydC5Db250cm9sbGVyfSBjaGFydCAtIFRoZSBjaGFydCBpbnN0YW5jZS4NCgkgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyAtIFRoZSBwbHVnaW4gb3B0aW9ucy4NCgkgKiBAcmV0dXJucyB7Qm9vbGVhbn0gYGZhbHNlYCB0byBjYW5jZWwgdGhlIGNoYXJ0IHVwZGF0ZS4NCgkgKi8NCgkvKioNCgkgKiBAbWV0aG9kIElQbHVnaW4jYWZ0ZXJVcGRhdGUNCgkgKiBAZGVzYyBDYWxsZWQgYWZ0ZXIgYGNoYXJ0YCBoYXMgYmVlbiB1cGRhdGVkIGFuZCBiZWZvcmUgcmVuZGVyaW5nLiBOb3RlIHRoYXQgdGhpcw0KCSAqIGhvb2sgd2lsbCBub3QgYmUgY2FsbGVkIGlmIHRoZSBjaGFydCB1cGRhdGUgaGFzIGJlZW4gcHJldmlvdXNseSBjYW5jZWxsZWQuDQoJICogQHBhcmFtIHtDaGFydC5Db250cm9sbGVyfSBjaGFydCAtIFRoZSBjaGFydCBpbnN0YW5jZS4NCgkgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyAtIFRoZSBwbHVnaW4gb3B0aW9ucy4NCgkgKi8NCgkvKioNCgkgKiBAbWV0aG9kIElQbHVnaW4jYmVmb3JlRGF0YXNldHNVcGRhdGUNCiAJICogQGRlc2MgQ2FsbGVkIGJlZm9yZSB1cGRhdGluZyB0aGUgYGNoYXJ0YCBkYXRhc2V0cy4gSWYgYW55IHBsdWdpbiByZXR1cm5zIGBmYWxzZWAsDQoJICogdGhlIGRhdGFzZXRzIHVwZGF0ZSBpcyBjYW5jZWxsZWQgdW50aWwgYW5vdGhlciBgdXBkYXRlYCBpcyB0cmlnZ2VyZWQuDQoJICogQHBhcmFtIHtDaGFydC5Db250cm9sbGVyfSBjaGFydCAtIFRoZSBjaGFydCBpbnN0YW5jZS4NCgkgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyAtIFRoZSBwbHVnaW4gb3B0aW9ucy4NCgkgKiBAcmV0dXJucyB7Qm9vbGVhbn0gZmFsc2UgdG8gY2FuY2VsIHRoZSBkYXRhc2V0cyB1cGRhdGUuDQoJICogQHNpbmNlIHZlcnNpb24gMi4xLjUNCgkgKi8NCgkvKioNCgkgKiBAbWV0aG9kIElQbHVnaW4jYWZ0ZXJEYXRhc2V0c1VwZGF0ZQ0KCSAqIEBkZXNjIENhbGxlZCBhZnRlciB0aGUgYGNoYXJ0YCBkYXRhc2V0cyBoYXZlIGJlZW4gdXBkYXRlZC4gTm90ZSB0aGF0IHRoaXMgaG9vaw0KCSAqIHdpbGwgbm90IGJlIGNhbGxlZCBpZiB0aGUgZGF0YXNldHMgdXBkYXRlIGhhcyBiZWVuIHByZXZpb3VzbHkgY2FuY2VsbGVkLg0KCSAqIEBwYXJhbSB7Q2hhcnQuQ29udHJvbGxlcn0gY2hhcnQgLSBUaGUgY2hhcnQgaW5zdGFuY2UuDQoJICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgLSBUaGUgcGx1Z2luIG9wdGlvbnMuDQoJICogQHNpbmNlIHZlcnNpb24gMi4xLjUNCgkgKi8NCgkvKioNCgkgKiBAbWV0aG9kIElQbHVnaW4jYmVmb3JlRGF0YXNldFVwZGF0ZQ0KIAkgKiBAZGVzYyBDYWxsZWQgYmVmb3JlIHVwZGF0aW5nIHRoZSBgY2hhcnRgIGRhdGFzZXQgYXQgdGhlIGdpdmVuIGBhcmdzLmluZGV4YC4gSWYgYW55IHBsdWdpbg0KCSAqIHJldHVybnMgYGZhbHNlYCwgdGhlIGRhdGFzZXRzIHVwZGF0ZSBpcyBjYW5jZWxsZWQgdW50aWwgYW5vdGhlciBgdXBkYXRlYCBpcyB0cmlnZ2VyZWQuDQoJICogQHBhcmFtIHtDaGFydH0gY2hhcnQgLSBUaGUgY2hhcnQgaW5zdGFuY2UuDQoJICogQHBhcmFtIHtPYmplY3R9IGFyZ3MgLSBUaGUgY2FsbCBhcmd1bWVudHMuDQoJICogQHBhcmFtIHtOdW1iZXJ9IGFyZ3MuaW5kZXggLSBUaGUgZGF0YXNldCBpbmRleC4NCgkgKiBAcGFyYW0ge09iamVjdH0gYXJncy5tZXRhIC0gVGhlIGRhdGFzZXQgbWV0YWRhdGEuDQoJICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgLSBUaGUgcGx1Z2luIG9wdGlvbnMuDQoJICogQHJldHVybnMge0Jvb2xlYW59IGBmYWxzZWAgdG8gY2FuY2VsIHRoZSBjaGFydCBkYXRhc2V0cyBkcmF3aW5nLg0KCSAqLw0KCS8qKg0KCSAqIEBtZXRob2QgSVBsdWdpbiNhZnRlckRhdGFzZXRVcGRhdGUNCiAJICogQGRlc2MgQ2FsbGVkIGFmdGVyIHRoZSBgY2hhcnRgIGRhdGFzZXRzIGF0IHRoZSBnaXZlbiBgYXJncy5pbmRleGAgaGFzIGJlZW4gdXBkYXRlZC4gTm90ZQ0KCSAqIHRoYXQgdGhpcyBob29rIHdpbGwgbm90IGJlIGNhbGxlZCBpZiB0aGUgZGF0YXNldHMgdXBkYXRlIGhhcyBiZWVuIHByZXZpb3VzbHkgY2FuY2VsbGVkLg0KCSAqIEBwYXJhbSB7Q2hhcnR9IGNoYXJ0IC0gVGhlIGNoYXJ0IGluc3RhbmNlLg0KCSAqIEBwYXJhbSB7T2JqZWN0fSBhcmdzIC0gVGhlIGNhbGwgYXJndW1lbnRzLg0KCSAqIEBwYXJhbSB7TnVtYmVyfSBhcmdzLmluZGV4IC0gVGhlIGRhdGFzZXQgaW5kZXguDQoJICogQHBhcmFtIHtPYmplY3R9IGFyZ3MubWV0YSAtIFRoZSBkYXRhc2V0IG1ldGFkYXRhLg0KCSAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIC0gVGhlIHBsdWdpbiBvcHRpb25zLg0KCSAqLw0KCS8qKg0KCSAqIEBtZXRob2QgSVBsdWdpbiNiZWZvcmVMYXlvdXQNCgkgKiBAZGVzYyBDYWxsZWQgYmVmb3JlIGxheWluZyBvdXQgYGNoYXJ0YC4gSWYgYW55IHBsdWdpbiByZXR1cm5zIGBmYWxzZWAsDQoJICogdGhlIGxheW91dCB1cGRhdGUgaXMgY2FuY2VsbGVkIHVudGlsIGFub3RoZXIgYHVwZGF0ZWAgaXMgdHJpZ2dlcmVkLg0KCSAqIEBwYXJhbSB7Q2hhcnQuQ29udHJvbGxlcn0gY2hhcnQgLSBUaGUgY2hhcnQgaW5zdGFuY2UuDQoJICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgLSBUaGUgcGx1Z2luIG9wdGlvbnMuDQoJICogQHJldHVybnMge0Jvb2xlYW59IGBmYWxzZWAgdG8gY2FuY2VsIHRoZSBjaGFydCBsYXlvdXQuDQoJICovDQoJLyoqDQoJICogQG1ldGhvZCBJUGx1Z2luI2FmdGVyTGF5b3V0DQoJICogQGRlc2MgQ2FsbGVkIGFmdGVyIHRoZSBgY2hhcnRgIGhhcyBiZWVuIGxheWVkIG91dC4gTm90ZSB0aGF0IHRoaXMgaG9vayB3aWxsIG5vdA0KCSAqIGJlIGNhbGxlZCBpZiB0aGUgbGF5b3V0IHVwZGF0ZSBoYXMgYmVlbiBwcmV2aW91c2x5IGNhbmNlbGxlZC4NCgkgKiBAcGFyYW0ge0NoYXJ0LkNvbnRyb2xsZXJ9IGNoYXJ0IC0gVGhlIGNoYXJ0IGluc3RhbmNlLg0KCSAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIC0gVGhlIHBsdWdpbiBvcHRpb25zLg0KCSAqLw0KCS8qKg0KCSAqIEBtZXRob2QgSVBsdWdpbiNiZWZvcmVSZW5kZXINCgkgKiBAZGVzYyBDYWxsZWQgYmVmb3JlIHJlbmRlcmluZyBgY2hhcnRgLiBJZiBhbnkgcGx1Z2luIHJldHVybnMgYGZhbHNlYCwNCgkgKiB0aGUgcmVuZGVyaW5nIGlzIGNhbmNlbGxlZCB1bnRpbCBhbm90aGVyIGByZW5kZXJgIGlzIHRyaWdnZXJlZC4NCgkgKiBAcGFyYW0ge0NoYXJ0LkNvbnRyb2xsZXJ9IGNoYXJ0IC0gVGhlIGNoYXJ0IGluc3RhbmNlLg0KCSAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIC0gVGhlIHBsdWdpbiBvcHRpb25zLg0KCSAqIEByZXR1cm5zIHtCb29sZWFufSBgZmFsc2VgIHRvIGNhbmNlbCB0aGUgY2hhcnQgcmVuZGVyaW5nLg0KCSAqLw0KCS8qKg0KCSAqIEBtZXRob2QgSVBsdWdpbiNhZnRlclJlbmRlcg0KCSAqIEBkZXNjIENhbGxlZCBhZnRlciB0aGUgYGNoYXJ0YCBoYXMgYmVlbiBmdWxseSByZW5kZXJlZCAoYW5kIGFuaW1hdGlvbiBjb21wbGV0ZWQpLiBOb3RlDQoJICogdGhhdCB0aGlzIGhvb2sgd2lsbCBub3QgYmUgY2FsbGVkIGlmIHRoZSByZW5kZXJpbmcgaGFzIGJlZW4gcHJldmlvdXNseSBjYW5jZWxsZWQuDQoJICogQHBhcmFtIHtDaGFydC5Db250cm9sbGVyfSBjaGFydCAtIFRoZSBjaGFydCBpbnN0YW5jZS4NCgkgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyAtIFRoZSBwbHVnaW4gb3B0aW9ucy4NCgkgKi8NCgkvKioNCgkgKiBAbWV0aG9kIElQbHVnaW4jYmVmb3JlRHJhdw0KCSAqIEBkZXNjIENhbGxlZCBiZWZvcmUgZHJhd2luZyBgY2hhcnRgIGF0IGV2ZXJ5IGFuaW1hdGlvbiBmcmFtZSBzcGVjaWZpZWQgYnkgdGhlIGdpdmVuDQoJICogZWFzaW5nIHZhbHVlLiBJZiBhbnkgcGx1Z2luIHJldHVybnMgYGZhbHNlYCwgdGhlIGZyYW1lIGRyYXdpbmcgaXMgY2FuY2VsbGVkIHVudGlsDQoJICogYW5vdGhlciBgcmVuZGVyYCBpcyB0cmlnZ2VyZWQuDQoJICogQHBhcmFtIHtDaGFydC5Db250cm9sbGVyfSBjaGFydCAtIFRoZSBjaGFydCBpbnN0YW5jZS4NCgkgKiBAcGFyYW0ge051bWJlcn0gZWFzaW5nVmFsdWUgLSBUaGUgY3VycmVudCBhbmltYXRpb24gdmFsdWUsIGJldHdlZW4gMC4wIGFuZCAxLjAuDQoJICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgLSBUaGUgcGx1Z2luIG9wdGlvbnMuDQoJICogQHJldHVybnMge0Jvb2xlYW59IGBmYWxzZWAgdG8gY2FuY2VsIHRoZSBjaGFydCBkcmF3aW5nLg0KCSAqLw0KCS8qKg0KCSAqIEBtZXRob2QgSVBsdWdpbiNhZnRlckRyYXcNCgkgKiBAZGVzYyBDYWxsZWQgYWZ0ZXIgdGhlIGBjaGFydGAgaGFzIGJlZW4gZHJhd24gZm9yIHRoZSBzcGVjaWZpYyBlYXNpbmcgdmFsdWUuIE5vdGUNCgkgKiB0aGF0IHRoaXMgaG9vayB3aWxsIG5vdCBiZSBjYWxsZWQgaWYgdGhlIGRyYXdpbmcgaGFzIGJlZW4gcHJldmlvdXNseSBjYW5jZWxsZWQuDQoJICogQHBhcmFtIHtDaGFydC5Db250cm9sbGVyfSBjaGFydCAtIFRoZSBjaGFydCBpbnN0YW5jZS4NCgkgKiBAcGFyYW0ge051bWJlcn0gZWFzaW5nVmFsdWUgLSBUaGUgY3VycmVudCBhbmltYXRpb24gdmFsdWUsIGJldHdlZW4gMC4wIGFuZCAxLjAuDQoJICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgLSBUaGUgcGx1Z2luIG9wdGlvbnMuDQoJICovDQoJLyoqDQoJICogQG1ldGhvZCBJUGx1Z2luI2JlZm9yZURhdGFzZXRzRHJhdw0KIAkgKiBAZGVzYyBDYWxsZWQgYmVmb3JlIGRyYXdpbmcgdGhlIGBjaGFydGAgZGF0YXNldHMuIElmIGFueSBwbHVnaW4gcmV0dXJucyBgZmFsc2VgLA0KCSAqIHRoZSBkYXRhc2V0cyBkcmF3aW5nIGlzIGNhbmNlbGxlZCB1bnRpbCBhbm90aGVyIGByZW5kZXJgIGlzIHRyaWdnZXJlZC4NCgkgKiBAcGFyYW0ge0NoYXJ0LkNvbnRyb2xsZXJ9IGNoYXJ0IC0gVGhlIGNoYXJ0IGluc3RhbmNlLg0KCSAqIEBwYXJhbSB7TnVtYmVyfSBlYXNpbmdWYWx1ZSAtIFRoZSBjdXJyZW50IGFuaW1hdGlvbiB2YWx1ZSwgYmV0d2VlbiAwLjAgYW5kIDEuMC4NCgkgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyAtIFRoZSBwbHVnaW4gb3B0aW9ucy4NCgkgKiBAcmV0dXJucyB7Qm9vbGVhbn0gYGZhbHNlYCB0byBjYW5jZWwgdGhlIGNoYXJ0IGRhdGFzZXRzIGRyYXdpbmcuDQoJICovDQoJLyoqDQoJICogQG1ldGhvZCBJUGx1Z2luI2FmdGVyRGF0YXNldHNEcmF3DQoJICogQGRlc2MgQ2FsbGVkIGFmdGVyIHRoZSBgY2hhcnRgIGRhdGFzZXRzIGhhdmUgYmVlbiBkcmF3bi4gTm90ZSB0aGF0IHRoaXMgaG9vaw0KCSAqIHdpbGwgbm90IGJlIGNhbGxlZCBpZiB0aGUgZGF0YXNldHMgZHJhd2luZyBoYXMgYmVlbiBwcmV2aW91c2x5IGNhbmNlbGxlZC4NCgkgKiBAcGFyYW0ge0NoYXJ0LkNvbnRyb2xsZXJ9IGNoYXJ0IC0gVGhlIGNoYXJ0IGluc3RhbmNlLg0KCSAqIEBwYXJhbSB7TnVtYmVyfSBlYXNpbmdWYWx1ZSAtIFRoZSBjdXJyZW50IGFuaW1hdGlvbiB2YWx1ZSwgYmV0d2VlbiAwLjAgYW5kIDEuMC4NCgkgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyAtIFRoZSBwbHVnaW4gb3B0aW9ucy4NCgkgKi8NCgkvKioNCgkgKiBAbWV0aG9kIElQbHVnaW4jYmVmb3JlRGF0YXNldERyYXcNCiAJICogQGRlc2MgQ2FsbGVkIGJlZm9yZSBkcmF3aW5nIHRoZSBgY2hhcnRgIGRhdGFzZXQgYXQgdGhlIGdpdmVuIGBhcmdzLmluZGV4YCAoZGF0YXNldHMNCgkgKiBhcmUgZHJhd24gaW4gdGhlIHJldmVyc2Ugb3JkZXIpLiBJZiBhbnkgcGx1Z2luIHJldHVybnMgYGZhbHNlYCwgdGhlIGRhdGFzZXRzIGRyYXdpbmcNCgkgKiBpcyBjYW5jZWxsZWQgdW50aWwgYW5vdGhlciBgcmVuZGVyYCBpcyB0cmlnZ2VyZWQuDQoJICogQHBhcmFtIHtDaGFydH0gY2hhcnQgLSBUaGUgY2hhcnQgaW5zdGFuY2UuDQoJICogQHBhcmFtIHtPYmplY3R9IGFyZ3MgLSBUaGUgY2FsbCBhcmd1bWVudHMuDQoJICogQHBhcmFtIHtOdW1iZXJ9IGFyZ3MuaW5kZXggLSBUaGUgZGF0YXNldCBpbmRleC4NCgkgKiBAcGFyYW0ge09iamVjdH0gYXJncy5tZXRhIC0gVGhlIGRhdGFzZXQgbWV0YWRhdGEuDQoJICogQHBhcmFtIHtOdW1iZXJ9IGFyZ3MuZWFzaW5nVmFsdWUgLSBUaGUgY3VycmVudCBhbmltYXRpb24gdmFsdWUsIGJldHdlZW4gMC4wIGFuZCAxLjAuDQoJICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgLSBUaGUgcGx1Z2luIG9wdGlvbnMuDQoJICogQHJldHVybnMge0Jvb2xlYW59IGBmYWxzZWAgdG8gY2FuY2VsIHRoZSBjaGFydCBkYXRhc2V0cyBkcmF3aW5nLg0KCSAqLw0KCS8qKg0KCSAqIEBtZXRob2QgSVBsdWdpbiNhZnRlckRhdGFzZXREcmF3DQogCSAqIEBkZXNjIENhbGxlZCBhZnRlciB0aGUgYGNoYXJ0YCBkYXRhc2V0cyBhdCB0aGUgZ2l2ZW4gYGFyZ3MuaW5kZXhgIGhhdmUgYmVlbiBkcmF3bg0KCSAqIChkYXRhc2V0cyBhcmUgZHJhd24gaW4gdGhlIHJldmVyc2Ugb3JkZXIpLiBOb3RlIHRoYXQgdGhpcyBob29rIHdpbGwgbm90IGJlIGNhbGxlZA0KCSAqIGlmIHRoZSBkYXRhc2V0cyBkcmF3aW5nIGhhcyBiZWVuIHByZXZpb3VzbHkgY2FuY2VsbGVkLg0KCSAqIEBwYXJhbSB7Q2hhcnR9IGNoYXJ0IC0gVGhlIGNoYXJ0IGluc3RhbmNlLg0KCSAqIEBwYXJhbSB7T2JqZWN0fSBhcmdzIC0gVGhlIGNhbGwgYXJndW1lbnRzLg0KCSAqIEBwYXJhbSB7TnVtYmVyfSBhcmdzLmluZGV4IC0gVGhlIGRhdGFzZXQgaW5kZXguDQoJICogQHBhcmFtIHtPYmplY3R9IGFyZ3MubWV0YSAtIFRoZSBkYXRhc2V0IG1ldGFkYXRhLg0KCSAqIEBwYXJhbSB7TnVtYmVyfSBhcmdzLmVhc2luZ1ZhbHVlIC0gVGhlIGN1cnJlbnQgYW5pbWF0aW9uIHZhbHVlLCBiZXR3ZWVuIDAuMCBhbmQgMS4wLg0KCSAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIC0gVGhlIHBsdWdpbiBvcHRpb25zLg0KCSAqLw0KCS8qKg0KICAJICogQG1ldGhvZCBJUGx1Z2luI2JlZm9yZVRvb2x0aXBEcmF3DQoJICogQGRlc2MgQ2FsbGVkIGJlZm9yZSBkcmF3aW5nIHRoZSBgdG9vbHRpcGAuIElmIGFueSBwbHVnaW4gcmV0dXJucyBgZmFsc2VgLA0KCSAqIHRoZSB0b29sdGlwIGRyYXdpbmcgaXMgY2FuY2VsbGVkIHVudGlsIGFub3RoZXIgYHJlbmRlcmAgaXMgdHJpZ2dlcmVkLg0KCSAqIEBwYXJhbSB7Q2hhcnR9IGNoYXJ0IC0gVGhlIGNoYXJ0IGluc3RhbmNlLg0KCSAqIEBwYXJhbSB7T2JqZWN0fSBhcmdzIC0gVGhlIGNhbGwgYXJndW1lbnRzLg0KCSAqIEBwYXJhbSB7T2JqZWN0fSBhcmdzLnRvb2x0aXAgLSBUaGUgdG9vbHRpcC4NCgkgKiBAcGFyYW0ge051bWJlcn0gYXJncy5lYXNpbmdWYWx1ZSAtIFRoZSBjdXJyZW50IGFuaW1hdGlvbiB2YWx1ZSwgYmV0d2VlbiAwLjAgYW5kIDEuMC4NCgkgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyAtIFRoZSBwbHVnaW4gb3B0aW9ucy4NCgkgKiBAcmV0dXJucyB7Qm9vbGVhbn0gYGZhbHNlYCB0byBjYW5jZWwgdGhlIGNoYXJ0IHRvb2x0aXAgZHJhd2luZy4NCiAgCSAqLw0KCS8qKg0KIAkgKiBAbWV0aG9kIElQbHVnaW4jYWZ0ZXJUb29sdGlwRHJhdw0KICAJICogQGRlc2MgQ2FsbGVkIGFmdGVyIGRyYXdpbmcgdGhlIGB0b29sdGlwYC4gTm90ZSB0aGF0IHRoaXMgaG9vayB3aWxsIG5vdA0KIAkgKiBiZSBjYWxsZWQgaWYgdGhlIHRvb2x0aXAgZHJhd2luZyBoYXMgYmVlbiBwcmV2aW91c2x5IGNhbmNlbGxlZC4NCiAJICogQHBhcmFtIHtDaGFydH0gY2hhcnQgLSBUaGUgY2hhcnQgaW5zdGFuY2UuDQogCSAqIEBwYXJhbSB7T2JqZWN0fSBhcmdzIC0gVGhlIGNhbGwgYXJndW1lbnRzLg0KIAkgKiBAcGFyYW0ge09iamVjdH0gYXJncy50b29sdGlwIC0gVGhlIHRvb2x0aXAuDQoJICogQHBhcmFtIHtOdW1iZXJ9IGFyZ3MuZWFzaW5nVmFsdWUgLSBUaGUgY3VycmVudCBhbmltYXRpb24gdmFsdWUsIGJldHdlZW4gMC4wIGFuZCAxLjAuDQogCSAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIC0gVGhlIHBsdWdpbiBvcHRpb25zLg0KIAkgKi8NCgkvKioNCgkgKiBAbWV0aG9kIElQbHVnaW4jYmVmb3JlRXZlbnQNCiAJICogQGRlc2MgQ2FsbGVkIGJlZm9yZSBwcm9jZXNzaW5nIHRoZSBzcGVjaWZpZWQgYGV2ZW50YC4gSWYgYW55IHBsdWdpbiByZXR1cm5zIGBmYWxzZWAsDQoJICogdGhlIGV2ZW50IHdpbGwgYmUgZGlzY2FyZGVkLg0KCSAqIEBwYXJhbSB7Q2hhcnQuQ29udHJvbGxlcn0gY2hhcnQgLSBUaGUgY2hhcnQgaW5zdGFuY2UuDQoJICogQHBhcmFtIHtJRXZlbnR9IGV2ZW50IC0gVGhlIGV2ZW50IG9iamVjdC4NCgkgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyAtIFRoZSBwbHVnaW4gb3B0aW9ucy4NCgkgKi8NCgkvKioNCgkgKiBAbWV0aG9kIElQbHVnaW4jYWZ0ZXJFdmVudA0KCSAqIEBkZXNjIENhbGxlZCBhZnRlciB0aGUgYGV2ZW50YCBoYXMgYmVlbiBjb25zdW1lZC4gTm90ZSB0aGF0IHRoaXMgaG9vaw0KCSAqIHdpbGwgbm90IGJlIGNhbGxlZCBpZiB0aGUgYGV2ZW50YCBoYXMgYmVlbiBwcmV2aW91c2x5IGRpc2NhcmRlZC4NCgkgKiBAcGFyYW0ge0NoYXJ0LkNvbnRyb2xsZXJ9IGNoYXJ0IC0gVGhlIGNoYXJ0IGluc3RhbmNlLg0KCSAqIEBwYXJhbSB7SUV2ZW50fSBldmVudCAtIFRoZSBldmVudCBvYmplY3QuDQoJICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgLSBUaGUgcGx1Z2luIG9wdGlvbnMuDQoJICovDQoJLyoqDQoJICogQG1ldGhvZCBJUGx1Z2luI3Jlc2l6ZQ0KCSAqIEBkZXNjIENhbGxlZCBhZnRlciB0aGUgY2hhcnQgYXMgYmVlbiByZXNpemVkLg0KCSAqIEBwYXJhbSB7Q2hhcnQuQ29udHJvbGxlcn0gY2hhcnQgLSBUaGUgY2hhcnQgaW5zdGFuY2UuDQoJICogQHBhcmFtIHtOdW1iZXJ9IHNpemUgLSBUaGUgbmV3IGNhbnZhcyBkaXNwbGF5IHNpemUgKGVxLiBjYW52YXMuc3R5bGUgd2lkdGggJiBoZWlnaHQpLg0KCSAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIC0gVGhlIHBsdWdpbiBvcHRpb25zLg0KCSAqLw0KCS8qKg0KCSAqIEBtZXRob2QgSVBsdWdpbiNkZXN0cm95DQoJICogQGRlc2MgQ2FsbGVkIGFmdGVyIHRoZSBjaGFydCBhcyBiZWVuIGRlc3Ryb3llZC4NCgkgKiBAcGFyYW0ge0NoYXJ0LkNvbnRyb2xsZXJ9IGNoYXJ0IC0gVGhlIGNoYXJ0IGluc3RhbmNlLg0KCSAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIC0gVGhlIHBsdWdpbiBvcHRpb25zLg0KCSAqLw0KDQoJLyoqDQoJICogUHJvdmlkZWQgZm9yIGJhY2t3YXJkIGNvbXBhdGliaWxpdHksIHVzZSBDaGFydC5wbHVnaW5zIGluc3RlYWQNCgkgKiBAbmFtZXNwYWNlIENoYXJ0LnBsdWdpblNlcnZpY2UNCgkgKiBAZGVwcmVjYXRlZCBzaW5jZSB2ZXJzaW9uIDIuMS41DQoJICogQHRvZG8gcmVtb3ZlIGF0IHZlcnNpb24gMw0KCSAqIEBwcml2YXRlDQoJICovDQoJQ2hhcnQucGx1Z2luU2VydmljZSA9IENoYXJ0LnBsdWdpbnM7DQoNCgkvKioNCgkgKiBQcm92aWRlZCBmb3IgYmFja3dhcmQgY29tcGF0aWJpbGl0eSwgaW5oZXJpdGluZyBmcm9tIENoYXJ0LlBsdWdpbmdCYXNlIGhhcyBubw0KCSAqIGVmZmVjdCwgaW5zdGVhZCBzaW1wbHkgY3JlYXRlL3JlZ2lzdGVyIHBsdWdpbnMgdmlhIHBsYWluIEphdmFTY3JpcHQgb2JqZWN0cy4NCgkgKiBAaW50ZXJmYWNlIENoYXJ0LlBsdWdpbkJhc2UNCgkgKiBAZGVwcmVjYXRlZCBzaW5jZSB2ZXJzaW9uIDIuNS4wDQoJICogQHRvZG8gcmVtb3ZlIGF0IHZlcnNpb24gMw0KCSAqIEBwcml2YXRlDQoJICovDQoJQ2hhcnQuUGx1Z2luQmFzZSA9IEVsZW1lbnQuZXh0ZW5kKHt9KTsNCn07DQoNCn0seyIyNSI6MjUsIjI2IjoyNiwiNDUiOjQ1fV0sMzI6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpew0KJ3VzZSBzdHJpY3QnOw0KDQp2YXIgZGVmYXVsdHMgPSByZXF1aXJlKDI1KTsNCnZhciBFbGVtZW50ID0gcmVxdWlyZSgyNik7DQp2YXIgaGVscGVycyA9IHJlcXVpcmUoNDUpOw0KdmFyIFRpY2tzID0gcmVxdWlyZSgzNCk7DQoNCmRlZmF1bHRzLl9zZXQoJ3NjYWxlJywgew0KCWRpc3BsYXk6IHRydWUsDQoJcG9zaXRpb246ICdsZWZ0JywNCglvZmZzZXQ6IGZhbHNlLA0KDQoJLy8gZ3JpZCBsaW5lIHNldHRpbmdzDQoJZ3JpZExpbmVzOiB7DQoJCWRpc3BsYXk6IHRydWUsDQoJCWNvbG9yOiAncmdiYSgwLCAwLCAwLCAwLjEpJywNCgkJbGluZVdpZHRoOiAxLA0KCQlkcmF3Qm9yZGVyOiB0cnVlLA0KCQlkcmF3T25DaGFydEFyZWE6IHRydWUsDQoJCWRyYXdUaWNrczogdHJ1ZSwNCgkJdGlja01hcmtMZW5ndGg6IDEwLA0KCQl6ZXJvTGluZVdpZHRoOiAxLA0KCQl6ZXJvTGluZUNvbG9yOiAncmdiYSgwLDAsMCwwLjI1KScsDQoJCXplcm9MaW5lQm9yZGVyRGFzaDogW10sDQoJCXplcm9MaW5lQm9yZGVyRGFzaE9mZnNldDogMC4wLA0KCQlvZmZzZXRHcmlkTGluZXM6IGZhbHNlLA0KCQlib3JkZXJEYXNoOiBbXSwNCgkJYm9yZGVyRGFzaE9mZnNldDogMC4wDQoJfSwNCg0KCS8vIHNjYWxlIGxhYmVsDQoJc2NhbGVMYWJlbDogew0KCQkvLyBkaXNwbGF5IHByb3BlcnR5DQoJCWRpc3BsYXk6IGZhbHNlLA0KDQoJCS8vIGFjdHVhbCBsYWJlbA0KCQlsYWJlbFN0cmluZzogJycsDQoNCgkJLy8gbGluZSBoZWlnaHQNCgkJbGluZUhlaWdodDogMS4yLA0KDQoJCS8vIHRvcC9ib3R0b20gcGFkZGluZw0KCQlwYWRkaW5nOiB7DQoJCQl0b3A6IDQsDQoJCQlib3R0b206IDQNCgkJfQ0KCX0sDQoNCgkvLyBsYWJlbCBzZXR0aW5ncw0KCXRpY2tzOiB7DQoJCWJlZ2luQXRaZXJvOiBmYWxzZSwNCgkJbWluUm90YXRpb246IDAsDQoJCW1heFJvdGF0aW9uOiA1MCwNCgkJbWlycm9yOiBmYWxzZSwNCgkJcGFkZGluZzogMCwNCgkJcmV2ZXJzZTogZmFsc2UsDQoJCWRpc3BsYXk6IHRydWUsDQoJCWF1dG9Ta2lwOiB0cnVlLA0KCQlhdXRvU2tpcFBhZGRpbmc6IDAsDQoJCWxhYmVsT2Zmc2V0OiAwLA0KCQkvLyBXZSBwYXNzIHRocm91Z2ggYXJyYXlzIHRvIGJlIHJlbmRlcmVkIGFzIG11bHRpbGluZSBsYWJlbHMsIHdlIGNvbnZlcnQgT3RoZXJzIHRvIHN0cmluZ3MgaGVyZS4NCgkJY2FsbGJhY2s6IFRpY2tzLmZvcm1hdHRlcnMudmFsdWVzLA0KCQltaW5vcjoge30sDQoJCW1ham9yOiB7fQ0KCX0NCn0pOw0KDQpmdW5jdGlvbiBsYWJlbHNGcm9tVGlja3ModGlja3MpIHsNCgl2YXIgbGFiZWxzID0gW107DQoJdmFyIGksIGlsZW47DQoNCglmb3IgKGkgPSAwLCBpbGVuID0gdGlja3MubGVuZ3RoOyBpIDwgaWxlbjsgKytpKSB7DQoJCWxhYmVscy5wdXNoKHRpY2tzW2ldLmxhYmVsKTsNCgl9DQoNCglyZXR1cm4gbGFiZWxzOw0KfQ0KDQpmdW5jdGlvbiBnZXRMaW5lVmFsdWUoc2NhbGUsIGluZGV4LCBvZmZzZXRHcmlkTGluZXMpIHsNCgl2YXIgbGluZVZhbHVlID0gc2NhbGUuZ2V0UGl4ZWxGb3JUaWNrKGluZGV4KTsNCg0KCWlmIChvZmZzZXRHcmlkTGluZXMpIHsNCgkJaWYgKGluZGV4ID09PSAwKSB7DQoJCQlsaW5lVmFsdWUgLT0gKHNjYWxlLmdldFBpeGVsRm9yVGljaygxKSAtIGxpbmVWYWx1ZSkgLyAyOw0KCQl9IGVsc2Ugew0KCQkJbGluZVZhbHVlIC09IChsaW5lVmFsdWUgLSBzY2FsZS5nZXRQaXhlbEZvclRpY2soaW5kZXggLSAxKSkgLyAyOw0KCQl9DQoJfQ0KCXJldHVybiBsaW5lVmFsdWU7DQp9DQoNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oQ2hhcnQpIHsNCg0KCWZ1bmN0aW9uIGNvbXB1dGVUZXh0U2l6ZShjb250ZXh0LCB0aWNrLCBmb250KSB7DQoJCXJldHVybiBoZWxwZXJzLmlzQXJyYXkodGljaykgPw0KCQkJaGVscGVycy5sb25nZXN0VGV4dChjb250ZXh0LCBmb250LCB0aWNrKSA6DQoJCQljb250ZXh0Lm1lYXN1cmVUZXh0KHRpY2spLndpZHRoOw0KCX0NCg0KCWZ1bmN0aW9uIHBhcnNlRm9udE9wdGlvbnMob3B0aW9ucykgew0KCQl2YXIgdmFsdWVPckRlZmF1bHQgPSBoZWxwZXJzLnZhbHVlT3JEZWZhdWx0Ow0KCQl2YXIgZ2xvYmFsRGVmYXVsdHMgPSBkZWZhdWx0cy5nbG9iYWw7DQoJCXZhciBzaXplID0gdmFsdWVPckRlZmF1bHQob3B0aW9ucy5mb250U2l6ZSwgZ2xvYmFsRGVmYXVsdHMuZGVmYXVsdEZvbnRTaXplKTsNCgkJdmFyIHN0eWxlID0gdmFsdWVPckRlZmF1bHQob3B0aW9ucy5mb250U3R5bGUsIGdsb2JhbERlZmF1bHRzLmRlZmF1bHRGb250U3R5bGUpOw0KCQl2YXIgZmFtaWx5ID0gdmFsdWVPckRlZmF1bHQob3B0aW9ucy5mb250RmFtaWx5LCBnbG9iYWxEZWZhdWx0cy5kZWZhdWx0Rm9udEZhbWlseSk7DQoNCgkJcmV0dXJuIHsNCgkJCXNpemU6IHNpemUsDQoJCQlzdHlsZTogc3R5bGUsDQoJCQlmYW1pbHk6IGZhbWlseSwNCgkJCWZvbnQ6IGhlbHBlcnMuZm9udFN0cmluZyhzaXplLCBzdHlsZSwgZmFtaWx5KQ0KCQl9Ow0KCX0NCg0KCWZ1bmN0aW9uIHBhcnNlTGluZUhlaWdodChvcHRpb25zKSB7DQoJCXJldHVybiBoZWxwZXJzLm9wdGlvbnMudG9MaW5lSGVpZ2h0KA0KCQkJaGVscGVycy52YWx1ZU9yRGVmYXVsdChvcHRpb25zLmxpbmVIZWlnaHQsIDEuMiksDQoJCQloZWxwZXJzLnZhbHVlT3JEZWZhdWx0KG9wdGlvbnMuZm9udFNpemUsIGRlZmF1bHRzLmdsb2JhbC5kZWZhdWx0Rm9udFNpemUpKTsNCgl9DQoNCglDaGFydC5TY2FsZSA9IEVsZW1lbnQuZXh0ZW5kKHsNCgkJLyoqDQoJCSAqIEdldCB0aGUgcGFkZGluZyBuZWVkZWQgZm9yIHRoZSBzY2FsZQ0KCQkgKiBAbWV0aG9kIGdldFBhZGRpbmcNCgkJICogQHByaXZhdGUNCgkJICogQHJldHVybnMge1BhZGRpbmd9IHRoZSBuZWNlc3NhcnkgcGFkZGluZw0KCQkgKi8NCgkJZ2V0UGFkZGluZzogZnVuY3Rpb24oKSB7DQoJCQl2YXIgbWUgPSB0aGlzOw0KCQkJcmV0dXJuIHsNCgkJCQlsZWZ0OiBtZS5wYWRkaW5nTGVmdCB8fCAwLA0KCQkJCXRvcDogbWUucGFkZGluZ1RvcCB8fCAwLA0KCQkJCXJpZ2h0OiBtZS5wYWRkaW5nUmlnaHQgfHwgMCwNCgkJCQlib3R0b206IG1lLnBhZGRpbmdCb3R0b20gfHwgMA0KCQkJfTsNCgkJfSwNCg0KCQkvKioNCgkJICogUmV0dXJucyB0aGUgc2NhbGUgdGljayBvYmplY3RzICh7bGFiZWwsIG1ham9yfSkNCgkJICogQHNpbmNlIDIuNw0KCQkgKi8NCgkJZ2V0VGlja3M6IGZ1bmN0aW9uKCkgew0KCQkJcmV0dXJuIHRoaXMuX3RpY2tzOw0KCQl9LA0KDQoJCS8vIFRoZXNlIG1ldGhvZHMgYXJlIG9yZGVyZWQgYnkgbGlmZWN5bGUuIFV0aWxpdGllcyB0aGVuIGZvbGxvdy4NCgkJLy8gQW55IGZ1bmN0aW9uIGRlZmluZWQgaGVyZSBpcyBpbmhlcml0ZWQgYnkgYWxsIHNjYWxlIHR5cGVzLg0KCQkvLyBBbnkgZnVuY3Rpb24gY2FuIGJlIGV4dGVuZGVkIGJ5IHRoZSBzY2FsZSB0eXBlDQoNCgkJbWVyZ2VUaWNrc09wdGlvbnM6IGZ1bmN0aW9uKCkgew0KCQkJdmFyIHRpY2tzID0gdGhpcy5vcHRpb25zLnRpY2tzOw0KCQkJaWYgKHRpY2tzLm1pbm9yID09PSBmYWxzZSkgew0KCQkJCXRpY2tzLm1pbm9yID0gew0KCQkJCQlkaXNwbGF5OiBmYWxzZQ0KCQkJCX07DQoJCQl9DQoJCQlpZiAodGlja3MubWFqb3IgPT09IGZhbHNlKSB7DQoJCQkJdGlja3MubWFqb3IgPSB7DQoJCQkJCWRpc3BsYXk6IGZhbHNlDQoJCQkJfTsNCgkJCX0NCgkJCWZvciAodmFyIGtleSBpbiB0aWNrcykgew0KCQkJCWlmIChrZXkgIT09ICdtYWpvcicgJiYga2V5ICE9PSAnbWlub3InKSB7DQoJCQkJCWlmICh0eXBlb2YgdGlja3MubWlub3Jba2V5XSA9PT0gJ3VuZGVmaW5lZCcpIHsNCgkJCQkJCXRpY2tzLm1pbm9yW2tleV0gPSB0aWNrc1trZXldOw0KCQkJCQl9DQoJCQkJCWlmICh0eXBlb2YgdGlja3MubWFqb3Jba2V5XSA9PT0gJ3VuZGVmaW5lZCcpIHsNCgkJCQkJCXRpY2tzLm1ham9yW2tleV0gPSB0aWNrc1trZXldOw0KCQkJCQl9DQoJCQkJfQ0KCQkJfQ0KCQl9LA0KCQliZWZvcmVVcGRhdGU6IGZ1bmN0aW9uKCkgew0KCQkJaGVscGVycy5jYWxsYmFjayh0aGlzLm9wdGlvbnMuYmVmb3JlVXBkYXRlLCBbdGhpc10pOw0KCQl9LA0KCQl1cGRhdGU6IGZ1bmN0aW9uKG1heFdpZHRoLCBtYXhIZWlnaHQsIG1hcmdpbnMpIHsNCgkJCXZhciBtZSA9IHRoaXM7DQoJCQl2YXIgaSwgaWxlbiwgbGFiZWxzLCBsYWJlbCwgdGlja3MsIHRpY2s7DQoNCgkJCS8vIFVwZGF0ZSBMaWZlY3ljbGUgLSBQcm9iYWJseSBkb24ndCB3YW50IHRvIGV2ZXIgZXh0ZW5kIG9yIG92ZXJ3cml0ZSB0aGlzIGZ1bmN0aW9uIDspDQoJCQltZS5iZWZvcmVVcGRhdGUoKTsNCg0KCQkJLy8gQWJzb3JiIHRoZSBtYXN0ZXIgbWVhc3VyZW1lbnRzDQoJCQltZS5tYXhXaWR0aCA9IG1heFdpZHRoOw0KCQkJbWUubWF4SGVpZ2h0ID0gbWF4SGVpZ2h0Ow0KCQkJbWUubWFyZ2lucyA9IGhlbHBlcnMuZXh0ZW5kKHsNCgkJCQlsZWZ0OiAwLA0KCQkJCXJpZ2h0OiAwLA0KCQkJCXRvcDogMCwNCgkJCQlib3R0b206IDANCgkJCX0sIG1hcmdpbnMpOw0KCQkJbWUubG9uZ2VzdFRleHRDYWNoZSA9IG1lLmxvbmdlc3RUZXh0Q2FjaGUgfHwge307DQoNCgkJCS8vIERpbWVuc2lvbnMNCgkJCW1lLmJlZm9yZVNldERpbWVuc2lvbnMoKTsNCgkJCW1lLnNldERpbWVuc2lvbnMoKTsNCgkJCW1lLmFmdGVyU2V0RGltZW5zaW9ucygpOw0KDQoJCQkvLyBEYXRhIG1pbi9tYXgNCgkJCW1lLmJlZm9yZURhdGFMaW1pdHMoKTsNCgkJCW1lLmRldGVybWluZURhdGFMaW1pdHMoKTsNCgkJCW1lLmFmdGVyRGF0YUxpbWl0cygpOw0KDQoJCQkvLyBUaWNrcyAtIGB0aGlzLnRpY2tzYCBpcyBub3cgREVQUkVDQVRFRCENCgkJCS8vIEludGVybmFsIHRpY2tzIGFyZSBub3cgc3RvcmVkIGFzIG9iamVjdHMgaW4gdGhlIFBSSVZBVEUgYHRoaXMuX3RpY2tzYCBtZW1iZXINCgkJCS8vIGFuZCBtdXN0IG5vdCBiZSBhY2Nlc3NlZCBkaXJlY3RseSBmcm9tIG91dHNpZGUgdGhpcyBjbGFzcy4gYHRoaXMudGlja3NgIGJlaW5nDQoJCQkvLyBhcm91bmQgZm9yIGxvbmcgdGltZSBhbmQgbm90IG1hcmtlZCBhcyBwcml2YXRlLCB3ZSBjYW4ndCBjaGFuZ2UgaXRzIHN0cnVjdHVyZQ0KCQkJLy8gd2l0aG91dCB1bmV4cGVjdGVkIGJyZWFraW5nIGNoYW5nZXMuIElmIHlvdSBuZWVkIHRvIGFjY2VzcyB0aGUgc2NhbGUgdGlja3MsDQoJCQkvLyB1c2Ugc2NhbGUuZ2V0VGlja3MoKSBpbnN0ZWFkLg0KDQoJCQltZS5iZWZvcmVCdWlsZFRpY2tzKCk7DQoNCgkJCS8vIE5ldyBpbXBsZW1lbnRhdGlvbnMgc2hvdWxkIHJldHVybiBhbiBhcnJheSBvZiBvYmplY3RzIGJ1dCBmb3IgQkFDS1dBUkQgQ09NUEFULA0KCQkJLy8gd2Ugc3RpbGwgc3VwcG9ydCBubyByZXR1cm4gKGB0aGlzLnRpY2tzYCBpbnRlcm5hbGx5IHNldCBieSBjYWxsaW5nIHRoaXMgbWV0aG9kKS4NCgkJCXRpY2tzID0gbWUuYnVpbGRUaWNrcygpIHx8IFtdOw0KDQoJCQltZS5hZnRlckJ1aWxkVGlja3MoKTsNCg0KCQkJbWUuYmVmb3JlVGlja1RvTGFiZWxDb252ZXJzaW9uKCk7DQoNCgkJCS8vIE5ldyBpbXBsZW1lbnRhdGlvbnMgc2hvdWxkIHJldHVybiB0aGUgZm9ybWF0dGVkIHRpY2sgbGFiZWxzIGJ1dCBmb3IgQkFDS1dBUkQNCgkJCS8vIENPTVBBVCwgd2Ugc3RpbGwgc3VwcG9ydCBubyByZXR1cm4gKGB0aGlzLnRpY2tzYCBpbnRlcm5hbGx5IGNoYW5nZWQgYnkgY2FsbGluZw0KCQkJLy8gdGhpcyBtZXRob2QgYW5kIHN1cHBvc2VkIHRvIGNvbnRhaW4gb25seSBzdHJpbmcgdmFsdWVzKS4NCgkJCWxhYmVscyA9IG1lLmNvbnZlcnRUaWNrc1RvTGFiZWxzKHRpY2tzKSB8fCBtZS50aWNrczsNCg0KCQkJbWUuYWZ0ZXJUaWNrVG9MYWJlbENvbnZlcnNpb24oKTsNCg0KCQkJbWUudGlja3MgPSBsYWJlbHM7ICAgLy8gQkFDS1dBUkQgQ09NUEFUSUJJTElUWQ0KDQoJCQkvLyBJTVBPUlRBTlQ6IGZyb20gdGhpcyBwb2ludCwgd2UgY29uc2lkZXIgdGhhdCBgdGhpcy50aWNrc2Agd2lsbCBORVZFUiBjaGFuZ2UhDQoNCgkJCS8vIEJBQ0tXQVJEIENPTVBBVDogc3luY2hyb25pemUgYF90aWNrc2Agd2l0aCBsYWJlbHMgKHNvIHBvdGVudGlhbGx5IGB0aGlzLnRpY2tzYCkNCgkJCWZvciAoaSA9IDAsIGlsZW4gPSBsYWJlbHMubGVuZ3RoOyBpIDwgaWxlbjsgKytpKSB7DQoJCQkJbGFiZWwgPSBsYWJlbHNbaV07DQoJCQkJdGljayA9IHRpY2tzW2ldOw0KCQkJCWlmICghdGljaykgew0KCQkJCQl0aWNrcy5wdXNoKHRpY2sgPSB7DQoJCQkJCQlsYWJlbDogbGFiZWwsDQoJCQkJCQltYWpvcjogZmFsc2UNCgkJCQkJfSk7DQoJCQkJfSBlbHNlIHsNCgkJCQkJdGljay5sYWJlbCA9IGxhYmVsOw0KCQkJCX0NCgkJCX0NCg0KCQkJbWUuX3RpY2tzID0gdGlja3M7DQoNCgkJCS8vIFRpY2sgUm90YXRpb24NCgkJCW1lLmJlZm9yZUNhbGN1bGF0ZVRpY2tSb3RhdGlvbigpOw0KCQkJbWUuY2FsY3VsYXRlVGlja1JvdGF0aW9uKCk7DQoJCQltZS5hZnRlckNhbGN1bGF0ZVRpY2tSb3RhdGlvbigpOw0KCQkJLy8gRml0DQoJCQltZS5iZWZvcmVGaXQoKTsNCgkJCW1lLmZpdCgpOw0KCQkJbWUuYWZ0ZXJGaXQoKTsNCgkJCS8vDQoJCQltZS5hZnRlclVwZGF0ZSgpOw0KDQoJCQlyZXR1cm4gbWUubWluU2l6ZTsNCg0KCQl9LA0KCQlhZnRlclVwZGF0ZTogZnVuY3Rpb24oKSB7DQoJCQloZWxwZXJzLmNhbGxiYWNrKHRoaXMub3B0aW9ucy5hZnRlclVwZGF0ZSwgW3RoaXNdKTsNCgkJfSwNCg0KCQkvLw0KDQoJCWJlZm9yZVNldERpbWVuc2lvbnM6IGZ1bmN0aW9uKCkgew0KCQkJaGVscGVycy5jYWxsYmFjayh0aGlzLm9wdGlvbnMuYmVmb3JlU2V0RGltZW5zaW9ucywgW3RoaXNdKTsNCgkJfSwNCgkJc2V0RGltZW5zaW9uczogZnVuY3Rpb24oKSB7DQoJCQl2YXIgbWUgPSB0aGlzOw0KCQkJLy8gU2V0IHRoZSB1bmNvbnN0cmFpbmVkIGRpbWVuc2lvbiBiZWZvcmUgbGFiZWwgcm90YXRpb24NCgkJCWlmIChtZS5pc0hvcml6b250YWwoKSkgew0KCQkJCS8vIFJlc2V0IHBvc2l0aW9uIGJlZm9yZSBjYWxjdWxhdGluZyByb3RhdGlvbg0KCQkJCW1lLndpZHRoID0gbWUubWF4V2lkdGg7DQoJCQkJbWUubGVmdCA9IDA7DQoJCQkJbWUucmlnaHQgPSBtZS53aWR0aDsNCgkJCX0gZWxzZSB7DQoJCQkJbWUuaGVpZ2h0ID0gbWUubWF4SGVpZ2h0Ow0KDQoJCQkJLy8gUmVzZXQgcG9zaXRpb24gYmVmb3JlIGNhbGN1bGF0aW5nIHJvdGF0aW9uDQoJCQkJbWUudG9wID0gMDsNCgkJCQltZS5ib3R0b20gPSBtZS5oZWlnaHQ7DQoJCQl9DQoNCgkJCS8vIFJlc2V0IHBhZGRpbmcNCgkJCW1lLnBhZGRpbmdMZWZ0ID0gMDsNCgkJCW1lLnBhZGRpbmdUb3AgPSAwOw0KCQkJbWUucGFkZGluZ1JpZ2h0ID0gMDsNCgkJCW1lLnBhZGRpbmdCb3R0b20gPSAwOw0KCQl9LA0KCQlhZnRlclNldERpbWVuc2lvbnM6IGZ1bmN0aW9uKCkgew0KCQkJaGVscGVycy5jYWxsYmFjayh0aGlzLm9wdGlvbnMuYWZ0ZXJTZXREaW1lbnNpb25zLCBbdGhpc10pOw0KCQl9LA0KDQoJCS8vIERhdGEgbGltaXRzDQoJCWJlZm9yZURhdGFMaW1pdHM6IGZ1bmN0aW9uKCkgew0KCQkJaGVscGVycy5jYWxsYmFjayh0aGlzLm9wdGlvbnMuYmVmb3JlRGF0YUxpbWl0cywgW3RoaXNdKTsNCgkJfSwNCgkJZGV0ZXJtaW5lRGF0YUxpbWl0czogaGVscGVycy5ub29wLA0KCQlhZnRlckRhdGFMaW1pdHM6IGZ1bmN0aW9uKCkgew0KCQkJaGVscGVycy5jYWxsYmFjayh0aGlzLm9wdGlvbnMuYWZ0ZXJEYXRhTGltaXRzLCBbdGhpc10pOw0KCQl9LA0KDQoJCS8vDQoJCWJlZm9yZUJ1aWxkVGlja3M6IGZ1bmN0aW9uKCkgew0KCQkJaGVscGVycy5jYWxsYmFjayh0aGlzLm9wdGlvbnMuYmVmb3JlQnVpbGRUaWNrcywgW3RoaXNdKTsNCgkJfSwNCgkJYnVpbGRUaWNrczogaGVscGVycy5ub29wLA0KCQlhZnRlckJ1aWxkVGlja3M6IGZ1bmN0aW9uKCkgew0KCQkJaGVscGVycy5jYWxsYmFjayh0aGlzLm9wdGlvbnMuYWZ0ZXJCdWlsZFRpY2tzLCBbdGhpc10pOw0KCQl9LA0KDQoJCWJlZm9yZVRpY2tUb0xhYmVsQ29udmVyc2lvbjogZnVuY3Rpb24oKSB7DQoJCQloZWxwZXJzLmNhbGxiYWNrKHRoaXMub3B0aW9ucy5iZWZvcmVUaWNrVG9MYWJlbENvbnZlcnNpb24sIFt0aGlzXSk7DQoJCX0sDQoJCWNvbnZlcnRUaWNrc1RvTGFiZWxzOiBmdW5jdGlvbigpIHsNCgkJCXZhciBtZSA9IHRoaXM7DQoJCQkvLyBDb252ZXJ0IHRpY2tzIHRvIHN0cmluZ3MNCgkJCXZhciB0aWNrT3B0cyA9IG1lLm9wdGlvbnMudGlja3M7DQoJCQltZS50aWNrcyA9IG1lLnRpY2tzLm1hcCh0aWNrT3B0cy51c2VyQ2FsbGJhY2sgfHwgdGlja09wdHMuY2FsbGJhY2ssIHRoaXMpOw0KCQl9LA0KCQlhZnRlclRpY2tUb0xhYmVsQ29udmVyc2lvbjogZnVuY3Rpb24oKSB7DQoJCQloZWxwZXJzLmNhbGxiYWNrKHRoaXMub3B0aW9ucy5hZnRlclRpY2tUb0xhYmVsQ29udmVyc2lvbiwgW3RoaXNdKTsNCgkJfSwNCg0KCQkvLw0KDQoJCWJlZm9yZUNhbGN1bGF0ZVRpY2tSb3RhdGlvbjogZnVuY3Rpb24oKSB7DQoJCQloZWxwZXJzLmNhbGxiYWNrKHRoaXMub3B0aW9ucy5iZWZvcmVDYWxjdWxhdGVUaWNrUm90YXRpb24sIFt0aGlzXSk7DQoJCX0sDQoJCWNhbGN1bGF0ZVRpY2tSb3RhdGlvbjogZnVuY3Rpb24oKSB7DQoJCQl2YXIgbWUgPSB0aGlzOw0KCQkJdmFyIGNvbnRleHQgPSBtZS5jdHg7DQoJCQl2YXIgdGlja09wdHMgPSBtZS5vcHRpb25zLnRpY2tzOw0KCQkJdmFyIGxhYmVscyA9IGxhYmVsc0Zyb21UaWNrcyhtZS5fdGlja3MpOw0KDQoJCQkvLyBHZXQgdGhlIHdpZHRoIG9mIGVhY2ggZ3JpZCBieSBjYWxjdWxhdGluZyB0aGUgZGlmZmVyZW5jZQ0KCQkJLy8gYmV0d2VlbiB4IG9mZnNldHMgYmV0d2VlbiAwIGFuZCAxLg0KCQkJdmFyIHRpY2tGb250ID0gcGFyc2VGb250T3B0aW9ucyh0aWNrT3B0cyk7DQoJCQljb250ZXh0LmZvbnQgPSB0aWNrRm9udC5mb250Ow0KDQoJCQl2YXIgbGFiZWxSb3RhdGlvbiA9IHRpY2tPcHRzLm1pblJvdGF0aW9uIHx8IDA7DQoNCgkJCWlmIChsYWJlbHMubGVuZ3RoICYmIG1lLm9wdGlvbnMuZGlzcGxheSAmJiBtZS5pc0hvcml6b250YWwoKSkgew0KCQkJCXZhciBvcmlnaW5hbExhYmVsV2lkdGggPSBoZWxwZXJzLmxvbmdlc3RUZXh0KGNvbnRleHQsIHRpY2tGb250LmZvbnQsIGxhYmVscywgbWUubG9uZ2VzdFRleHRDYWNoZSk7DQoJCQkJdmFyIGxhYmVsV2lkdGggPSBvcmlnaW5hbExhYmVsV2lkdGg7DQoJCQkJdmFyIGNvc1JvdGF0aW9uLCBzaW5Sb3RhdGlvbjsNCg0KCQkJCS8vIEFsbG93IDMgcGl4ZWxzIHgyIHBhZGRpbmcgZWl0aGVyIHNpZGUgZm9yIGxhYmVsIHJlYWRhYmlsaXR5DQoJCQkJdmFyIHRpY2tXaWR0aCA9IG1lLmdldFBpeGVsRm9yVGljaygxKSAtIG1lLmdldFBpeGVsRm9yVGljaygwKSAtIDY7DQoNCgkJCQkvLyBNYXggbGFiZWwgcm90YXRpb24gY2FuIGJlIHNldCBvciBkZWZhdWx0IHRvIDkwIC0gYWxzbyBhY3QgYXMgYSBsb29wIGNvdW50ZXINCgkJCQl3aGlsZSAobGFiZWxXaWR0aCA+IHRpY2tXaWR0aCAmJiBsYWJlbFJvdGF0aW9uIDwgdGlja09wdHMubWF4Um90YXRpb24pIHsNCgkJCQkJdmFyIGFuZ2xlUmFkaWFucyA9IGhlbHBlcnMudG9SYWRpYW5zKGxhYmVsUm90YXRpb24pOw0KCQkJCQljb3NSb3RhdGlvbiA9IE1hdGguY29zKGFuZ2xlUmFkaWFucyk7DQoJCQkJCXNpblJvdGF0aW9uID0gTWF0aC5zaW4oYW5nbGVSYWRpYW5zKTsNCg0KCQkJCQlpZiAoc2luUm90YXRpb24gKiBvcmlnaW5hbExhYmVsV2lkdGggPiBtZS5tYXhIZWlnaHQpIHsNCgkJCQkJCS8vIGdvIGJhY2sgb25lIHN0ZXANCgkJCQkJCWxhYmVsUm90YXRpb24tLTsNCgkJCQkJCWJyZWFrOw0KCQkJCQl9DQoNCgkJCQkJbGFiZWxSb3RhdGlvbisrOw0KCQkJCQlsYWJlbFdpZHRoID0gY29zUm90YXRpb24gKiBvcmlnaW5hbExhYmVsV2lkdGg7DQoJCQkJfQ0KCQkJfQ0KDQoJCQltZS5sYWJlbFJvdGF0aW9uID0gbGFiZWxSb3RhdGlvbjsNCgkJfSwNCgkJYWZ0ZXJDYWxjdWxhdGVUaWNrUm90YXRpb246IGZ1bmN0aW9uKCkgew0KCQkJaGVscGVycy5jYWxsYmFjayh0aGlzLm9wdGlvbnMuYWZ0ZXJDYWxjdWxhdGVUaWNrUm90YXRpb24sIFt0aGlzXSk7DQoJCX0sDQoNCgkJLy8NCg0KCQliZWZvcmVGaXQ6IGZ1bmN0aW9uKCkgew0KCQkJaGVscGVycy5jYWxsYmFjayh0aGlzLm9wdGlvbnMuYmVmb3JlRml0LCBbdGhpc10pOw0KCQl9LA0KCQlmaXQ6IGZ1bmN0aW9uKCkgew0KCQkJdmFyIG1lID0gdGhpczsNCgkJCS8vIFJlc2V0DQoJCQl2YXIgbWluU2l6ZSA9IG1lLm1pblNpemUgPSB7DQoJCQkJd2lkdGg6IDAsDQoJCQkJaGVpZ2h0OiAwDQoJCQl9Ow0KDQoJCQl2YXIgbGFiZWxzID0gbGFiZWxzRnJvbVRpY2tzKG1lLl90aWNrcyk7DQoNCgkJCXZhciBvcHRzID0gbWUub3B0aW9uczsNCgkJCXZhciB0aWNrT3B0cyA9IG9wdHMudGlja3M7DQoJCQl2YXIgc2NhbGVMYWJlbE9wdHMgPSBvcHRzLnNjYWxlTGFiZWw7DQoJCQl2YXIgZ3JpZExpbmVPcHRzID0gb3B0cy5ncmlkTGluZXM7DQoJCQl2YXIgZGlzcGxheSA9IG9wdHMuZGlzcGxheTsNCgkJCXZhciBpc0hvcml6b250YWwgPSBtZS5pc0hvcml6b250YWwoKTsNCg0KCQkJdmFyIHRpY2tGb250ID0gcGFyc2VGb250T3B0aW9ucyh0aWNrT3B0cyk7DQoJCQl2YXIgdGlja01hcmtMZW5ndGggPSBvcHRzLmdyaWRMaW5lcy50aWNrTWFya0xlbmd0aDsNCg0KCQkJLy8gV2lkdGgNCgkJCWlmIChpc0hvcml6b250YWwpIHsNCgkJCQkvLyBzdWJ0cmFjdCB0aGUgbWFyZ2lucyB0byBsaW5lIHVwIHdpdGggdGhlIGNoYXJ0QXJlYSBpZiB3ZSBhcmUgYSBmdWxsIHdpZHRoIHNjYWxlDQoJCQkJbWluU2l6ZS53aWR0aCA9IG1lLmlzRnVsbFdpZHRoKCkgPyBtZS5tYXhXaWR0aCAtIG1lLm1hcmdpbnMubGVmdCAtIG1lLm1hcmdpbnMucmlnaHQgOiBtZS5tYXhXaWR0aDsNCgkJCX0gZWxzZSB7DQoJCQkJbWluU2l6ZS53aWR0aCA9IGRpc3BsYXkgJiYgZ3JpZExpbmVPcHRzLmRyYXdUaWNrcyA/IHRpY2tNYXJrTGVuZ3RoIDogMDsNCgkJCX0NCg0KCQkJLy8gaGVpZ2h0DQoJCQlpZiAoaXNIb3Jpem9udGFsKSB7DQoJCQkJbWluU2l6ZS5oZWlnaHQgPSBkaXNwbGF5ICYmIGdyaWRMaW5lT3B0cy5kcmF3VGlja3MgPyB0aWNrTWFya0xlbmd0aCA6IDA7DQoJCQl9IGVsc2Ugew0KCQkJCW1pblNpemUuaGVpZ2h0ID0gbWUubWF4SGVpZ2h0OyAvLyBmaWxsIGFsbCB0aGUgaGVpZ2h0DQoJCQl9DQoNCgkJCS8vIEFyZSB3ZSBzaG93aW5nIGEgdGl0bGUgZm9yIHRoZSBzY2FsZT8NCgkJCWlmIChzY2FsZUxhYmVsT3B0cy5kaXNwbGF5ICYmIGRpc3BsYXkpIHsNCgkJCQl2YXIgc2NhbGVMYWJlbExpbmVIZWlnaHQgPSBwYXJzZUxpbmVIZWlnaHQoc2NhbGVMYWJlbE9wdHMpOw0KCQkJCXZhciBzY2FsZUxhYmVsUGFkZGluZyA9IGhlbHBlcnMub3B0aW9ucy50b1BhZGRpbmcoc2NhbGVMYWJlbE9wdHMucGFkZGluZyk7DQoJCQkJdmFyIGRlbHRhSGVpZ2h0ID0gc2NhbGVMYWJlbExpbmVIZWlnaHQgKyBzY2FsZUxhYmVsUGFkZGluZy5oZWlnaHQ7DQoNCgkJCQlpZiAoaXNIb3Jpem9udGFsKSB7DQoJCQkJCW1pblNpemUuaGVpZ2h0ICs9IGRlbHRhSGVpZ2h0Ow0KCQkJCX0gZWxzZSB7DQoJCQkJCW1pblNpemUud2lkdGggKz0gZGVsdGFIZWlnaHQ7DQoJCQkJfQ0KCQkJfQ0KDQoJCQkvLyBEb24ndCBib3RoZXIgZml0dGluZyB0aGUgdGlja3MgaWYgd2UgYXJlIG5vdCBzaG93aW5nIHRoZW0NCgkJCWlmICh0aWNrT3B0cy5kaXNwbGF5ICYmIGRpc3BsYXkpIHsNCgkJCQl2YXIgbGFyZ2VzdFRleHRXaWR0aCA9IGhlbHBlcnMubG9uZ2VzdFRleHQobWUuY3R4LCB0aWNrRm9udC5mb250LCBsYWJlbHMsIG1lLmxvbmdlc3RUZXh0Q2FjaGUpOw0KCQkJCXZhciB0YWxsZXN0TGFiZWxIZWlnaHRJbkxpbmVzID0gaGVscGVycy5udW1iZXJPZkxhYmVsTGluZXMobGFiZWxzKTsNCgkJCQl2YXIgbGluZVNwYWNlID0gdGlja0ZvbnQuc2l6ZSAqIDAuNTsNCgkJCQl2YXIgdGlja1BhZGRpbmcgPSBtZS5vcHRpb25zLnRpY2tzLnBhZGRpbmc7DQoNCgkJCQlpZiAoaXNIb3Jpem9udGFsKSB7DQoJCQkJCS8vIEEgaG9yaXpvbnRhbCBheGlzIGlzIG1vcmUgY29uc3RyYWluZWQgYnkgdGhlIGhlaWdodC4NCgkJCQkJbWUubG9uZ2VzdExhYmVsV2lkdGggPSBsYXJnZXN0VGV4dFdpZHRoOw0KDQoJCQkJCXZhciBhbmdsZVJhZGlhbnMgPSBoZWxwZXJzLnRvUmFkaWFucyhtZS5sYWJlbFJvdGF0aW9uKTsNCgkJCQkJdmFyIGNvc1JvdGF0aW9uID0gTWF0aC5jb3MoYW5nbGVSYWRpYW5zKTsNCgkJCQkJdmFyIHNpblJvdGF0aW9uID0gTWF0aC5zaW4oYW5nbGVSYWRpYW5zKTsNCg0KCQkJCQkvLyBUT0RPIC0gaW1wcm92ZSB0aGlzIGNhbGN1bGF0aW9uDQoJCQkJCXZhciBsYWJlbEhlaWdodCA9IChzaW5Sb3RhdGlvbiAqIGxhcmdlc3RUZXh0V2lkdGgpDQoJCQkJCQkrICh0aWNrRm9udC5zaXplICogdGFsbGVzdExhYmVsSGVpZ2h0SW5MaW5lcykNCgkJCQkJCSsgKGxpbmVTcGFjZSAqICh0YWxsZXN0TGFiZWxIZWlnaHRJbkxpbmVzIC0gMSkpDQoJCQkJCQkrIGxpbmVTcGFjZTsgLy8gcGFkZGluZw0KDQoJCQkJCW1pblNpemUuaGVpZ2h0ID0gTWF0aC5taW4obWUubWF4SGVpZ2h0LCBtaW5TaXplLmhlaWdodCArIGxhYmVsSGVpZ2h0ICsgdGlja1BhZGRpbmcpOw0KDQoJCQkJCW1lLmN0eC5mb250ID0gdGlja0ZvbnQuZm9udDsNCgkJCQkJdmFyIGZpcnN0TGFiZWxXaWR0aCA9IGNvbXB1dGVUZXh0U2l6ZShtZS5jdHgsIGxhYmVsc1swXSwgdGlja0ZvbnQuZm9udCk7DQoJCQkJCXZhciBsYXN0TGFiZWxXaWR0aCA9IGNvbXB1dGVUZXh0U2l6ZShtZS5jdHgsIGxhYmVsc1tsYWJlbHMubGVuZ3RoIC0gMV0sIHRpY2tGb250LmZvbnQpOw0KDQoJCQkJCS8vIEVuc3VyZSB0aGF0IG91ciB0aWNrcyBhcmUgYWx3YXlzIGluc2lkZSB0aGUgY2FudmFzLiBXaGVuIHJvdGF0ZWQsIHRpY2tzIGFyZSByaWdodCBhbGlnbmVkDQoJCQkJCS8vIHdoaWNoIG1lYW5zIHRoYXQgdGhlIHJpZ2h0IHBhZGRpbmcgaXMgZG9taW5hdGVkIGJ5IHRoZSBmb250IGhlaWdodA0KCQkJCQlpZiAobWUubGFiZWxSb3RhdGlvbiAhPT0gMCkgew0KCQkJCQkJbWUucGFkZGluZ0xlZnQgPSBvcHRzLnBvc2l0aW9uID09PSAnYm90dG9tJyA/IChjb3NSb3RhdGlvbiAqIGZpcnN0TGFiZWxXaWR0aCkgKyAzIDogKGNvc1JvdGF0aW9uICogbGluZVNwYWNlKSArIDM7IC8vIGFkZCAzIHB4IHRvIG1vdmUgYXdheSBmcm9tIGNhbnZhcyBlZGdlcw0KCQkJCQkJbWUucGFkZGluZ1JpZ2h0ID0gb3B0cy5wb3NpdGlvbiA9PT0gJ2JvdHRvbScgPyAoY29zUm90YXRpb24gKiBsaW5lU3BhY2UpICsgMyA6IChjb3NSb3RhdGlvbiAqIGxhc3RMYWJlbFdpZHRoKSArIDM7DQoJCQkJCX0gZWxzZSB7DQoJCQkJCQltZS5wYWRkaW5nTGVmdCA9IGZpcnN0TGFiZWxXaWR0aCAvIDIgKyAzOyAvLyBhZGQgMyBweCB0byBtb3ZlIGF3YXkgZnJvbSBjYW52YXMgZWRnZXMNCgkJCQkJCW1lLnBhZGRpbmdSaWdodCA9IGxhc3RMYWJlbFdpZHRoIC8gMiArIDM7DQoJCQkJCX0NCgkJCQl9IGVsc2Ugew0KCQkJCQkvLyBBIHZlcnRpY2FsIGF4aXMgaXMgbW9yZSBjb25zdHJhaW5lZCBieSB0aGUgd2lkdGguIExhYmVscyBhcmUgdGhlDQoJCQkJCS8vIGRvbWluYW50IGZhY3RvciBoZXJlLCBzbyBnZXQgdGhhdCBsZW5ndGggZmlyc3QgYW5kIGFjY291bnQgZm9yIHBhZGRpbmcNCgkJCQkJaWYgKHRpY2tPcHRzLm1pcnJvcikgew0KCQkJCQkJbGFyZ2VzdFRleHRXaWR0aCA9IDA7DQoJCQkJCX0gZWxzZSB7DQoJCQkJCQkvLyB1c2UgbGluZVNwYWNlIGZvciBjb25zaXN0ZW5jeSB3aXRoIGhvcml6b250YWwgYXhpcw0KCQkJCQkJLy8gdGlja1BhZGRpbmcgaXMgbm90IGltcGxlbWVudGVkIGZvciBob3Jpem9udGFsDQoJCQkJCQlsYXJnZXN0VGV4dFdpZHRoICs9IHRpY2tQYWRkaW5nICsgbGluZVNwYWNlOw0KCQkJCQl9DQoNCgkJCQkJbWluU2l6ZS53aWR0aCA9IE1hdGgubWluKG1lLm1heFdpZHRoLCBtaW5TaXplLndpZHRoICsgbGFyZ2VzdFRleHRXaWR0aCk7DQoNCgkJCQkJbWUucGFkZGluZ1RvcCA9IHRpY2tGb250LnNpemUgLyAyOw0KCQkJCQltZS5wYWRkaW5nQm90dG9tID0gdGlja0ZvbnQuc2l6ZSAvIDI7DQoJCQkJfQ0KCQkJfQ0KDQoJCQltZS5oYW5kbGVNYXJnaW5zKCk7DQoNCgkJCW1lLndpZHRoID0gbWluU2l6ZS53aWR0aDsNCgkJCW1lLmhlaWdodCA9IG1pblNpemUuaGVpZ2h0Ow0KCQl9LA0KDQoJCS8qKg0KCQkgKiBIYW5kbGUgbWFyZ2lucyBhbmQgcGFkZGluZyBpbnRlcmFjdGlvbnMNCgkJICogQHByaXZhdGUNCgkJICovDQoJCWhhbmRsZU1hcmdpbnM6IGZ1bmN0aW9uKCkgew0KCQkJdmFyIG1lID0gdGhpczsNCgkJCWlmIChtZS5tYXJnaW5zKSB7DQoJCQkJbWUucGFkZGluZ0xlZnQgPSBNYXRoLm1heChtZS5wYWRkaW5nTGVmdCAtIG1lLm1hcmdpbnMubGVmdCwgMCk7DQoJCQkJbWUucGFkZGluZ1RvcCA9IE1hdGgubWF4KG1lLnBhZGRpbmdUb3AgLSBtZS5tYXJnaW5zLnRvcCwgMCk7DQoJCQkJbWUucGFkZGluZ1JpZ2h0ID0gTWF0aC5tYXgobWUucGFkZGluZ1JpZ2h0IC0gbWUubWFyZ2lucy5yaWdodCwgMCk7DQoJCQkJbWUucGFkZGluZ0JvdHRvbSA9IE1hdGgubWF4KG1lLnBhZGRpbmdCb3R0b20gLSBtZS5tYXJnaW5zLmJvdHRvbSwgMCk7DQoJCQl9DQoJCX0sDQoNCgkJYWZ0ZXJGaXQ6IGZ1bmN0aW9uKCkgew0KCQkJaGVscGVycy5jYWxsYmFjayh0aGlzLm9wdGlvbnMuYWZ0ZXJGaXQsIFt0aGlzXSk7DQoJCX0sDQoNCgkJLy8gU2hhcmVkIE1ldGhvZHMNCgkJaXNIb3Jpem9udGFsOiBmdW5jdGlvbigpIHsNCgkJCXJldHVybiB0aGlzLm9wdGlvbnMucG9zaXRpb24gPT09ICd0b3AnIHx8IHRoaXMub3B0aW9ucy5wb3NpdGlvbiA9PT0gJ2JvdHRvbSc7DQoJCX0sDQoJCWlzRnVsbFdpZHRoOiBmdW5jdGlvbigpIHsNCgkJCXJldHVybiAodGhpcy5vcHRpb25zLmZ1bGxXaWR0aCk7DQoJCX0sDQoNCgkJLy8gR2V0IHRoZSBjb3JyZWN0IHZhbHVlLiBOYU4gYmFkIGlucHV0cywgSWYgdGhlIHZhbHVlIHR5cGUgaXMgb2JqZWN0IGdldCB0aGUgeCBvciB5IGJhc2VkIG9uIHdoZXRoZXIgd2UgYXJlIGhvcml6b250YWwgb3Igbm90DQoJCWdldFJpZ2h0VmFsdWU6IGZ1bmN0aW9uKHJhd1ZhbHVlKSB7DQoJCQkvLyBOdWxsIGFuZCB1bmRlZmluZWQgdmFsdWVzIGZpcnN0DQoJCQlpZiAoaGVscGVycy5pc051bGxPclVuZGVmKHJhd1ZhbHVlKSkgew0KCQkJCXJldHVybiBOYU47DQoJCQl9DQoJCQkvLyBpc05hTihvYmplY3QpIHJldHVybnMgdHJ1ZSwgc28gbWFrZSBzdXJlIE5hTiBpcyBjaGVja2luZyBmb3IgYSBudW1iZXI7IERpc2NhcmQgSW5maW5pdGUgdmFsdWVzDQoJCQlpZiAodHlwZW9mIHJhd1ZhbHVlID09PSAnbnVtYmVyJyAmJiAhaXNGaW5pdGUocmF3VmFsdWUpKSB7DQoJCQkJcmV0dXJuIE5hTjsNCgkJCX0NCgkJCS8vIElmIGl0IGlzIGluIGZhY3QgYW4gb2JqZWN0LCBkaXZlIGluIG9uZSBtb3JlIGxldmVsDQoJCQlpZiAocmF3VmFsdWUpIHsNCgkJCQlpZiAodGhpcy5pc0hvcml6b250YWwoKSkgew0KCQkJCQlpZiAocmF3VmFsdWUueCAhPT0gdW5kZWZpbmVkKSB7DQoJCQkJCQlyZXR1cm4gdGhpcy5nZXRSaWdodFZhbHVlKHJhd1ZhbHVlLngpOw0KCQkJCQl9DQoJCQkJfSBlbHNlIGlmIChyYXdWYWx1ZS55ICE9PSB1bmRlZmluZWQpIHsNCgkJCQkJcmV0dXJuIHRoaXMuZ2V0UmlnaHRWYWx1ZShyYXdWYWx1ZS55KTsNCgkJCQl9DQoJCQl9DQoNCgkJCS8vIFZhbHVlIGlzIGdvb2QsIHJldHVybiBpdA0KCQkJcmV0dXJuIHJhd1ZhbHVlOw0KCQl9LA0KDQoJCS8qKg0KCQkgKiBVc2VkIHRvIGdldCB0aGUgdmFsdWUgdG8gZGlzcGxheSBpbiB0aGUgdG9vbHRpcCBmb3IgdGhlIGRhdGEgYXQgdGhlIGdpdmVuIGluZGV4DQoJCSAqIEBwYXJhbSBpbmRleA0KCQkgKiBAcGFyYW0gZGF0YXNldEluZGV4DQoJCSAqLw0KCQlnZXRMYWJlbEZvckluZGV4OiBoZWxwZXJzLm5vb3AsDQoNCgkJLyoqDQoJCSAqIFJldHVybnMgdGhlIGxvY2F0aW9uIG9mIHRoZSBnaXZlbiBkYXRhIHBvaW50LiBWYWx1ZSBjYW4gZWl0aGVyIGJlIGFuIGluZGV4IG9yIGEgbnVtZXJpY2FsIHZhbHVlDQoJCSAqIFRoZSBjb29yZGluYXRlICgwLCAwKSBpcyBhdCB0aGUgdXBwZXItbGVmdCBjb3JuZXIgb2YgdGhlIGNhbnZhcw0KCQkgKiBAcGFyYW0gdmFsdWUNCgkJICogQHBhcmFtIGluZGV4DQoJCSAqIEBwYXJhbSBkYXRhc2V0SW5kZXgNCgkJICovDQoJCWdldFBpeGVsRm9yVmFsdWU6IGhlbHBlcnMubm9vcCwNCg0KCQkvKioNCgkJICogVXNlZCB0byBnZXQgdGhlIGRhdGEgdmFsdWUgZnJvbSBhIGdpdmVuIHBpeGVsLiBUaGlzIGlzIHRoZSBpbnZlcnNlIG9mIGdldFBpeGVsRm9yVmFsdWUNCgkJICogVGhlIGNvb3JkaW5hdGUgKDAsIDApIGlzIGF0IHRoZSB1cHBlci1sZWZ0IGNvcm5lciBvZiB0aGUgY2FudmFzDQoJCSAqIEBwYXJhbSBwaXhlbA0KCQkgKi8NCgkJZ2V0VmFsdWVGb3JQaXhlbDogaGVscGVycy5ub29wLA0KDQoJCS8qKg0KCQkgKiBSZXR1cm5zIHRoZSBsb2NhdGlvbiBvZiB0aGUgdGljayBhdCB0aGUgZ2l2ZW4gaW5kZXgNCgkJICogVGhlIGNvb3JkaW5hdGUgKDAsIDApIGlzIGF0IHRoZSB1cHBlci1sZWZ0IGNvcm5lciBvZiB0aGUgY2FudmFzDQoJCSAqLw0KCQlnZXRQaXhlbEZvclRpY2s6IGZ1bmN0aW9uKGluZGV4KSB7DQoJCQl2YXIgbWUgPSB0aGlzOw0KCQkJdmFyIG9mZnNldCA9IG1lLm9wdGlvbnMub2Zmc2V0Ow0KCQkJaWYgKG1lLmlzSG9yaXpvbnRhbCgpKSB7DQoJCQkJdmFyIGlubmVyV2lkdGggPSBtZS53aWR0aCAtIChtZS5wYWRkaW5nTGVmdCArIG1lLnBhZGRpbmdSaWdodCk7DQoJCQkJdmFyIHRpY2tXaWR0aCA9IGlubmVyV2lkdGggLyBNYXRoLm1heCgobWUuX3RpY2tzLmxlbmd0aCAtIChvZmZzZXQgPyAwIDogMSkpLCAxKTsNCgkJCQl2YXIgcGl4ZWwgPSAodGlja1dpZHRoICogaW5kZXgpICsgbWUucGFkZGluZ0xlZnQ7DQoNCgkJCQlpZiAob2Zmc2V0KSB7DQoJCQkJCXBpeGVsICs9IHRpY2tXaWR0aCAvIDI7DQoJCQkJfQ0KDQoJCQkJdmFyIGZpbmFsVmFsID0gbWUubGVmdCArIE1hdGgucm91bmQocGl4ZWwpOw0KCQkJCWZpbmFsVmFsICs9IG1lLmlzRnVsbFdpZHRoKCkgPyBtZS5tYXJnaW5zLmxlZnQgOiAwOw0KCQkJCXJldHVybiBmaW5hbFZhbDsNCgkJCX0NCgkJCXZhciBpbm5lckhlaWdodCA9IG1lLmhlaWdodCAtIChtZS5wYWRkaW5nVG9wICsgbWUucGFkZGluZ0JvdHRvbSk7DQoJCQlyZXR1cm4gbWUudG9wICsgKGluZGV4ICogKGlubmVySGVpZ2h0IC8gKG1lLl90aWNrcy5sZW5ndGggLSAxKSkpOw0KCQl9LA0KDQoJCS8qKg0KCQkgKiBVdGlsaXR5IGZvciBnZXR0aW5nIHRoZSBwaXhlbCBsb2NhdGlvbiBvZiBhIHBlcmNlbnRhZ2Ugb2Ygc2NhbGUNCgkJICogVGhlIGNvb3JkaW5hdGUgKDAsIDApIGlzIGF0IHRoZSB1cHBlci1sZWZ0IGNvcm5lciBvZiB0aGUgY2FudmFzDQoJCSAqLw0KCQlnZXRQaXhlbEZvckRlY2ltYWw6IGZ1bmN0aW9uKGRlY2ltYWwpIHsNCgkJCXZhciBtZSA9IHRoaXM7DQoJCQlpZiAobWUuaXNIb3Jpem9udGFsKCkpIHsNCgkJCQl2YXIgaW5uZXJXaWR0aCA9IG1lLndpZHRoIC0gKG1lLnBhZGRpbmdMZWZ0ICsgbWUucGFkZGluZ1JpZ2h0KTsNCgkJCQl2YXIgdmFsdWVPZmZzZXQgPSAoaW5uZXJXaWR0aCAqIGRlY2ltYWwpICsgbWUucGFkZGluZ0xlZnQ7DQoNCgkJCQl2YXIgZmluYWxWYWwgPSBtZS5sZWZ0ICsgTWF0aC5yb3VuZCh2YWx1ZU9mZnNldCk7DQoJCQkJZmluYWxWYWwgKz0gbWUuaXNGdWxsV2lkdGgoKSA/IG1lLm1hcmdpbnMubGVmdCA6IDA7DQoJCQkJcmV0dXJuIGZpbmFsVmFsOw0KCQkJfQ0KCQkJcmV0dXJuIG1lLnRvcCArIChkZWNpbWFsICogbWUuaGVpZ2h0KTsNCgkJfSwNCg0KCQkvKioNCgkJICogUmV0dXJucyB0aGUgcGl4ZWwgZm9yIHRoZSBtaW5pbXVtIGNoYXJ0IHZhbHVlDQoJCSAqIFRoZSBjb29yZGluYXRlICgwLCAwKSBpcyBhdCB0aGUgdXBwZXItbGVmdCBjb3JuZXIgb2YgdGhlIGNhbnZhcw0KCQkgKi8NCgkJZ2V0QmFzZVBpeGVsOiBmdW5jdGlvbigpIHsNCgkJCXJldHVybiB0aGlzLmdldFBpeGVsRm9yVmFsdWUodGhpcy5nZXRCYXNlVmFsdWUoKSk7DQoJCX0sDQoNCgkJZ2V0QmFzZVZhbHVlOiBmdW5jdGlvbigpIHsNCgkJCXZhciBtZSA9IHRoaXM7DQoJCQl2YXIgbWluID0gbWUubWluOw0KCQkJdmFyIG1heCA9IG1lLm1heDsNCg0KCQkJcmV0dXJuIG1lLmJlZ2luQXRaZXJvID8gMCA6DQoJCQkJbWluIDwgMCAmJiBtYXggPCAwID8gbWF4IDoNCgkJCQltaW4gPiAwICYmIG1heCA+IDAgPyBtaW4gOg0KCQkJCTA7DQoJCX0sDQoNCgkJLyoqDQoJCSAqIFJldHVybnMgYSBzdWJzZXQgb2YgdGlja3MgdG8gYmUgcGxvdHRlZCB0byBhdm9pZCBvdmVybGFwcGluZyBsYWJlbHMuDQoJCSAqIEBwcml2YXRlDQoJCSAqLw0KCQlfYXV0b1NraXA6IGZ1bmN0aW9uKHRpY2tzKSB7DQoJCQl2YXIgc2tpcFJhdGlvOw0KCQkJdmFyIG1lID0gdGhpczsNCgkJCXZhciBpc0hvcml6b250YWwgPSBtZS5pc0hvcml6b250YWwoKTsNCgkJCXZhciBvcHRpb25UaWNrcyA9IG1lLm9wdGlvbnMudGlja3MubWlub3I7DQoJCQl2YXIgdGlja0NvdW50ID0gdGlja3MubGVuZ3RoOw0KCQkJdmFyIGxhYmVsUm90YXRpb25SYWRpYW5zID0gaGVscGVycy50b1JhZGlhbnMobWUubGFiZWxSb3RhdGlvbik7DQoJCQl2YXIgY29zUm90YXRpb24gPSBNYXRoLmNvcyhsYWJlbFJvdGF0aW9uUmFkaWFucyk7DQoJCQl2YXIgbG9uZ2VzdFJvdGF0ZWRMYWJlbCA9IG1lLmxvbmdlc3RMYWJlbFdpZHRoICogY29zUm90YXRpb247DQoJCQl2YXIgcmVzdWx0ID0gW107DQoJCQl2YXIgaSwgdGljaywgc2hvdWxkU2tpcDsNCg0KCQkJLy8gZmlndXJlIG91dCB0aGUgbWF4aW11bSBudW1iZXIgb2YgZ3JpZGxpbmVzIHRvIHNob3cNCgkJCXZhciBtYXhUaWNrczsNCgkJCWlmIChvcHRpb25UaWNrcy5tYXhUaWNrc0xpbWl0KSB7DQoJCQkJbWF4VGlja3MgPSBvcHRpb25UaWNrcy5tYXhUaWNrc0xpbWl0Ow0KCQkJfQ0KDQoJCQlpZiAoaXNIb3Jpem9udGFsKSB7DQoJCQkJc2tpcFJhdGlvID0gZmFsc2U7DQoNCgkJCQlpZiAoKGxvbmdlc3RSb3RhdGVkTGFiZWwgKyBvcHRpb25UaWNrcy5hdXRvU2tpcFBhZGRpbmcpICogdGlja0NvdW50ID4gKG1lLndpZHRoIC0gKG1lLnBhZGRpbmdMZWZ0ICsgbWUucGFkZGluZ1JpZ2h0KSkpIHsNCgkJCQkJc2tpcFJhdGlvID0gMSArIE1hdGguZmxvb3IoKChsb25nZXN0Um90YXRlZExhYmVsICsgb3B0aW9uVGlja3MuYXV0b1NraXBQYWRkaW5nKSAqIHRpY2tDb3VudCkgLyAobWUud2lkdGggLSAobWUucGFkZGluZ0xlZnQgKyBtZS5wYWRkaW5nUmlnaHQpKSk7DQoJCQkJfQ0KDQoJCQkJLy8gaWYgdGhleSBkZWZpbmVkIGEgbWF4IG51bWJlciBvZiBvcHRpb25UaWNrcywNCgkJCQkvLyBpbmNyZWFzZSBza2lwUmF0aW8gdW50aWwgdGhhdCBudW1iZXIgaXMgbWV0DQoJCQkJaWYgKG1heFRpY2tzICYmIHRpY2tDb3VudCA+IG1heFRpY2tzKSB7DQoJCQkJCXNraXBSYXRpbyA9IE1hdGgubWF4KHNraXBSYXRpbywgTWF0aC5mbG9vcih0aWNrQ291bnQgLyBtYXhUaWNrcykpOw0KCQkJCX0NCgkJCX0NCg0KCQkJZm9yIChpID0gMDsgaSA8IHRpY2tDb3VudDsgaSsrKSB7DQoJCQkJdGljayA9IHRpY2tzW2ldOw0KDQoJCQkJLy8gU2luY2Ugd2UgYWx3YXlzIHNob3cgdGhlIGxhc3QgdGljayx3ZSBuZWVkIG1heSBuZWVkIHRvIGhpZGUgdGhlIGxhc3Qgc2hvd24gb25lIGJlZm9yZQ0KCQkJCXNob3VsZFNraXAgPSAoc2tpcFJhdGlvID4gMSAmJiBpICUgc2tpcFJhdGlvID4gMCkgfHwgKGkgJSBza2lwUmF0aW8gPT09IDAgJiYgaSArIHNraXBSYXRpbyA+PSB0aWNrQ291bnQpOw0KCQkJCWlmIChzaG91bGRTa2lwICYmIGkgIT09IHRpY2tDb3VudCAtIDEpIHsNCgkJCQkJLy8gbGVhdmUgdGljayBpbiBwbGFjZSBidXQgbWFrZSBzdXJlIGl0J3Mgbm90IGRpc3BsYXllZCAoIzQ2MzUpDQoJCQkJCWRlbGV0ZSB0aWNrLmxhYmVsOw0KCQkJCX0NCgkJCQlyZXN1bHQucHVzaCh0aWNrKTsNCgkJCX0NCgkJCXJldHVybiByZXN1bHQ7DQoJCX0sDQoNCgkJLy8gQWN0dWFsbHkgZHJhdyB0aGUgc2NhbGUgb24gdGhlIGNhbnZhcw0KCQkvLyBAcGFyYW0ge3JlY3RhbmdsZX0gY2hhcnRBcmVhIDogdGhlIGFyZWEgb2YgdGhlIGNoYXJ0IHRvIGRyYXcgZnVsbCBncmlkIGxpbmVzIG9uDQoJCWRyYXc6IGZ1bmN0aW9uKGNoYXJ0QXJlYSkgew0KCQkJdmFyIG1lID0gdGhpczsNCgkJCXZhciBvcHRpb25zID0gbWUub3B0aW9uczsNCgkJCWlmICghb3B0aW9ucy5kaXNwbGF5KSB7DQoJCQkJcmV0dXJuOw0KCQkJfQ0KDQoJCQl2YXIgY29udGV4dCA9IG1lLmN0eDsNCgkJCXZhciBnbG9iYWxEZWZhdWx0cyA9IGRlZmF1bHRzLmdsb2JhbDsNCgkJCXZhciBvcHRpb25UaWNrcyA9IG9wdGlvbnMudGlja3MubWlub3I7DQoJCQl2YXIgb3B0aW9uTWFqb3JUaWNrcyA9IG9wdGlvbnMudGlja3MubWFqb3IgfHwgb3B0aW9uVGlja3M7DQoJCQl2YXIgZ3JpZExpbmVzID0gb3B0aW9ucy5ncmlkTGluZXM7DQoJCQl2YXIgc2NhbGVMYWJlbCA9IG9wdGlvbnMuc2NhbGVMYWJlbDsNCg0KCQkJdmFyIGlzUm90YXRlZCA9IG1lLmxhYmVsUm90YXRpb24gIT09IDA7DQoJCQl2YXIgaXNIb3Jpem9udGFsID0gbWUuaXNIb3Jpem9udGFsKCk7DQoNCgkJCXZhciB0aWNrcyA9IG9wdGlvblRpY2tzLmF1dG9Ta2lwID8gbWUuX2F1dG9Ta2lwKG1lLmdldFRpY2tzKCkpIDogbWUuZ2V0VGlja3MoKTsNCgkJCXZhciB0aWNrRm9udENvbG9yID0gaGVscGVycy52YWx1ZU9yRGVmYXVsdChvcHRpb25UaWNrcy5mb250Q29sb3IsIGdsb2JhbERlZmF1bHRzLmRlZmF1bHRGb250Q29sb3IpOw0KCQkJdmFyIHRpY2tGb250ID0gcGFyc2VGb250T3B0aW9ucyhvcHRpb25UaWNrcyk7DQoJCQl2YXIgbWFqb3JUaWNrRm9udENvbG9yID0gaGVscGVycy52YWx1ZU9yRGVmYXVsdChvcHRpb25NYWpvclRpY2tzLmZvbnRDb2xvciwgZ2xvYmFsRGVmYXVsdHMuZGVmYXVsdEZvbnRDb2xvcik7DQoJCQl2YXIgbWFqb3JUaWNrRm9udCA9IHBhcnNlRm9udE9wdGlvbnMob3B0aW9uTWFqb3JUaWNrcyk7DQoNCgkJCXZhciB0bCA9IGdyaWRMaW5lcy5kcmF3VGlja3MgPyBncmlkTGluZXMudGlja01hcmtMZW5ndGggOiAwOw0KDQoJCQl2YXIgc2NhbGVMYWJlbEZvbnRDb2xvciA9IGhlbHBlcnMudmFsdWVPckRlZmF1bHQoc2NhbGVMYWJlbC5mb250Q29sb3IsIGdsb2JhbERlZmF1bHRzLmRlZmF1bHRGb250Q29sb3IpOw0KCQkJdmFyIHNjYWxlTGFiZWxGb250ID0gcGFyc2VGb250T3B0aW9ucyhzY2FsZUxhYmVsKTsNCgkJCXZhciBzY2FsZUxhYmVsUGFkZGluZyA9IGhlbHBlcnMub3B0aW9ucy50b1BhZGRpbmcoc2NhbGVMYWJlbC5wYWRkaW5nKTsNCgkJCXZhciBsYWJlbFJvdGF0aW9uUmFkaWFucyA9IGhlbHBlcnMudG9SYWRpYW5zKG1lLmxhYmVsUm90YXRpb24pOw0KDQoJCQl2YXIgaXRlbXNUb0RyYXcgPSBbXTsNCg0KCQkJdmFyIHhUaWNrU3RhcnQgPSBvcHRpb25zLnBvc2l0aW9uID09PSAncmlnaHQnID8gbWUubGVmdCA6IG1lLnJpZ2h0IC0gdGw7DQoJCQl2YXIgeFRpY2tFbmQgPSBvcHRpb25zLnBvc2l0aW9uID09PSAncmlnaHQnID8gbWUubGVmdCArIHRsIDogbWUucmlnaHQ7DQoJCQl2YXIgeVRpY2tTdGFydCA9IG9wdGlvbnMucG9zaXRpb24gPT09ICdib3R0b20nID8gbWUudG9wIDogbWUuYm90dG9tIC0gdGw7DQoJCQl2YXIgeVRpY2tFbmQgPSBvcHRpb25zLnBvc2l0aW9uID09PSAnYm90dG9tJyA/IG1lLnRvcCArIHRsIDogbWUuYm90dG9tOw0KDQoJCQloZWxwZXJzLmVhY2godGlja3MsIGZ1bmN0aW9uKHRpY2ssIGluZGV4KSB7DQoJCQkJLy8gYXV0b3NraXBwZXIgc2tpcHBlZCB0aGlzIHRpY2sgKCM0NjM1KQ0KCQkJCWlmIChoZWxwZXJzLmlzTnVsbE9yVW5kZWYodGljay5sYWJlbCkpIHsNCgkJCQkJcmV0dXJuOw0KCQkJCX0NCg0KCQkJCXZhciBsYWJlbCA9IHRpY2subGFiZWw7DQoJCQkJdmFyIGxpbmVXaWR0aCwgbGluZUNvbG9yLCBib3JkZXJEYXNoLCBib3JkZXJEYXNoT2Zmc2V0Ow0KCQkJCWlmIChpbmRleCA9PT0gbWUuemVyb0xpbmVJbmRleCAmJiBvcHRpb25zLm9mZnNldCA9PT0gZ3JpZExpbmVzLm9mZnNldEdyaWRMaW5lcykgew0KCQkJCQkvLyBEcmF3IHRoZSBmaXJzdCBpbmRleCBzcGVjaWFsbHkNCgkJCQkJbGluZVdpZHRoID0gZ3JpZExpbmVzLnplcm9MaW5lV2lkdGg7DQoJCQkJCWxpbmVDb2xvciA9IGdyaWRMaW5lcy56ZXJvTGluZUNvbG9yOw0KCQkJCQlib3JkZXJEYXNoID0gZ3JpZExpbmVzLnplcm9MaW5lQm9yZGVyRGFzaDsNCgkJCQkJYm9yZGVyRGFzaE9mZnNldCA9IGdyaWRMaW5lcy56ZXJvTGluZUJvcmRlckRhc2hPZmZzZXQ7DQoJCQkJfSBlbHNlIHsNCgkJCQkJbGluZVdpZHRoID0gaGVscGVycy52YWx1ZUF0SW5kZXhPckRlZmF1bHQoZ3JpZExpbmVzLmxpbmVXaWR0aCwgaW5kZXgpOw0KCQkJCQlsaW5lQ29sb3IgPSBoZWxwZXJzLnZhbHVlQXRJbmRleE9yRGVmYXVsdChncmlkTGluZXMuY29sb3IsIGluZGV4KTsNCgkJCQkJYm9yZGVyRGFzaCA9IGhlbHBlcnMudmFsdWVPckRlZmF1bHQoZ3JpZExpbmVzLmJvcmRlckRhc2gsIGdsb2JhbERlZmF1bHRzLmJvcmRlckRhc2gpOw0KCQkJCQlib3JkZXJEYXNoT2Zmc2V0ID0gaGVscGVycy52YWx1ZU9yRGVmYXVsdChncmlkTGluZXMuYm9yZGVyRGFzaE9mZnNldCwgZ2xvYmFsRGVmYXVsdHMuYm9yZGVyRGFzaE9mZnNldCk7DQoJCQkJfQ0KDQoJCQkJLy8gQ29tbW9uIHByb3BlcnRpZXMNCgkJCQl2YXIgdHgxLCB0eTEsIHR4MiwgdHkyLCB4MSwgeTEsIHgyLCB5MiwgbGFiZWxYLCBsYWJlbFk7DQoJCQkJdmFyIHRleHRBbGlnbiA9ICdtaWRkbGUnOw0KCQkJCXZhciB0ZXh0QmFzZWxpbmUgPSAnbWlkZGxlJzsNCgkJCQl2YXIgdGlja1BhZGRpbmcgPSBvcHRpb25UaWNrcy5wYWRkaW5nOw0KDQoJCQkJaWYgKGlzSG9yaXpvbnRhbCkgew0KCQkJCQl2YXIgbGFiZWxZT2Zmc2V0ID0gdGwgKyB0aWNrUGFkZGluZzsNCg0KCQkJCQlpZiAob3B0aW9ucy5wb3NpdGlvbiA9PT0gJ2JvdHRvbScpIHsNCgkJCQkJCS8vIGJvdHRvbQ0KCQkJCQkJdGV4dEJhc2VsaW5lID0gIWlzUm90YXRlZCA/ICd0b3AnIDogJ21pZGRsZSc7DQoJCQkJCQl0ZXh0QWxpZ24gPSAhaXNSb3RhdGVkID8gJ2NlbnRlcicgOiAncmlnaHQnOw0KCQkJCQkJbGFiZWxZID0gbWUudG9wICsgbGFiZWxZT2Zmc2V0Ow0KCQkJCQl9IGVsc2Ugew0KCQkJCQkJLy8gdG9wDQoJCQkJCQl0ZXh0QmFzZWxpbmUgPSAhaXNSb3RhdGVkID8gJ2JvdHRvbScgOiAnbWlkZGxlJzsNCgkJCQkJCXRleHRBbGlnbiA9ICFpc1JvdGF0ZWQgPyAnY2VudGVyJyA6ICdsZWZ0JzsNCgkJCQkJCWxhYmVsWSA9IG1lLmJvdHRvbSAtIGxhYmVsWU9mZnNldDsNCgkJCQkJfQ0KDQoJCQkJCXZhciB4TGluZVZhbHVlID0gZ2V0TGluZVZhbHVlKG1lLCBpbmRleCwgZ3JpZExpbmVzLm9mZnNldEdyaWRMaW5lcyAmJiB0aWNrcy5sZW5ndGggPiAxKTsNCgkJCQkJaWYgKHhMaW5lVmFsdWUgPCBtZS5sZWZ0KSB7DQoJCQkJCQlsaW5lQ29sb3IgPSAncmdiYSgwLDAsMCwwKSc7DQoJCQkJCX0NCgkJCQkJeExpbmVWYWx1ZSArPSBoZWxwZXJzLmFsaWFzUGl4ZWwobGluZVdpZHRoKTsNCg0KCQkJCQlsYWJlbFggPSBtZS5nZXRQaXhlbEZvclRpY2soaW5kZXgpICsgb3B0aW9uVGlja3MubGFiZWxPZmZzZXQ7IC8vIHggdmFsdWVzIGZvciBvcHRpb25UaWNrcyAobmVlZCB0byBjb25zaWRlciBvZmZzZXRMYWJlbCBvcHRpb24pDQoNCgkJCQkJdHgxID0gdHgyID0geDEgPSB4MiA9IHhMaW5lVmFsdWU7DQoJCQkJCXR5MSA9IHlUaWNrU3RhcnQ7DQoJCQkJCXR5MiA9IHlUaWNrRW5kOw0KCQkJCQl5MSA9IGNoYXJ0QXJlYS50b3A7DQoJCQkJCXkyID0gY2hhcnRBcmVhLmJvdHRvbTsNCgkJCQl9IGVsc2Ugew0KCQkJCQl2YXIgaXNMZWZ0ID0gb3B0aW9ucy5wb3NpdGlvbiA9PT0gJ2xlZnQnOw0KCQkJCQl2YXIgbGFiZWxYT2Zmc2V0Ow0KDQoJCQkJCWlmIChvcHRpb25UaWNrcy5taXJyb3IpIHsNCgkJCQkJCXRleHRBbGlnbiA9IGlzTGVmdCA/ICdsZWZ0JyA6ICdyaWdodCc7DQoJCQkJCQlsYWJlbFhPZmZzZXQgPSB0aWNrUGFkZGluZzsNCgkJCQkJfSBlbHNlIHsNCgkJCQkJCXRleHRBbGlnbiA9IGlzTGVmdCA/ICdyaWdodCcgOiAnbGVmdCc7DQoJCQkJCQlsYWJlbFhPZmZzZXQgPSB0bCArIHRpY2tQYWRkaW5nOw0KCQkJCQl9DQoNCgkJCQkJbGFiZWxYID0gaXNMZWZ0ID8gbWUucmlnaHQgLSBsYWJlbFhPZmZzZXQgOiBtZS5sZWZ0ICsgbGFiZWxYT2Zmc2V0Ow0KDQoJCQkJCXZhciB5TGluZVZhbHVlID0gZ2V0TGluZVZhbHVlKG1lLCBpbmRleCwgZ3JpZExpbmVzLm9mZnNldEdyaWRMaW5lcyAmJiB0aWNrcy5sZW5ndGggPiAxKTsNCgkJCQkJaWYgKHlMaW5lVmFsdWUgPCBtZS50b3ApIHsNCgkJCQkJCWxpbmVDb2xvciA9ICdyZ2JhKDAsMCwwLDApJzsNCgkJCQkJfQ0KCQkJCQl5TGluZVZhbHVlICs9IGhlbHBlcnMuYWxpYXNQaXhlbChsaW5lV2lkdGgpOw0KDQoJCQkJCWxhYmVsWSA9IG1lLmdldFBpeGVsRm9yVGljayhpbmRleCkgKyBvcHRpb25UaWNrcy5sYWJlbE9mZnNldDsNCg0KCQkJCQl0eDEgPSB4VGlja1N0YXJ0Ow0KCQkJCQl0eDIgPSB4VGlja0VuZDsNCgkJCQkJeDEgPSBjaGFydEFyZWEubGVmdDsNCgkJCQkJeDIgPSBjaGFydEFyZWEucmlnaHQ7DQoJCQkJCXR5MSA9IHR5MiA9IHkxID0geTIgPSB5TGluZVZhbHVlOw0KCQkJCX0NCg0KCQkJCWl0ZW1zVG9EcmF3LnB1c2goew0KCQkJCQl0eDE6IHR4MSwNCgkJCQkJdHkxOiB0eTEsDQoJCQkJCXR4MjogdHgyLA0KCQkJCQl0eTI6IHR5MiwNCgkJCQkJeDE6IHgxLA0KCQkJCQl5MTogeTEsDQoJCQkJCXgyOiB4MiwNCgkJCQkJeTI6IHkyLA0KCQkJCQlsYWJlbFg6IGxhYmVsWCwNCgkJCQkJbGFiZWxZOiBsYWJlbFksDQoJCQkJCWdsV2lkdGg6IGxpbmVXaWR0aCwNCgkJCQkJZ2xDb2xvcjogbGluZUNvbG9yLA0KCQkJCQlnbEJvcmRlckRhc2g6IGJvcmRlckRhc2gsDQoJCQkJCWdsQm9yZGVyRGFzaE9mZnNldDogYm9yZGVyRGFzaE9mZnNldCwNCgkJCQkJcm90YXRpb246IC0xICogbGFiZWxSb3RhdGlvblJhZGlhbnMsDQoJCQkJCWxhYmVsOiBsYWJlbCwNCgkJCQkJbWFqb3I6IHRpY2subWFqb3IsDQoJCQkJCXRleHRCYXNlbGluZTogdGV4dEJhc2VsaW5lLA0KCQkJCQl0ZXh0QWxpZ246IHRleHRBbGlnbg0KCQkJCX0pOw0KCQkJfSk7DQoNCgkJCS8vIERyYXcgYWxsIG9mIHRoZSB0aWNrIGxhYmVscywgdGljayBtYXJrcywgYW5kIGdyaWQgbGluZXMgYXQgdGhlIGNvcnJlY3QgcGxhY2VzDQoJCQloZWxwZXJzLmVhY2goaXRlbXNUb0RyYXcsIGZ1bmN0aW9uKGl0ZW1Ub0RyYXcpIHsNCgkJCQlpZiAoZ3JpZExpbmVzLmRpc3BsYXkpIHsNCgkJCQkJY29udGV4dC5zYXZlKCk7DQoJCQkJCWNvbnRleHQubGluZVdpZHRoID0gaXRlbVRvRHJhdy5nbFdpZHRoOw0KCQkJCQljb250ZXh0LnN0cm9rZVN0eWxlID0gaXRlbVRvRHJhdy5nbENvbG9yOw0KCQkJCQlpZiAoY29udGV4dC5zZXRMaW5lRGFzaCkgew0KCQkJCQkJY29udGV4dC5zZXRMaW5lRGFzaChpdGVtVG9EcmF3LmdsQm9yZGVyRGFzaCk7DQoJCQkJCQljb250ZXh0LmxpbmVEYXNoT2Zmc2V0ID0gaXRlbVRvRHJhdy5nbEJvcmRlckRhc2hPZmZzZXQ7DQoJCQkJCX0NCg0KCQkJCQljb250ZXh0LmJlZ2luUGF0aCgpOw0KDQoJCQkJCWlmIChncmlkTGluZXMuZHJhd1RpY2tzKSB7DQoJCQkJCQljb250ZXh0Lm1vdmVUbyhpdGVtVG9EcmF3LnR4MSwgaXRlbVRvRHJhdy50eTEpOw0KCQkJCQkJY29udGV4dC5saW5lVG8oaXRlbVRvRHJhdy50eDIsIGl0ZW1Ub0RyYXcudHkyKTsNCgkJCQkJfQ0KDQoJCQkJCWlmIChncmlkTGluZXMuZHJhd09uQ2hhcnRBcmVhKSB7DQoJCQkJCQljb250ZXh0Lm1vdmVUbyhpdGVtVG9EcmF3LngxLCBpdGVtVG9EcmF3LnkxKTsNCgkJCQkJCWNvbnRleHQubGluZVRvKGl0ZW1Ub0RyYXcueDIsIGl0ZW1Ub0RyYXcueTIpOw0KCQkJCQl9DQoNCgkJCQkJY29udGV4dC5zdHJva2UoKTsNCgkJCQkJY29udGV4dC5yZXN0b3JlKCk7DQoJCQkJfQ0KDQoJCQkJaWYgKG9wdGlvblRpY2tzLmRpc3BsYXkpIHsNCgkJCQkJLy8gTWFrZSBzdXJlIHdlIGRyYXcgdGV4dCBpbiB0aGUgY29ycmVjdCBjb2xvciBhbmQgZm9udA0KCQkJCQljb250ZXh0LnNhdmUoKTsNCgkJCQkJY29udGV4dC50cmFuc2xhdGUoaXRlbVRvRHJhdy5sYWJlbFgsIGl0ZW1Ub0RyYXcubGFiZWxZKTsNCgkJCQkJY29udGV4dC5yb3RhdGUoaXRlbVRvRHJhdy5yb3RhdGlvbik7DQoJCQkJCWNvbnRleHQuZm9udCA9IGl0ZW1Ub0RyYXcubWFqb3IgPyBtYWpvclRpY2tGb250LmZvbnQgOiB0aWNrRm9udC5mb250Ow0KCQkJCQljb250ZXh0LmZpbGxTdHlsZSA9IGl0ZW1Ub0RyYXcubWFqb3IgPyBtYWpvclRpY2tGb250Q29sb3IgOiB0aWNrRm9udENvbG9yOw0KCQkJCQljb250ZXh0LnRleHRCYXNlbGluZSA9IGl0ZW1Ub0RyYXcudGV4dEJhc2VsaW5lOw0KCQkJCQljb250ZXh0LnRleHRBbGlnbiA9IGl0ZW1Ub0RyYXcudGV4dEFsaWduOw0KDQoJCQkJCXZhciBsYWJlbCA9IGl0ZW1Ub0RyYXcubGFiZWw7DQoJCQkJCWlmIChoZWxwZXJzLmlzQXJyYXkobGFiZWwpKSB7DQoJCQkJCQlmb3IgKHZhciBpID0gMCwgeSA9IDA7IGkgPCBsYWJlbC5sZW5ndGg7ICsraSkgew0KCQkJCQkJCS8vIFdlIGp1c3QgbWFrZSBzdXJlIHRoZSBtdWx0aWxpbmUgZWxlbWVudCBpcyBhIHN0cmluZyBoZXJlLi4NCgkJCQkJCQljb250ZXh0LmZpbGxUZXh0KCcnICsgbGFiZWxbaV0sIDAsIHkpOw0KCQkJCQkJCS8vIGFwcGx5IHNhbWUgbGluZVNwYWNpbmcgYXMgY2FsY3VsYXRlZCBAIEwjMzIwDQoJCQkJCQkJeSArPSAodGlja0ZvbnQuc2l6ZSAqIDEuNSk7DQoJCQkJCQl9DQoJCQkJCX0gZWxzZSB7DQoJCQkJCQljb250ZXh0LmZpbGxUZXh0KGxhYmVsLCAwLCAwKTsNCgkJCQkJfQ0KCQkJCQljb250ZXh0LnJlc3RvcmUoKTsNCgkJCQl9DQoJCQl9KTsNCg0KCQkJaWYgKHNjYWxlTGFiZWwuZGlzcGxheSkgew0KCQkJCS8vIERyYXcgdGhlIHNjYWxlIGxhYmVsDQoJCQkJdmFyIHNjYWxlTGFiZWxYOw0KCQkJCXZhciBzY2FsZUxhYmVsWTsNCgkJCQl2YXIgcm90YXRpb24gPSAwOw0KCQkJCXZhciBoYWxmTGluZUhlaWdodCA9IHBhcnNlTGluZUhlaWdodChzY2FsZUxhYmVsKSAvIDI7DQoNCgkJCQlpZiAoaXNIb3Jpem9udGFsKSB7DQoJCQkJCXNjYWxlTGFiZWxYID0gbWUubGVmdCArICgobWUucmlnaHQgLSBtZS5sZWZ0KSAvIDIpOyAvLyBtaWRwb2ludCBvZiB0aGUgd2lkdGgNCgkJCQkJc2NhbGVMYWJlbFkgPSBvcHRpb25zLnBvc2l0aW9uID09PSAnYm90dG9tJw0KCQkJCQkJPyBtZS5ib3R0b20gLSBoYWxmTGluZUhlaWdodCAtIHNjYWxlTGFiZWxQYWRkaW5nLmJvdHRvbQ0KCQkJCQkJOiBtZS50b3AgKyBoYWxmTGluZUhlaWdodCArIHNjYWxlTGFiZWxQYWRkaW5nLnRvcDsNCgkJCQl9IGVsc2Ugew0KCQkJCQl2YXIgaXNMZWZ0ID0gb3B0aW9ucy5wb3NpdGlvbiA9PT0gJ2xlZnQnOw0KCQkJCQlzY2FsZUxhYmVsWCA9IGlzTGVmdA0KCQkJCQkJPyBtZS5sZWZ0ICsgaGFsZkxpbmVIZWlnaHQgKyBzY2FsZUxhYmVsUGFkZGluZy50b3ANCgkJCQkJCTogbWUucmlnaHQgLSBoYWxmTGluZUhlaWdodCAtIHNjYWxlTGFiZWxQYWRkaW5nLnRvcDsNCgkJCQkJc2NhbGVMYWJlbFkgPSBtZS50b3AgKyAoKG1lLmJvdHRvbSAtIG1lLnRvcCkgLyAyKTsNCgkJCQkJcm90YXRpb24gPSBpc0xlZnQgPyAtMC41ICogTWF0aC5QSSA6IDAuNSAqIE1hdGguUEk7DQoJCQkJfQ0KDQoJCQkJY29udGV4dC5zYXZlKCk7DQoJCQkJY29udGV4dC50cmFuc2xhdGUoc2NhbGVMYWJlbFgsIHNjYWxlTGFiZWxZKTsNCgkJCQljb250ZXh0LnJvdGF0ZShyb3RhdGlvbik7DQoJCQkJY29udGV4dC50ZXh0QWxpZ24gPSAnY2VudGVyJzsNCgkJCQljb250ZXh0LnRleHRCYXNlbGluZSA9ICdtaWRkbGUnOw0KCQkJCWNvbnRleHQuZmlsbFN0eWxlID0gc2NhbGVMYWJlbEZvbnRDb2xvcjsgLy8gcmVuZGVyIGluIGNvcnJlY3QgY29sb3VyDQoJCQkJY29udGV4dC5mb250ID0gc2NhbGVMYWJlbEZvbnQuZm9udDsNCgkJCQljb250ZXh0LmZpbGxUZXh0KHNjYWxlTGFiZWwubGFiZWxTdHJpbmcsIDAsIDApOw0KCQkJCWNvbnRleHQucmVzdG9yZSgpOw0KCQkJfQ0KDQoJCQlpZiAoZ3JpZExpbmVzLmRyYXdCb3JkZXIpIHsNCgkJCQkvLyBEcmF3IHRoZSBsaW5lIGF0IHRoZSBlZGdlIG9mIHRoZSBheGlzDQoJCQkJY29udGV4dC5saW5lV2lkdGggPSBoZWxwZXJzLnZhbHVlQXRJbmRleE9yRGVmYXVsdChncmlkTGluZXMubGluZVdpZHRoLCAwKTsNCgkJCQljb250ZXh0LnN0cm9rZVN0eWxlID0gaGVscGVycy52YWx1ZUF0SW5kZXhPckRlZmF1bHQoZ3JpZExpbmVzLmNvbG9yLCAwKTsNCgkJCQl2YXIgeDEgPSBtZS5sZWZ0Ow0KCQkJCXZhciB4MiA9IG1lLnJpZ2h0Ow0KCQkJCXZhciB5MSA9IG1lLnRvcDsNCgkJCQl2YXIgeTIgPSBtZS5ib3R0b207DQoNCgkJCQl2YXIgYWxpYXNQaXhlbCA9IGhlbHBlcnMuYWxpYXNQaXhlbChjb250ZXh0LmxpbmVXaWR0aCk7DQoJCQkJaWYgKGlzSG9yaXpvbnRhbCkgew0KCQkJCQl5MSA9IHkyID0gb3B0aW9ucy5wb3NpdGlvbiA9PT0gJ3RvcCcgPyBtZS5ib3R0b20gOiBtZS50b3A7DQoJCQkJCXkxICs9IGFsaWFzUGl4ZWw7DQoJCQkJCXkyICs9IGFsaWFzUGl4ZWw7DQoJCQkJfSBlbHNlIHsNCgkJCQkJeDEgPSB4MiA9IG9wdGlvbnMucG9zaXRpb24gPT09ICdsZWZ0JyA/IG1lLnJpZ2h0IDogbWUubGVmdDsNCgkJCQkJeDEgKz0gYWxpYXNQaXhlbDsNCgkJCQkJeDIgKz0gYWxpYXNQaXhlbDsNCgkJCQl9DQoNCgkJCQljb250ZXh0LmJlZ2luUGF0aCgpOw0KCQkJCWNvbnRleHQubW92ZVRvKHgxLCB5MSk7DQoJCQkJY29udGV4dC5saW5lVG8oeDIsIHkyKTsNCgkJCQljb250ZXh0LnN0cm9rZSgpOw0KCQkJfQ0KCQl9DQoJfSk7DQp9Ow0KDQp9LHsiMjUiOjI1LCIyNiI6MjYsIjM0IjozNCwiNDUiOjQ1fV0sMzM6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpew0KJ3VzZSBzdHJpY3QnOw0KDQp2YXIgZGVmYXVsdHMgPSByZXF1aXJlKDI1KTsNCnZhciBoZWxwZXJzID0gcmVxdWlyZSg0NSk7DQoNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oQ2hhcnQpIHsNCg0KCUNoYXJ0LnNjYWxlU2VydmljZSA9IHsNCgkJLy8gU2NhbGUgcmVnaXN0cmF0aW9uIG9iamVjdC4gRXh0ZW5zaW9ucyBjYW4gcmVnaXN0ZXIgbmV3IHNjYWxlIHR5cGVzIChzdWNoIGFzIGxvZyBvciBEQiBzY2FsZXMpIGFuZCB0aGVuDQoJCS8vIHVzZSB0aGUgbmV3IGNoYXJ0IG9wdGlvbnMgdG8gZ3JhYiB0aGUgY29ycmVjdCBzY2FsZQ0KCQljb25zdHJ1Y3RvcnM6IHt9LA0KCQkvLyBVc2UgYSByZWdpc3RyYXRpb24gZnVuY3Rpb24gc28gdGhhdCB3ZSBjYW4gbW92ZSB0byBhbiBFUzYgbWFwIHdoZW4gd2Ugbm8gbG9uZ2VyIG5lZWQgdG8gc3VwcG9ydA0KCQkvLyBvbGQgYnJvd3NlcnMNCg0KCQkvLyBTY2FsZSBjb25maWcgZGVmYXVsdHMNCgkJZGVmYXVsdHM6IHt9LA0KCQlyZWdpc3RlclNjYWxlVHlwZTogZnVuY3Rpb24odHlwZSwgc2NhbGVDb25zdHJ1Y3Rvciwgc2NhbGVEZWZhdWx0cykgew0KCQkJdGhpcy5jb25zdHJ1Y3RvcnNbdHlwZV0gPSBzY2FsZUNvbnN0cnVjdG9yOw0KCQkJdGhpcy5kZWZhdWx0c1t0eXBlXSA9IGhlbHBlcnMuY2xvbmUoc2NhbGVEZWZhdWx0cyk7DQoJCX0sDQoJCWdldFNjYWxlQ29uc3RydWN0b3I6IGZ1bmN0aW9uKHR5cGUpIHsNCgkJCXJldHVybiB0aGlzLmNvbnN0cnVjdG9ycy5oYXNPd25Qcm9wZXJ0eSh0eXBlKSA/IHRoaXMuY29uc3RydWN0b3JzW3R5cGVdIDogdW5kZWZpbmVkOw0KCQl9LA0KCQlnZXRTY2FsZURlZmF1bHRzOiBmdW5jdGlvbih0eXBlKSB7DQoJCQkvLyBSZXR1cm4gdGhlIHNjYWxlIGRlZmF1bHRzIG1lcmdlZCB3aXRoIHRoZSBnbG9iYWwgc2V0dGluZ3Mgc28gdGhhdCB3ZSBhbHdheXMgdXNlIHRoZSBsYXRlc3Qgb25lcw0KCQkJcmV0dXJuIHRoaXMuZGVmYXVsdHMuaGFzT3duUHJvcGVydHkodHlwZSkgPyBoZWxwZXJzLm1lcmdlKHt9LCBbZGVmYXVsdHMuc2NhbGUsIHRoaXMuZGVmYXVsdHNbdHlwZV1dKSA6IHt9Ow0KCQl9LA0KCQl1cGRhdGVTY2FsZURlZmF1bHRzOiBmdW5jdGlvbih0eXBlLCBhZGRpdGlvbnMpIHsNCgkJCXZhciBtZSA9IHRoaXM7DQoJCQlpZiAobWUuZGVmYXVsdHMuaGFzT3duUHJvcGVydHkodHlwZSkpIHsNCgkJCQltZS5kZWZhdWx0c1t0eXBlXSA9IGhlbHBlcnMuZXh0ZW5kKG1lLmRlZmF1bHRzW3R5cGVdLCBhZGRpdGlvbnMpOw0KCQkJfQ0KCQl9LA0KCQlhZGRTY2FsZXNUb0xheW91dDogZnVuY3Rpb24oY2hhcnQpIHsNCgkJCS8vIEFkZHMgZWFjaCBzY2FsZSB0byB0aGUgY2hhcnQuYm94ZXMgYXJyYXkgdG8gYmUgc2l6ZWQgYWNjb3JkaW5nbHkNCgkJCWhlbHBlcnMuZWFjaChjaGFydC5zY2FsZXMsIGZ1bmN0aW9uKHNjYWxlKSB7DQoJCQkJLy8gU2V0IElMYXlvdXRJdGVtIHBhcmFtZXRlcnMgZm9yIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5DQoJCQkJc2NhbGUuZnVsbFdpZHRoID0gc2NhbGUub3B0aW9ucy5mdWxsV2lkdGg7DQoJCQkJc2NhbGUucG9zaXRpb24gPSBzY2FsZS5vcHRpb25zLnBvc2l0aW9uOw0KCQkJCXNjYWxlLndlaWdodCA9IHNjYWxlLm9wdGlvbnMud2VpZ2h0Ow0KCQkJCUNoYXJ0LmxheW91dFNlcnZpY2UuYWRkQm94KGNoYXJ0LCBzY2FsZSk7DQoJCQl9KTsNCgkJfQ0KCX07DQp9Ow0KDQp9LHsiMjUiOjI1LCI0NSI6NDV9XSwzNDpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7DQondXNlIHN0cmljdCc7DQoNCnZhciBoZWxwZXJzID0gcmVxdWlyZSg0NSk7DQoNCi8qKg0KICogTmFtZXNwYWNlIHRvIGhvbGQgc3RhdGljIHRpY2sgZ2VuZXJhdGlvbiBmdW5jdGlvbnMNCiAqIEBuYW1lc3BhY2UgQ2hhcnQuVGlja3MNCiAqLw0KbW9kdWxlLmV4cG9ydHMgPSB7DQoJLyoqDQoJICogTmFtZXNwYWNlIHRvIGhvbGQgZ2VuZXJhdG9ycyBmb3IgZGlmZmVyZW50IHR5cGVzIG9mIHRpY2tzDQoJICogQG5hbWVzcGFjZSBDaGFydC5UaWNrcy5nZW5lcmF0b3JzDQoJICovDQoJZ2VuZXJhdG9yczogew0KCQkvKioNCgkJICogSW50ZXJmYWNlIGZvciB0aGUgb3B0aW9ucyBwcm92aWRlZCB0byB0aGUgbnVtZXJpYyB0aWNrIGdlbmVyYXRvcg0KCQkgKiBAaW50ZXJmYWNlIElOdW1lcmljVGlja0dlbmVyYXRpb25PcHRpb25zDQoJCSAqLw0KCQkvKioNCgkJICogVGhlIG1heGltdW0gbnVtYmVyIG9mIHRpY2tzIHRvIGRpc3BsYXkNCgkJICogQG5hbWUgSU51bWVyaWNUaWNrR2VuZXJhdGlvbk9wdGlvbnMjbWF4VGlja3MNCgkJICogQHR5cGUgTnVtYmVyDQoJCSAqLw0KCQkvKioNCgkJICogVGhlIGRpc3RhbmNlIGJldHdlZW4gZWFjaCB0aWNrLg0KCQkgKiBAbmFtZSBJTnVtZXJpY1RpY2tHZW5lcmF0aW9uT3B0aW9ucyNzdGVwU2l6ZQ0KCQkgKiBAdHlwZSBOdW1iZXINCgkJICogQG9wdGlvbmFsDQoJCSAqLw0KCQkvKioNCgkJICogRm9yY2VkIG1pbmltdW0gZm9yIHRoZSB0aWNrcy4gSWYgbm90IHNwZWNpZmllZCwgdGhlIG1pbmltdW0gb2YgdGhlIGRhdGEgcmFuZ2UgaXMgdXNlZCB0byBjYWxjdWxhdGUgdGhlIHRpY2sgbWluaW11bQ0KCQkgKiBAbmFtZSBJTnVtZXJpY1RpY2tHZW5lcmF0aW9uT3B0aW9ucyNtaW4NCgkJICogQHR5cGUgTnVtYmVyDQoJCSAqIEBvcHRpb25hbA0KCQkgKi8NCgkJLyoqDQoJCSAqIFRoZSBtYXhpbXVtIHZhbHVlIG9mIHRoZSB0aWNrcy4gSWYgbm90IHNwZWNpZmllZCwgdGhlIG1heGltdW0gb2YgdGhlIGRhdGEgcmFuZ2UgaXMgdXNlZCB0byBjYWxjdWxhdGUgdGhlIHRpY2sgbWF4aW11bQ0KCQkgKiBAbmFtZSBJTnVtZXJpY1RpY2tHZW5lcmF0aW9uT3B0aW9ucyNtYXgNCgkJICogQHR5cGUgTnVtYmVyDQoJCSAqIEBvcHRpb25hbA0KCQkgKi8NCg0KCQkvKioNCgkJICogR2VuZXJhdGUgYSBzZXQgb2YgbGluZWFyIHRpY2tzDQoJCSAqIEBtZXRob2QgQ2hhcnQuVGlja3MuZ2VuZXJhdG9ycy5saW5lYXINCgkJICogQHBhcmFtIGdlbmVyYXRpb25PcHRpb25zIHtJTnVtZXJpY1RpY2tHZW5lcmF0aW9uT3B0aW9uc30gdGhlIG9wdGlvbnMgdXNlZCB0byBnZW5lcmF0ZSB0aGUgdGlja3MNCgkJICogQHBhcmFtIGRhdGFSYW5nZSB7SVJhbmdlfSB0aGUgcmFuZ2Ugb2YgdGhlIGRhdGENCgkJICogQHJldHVybnMge0FycmF5PE51bWJlcj59IGFycmF5IG9mIHRpY2sgdmFsdWVzDQoJCSAqLw0KCQlsaW5lYXI6IGZ1bmN0aW9uKGdlbmVyYXRpb25PcHRpb25zLCBkYXRhUmFuZ2UpIHsNCgkJCXZhciB0aWNrcyA9IFtdOw0KCQkJLy8gVG8gZ2V0IGEgIm5pY2UiIHZhbHVlIGZvciB0aGUgdGljayBzcGFjaW5nLCB3ZSB3aWxsIHVzZSB0aGUgYXBwcm9wcmlhdGVseSBuYW1lZA0KCQkJLy8gIm5pY2UgbnVtYmVyIiBhbGdvcml0aG0uIFNlZSBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzg1MDY4ODEvbmljZS1sYWJlbC1hbGdvcml0aG0tZm9yLWNoYXJ0cy13aXRoLW1pbmltdW0tdGlja3MNCgkJCS8vIGZvciBkZXRhaWxzLg0KDQoJCQl2YXIgc3BhY2luZzsNCgkJCWlmIChnZW5lcmF0aW9uT3B0aW9ucy5zdGVwU2l6ZSAmJiBnZW5lcmF0aW9uT3B0aW9ucy5zdGVwU2l6ZSA+IDApIHsNCgkJCQlzcGFjaW5nID0gZ2VuZXJhdGlvbk9wdGlvbnMuc3RlcFNpemU7DQoJCQl9IGVsc2Ugew0KCQkJCXZhciBuaWNlUmFuZ2UgPSBoZWxwZXJzLm5pY2VOdW0oZGF0YVJhbmdlLm1heCAtIGRhdGFSYW5nZS5taW4sIGZhbHNlKTsNCgkJCQlzcGFjaW5nID0gaGVscGVycy5uaWNlTnVtKG5pY2VSYW5nZSAvIChnZW5lcmF0aW9uT3B0aW9ucy5tYXhUaWNrcyAtIDEpLCB0cnVlKTsNCgkJCX0NCgkJCXZhciBuaWNlTWluID0gTWF0aC5mbG9vcihkYXRhUmFuZ2UubWluIC8gc3BhY2luZykgKiBzcGFjaW5nOw0KCQkJdmFyIG5pY2VNYXggPSBNYXRoLmNlaWwoZGF0YVJhbmdlLm1heCAvIHNwYWNpbmcpICogc3BhY2luZzsNCg0KCQkJLy8gSWYgbWluLCBtYXggYW5kIHN0ZXBTaXplIGlzIHNldCBhbmQgdGhleSBtYWtlIGFuIGV2ZW5seSBzcGFjZWQgc2NhbGUgdXNlIGl0Lg0KCQkJaWYgKGdlbmVyYXRpb25PcHRpb25zLm1pbiAmJiBnZW5lcmF0aW9uT3B0aW9ucy5tYXggJiYgZ2VuZXJhdGlvbk9wdGlvbnMuc3RlcFNpemUpIHsNCgkJCQkvLyBJZiB2ZXJ5IGNsb3NlIHRvIG91ciB3aG9sZSBudW1iZXIsIHVzZSBpdC4NCgkJCQlpZiAoaGVscGVycy5hbG1vc3RXaG9sZSgoZ2VuZXJhdGlvbk9wdGlvbnMubWF4IC0gZ2VuZXJhdGlvbk9wdGlvbnMubWluKSAvIGdlbmVyYXRpb25PcHRpb25zLnN0ZXBTaXplLCBzcGFjaW5nIC8gMTAwMCkpIHsNCgkJCQkJbmljZU1pbiA9IGdlbmVyYXRpb25PcHRpb25zLm1pbjsNCgkJCQkJbmljZU1heCA9IGdlbmVyYXRpb25PcHRpb25zLm1heDsNCgkJCQl9DQoJCQl9DQoNCgkJCXZhciBudW1TcGFjZXMgPSAobmljZU1heCAtIG5pY2VNaW4pIC8gc3BhY2luZzsNCgkJCS8vIElmIHZlcnkgY2xvc2UgdG8gb3VyIHJvdW5kZWQgdmFsdWUsIHVzZSBpdC4NCgkJCWlmIChoZWxwZXJzLmFsbW9zdEVxdWFscyhudW1TcGFjZXMsIE1hdGgucm91bmQobnVtU3BhY2VzKSwgc3BhY2luZyAvIDEwMDApKSB7DQoJCQkJbnVtU3BhY2VzID0gTWF0aC5yb3VuZChudW1TcGFjZXMpOw0KCQkJfSBlbHNlIHsNCgkJCQludW1TcGFjZXMgPSBNYXRoLmNlaWwobnVtU3BhY2VzKTsNCgkJCX0NCg0KCQkJLy8gUHV0IHRoZSB2YWx1ZXMgaW50byB0aGUgdGlja3MgYXJyYXkNCgkJCXRpY2tzLnB1c2goZ2VuZXJhdGlvbk9wdGlvbnMubWluICE9PSB1bmRlZmluZWQgPyBnZW5lcmF0aW9uT3B0aW9ucy5taW4gOiBuaWNlTWluKTsNCgkJCWZvciAodmFyIGogPSAxOyBqIDwgbnVtU3BhY2VzOyArK2opIHsNCgkJCQl0aWNrcy5wdXNoKG5pY2VNaW4gKyAoaiAqIHNwYWNpbmcpKTsNCgkJCX0NCgkJCXRpY2tzLnB1c2goZ2VuZXJhdGlvbk9wdGlvbnMubWF4ICE9PSB1bmRlZmluZWQgPyBnZW5lcmF0aW9uT3B0aW9ucy5tYXggOiBuaWNlTWF4KTsNCg0KCQkJcmV0dXJuIHRpY2tzOw0KCQl9LA0KDQoJCS8qKg0KCQkgKiBHZW5lcmF0ZSBhIHNldCBvZiBsb2dhcml0aG1pYyB0aWNrcw0KCQkgKiBAbWV0aG9kIENoYXJ0LlRpY2tzLmdlbmVyYXRvcnMubG9nYXJpdGhtaWMNCgkJICogQHBhcmFtIGdlbmVyYXRpb25PcHRpb25zIHtJTnVtZXJpY1RpY2tHZW5lcmF0aW9uT3B0aW9uc30gdGhlIG9wdGlvbnMgdXNlZCB0byBnZW5lcmF0ZSB0aGUgdGlja3MNCgkJICogQHBhcmFtIGRhdGFSYW5nZSB7SVJhbmdlfSB0aGUgcmFuZ2Ugb2YgdGhlIGRhdGENCgkJICogQHJldHVybnMge0FycmF5PE51bWJlcj59IGFycmF5IG9mIHRpY2sgdmFsdWVzDQoJCSAqLw0KCQlsb2dhcml0aG1pYzogZnVuY3Rpb24oZ2VuZXJhdGlvbk9wdGlvbnMsIGRhdGFSYW5nZSkgew0KCQkJdmFyIHRpY2tzID0gW107DQoJCQl2YXIgdmFsdWVPckRlZmF1bHQgPSBoZWxwZXJzLnZhbHVlT3JEZWZhdWx0Ow0KDQoJCQkvLyBGaWd1cmUgb3V0IHdoYXQgdGhlIG1heCBudW1iZXIgb2YgdGlja3Mgd2UgY2FuIHN1cHBvcnQgaXQgaXMgYmFzZWQgb24gdGhlIHNpemUgb2YNCgkJCS8vIHRoZSBheGlzIGFyZWEuIEZvciBub3csIHdlIHNheSB0aGF0IHRoZSBtaW5pbXVtIHRpY2sgc3BhY2luZyBpbiBwaXhlbHMgbXVzdCBiZSA1MA0KCQkJLy8gV2UgYWxzbyBsaW1pdCB0aGUgbWF4aW11bSBudW1iZXIgb2YgdGlja3MgdG8gMTEgd2hpY2ggZ2l2ZXMgYSBuaWNlIDEwIHNxdWFyZXMgb24NCgkJCS8vIHRoZSBncmFwaA0KCQkJdmFyIHRpY2tWYWwgPSB2YWx1ZU9yRGVmYXVsdChnZW5lcmF0aW9uT3B0aW9ucy5taW4sIE1hdGgucG93KDEwLCBNYXRoLmZsb29yKGhlbHBlcnMubG9nMTAoZGF0YVJhbmdlLm1pbikpKSk7DQoNCgkJCXZhciBlbmRFeHAgPSBNYXRoLmZsb29yKGhlbHBlcnMubG9nMTAoZGF0YVJhbmdlLm1heCkpOw0KCQkJdmFyIGVuZFNpZ25pZmljYW5kID0gTWF0aC5jZWlsKGRhdGFSYW5nZS5tYXggLyBNYXRoLnBvdygxMCwgZW5kRXhwKSk7DQoJCQl2YXIgZXhwLCBzaWduaWZpY2FuZDsNCg0KCQkJaWYgKHRpY2tWYWwgPT09IDApIHsNCgkJCQlleHAgPSBNYXRoLmZsb29yKGhlbHBlcnMubG9nMTAoZGF0YVJhbmdlLm1pbk5vdFplcm8pKTsNCgkJCQlzaWduaWZpY2FuZCA9IE1hdGguZmxvb3IoZGF0YVJhbmdlLm1pbk5vdFplcm8gLyBNYXRoLnBvdygxMCwgZXhwKSk7DQoNCgkJCQl0aWNrcy5wdXNoKHRpY2tWYWwpOw0KCQkJCXRpY2tWYWwgPSBzaWduaWZpY2FuZCAqIE1hdGgucG93KDEwLCBleHApOw0KCQkJfSBlbHNlIHsNCgkJCQlleHAgPSBNYXRoLmZsb29yKGhlbHBlcnMubG9nMTAodGlja1ZhbCkpOw0KCQkJCXNpZ25pZmljYW5kID0gTWF0aC5mbG9vcih0aWNrVmFsIC8gTWF0aC5wb3coMTAsIGV4cCkpOw0KCQkJfQ0KDQoJCQlkbyB7DQoJCQkJdGlja3MucHVzaCh0aWNrVmFsKTsNCg0KCQkJCSsrc2lnbmlmaWNhbmQ7DQoJCQkJaWYgKHNpZ25pZmljYW5kID09PSAxMCkgew0KCQkJCQlzaWduaWZpY2FuZCA9IDE7DQoJCQkJCSsrZXhwOw0KCQkJCX0NCg0KCQkJCXRpY2tWYWwgPSBzaWduaWZpY2FuZCAqIE1hdGgucG93KDEwLCBleHApOw0KCQkJfSB3aGlsZSAoZXhwIDwgZW5kRXhwIHx8IChleHAgPT09IGVuZEV4cCAmJiBzaWduaWZpY2FuZCA8IGVuZFNpZ25pZmljYW5kKSk7DQoNCgkJCXZhciBsYXN0VGljayA9IHZhbHVlT3JEZWZhdWx0KGdlbmVyYXRpb25PcHRpb25zLm1heCwgdGlja1ZhbCk7DQoJCQl0aWNrcy5wdXNoKGxhc3RUaWNrKTsNCg0KCQkJcmV0dXJuIHRpY2tzOw0KCQl9DQoJfSwNCg0KCS8qKg0KCSAqIE5hbWVzcGFjZSB0byBob2xkIGZvcm1hdHRlcnMgZm9yIGRpZmZlcmVudCB0eXBlcyBvZiB0aWNrcw0KCSAqIEBuYW1lc3BhY2UgQ2hhcnQuVGlja3MuZm9ybWF0dGVycw0KCSAqLw0KCWZvcm1hdHRlcnM6IHsNCgkJLyoqDQoJCSAqIEZvcm1hdHRlciBmb3IgdmFsdWUgbGFiZWxzDQoJCSAqIEBtZXRob2QgQ2hhcnQuVGlja3MuZm9ybWF0dGVycy52YWx1ZXMNCgkJICogQHBhcmFtIHZhbHVlIHRoZSB2YWx1ZSB0byBkaXNwbGF5DQoJCSAqIEByZXR1cm4ge1N0cmluZ3xBcnJheX0gdGhlIGxhYmVsIHRvIGRpc3BsYXkNCgkJICovDQoJCXZhbHVlczogZnVuY3Rpb24odmFsdWUpIHsNCgkJCXJldHVybiBoZWxwZXJzLmlzQXJyYXkodmFsdWUpID8gdmFsdWUgOiAnJyArIHZhbHVlOw0KCQl9LA0KDQoJCS8qKg0KCQkgKiBGb3JtYXR0ZXIgZm9yIGxpbmVhciBudW1lcmljIHRpY2tzDQoJCSAqIEBtZXRob2QgQ2hhcnQuVGlja3MuZm9ybWF0dGVycy5saW5lYXINCgkJICogQHBhcmFtIHRpY2tWYWx1ZSB7TnVtYmVyfSB0aGUgdmFsdWUgdG8gYmUgZm9ybWF0dGVkDQoJCSAqIEBwYXJhbSBpbmRleCB7TnVtYmVyfSB0aGUgcG9zaXRpb24gb2YgdGhlIHRpY2tWYWx1ZSBwYXJhbWV0ZXIgaW4gdGhlIHRpY2tzIGFycmF5DQoJCSAqIEBwYXJhbSB0aWNrcyB7QXJyYXk8TnVtYmVyPn0gdGhlIGxpc3Qgb2YgdGlja3MgYmVpbmcgY29udmVydGVkDQoJCSAqIEByZXR1cm4ge1N0cmluZ30gc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIHRoZSB0aWNrVmFsdWUgcGFyYW1ldGVyDQoJCSAqLw0KCQlsaW5lYXI6IGZ1bmN0aW9uKHRpY2tWYWx1ZSwgaW5kZXgsIHRpY2tzKSB7DQoJCQkvLyBJZiB3ZSBoYXZlIGxvdHMgb2YgdGlja3MsIGRvbid0IHVzZSB0aGUgb25lcw0KCQkJdmFyIGRlbHRhID0gdGlja3MubGVuZ3RoID4gMyA/IHRpY2tzWzJdIC0gdGlja3NbMV0gOiB0aWNrc1sxXSAtIHRpY2tzWzBdOw0KDQoJCQkvLyBJZiB3ZSBoYXZlIGEgbnVtYmVyIGxpa2UgMi41IGFzIHRoZSBkZWx0YSwgZmlndXJlIG91dCBob3cgbWFueSBkZWNpbWFsIHBsYWNlcyB3ZSBuZWVkDQoJCQlpZiAoTWF0aC5hYnMoZGVsdGEpID4gMSkgew0KCQkJCWlmICh0aWNrVmFsdWUgIT09IE1hdGguZmxvb3IodGlja1ZhbHVlKSkgew0KCQkJCQkvLyBub3QgYW4gaW50ZWdlcg0KCQkJCQlkZWx0YSA9IHRpY2tWYWx1ZSAtIE1hdGguZmxvb3IodGlja1ZhbHVlKTsNCgkJCQl9DQoJCQl9DQoNCgkJCXZhciBsb2dEZWx0YSA9IGhlbHBlcnMubG9nMTAoTWF0aC5hYnMoZGVsdGEpKTsNCgkJCXZhciB0aWNrU3RyaW5nID0gJyc7DQoNCgkJCWlmICh0aWNrVmFsdWUgIT09IDApIHsNCgkJCQl2YXIgbnVtRGVjaW1hbCA9IC0xICogTWF0aC5mbG9vcihsb2dEZWx0YSk7DQoJCQkJbnVtRGVjaW1hbCA9IE1hdGgubWF4KE1hdGgubWluKG51bURlY2ltYWwsIDIwKSwgMCk7IC8vIHRvRml4ZWQgaGFzIGEgbWF4IG9mIDIwIGRlY2ltYWwgcGxhY2VzDQoJCQkJdGlja1N0cmluZyA9IHRpY2tWYWx1ZS50b0ZpeGVkKG51bURlY2ltYWwpOw0KCQkJfSBlbHNlIHsNCgkJCQl0aWNrU3RyaW5nID0gJzAnOyAvLyBuZXZlciBzaG93IGRlY2ltYWwgcGxhY2VzIGZvciAwDQoJCQl9DQoNCgkJCXJldHVybiB0aWNrU3RyaW5nOw0KCQl9LA0KDQoJCWxvZ2FyaXRobWljOiBmdW5jdGlvbih0aWNrVmFsdWUsIGluZGV4LCB0aWNrcykgew0KCQkJdmFyIHJlbWFpbiA9IHRpY2tWYWx1ZSAvIChNYXRoLnBvdygxMCwgTWF0aC5mbG9vcihoZWxwZXJzLmxvZzEwKHRpY2tWYWx1ZSkpKSk7DQoNCgkJCWlmICh0aWNrVmFsdWUgPT09IDApIHsNCgkJCQlyZXR1cm4gJzAnOw0KCQkJfSBlbHNlIGlmIChyZW1haW4gPT09IDEgfHwgcmVtYWluID09PSAyIHx8IHJlbWFpbiA9PT0gNSB8fCBpbmRleCA9PT0gMCB8fCBpbmRleCA9PT0gdGlja3MubGVuZ3RoIC0gMSkgew0KCQkJCXJldHVybiB0aWNrVmFsdWUudG9FeHBvbmVudGlhbCgpOw0KCQkJfQ0KCQkJcmV0dXJuICcnOw0KCQl9DQoJfQ0KfTsNCg0KfSx7IjQ1Ijo0NX1dLDM1OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsNCid1c2Ugc3RyaWN0JzsNCg0KdmFyIGRlZmF1bHRzID0gcmVxdWlyZSgyNSk7DQp2YXIgRWxlbWVudCA9IHJlcXVpcmUoMjYpOw0KdmFyIGhlbHBlcnMgPSByZXF1aXJlKDQ1KTsNCg0KZGVmYXVsdHMuX3NldCgnZ2xvYmFsJywgew0KCXRvb2x0aXBzOiB7DQoJCWVuYWJsZWQ6IHRydWUsDQoJCWN1c3RvbTogbnVsbCwNCgkJbW9kZTogJ25lYXJlc3QnLA0KCQlwb3NpdGlvbjogJ2F2ZXJhZ2UnLA0KCQlpbnRlcnNlY3Q6IHRydWUsDQoJCWJhY2tncm91bmRDb2xvcjogJ3JnYmEoMCwwLDAsMC44KScsDQoJCXRpdGxlRm9udFN0eWxlOiAnYm9sZCcsDQoJCXRpdGxlU3BhY2luZzogMiwNCgkJdGl0bGVNYXJnaW5Cb3R0b206IDYsDQoJCXRpdGxlRm9udENvbG9yOiAnI2ZmZicsDQoJCXRpdGxlQWxpZ246ICdsZWZ0JywNCgkJYm9keVNwYWNpbmc6IDIsDQoJCWJvZHlGb250Q29sb3I6ICcjZmZmJywNCgkJYm9keUFsaWduOiAnbGVmdCcsDQoJCWZvb3RlckZvbnRTdHlsZTogJ2JvbGQnLA0KCQlmb290ZXJTcGFjaW5nOiAyLA0KCQlmb290ZXJNYXJnaW5Ub3A6IDYsDQoJCWZvb3RlckZvbnRDb2xvcjogJyNmZmYnLA0KCQlmb290ZXJBbGlnbjogJ2xlZnQnLA0KCQl5UGFkZGluZzogNiwNCgkJeFBhZGRpbmc6IDYsDQoJCWNhcmV0UGFkZGluZzogMiwNCgkJY2FyZXRTaXplOiA1LA0KCQljb3JuZXJSYWRpdXM6IDYsDQoJCW11bHRpS2V5QmFja2dyb3VuZDogJyNmZmYnLA0KCQlkaXNwbGF5Q29sb3JzOiB0cnVlLA0KCQlib3JkZXJDb2xvcjogJ3JnYmEoMCwwLDAsMCknLA0KCQlib3JkZXJXaWR0aDogMCwNCgkJY2FsbGJhY2tzOiB7DQoJCQkvLyBBcmdzIGFyZTogKHRvb2x0aXBJdGVtcywgZGF0YSkNCgkJCWJlZm9yZVRpdGxlOiBoZWxwZXJzLm5vb3AsDQoJCQl0aXRsZTogZnVuY3Rpb24odG9vbHRpcEl0ZW1zLCBkYXRhKSB7DQoJCQkJLy8gUGljayBmaXJzdCB4TGFiZWwgZm9yIG5vdw0KCQkJCXZhciB0aXRsZSA9ICcnOw0KCQkJCXZhciBsYWJlbHMgPSBkYXRhLmxhYmVsczsNCgkJCQl2YXIgbGFiZWxDb3VudCA9IGxhYmVscyA/IGxhYmVscy5sZW5ndGggOiAwOw0KDQoJCQkJaWYgKHRvb2x0aXBJdGVtcy5sZW5ndGggPiAwKSB7DQoJCQkJCXZhciBpdGVtID0gdG9vbHRpcEl0ZW1zWzBdOw0KDQoJCQkJCWlmIChpdGVtLnhMYWJlbCkgew0KCQkJCQkJdGl0bGUgPSBpdGVtLnhMYWJlbDsNCgkJCQkJfSBlbHNlIGlmIChsYWJlbENvdW50ID4gMCAmJiBpdGVtLmluZGV4IDwgbGFiZWxDb3VudCkgew0KCQkJCQkJdGl0bGUgPSBsYWJlbHNbaXRlbS5pbmRleF07DQoJCQkJCX0NCgkJCQl9DQoNCgkJCQlyZXR1cm4gdGl0bGU7DQoJCQl9LA0KCQkJYWZ0ZXJUaXRsZTogaGVscGVycy5ub29wLA0KDQoJCQkvLyBBcmdzIGFyZTogKHRvb2x0aXBJdGVtcywgZGF0YSkNCgkJCWJlZm9yZUJvZHk6IGhlbHBlcnMubm9vcCwNCg0KCQkJLy8gQXJncyBhcmU6ICh0b29sdGlwSXRlbSwgZGF0YSkNCgkJCWJlZm9yZUxhYmVsOiBoZWxwZXJzLm5vb3AsDQoJCQlsYWJlbDogZnVuY3Rpb24odG9vbHRpcEl0ZW0sIGRhdGEpIHsNCgkJCQl2YXIgbGFiZWwgPSBkYXRhLmRhdGFzZXRzW3Rvb2x0aXBJdGVtLmRhdGFzZXRJbmRleF0ubGFiZWwgfHwgJyc7DQoNCgkJCQlpZiAobGFiZWwpIHsNCgkJCQkJbGFiZWwgKz0gJzogJzsNCgkJCQl9DQoJCQkJbGFiZWwgKz0gdG9vbHRpcEl0ZW0ueUxhYmVsOw0KCQkJCXJldHVybiBsYWJlbDsNCgkJCX0sDQoJCQlsYWJlbENvbG9yOiBmdW5jdGlvbih0b29sdGlwSXRlbSwgY2hhcnQpIHsNCgkJCQl2YXIgbWV0YSA9IGNoYXJ0LmdldERhdGFzZXRNZXRhKHRvb2x0aXBJdGVtLmRhdGFzZXRJbmRleCk7DQoJCQkJdmFyIGFjdGl2ZUVsZW1lbnQgPSBtZXRhLmRhdGFbdG9vbHRpcEl0ZW0uaW5kZXhdOw0KCQkJCXZhciB2aWV3ID0gYWN0aXZlRWxlbWVudC5fdmlldzsNCgkJCQlyZXR1cm4gew0KCQkJCQlib3JkZXJDb2xvcjogdmlldy5ib3JkZXJDb2xvciwNCgkJCQkJYmFja2dyb3VuZENvbG9yOiB2aWV3LmJhY2tncm91bmRDb2xvcg0KCQkJCX07DQoJCQl9LA0KCQkJbGFiZWxUZXh0Q29sb3I6IGZ1bmN0aW9uKCkgew0KCQkJCXJldHVybiB0aGlzLl9vcHRpb25zLmJvZHlGb250Q29sb3I7DQoJCQl9LA0KCQkJYWZ0ZXJMYWJlbDogaGVscGVycy5ub29wLA0KDQoJCQkvLyBBcmdzIGFyZTogKHRvb2x0aXBJdGVtcywgZGF0YSkNCgkJCWFmdGVyQm9keTogaGVscGVycy5ub29wLA0KDQoJCQkvLyBBcmdzIGFyZTogKHRvb2x0aXBJdGVtcywgZGF0YSkNCgkJCWJlZm9yZUZvb3RlcjogaGVscGVycy5ub29wLA0KCQkJZm9vdGVyOiBoZWxwZXJzLm5vb3AsDQoJCQlhZnRlckZvb3RlcjogaGVscGVycy5ub29wDQoJCX0NCgl9DQp9KTsNCg0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihDaGFydCkgew0KDQoJLyoqDQogCSAqIEhlbHBlciBtZXRob2QgdG8gbWVyZ2UgdGhlIG9wYWNpdHkgaW50byBhIGNvbG9yDQogCSAqLw0KCWZ1bmN0aW9uIG1lcmdlT3BhY2l0eShjb2xvclN0cmluZywgb3BhY2l0eSkgew0KCQl2YXIgY29sb3IgPSBoZWxwZXJzLmNvbG9yKGNvbG9yU3RyaW5nKTsNCgkJcmV0dXJuIGNvbG9yLmFscGhhKG9wYWNpdHkgKiBjb2xvci5hbHBoYSgpKS5yZ2JhU3RyaW5nKCk7DQoJfQ0KDQoJLy8gSGVscGVyIHRvIHB1c2ggb3IgY29uY2F0IGJhc2VkIG9uIGlmIHRoZSAybmQgcGFyYW1ldGVyIGlzIGFuIGFycmF5IG9yIG5vdA0KCWZ1bmN0aW9uIHB1c2hPckNvbmNhdChiYXNlLCB0b1B1c2gpIHsNCgkJaWYgKHRvUHVzaCkgew0KCQkJaWYgKGhlbHBlcnMuaXNBcnJheSh0b1B1c2gpKSB7DQoJCQkJLy8gYmFzZSA9IGJhc2UuY29uY2F0KHRvUHVzaCk7DQoJCQkJQXJyYXkucHJvdG90eXBlLnB1c2guYXBwbHkoYmFzZSwgdG9QdXNoKTsNCgkJCX0gZWxzZSB7DQoJCQkJYmFzZS5wdXNoKHRvUHVzaCk7DQoJCQl9DQoJCX0NCg0KCQlyZXR1cm4gYmFzZTsNCgl9DQoNCgkvLyBQcml2YXRlIGhlbHBlciB0byBjcmVhdGUgYSB0b29sdGlwIGl0ZW0gbW9kZWwNCgkvLyBAcGFyYW0gZWxlbWVudCA6IHRoZSBjaGFydCBlbGVtZW50IChwb2ludCwgYXJjLCBiYXIpIHRvIGNyZWF0ZSB0aGUgdG9vbHRpcCBpdGVtIGZvcg0KCS8vIEByZXR1cm4gOiBuZXcgdG9vbHRpcCBpdGVtDQoJZnVuY3Rpb24gY3JlYXRlVG9vbHRpcEl0ZW0oZWxlbWVudCkgew0KCQl2YXIgeFNjYWxlID0gZWxlbWVudC5feFNjYWxlOw0KCQl2YXIgeVNjYWxlID0gZWxlbWVudC5feVNjYWxlIHx8IGVsZW1lbnQuX3NjYWxlOyAvLyBoYW5kbGUgcmFkYXIgfHwgcG9sYXJBcmVhIGNoYXJ0cw0KCQl2YXIgaW5kZXggPSBlbGVtZW50Ll9pbmRleDsNCgkJdmFyIGRhdGFzZXRJbmRleCA9IGVsZW1lbnQuX2RhdGFzZXRJbmRleDsNCg0KCQlyZXR1cm4gew0KCQkJeExhYmVsOiB4U2NhbGUgPyB4U2NhbGUuZ2V0TGFiZWxGb3JJbmRleChpbmRleCwgZGF0YXNldEluZGV4KSA6ICcnLA0KCQkJeUxhYmVsOiB5U2NhbGUgPyB5U2NhbGUuZ2V0TGFiZWxGb3JJbmRleChpbmRleCwgZGF0YXNldEluZGV4KSA6ICcnLA0KCQkJaW5kZXg6IGluZGV4LA0KCQkJZGF0YXNldEluZGV4OiBkYXRhc2V0SW5kZXgsDQoJCQl4OiBlbGVtZW50Ll9tb2RlbC54LA0KCQkJeTogZWxlbWVudC5fbW9kZWwueQ0KCQl9Ow0KCX0NCg0KCS8qKg0KCSAqIEhlbHBlciB0byBnZXQgdGhlIHJlc2V0IG1vZGVsIGZvciB0aGUgdG9vbHRpcA0KCSAqIEBwYXJhbSB0b29sdGlwT3B0cyB7T2JqZWN0fSB0aGUgdG9vbHRpcCBvcHRpb25zDQoJICovDQoJZnVuY3Rpb24gZ2V0QmFzZU1vZGVsKHRvb2x0aXBPcHRzKSB7DQoJCXZhciBnbG9iYWxEZWZhdWx0cyA9IGRlZmF1bHRzLmdsb2JhbDsNCgkJdmFyIHZhbHVlT3JEZWZhdWx0ID0gaGVscGVycy52YWx1ZU9yRGVmYXVsdDsNCg0KCQlyZXR1cm4gew0KCQkJLy8gUG9zaXRpb25pbmcNCgkJCXhQYWRkaW5nOiB0b29sdGlwT3B0cy54UGFkZGluZywNCgkJCXlQYWRkaW5nOiB0b29sdGlwT3B0cy55UGFkZGluZywNCgkJCXhBbGlnbjogdG9vbHRpcE9wdHMueEFsaWduLA0KCQkJeUFsaWduOiB0b29sdGlwT3B0cy55QWxpZ24sDQoNCgkJCS8vIEJvZHkNCgkJCWJvZHlGb250Q29sb3I6IHRvb2x0aXBPcHRzLmJvZHlGb250Q29sb3IsDQoJCQlfYm9keUZvbnRGYW1pbHk6IHZhbHVlT3JEZWZhdWx0KHRvb2x0aXBPcHRzLmJvZHlGb250RmFtaWx5LCBnbG9iYWxEZWZhdWx0cy5kZWZhdWx0Rm9udEZhbWlseSksDQoJCQlfYm9keUZvbnRTdHlsZTogdmFsdWVPckRlZmF1bHQodG9vbHRpcE9wdHMuYm9keUZvbnRTdHlsZSwgZ2xvYmFsRGVmYXVsdHMuZGVmYXVsdEZvbnRTdHlsZSksDQoJCQlfYm9keUFsaWduOiB0b29sdGlwT3B0cy5ib2R5QWxpZ24sDQoJCQlib2R5Rm9udFNpemU6IHZhbHVlT3JEZWZhdWx0KHRvb2x0aXBPcHRzLmJvZHlGb250U2l6ZSwgZ2xvYmFsRGVmYXVsdHMuZGVmYXVsdEZvbnRTaXplKSwNCgkJCWJvZHlTcGFjaW5nOiB0b29sdGlwT3B0cy5ib2R5U3BhY2luZywNCg0KCQkJLy8gVGl0bGUNCgkJCXRpdGxlRm9udENvbG9yOiB0b29sdGlwT3B0cy50aXRsZUZvbnRDb2xvciwNCgkJCV90aXRsZUZvbnRGYW1pbHk6IHZhbHVlT3JEZWZhdWx0KHRvb2x0aXBPcHRzLnRpdGxlRm9udEZhbWlseSwgZ2xvYmFsRGVmYXVsdHMuZGVmYXVsdEZvbnRGYW1pbHkpLA0KCQkJX3RpdGxlRm9udFN0eWxlOiB2YWx1ZU9yRGVmYXVsdCh0b29sdGlwT3B0cy50aXRsZUZvbnRTdHlsZSwgZ2xvYmFsRGVmYXVsdHMuZGVmYXVsdEZvbnRTdHlsZSksDQoJCQl0aXRsZUZvbnRTaXplOiB2YWx1ZU9yRGVmYXVsdCh0b29sdGlwT3B0cy50aXRsZUZvbnRTaXplLCBnbG9iYWxEZWZhdWx0cy5kZWZhdWx0Rm9udFNpemUpLA0KCQkJX3RpdGxlQWxpZ246IHRvb2x0aXBPcHRzLnRpdGxlQWxpZ24sDQoJCQl0aXRsZVNwYWNpbmc6IHRvb2x0aXBPcHRzLnRpdGxlU3BhY2luZywNCgkJCXRpdGxlTWFyZ2luQm90dG9tOiB0b29sdGlwT3B0cy50aXRsZU1hcmdpbkJvdHRvbSwNCg0KCQkJLy8gRm9vdGVyDQoJCQlmb290ZXJGb250Q29sb3I6IHRvb2x0aXBPcHRzLmZvb3RlckZvbnRDb2xvciwNCgkJCV9mb290ZXJGb250RmFtaWx5OiB2YWx1ZU9yRGVmYXVsdCh0b29sdGlwT3B0cy5mb290ZXJGb250RmFtaWx5LCBnbG9iYWxEZWZhdWx0cy5kZWZhdWx0Rm9udEZhbWlseSksDQoJCQlfZm9vdGVyRm9udFN0eWxlOiB2YWx1ZU9yRGVmYXVsdCh0b29sdGlwT3B0cy5mb290ZXJGb250U3R5bGUsIGdsb2JhbERlZmF1bHRzLmRlZmF1bHRGb250U3R5bGUpLA0KCQkJZm9vdGVyRm9udFNpemU6IHZhbHVlT3JEZWZhdWx0KHRvb2x0aXBPcHRzLmZvb3RlckZvbnRTaXplLCBnbG9iYWxEZWZhdWx0cy5kZWZhdWx0Rm9udFNpemUpLA0KCQkJX2Zvb3RlckFsaWduOiB0b29sdGlwT3B0cy5mb290ZXJBbGlnbiwNCgkJCWZvb3RlclNwYWNpbmc6IHRvb2x0aXBPcHRzLmZvb3RlclNwYWNpbmcsDQoJCQlmb290ZXJNYXJnaW5Ub3A6IHRvb2x0aXBPcHRzLmZvb3Rlck1hcmdpblRvcCwNCg0KCQkJLy8gQXBwZWFyYW5jZQ0KCQkJY2FyZXRTaXplOiB0b29sdGlwT3B0cy5jYXJldFNpemUsDQoJCQljb3JuZXJSYWRpdXM6IHRvb2x0aXBPcHRzLmNvcm5lclJhZGl1cywNCgkJCWJhY2tncm91bmRDb2xvcjogdG9vbHRpcE9wdHMuYmFja2dyb3VuZENvbG9yLA0KCQkJb3BhY2l0eTogMCwNCgkJCWxlZ2VuZENvbG9yQmFja2dyb3VuZDogdG9vbHRpcE9wdHMubXVsdGlLZXlCYWNrZ3JvdW5kLA0KCQkJZGlzcGxheUNvbG9yczogdG9vbHRpcE9wdHMuZGlzcGxheUNvbG9ycywNCgkJCWJvcmRlckNvbG9yOiB0b29sdGlwT3B0cy5ib3JkZXJDb2xvciwNCgkJCWJvcmRlcldpZHRoOiB0b29sdGlwT3B0cy5ib3JkZXJXaWR0aA0KCQl9Ow0KCX0NCg0KCS8qKg0KCSAqIEdldCB0aGUgc2l6ZSBvZiB0aGUgdG9vbHRpcA0KCSAqLw0KCWZ1bmN0aW9uIGdldFRvb2x0aXBTaXplKHRvb2x0aXAsIG1vZGVsKSB7DQoJCXZhciBjdHggPSB0b29sdGlwLl9jaGFydC5jdHg7DQoNCgkJdmFyIGhlaWdodCA9IG1vZGVsLnlQYWRkaW5nICogMjsgLy8gVG9vbHRpcCBQYWRkaW5nDQoJCXZhciB3aWR0aCA9IDA7DQoNCgkJLy8gQ291bnQgb2YgYWxsIGxpbmVzIGluIHRoZSBib2R5DQoJCXZhciBib2R5ID0gbW9kZWwuYm9keTsNCgkJdmFyIGNvbWJpbmVkQm9keUxlbmd0aCA9IGJvZHkucmVkdWNlKGZ1bmN0aW9uKGNvdW50LCBib2R5SXRlbSkgew0KCQkJcmV0dXJuIGNvdW50ICsgYm9keUl0ZW0uYmVmb3JlLmxlbmd0aCArIGJvZHlJdGVtLmxpbmVzLmxlbmd0aCArIGJvZHlJdGVtLmFmdGVyLmxlbmd0aDsNCgkJfSwgMCk7DQoJCWNvbWJpbmVkQm9keUxlbmd0aCArPSBtb2RlbC5iZWZvcmVCb2R5Lmxlbmd0aCArIG1vZGVsLmFmdGVyQm9keS5sZW5ndGg7DQoNCgkJdmFyIHRpdGxlTGluZUNvdW50ID0gbW9kZWwudGl0bGUubGVuZ3RoOw0KCQl2YXIgZm9vdGVyTGluZUNvdW50ID0gbW9kZWwuZm9vdGVyLmxlbmd0aDsNCgkJdmFyIHRpdGxlRm9udFNpemUgPSBtb2RlbC50aXRsZUZvbnRTaXplOw0KCQl2YXIgYm9keUZvbnRTaXplID0gbW9kZWwuYm9keUZvbnRTaXplOw0KCQl2YXIgZm9vdGVyRm9udFNpemUgPSBtb2RlbC5mb290ZXJGb250U2l6ZTsNCg0KCQloZWlnaHQgKz0gdGl0bGVMaW5lQ291bnQgKiB0aXRsZUZvbnRTaXplOyAvLyBUaXRsZSBMaW5lcw0KCQloZWlnaHQgKz0gdGl0bGVMaW5lQ291bnQgPyAodGl0bGVMaW5lQ291bnQgLSAxKSAqIG1vZGVsLnRpdGxlU3BhY2luZyA6IDA7IC8vIFRpdGxlIExpbmUgU3BhY2luZw0KCQloZWlnaHQgKz0gdGl0bGVMaW5lQ291bnQgPyBtb2RlbC50aXRsZU1hcmdpbkJvdHRvbSA6IDA7IC8vIFRpdGxlJ3MgYm90dG9tIE1hcmdpbg0KCQloZWlnaHQgKz0gY29tYmluZWRCb2R5TGVuZ3RoICogYm9keUZvbnRTaXplOyAvLyBCb2R5IExpbmVzDQoJCWhlaWdodCArPSBjb21iaW5lZEJvZHlMZW5ndGggPyAoY29tYmluZWRCb2R5TGVuZ3RoIC0gMSkgKiBtb2RlbC5ib2R5U3BhY2luZyA6IDA7IC8vIEJvZHkgTGluZSBTcGFjaW5nDQoJCWhlaWdodCArPSBmb290ZXJMaW5lQ291bnQgPyBtb2RlbC5mb290ZXJNYXJnaW5Ub3AgOiAwOyAvLyBGb290ZXIgTWFyZ2luDQoJCWhlaWdodCArPSBmb290ZXJMaW5lQ291bnQgKiAoZm9vdGVyRm9udFNpemUpOyAvLyBGb290ZXIgTGluZXMNCgkJaGVpZ2h0ICs9IGZvb3RlckxpbmVDb3VudCA/IChmb290ZXJMaW5lQ291bnQgLSAxKSAqIG1vZGVsLmZvb3RlclNwYWNpbmcgOiAwOyAvLyBGb290ZXIgTGluZSBTcGFjaW5nDQoNCgkJLy8gVGl0bGUgd2lkdGgNCgkJdmFyIHdpZHRoUGFkZGluZyA9IDA7DQoJCXZhciBtYXhMaW5lV2lkdGggPSBmdW5jdGlvbihsaW5lKSB7DQoJCQl3aWR0aCA9IE1hdGgubWF4KHdpZHRoLCBjdHgubWVhc3VyZVRleHQobGluZSkud2lkdGggKyB3aWR0aFBhZGRpbmcpOw0KCQl9Ow0KDQoJCWN0eC5mb250ID0gaGVscGVycy5mb250U3RyaW5nKHRpdGxlRm9udFNpemUsIG1vZGVsLl90aXRsZUZvbnRTdHlsZSwgbW9kZWwuX3RpdGxlRm9udEZhbWlseSk7DQoJCWhlbHBlcnMuZWFjaChtb2RlbC50aXRsZSwgbWF4TGluZVdpZHRoKTsNCg0KCQkvLyBCb2R5IHdpZHRoDQoJCWN0eC5mb250ID0gaGVscGVycy5mb250U3RyaW5nKGJvZHlGb250U2l6ZSwgbW9kZWwuX2JvZHlGb250U3R5bGUsIG1vZGVsLl9ib2R5Rm9udEZhbWlseSk7DQoJCWhlbHBlcnMuZWFjaChtb2RlbC5iZWZvcmVCb2R5LmNvbmNhdChtb2RlbC5hZnRlckJvZHkpLCBtYXhMaW5lV2lkdGgpOw0KDQoJCS8vIEJvZHkgbGluZXMgbWF5IGluY2x1ZGUgc29tZSBleHRyYSB3aWR0aCBkdWUgdG8gdGhlIGNvbG9yIGJveA0KCQl3aWR0aFBhZGRpbmcgPSBtb2RlbC5kaXNwbGF5Q29sb3JzID8gKGJvZHlGb250U2l6ZSArIDIpIDogMDsNCgkJaGVscGVycy5lYWNoKGJvZHksIGZ1bmN0aW9uKGJvZHlJdGVtKSB7DQoJCQloZWxwZXJzLmVhY2goYm9keUl0ZW0uYmVmb3JlLCBtYXhMaW5lV2lkdGgpOw0KCQkJaGVscGVycy5lYWNoKGJvZHlJdGVtLmxpbmVzLCBtYXhMaW5lV2lkdGgpOw0KCQkJaGVscGVycy5lYWNoKGJvZHlJdGVtLmFmdGVyLCBtYXhMaW5lV2lkdGgpOw0KCQl9KTsNCg0KCQkvLyBSZXNldCBiYWNrIHRvIDANCgkJd2lkdGhQYWRkaW5nID0gMDsNCg0KCQkvLyBGb290ZXIgd2lkdGgNCgkJY3R4LmZvbnQgPSBoZWxwZXJzLmZvbnRTdHJpbmcoZm9vdGVyRm9udFNpemUsIG1vZGVsLl9mb290ZXJGb250U3R5bGUsIG1vZGVsLl9mb290ZXJGb250RmFtaWx5KTsNCgkJaGVscGVycy5lYWNoKG1vZGVsLmZvb3RlciwgbWF4TGluZVdpZHRoKTsNCg0KCQkvLyBBZGQgcGFkZGluZw0KCQl3aWR0aCArPSAyICogbW9kZWwueFBhZGRpbmc7DQoNCgkJcmV0dXJuIHsNCgkJCXdpZHRoOiB3aWR0aCwNCgkJCWhlaWdodDogaGVpZ2h0DQoJCX07DQoJfQ0KDQoJLyoqDQoJICogSGVscGVyIHRvIGdldCB0aGUgYWxpZ25tZW50IG9mIGEgdG9vbHRpcCBnaXZlbiB0aGUgc2l6ZQ0KCSAqLw0KCWZ1bmN0aW9uIGRldGVybWluZUFsaWdubWVudCh0b29sdGlwLCBzaXplKSB7DQoJCXZhciBtb2RlbCA9IHRvb2x0aXAuX21vZGVsOw0KCQl2YXIgY2hhcnQgPSB0b29sdGlwLl9jaGFydDsNCgkJdmFyIGNoYXJ0QXJlYSA9IHRvb2x0aXAuX2NoYXJ0LmNoYXJ0QXJlYTsNCgkJdmFyIHhBbGlnbiA9ICdjZW50ZXInOw0KCQl2YXIgeUFsaWduID0gJ2NlbnRlcic7DQoNCgkJaWYgKG1vZGVsLnkgPCBzaXplLmhlaWdodCkgew0KCQkJeUFsaWduID0gJ3RvcCc7DQoJCX0gZWxzZSBpZiAobW9kZWwueSA+IChjaGFydC5oZWlnaHQgLSBzaXplLmhlaWdodCkpIHsNCgkJCXlBbGlnbiA9ICdib3R0b20nOw0KCQl9DQoNCgkJdmFyIGxmLCByZjsgLy8gZnVuY3Rpb25zIHRvIGRldGVybWluZSBsZWZ0LCByaWdodCBhbGlnbm1lbnQNCgkJdmFyIG9sZiwgb3JmOyAvLyBmdW5jdGlvbnMgdG8gZGV0ZXJtaW5lIGlmIGxlZnQvcmlnaHQgYWxpZ25tZW50IGNhdXNlcyB0b29sdGlwIHRvIGdvIG91dHNpZGUgY2hhcnQNCgkJdmFyIHlmOyAvLyBmdW5jdGlvbiB0byBnZXQgdGhlIHkgYWxpZ25tZW50IGlmIHRoZSB0b29sdGlwIGdvZXMgb3V0c2lkZSBvZiB0aGUgbGVmdCBvciByaWdodCBlZGdlcw0KCQl2YXIgbWlkWCA9IChjaGFydEFyZWEubGVmdCArIGNoYXJ0QXJlYS5yaWdodCkgLyAyOw0KCQl2YXIgbWlkWSA9IChjaGFydEFyZWEudG9wICsgY2hhcnRBcmVhLmJvdHRvbSkgLyAyOw0KDQoJCWlmICh5QWxpZ24gPT09ICdjZW50ZXInKSB7DQoJCQlsZiA9IGZ1bmN0aW9uKHgpIHsNCgkJCQlyZXR1cm4geCA8PSBtaWRYOw0KCQkJfTsNCgkJCXJmID0gZnVuY3Rpb24oeCkgew0KCQkJCXJldHVybiB4ID4gbWlkWDsNCgkJCX07DQoJCX0gZWxzZSB7DQoJCQlsZiA9IGZ1bmN0aW9uKHgpIHsNCgkJCQlyZXR1cm4geCA8PSAoc2l6ZS53aWR0aCAvIDIpOw0KCQkJfTsNCgkJCXJmID0gZnVuY3Rpb24oeCkgew0KCQkJCXJldHVybiB4ID49IChjaGFydC53aWR0aCAtIChzaXplLndpZHRoIC8gMikpOw0KCQkJfTsNCgkJfQ0KDQoJCW9sZiA9IGZ1bmN0aW9uKHgpIHsNCgkJCXJldHVybiB4ICsgc2l6ZS53aWR0aCA+IGNoYXJ0LndpZHRoOw0KCQl9Ow0KCQlvcmYgPSBmdW5jdGlvbih4KSB7DQoJCQlyZXR1cm4geCAtIHNpemUud2lkdGggPCAwOw0KCQl9Ow0KCQl5ZiA9IGZ1bmN0aW9uKHkpIHsNCgkJCXJldHVybiB5IDw9IG1pZFkgPyAndG9wJyA6ICdib3R0b20nOw0KCQl9Ow0KDQoJCWlmIChsZihtb2RlbC54KSkgew0KCQkJeEFsaWduID0gJ2xlZnQnOw0KDQoJCQkvLyBJcyB0b29sdGlwIHRvbyB3aWRlIGFuZCBnb2VzIG92ZXIgdGhlIHJpZ2h0IHNpZGUgb2YgdGhlIGNoYXJ0Lj8NCgkJCWlmIChvbGYobW9kZWwueCkpIHsNCgkJCQl4QWxpZ24gPSAnY2VudGVyJzsNCgkJCQl5QWxpZ24gPSB5Zihtb2RlbC55KTsNCgkJCX0NCgkJfSBlbHNlIGlmIChyZihtb2RlbC54KSkgew0KCQkJeEFsaWduID0gJ3JpZ2h0JzsNCg0KCQkJLy8gSXMgdG9vbHRpcCB0b28gd2lkZSBhbmQgZ29lcyBvdXRzaWRlIGxlZnQgZWRnZSBvZiBjYW52YXM/DQoJCQlpZiAob3JmKG1vZGVsLngpKSB7DQoJCQkJeEFsaWduID0gJ2NlbnRlcic7DQoJCQkJeUFsaWduID0geWYobW9kZWwueSk7DQoJCQl9DQoJCX0NCg0KCQl2YXIgb3B0cyA9IHRvb2x0aXAuX29wdGlvbnM7DQoJCXJldHVybiB7DQoJCQl4QWxpZ246IG9wdHMueEFsaWduID8gb3B0cy54QWxpZ24gOiB4QWxpZ24sDQoJCQl5QWxpZ246IG9wdHMueUFsaWduID8gb3B0cy55QWxpZ24gOiB5QWxpZ24NCgkJfTsNCgl9DQoNCgkvKioNCgkgKiBASGVscGVyIHRvIGdldCB0aGUgbG9jYXRpb24gYSB0b29sdGlwIG5lZWRzIHRvIGJlIHBsYWNlZCBhdCBnaXZlbiB0aGUgaW5pdGlhbCBwb3NpdGlvbiAodmlhIHRoZSB2bSkgYW5kIHRoZSBzaXplIGFuZCBhbGlnbm1lbnQNCgkgKi8NCglmdW5jdGlvbiBnZXRCYWNrZ3JvdW5kUG9pbnQodm0sIHNpemUsIGFsaWdubWVudCkgew0KCQkvLyBCYWNrZ3JvdW5kIFBvc2l0aW9uDQoJCXZhciB4ID0gdm0ueDsNCgkJdmFyIHkgPSB2bS55Ow0KDQoJCXZhciBjYXJldFNpemUgPSB2bS5jYXJldFNpemU7DQoJCXZhciBjYXJldFBhZGRpbmcgPSB2bS5jYXJldFBhZGRpbmc7DQoJCXZhciBjb3JuZXJSYWRpdXMgPSB2bS5jb3JuZXJSYWRpdXM7DQoJCXZhciB4QWxpZ24gPSBhbGlnbm1lbnQueEFsaWduOw0KCQl2YXIgeUFsaWduID0gYWxpZ25tZW50LnlBbGlnbjsNCgkJdmFyIHBhZGRpbmdBbmRTaXplID0gY2FyZXRTaXplICsgY2FyZXRQYWRkaW5nOw0KCQl2YXIgcmFkaXVzQW5kUGFkZGluZyA9IGNvcm5lclJhZGl1cyArIGNhcmV0UGFkZGluZzsNCg0KCQlpZiAoeEFsaWduID09PSAncmlnaHQnKSB7DQoJCQl4IC09IHNpemUud2lkdGg7DQoJCX0gZWxzZSBpZiAoeEFsaWduID09PSAnY2VudGVyJykgew0KCQkJeCAtPSAoc2l6ZS53aWR0aCAvIDIpOw0KCQl9DQoNCgkJaWYgKHlBbGlnbiA9PT0gJ3RvcCcpIHsNCgkJCXkgKz0gcGFkZGluZ0FuZFNpemU7DQoJCX0gZWxzZSBpZiAoeUFsaWduID09PSAnYm90dG9tJykgew0KCQkJeSAtPSBzaXplLmhlaWdodCArIHBhZGRpbmdBbmRTaXplOw0KCQl9IGVsc2Ugew0KCQkJeSAtPSAoc2l6ZS5oZWlnaHQgLyAyKTsNCgkJfQ0KDQoJCWlmICh5QWxpZ24gPT09ICdjZW50ZXInKSB7DQoJCQlpZiAoeEFsaWduID09PSAnbGVmdCcpIHsNCgkJCQl4ICs9IHBhZGRpbmdBbmRTaXplOw0KCQkJfSBlbHNlIGlmICh4QWxpZ24gPT09ICdyaWdodCcpIHsNCgkJCQl4IC09IHBhZGRpbmdBbmRTaXplOw0KCQkJfQ0KCQl9IGVsc2UgaWYgKHhBbGlnbiA9PT0gJ2xlZnQnKSB7DQoJCQl4IC09IHJhZGl1c0FuZFBhZGRpbmc7DQoJCX0gZWxzZSBpZiAoeEFsaWduID09PSAncmlnaHQnKSB7DQoJCQl4ICs9IHJhZGl1c0FuZFBhZGRpbmc7DQoJCX0NCg0KCQlyZXR1cm4gew0KCQkJeDogeCwNCgkJCXk6IHkNCgkJfTsNCgl9DQoNCglDaGFydC5Ub29sdGlwID0gRWxlbWVudC5leHRlbmQoew0KCQlpbml0aWFsaXplOiBmdW5jdGlvbigpIHsNCgkJCXRoaXMuX21vZGVsID0gZ2V0QmFzZU1vZGVsKHRoaXMuX29wdGlvbnMpOw0KCQkJdGhpcy5fbGFzdEFjdGl2ZSA9IFtdOw0KCQl9LA0KDQoJCS8vIEdldCB0aGUgdGl0bGUNCgkJLy8gQXJncyBhcmU6ICh0b29sdGlwSXRlbSwgZGF0YSkNCgkJZ2V0VGl0bGU6IGZ1bmN0aW9uKCkgew0KCQkJdmFyIG1lID0gdGhpczsNCgkJCXZhciBvcHRzID0gbWUuX29wdGlvbnM7DQoJCQl2YXIgY2FsbGJhY2tzID0gb3B0cy5jYWxsYmFja3M7DQoNCgkJCXZhciBiZWZvcmVUaXRsZSA9IGNhbGxiYWNrcy5iZWZvcmVUaXRsZS5hcHBseShtZSwgYXJndW1lbnRzKTsNCgkJCXZhciB0aXRsZSA9IGNhbGxiYWNrcy50aXRsZS5hcHBseShtZSwgYXJndW1lbnRzKTsNCgkJCXZhciBhZnRlclRpdGxlID0gY2FsbGJhY2tzLmFmdGVyVGl0bGUuYXBwbHkobWUsIGFyZ3VtZW50cyk7DQoNCgkJCXZhciBsaW5lcyA9IFtdOw0KCQkJbGluZXMgPSBwdXNoT3JDb25jYXQobGluZXMsIGJlZm9yZVRpdGxlKTsNCgkJCWxpbmVzID0gcHVzaE9yQ29uY2F0KGxpbmVzLCB0aXRsZSk7DQoJCQlsaW5lcyA9IHB1c2hPckNvbmNhdChsaW5lcywgYWZ0ZXJUaXRsZSk7DQoNCgkJCXJldHVybiBsaW5lczsNCgkJfSwNCg0KCQkvLyBBcmdzIGFyZTogKHRvb2x0aXBJdGVtLCBkYXRhKQ0KCQlnZXRCZWZvcmVCb2R5OiBmdW5jdGlvbigpIHsNCgkJCXZhciBsaW5lcyA9IHRoaXMuX29wdGlvbnMuY2FsbGJhY2tzLmJlZm9yZUJvZHkuYXBwbHkodGhpcywgYXJndW1lbnRzKTsNCgkJCXJldHVybiBoZWxwZXJzLmlzQXJyYXkobGluZXMpID8gbGluZXMgOiBsaW5lcyAhPT0gdW5kZWZpbmVkID8gW2xpbmVzXSA6IFtdOw0KCQl9LA0KDQoJCS8vIEFyZ3MgYXJlOiAodG9vbHRpcEl0ZW0sIGRhdGEpDQoJCWdldEJvZHk6IGZ1bmN0aW9uKHRvb2x0aXBJdGVtcywgZGF0YSkgew0KCQkJdmFyIG1lID0gdGhpczsNCgkJCXZhciBjYWxsYmFja3MgPSBtZS5fb3B0aW9ucy5jYWxsYmFja3M7DQoJCQl2YXIgYm9keUl0ZW1zID0gW107DQoNCgkJCWhlbHBlcnMuZWFjaCh0b29sdGlwSXRlbXMsIGZ1bmN0aW9uKHRvb2x0aXBJdGVtKSB7DQoJCQkJdmFyIGJvZHlJdGVtID0gew0KCQkJCQliZWZvcmU6IFtdLA0KCQkJCQlsaW5lczogW10sDQoJCQkJCWFmdGVyOiBbXQ0KCQkJCX07DQoJCQkJcHVzaE9yQ29uY2F0KGJvZHlJdGVtLmJlZm9yZSwgY2FsbGJhY2tzLmJlZm9yZUxhYmVsLmNhbGwobWUsIHRvb2x0aXBJdGVtLCBkYXRhKSk7DQoJCQkJcHVzaE9yQ29uY2F0KGJvZHlJdGVtLmxpbmVzLCBjYWxsYmFja3MubGFiZWwuY2FsbChtZSwgdG9vbHRpcEl0ZW0sIGRhdGEpKTsNCgkJCQlwdXNoT3JDb25jYXQoYm9keUl0ZW0uYWZ0ZXIsIGNhbGxiYWNrcy5hZnRlckxhYmVsLmNhbGwobWUsIHRvb2x0aXBJdGVtLCBkYXRhKSk7DQoNCgkJCQlib2R5SXRlbXMucHVzaChib2R5SXRlbSk7DQoJCQl9KTsNCg0KCQkJcmV0dXJuIGJvZHlJdGVtczsNCgkJfSwNCg0KCQkvLyBBcmdzIGFyZTogKHRvb2x0aXBJdGVtLCBkYXRhKQ0KCQlnZXRBZnRlckJvZHk6IGZ1bmN0aW9uKCkgew0KCQkJdmFyIGxpbmVzID0gdGhpcy5fb3B0aW9ucy5jYWxsYmFja3MuYWZ0ZXJCb2R5LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7DQoJCQlyZXR1cm4gaGVscGVycy5pc0FycmF5KGxpbmVzKSA/IGxpbmVzIDogbGluZXMgIT09IHVuZGVmaW5lZCA/IFtsaW5lc10gOiBbXTsNCgkJfSwNCg0KCQkvLyBHZXQgdGhlIGZvb3RlciBhbmQgYmVmb3JlRm9vdGVyIGFuZCBhZnRlckZvb3RlciBsaW5lcw0KCQkvLyBBcmdzIGFyZTogKHRvb2x0aXBJdGVtLCBkYXRhKQ0KCQlnZXRGb290ZXI6IGZ1bmN0aW9uKCkgew0KCQkJdmFyIG1lID0gdGhpczsNCgkJCXZhciBjYWxsYmFja3MgPSBtZS5fb3B0aW9ucy5jYWxsYmFja3M7DQoNCgkJCXZhciBiZWZvcmVGb290ZXIgPSBjYWxsYmFja3MuYmVmb3JlRm9vdGVyLmFwcGx5KG1lLCBhcmd1bWVudHMpOw0KCQkJdmFyIGZvb3RlciA9IGNhbGxiYWNrcy5mb290ZXIuYXBwbHkobWUsIGFyZ3VtZW50cyk7DQoJCQl2YXIgYWZ0ZXJGb290ZXIgPSBjYWxsYmFja3MuYWZ0ZXJGb290ZXIuYXBwbHkobWUsIGFyZ3VtZW50cyk7DQoNCgkJCXZhciBsaW5lcyA9IFtdOw0KCQkJbGluZXMgPSBwdXNoT3JDb25jYXQobGluZXMsIGJlZm9yZUZvb3Rlcik7DQoJCQlsaW5lcyA9IHB1c2hPckNvbmNhdChsaW5lcywgZm9vdGVyKTsNCgkJCWxpbmVzID0gcHVzaE9yQ29uY2F0KGxpbmVzLCBhZnRlckZvb3Rlcik7DQoNCgkJCXJldHVybiBsaW5lczsNCgkJfSwNCg0KCQl1cGRhdGU6IGZ1bmN0aW9uKGNoYW5nZWQpIHsNCgkJCXZhciBtZSA9IHRoaXM7DQoJCQl2YXIgb3B0cyA9IG1lLl9vcHRpb25zOw0KDQoJCQkvLyBOZWVkIHRvIHJlZ2VuZXJhdGUgdGhlIG1vZGVsIGJlY2F1c2UgaXRzIGZhc3RlciB0aGFuIHVzaW5nIGV4dGVuZCBhbmQgaXQgaXMgbmVjZXNzYXJ5IGR1ZSB0byB0aGUgb3B0aW1pemF0aW9uIGluIENoYXJ0LkVsZW1lbnQudHJhbnNpdGlvbg0KCQkJLy8gdGhhdCBkb2VzIF92aWV3ID0gX21vZGVsIGlmIGVhc2UgPT09IDEuIFRoaXMgY2F1c2VzIHRoZSAybmQgdG9vbHRpcCB1cGRhdGUgdG8gc2V0IHByb3BlcnRpZXMgaW4gYm90aCB0aGUgdmlldyBhbmQgbW9kZWwgYXQgdGhlIHNhbWUgdGltZQ0KCQkJLy8gd2hpY2ggYnJlYWtzIGFueSBhbmltYXRpb25zLg0KCQkJdmFyIGV4aXN0aW5nTW9kZWwgPSBtZS5fbW9kZWw7DQoJCQl2YXIgbW9kZWwgPSBtZS5fbW9kZWwgPSBnZXRCYXNlTW9kZWwob3B0cyk7DQoJCQl2YXIgYWN0aXZlID0gbWUuX2FjdGl2ZTsNCg0KCQkJdmFyIGRhdGEgPSBtZS5fZGF0YTsNCg0KCQkJLy8gSW4gdGhlIGNhc2Ugd2hlcmUgYWN0aXZlLmxlbmd0aCA9PT0gMCB3ZSBuZWVkIHRvIGtlZXAgdGhlc2UgYXQgZXhpc3RpbmcgdmFsdWVzIGZvciBnb29kIGFuaW1hdGlvbnMNCgkJCXZhciBhbGlnbm1lbnQgPSB7DQoJCQkJeEFsaWduOiBleGlzdGluZ01vZGVsLnhBbGlnbiwNCgkJCQl5QWxpZ246IGV4aXN0aW5nTW9kZWwueUFsaWduDQoJCQl9Ow0KCQkJdmFyIGJhY2tncm91bmRQb2ludCA9IHsNCgkJCQl4OiBleGlzdGluZ01vZGVsLngsDQoJCQkJeTogZXhpc3RpbmdNb2RlbC55DQoJCQl9Ow0KCQkJdmFyIHRvb2x0aXBTaXplID0gew0KCQkJCXdpZHRoOiBleGlzdGluZ01vZGVsLndpZHRoLA0KCQkJCWhlaWdodDogZXhpc3RpbmdNb2RlbC5oZWlnaHQNCgkJCX07DQoJCQl2YXIgdG9vbHRpcFBvc2l0aW9uID0gew0KCQkJCXg6IGV4aXN0aW5nTW9kZWwuY2FyZXRYLA0KCQkJCXk6IGV4aXN0aW5nTW9kZWwuY2FyZXRZDQoJCQl9Ow0KDQoJCQl2YXIgaSwgbGVuOw0KDQoJCQlpZiAoYWN0aXZlLmxlbmd0aCkgew0KCQkJCW1vZGVsLm9wYWNpdHkgPSAxOw0KDQoJCQkJdmFyIGxhYmVsQ29sb3JzID0gW107DQoJCQkJdmFyIGxhYmVsVGV4dENvbG9ycyA9IFtdOw0KCQkJCXRvb2x0aXBQb3NpdGlvbiA9IENoYXJ0LlRvb2x0aXAucG9zaXRpb25lcnNbb3B0cy5wb3NpdGlvbl0uY2FsbChtZSwgYWN0aXZlLCBtZS5fZXZlbnRQb3NpdGlvbik7DQoNCgkJCQl2YXIgdG9vbHRpcEl0ZW1zID0gW107DQoJCQkJZm9yIChpID0gMCwgbGVuID0gYWN0aXZlLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7DQoJCQkJCXRvb2x0aXBJdGVtcy5wdXNoKGNyZWF0ZVRvb2x0aXBJdGVtKGFjdGl2ZVtpXSkpOw0KCQkJCX0NCg0KCQkJCS8vIElmIHRoZSB1c2VyIHByb3ZpZGVkIGEgZmlsdGVyIGZ1bmN0aW9uLCB1c2UgaXQgdG8gbW9kaWZ5IHRoZSB0b29sdGlwIGl0ZW1zDQoJCQkJaWYgKG9wdHMuZmlsdGVyKSB7DQoJCQkJCXRvb2x0aXBJdGVtcyA9IHRvb2x0aXBJdGVtcy5maWx0ZXIoZnVuY3Rpb24oYSkgew0KCQkJCQkJcmV0dXJuIG9wdHMuZmlsdGVyKGEsIGRhdGEpOw0KCQkJCQl9KTsNCgkJCQl9DQoNCgkJCQkvLyBJZiB0aGUgdXNlciBwcm92aWRlZCBhIHNvcnRpbmcgZnVuY3Rpb24sIHVzZSBpdCB0byBtb2RpZnkgdGhlIHRvb2x0aXAgaXRlbXMNCgkJCQlpZiAob3B0cy5pdGVtU29ydCkgew0KCQkJCQl0b29sdGlwSXRlbXMgPSB0b29sdGlwSXRlbXMuc29ydChmdW5jdGlvbihhLCBiKSB7DQoJCQkJCQlyZXR1cm4gb3B0cy5pdGVtU29ydChhLCBiLCBkYXRhKTsNCgkJCQkJfSk7DQoJCQkJfQ0KDQoJCQkJLy8gRGV0ZXJtaW5lIGNvbG9ycyBmb3IgYm94ZXMNCgkJCQloZWxwZXJzLmVhY2godG9vbHRpcEl0ZW1zLCBmdW5jdGlvbih0b29sdGlwSXRlbSkgew0KCQkJCQlsYWJlbENvbG9ycy5wdXNoKG9wdHMuY2FsbGJhY2tzLmxhYmVsQ29sb3IuY2FsbChtZSwgdG9vbHRpcEl0ZW0sIG1lLl9jaGFydCkpOw0KCQkJCQlsYWJlbFRleHRDb2xvcnMucHVzaChvcHRzLmNhbGxiYWNrcy5sYWJlbFRleHRDb2xvci5jYWxsKG1lLCB0b29sdGlwSXRlbSwgbWUuX2NoYXJ0KSk7DQoJCQkJfSk7DQoNCg0KCQkJCS8vIEJ1aWxkIHRoZSBUZXh0IExpbmVzDQoJCQkJbW9kZWwudGl0bGUgPSBtZS5nZXRUaXRsZSh0b29sdGlwSXRlbXMsIGRhdGEpOw0KCQkJCW1vZGVsLmJlZm9yZUJvZHkgPSBtZS5nZXRCZWZvcmVCb2R5KHRvb2x0aXBJdGVtcywgZGF0YSk7DQoJCQkJbW9kZWwuYm9keSA9IG1lLmdldEJvZHkodG9vbHRpcEl0ZW1zLCBkYXRhKTsNCgkJCQltb2RlbC5hZnRlckJvZHkgPSBtZS5nZXRBZnRlckJvZHkodG9vbHRpcEl0ZW1zLCBkYXRhKTsNCgkJCQltb2RlbC5mb290ZXIgPSBtZS5nZXRGb290ZXIodG9vbHRpcEl0ZW1zLCBkYXRhKTsNCg0KCQkJCS8vIEluaXRpYWwgcG9zaXRpb25pbmcgYW5kIGNvbG9ycw0KCQkJCW1vZGVsLnggPSBNYXRoLnJvdW5kKHRvb2x0aXBQb3NpdGlvbi54KTsNCgkJCQltb2RlbC55ID0gTWF0aC5yb3VuZCh0b29sdGlwUG9zaXRpb24ueSk7DQoJCQkJbW9kZWwuY2FyZXRQYWRkaW5nID0gb3B0cy5jYXJldFBhZGRpbmc7DQoJCQkJbW9kZWwubGFiZWxDb2xvcnMgPSBsYWJlbENvbG9yczsNCgkJCQltb2RlbC5sYWJlbFRleHRDb2xvcnMgPSBsYWJlbFRleHRDb2xvcnM7DQoNCgkJCQkvLyBkYXRhIHBvaW50cw0KCQkJCW1vZGVsLmRhdGFQb2ludHMgPSB0b29sdGlwSXRlbXM7DQoNCgkJCQkvLyBXZSBuZWVkIHRvIGRldGVybWluZSBhbGlnbm1lbnQgb2YgdGhlIHRvb2x0aXANCgkJCQl0b29sdGlwU2l6ZSA9IGdldFRvb2x0aXBTaXplKHRoaXMsIG1vZGVsKTsNCgkJCQlhbGlnbm1lbnQgPSBkZXRlcm1pbmVBbGlnbm1lbnQodGhpcywgdG9vbHRpcFNpemUpOw0KCQkJCS8vIEZpbmFsIFNpemUgYW5kIFBvc2l0aW9uDQoJCQkJYmFja2dyb3VuZFBvaW50ID0gZ2V0QmFja2dyb3VuZFBvaW50KG1vZGVsLCB0b29sdGlwU2l6ZSwgYWxpZ25tZW50KTsNCgkJCX0gZWxzZSB7DQoJCQkJbW9kZWwub3BhY2l0eSA9IDA7DQoJCQl9DQoNCgkJCW1vZGVsLnhBbGlnbiA9IGFsaWdubWVudC54QWxpZ247DQoJCQltb2RlbC55QWxpZ24gPSBhbGlnbm1lbnQueUFsaWduOw0KCQkJbW9kZWwueCA9IGJhY2tncm91bmRQb2ludC54Ow0KCQkJbW9kZWwueSA9IGJhY2tncm91bmRQb2ludC55Ow0KCQkJbW9kZWwud2lkdGggPSB0b29sdGlwU2l6ZS53aWR0aDsNCgkJCW1vZGVsLmhlaWdodCA9IHRvb2x0aXBTaXplLmhlaWdodDsNCg0KCQkJLy8gUG9pbnQgd2hlcmUgdGhlIGNhcmV0IG9uIHRoZSB0b29sdGlwIHBvaW50cyB0bw0KCQkJbW9kZWwuY2FyZXRYID0gdG9vbHRpcFBvc2l0aW9uLng7DQoJCQltb2RlbC5jYXJldFkgPSB0b29sdGlwUG9zaXRpb24ueTsNCg0KCQkJbWUuX21vZGVsID0gbW9kZWw7DQoNCgkJCWlmIChjaGFuZ2VkICYmIG9wdHMuY3VzdG9tKSB7DQoJCQkJb3B0cy5jdXN0b20uY2FsbChtZSwgbW9kZWwpOw0KCQkJfQ0KDQoJCQlyZXR1cm4gbWU7DQoJCX0sDQoJCWRyYXdDYXJldDogZnVuY3Rpb24odG9vbHRpcFBvaW50LCBzaXplKSB7DQoJCQl2YXIgY3R4ID0gdGhpcy5fY2hhcnQuY3R4Ow0KCQkJdmFyIHZtID0gdGhpcy5fdmlldzsNCgkJCXZhciBjYXJldFBvc2l0aW9uID0gdGhpcy5nZXRDYXJldFBvc2l0aW9uKHRvb2x0aXBQb2ludCwgc2l6ZSwgdm0pOw0KDQoJCQljdHgubGluZVRvKGNhcmV0UG9zaXRpb24ueDEsIGNhcmV0UG9zaXRpb24ueTEpOw0KCQkJY3R4LmxpbmVUbyhjYXJldFBvc2l0aW9uLngyLCBjYXJldFBvc2l0aW9uLnkyKTsNCgkJCWN0eC5saW5lVG8oY2FyZXRQb3NpdGlvbi54MywgY2FyZXRQb3NpdGlvbi55Myk7DQoJCX0sDQoJCWdldENhcmV0UG9zaXRpb246IGZ1bmN0aW9uKHRvb2x0aXBQb2ludCwgc2l6ZSwgdm0pIHsNCgkJCXZhciB4MSwgeDIsIHgzLCB5MSwgeTIsIHkzOw0KCQkJdmFyIGNhcmV0U2l6ZSA9IHZtLmNhcmV0U2l6ZTsNCgkJCXZhciBjb3JuZXJSYWRpdXMgPSB2bS5jb3JuZXJSYWRpdXM7DQoJCQl2YXIgeEFsaWduID0gdm0ueEFsaWduOw0KCQkJdmFyIHlBbGlnbiA9IHZtLnlBbGlnbjsNCgkJCXZhciBwdFggPSB0b29sdGlwUG9pbnQueDsNCgkJCXZhciBwdFkgPSB0b29sdGlwUG9pbnQueTsNCgkJCXZhciB3aWR0aCA9IHNpemUud2lkdGg7DQoJCQl2YXIgaGVpZ2h0ID0gc2l6ZS5oZWlnaHQ7DQoNCgkJCWlmICh5QWxpZ24gPT09ICdjZW50ZXInKSB7DQoJCQkJeTIgPSBwdFkgKyAoaGVpZ2h0IC8gMik7DQoNCgkJCQlpZiAoeEFsaWduID09PSAnbGVmdCcpIHsNCgkJCQkJeDEgPSBwdFg7DQoJCQkJCXgyID0geDEgLSBjYXJldFNpemU7DQoJCQkJCXgzID0geDE7DQoNCgkJCQkJeTEgPSB5MiArIGNhcmV0U2l6ZTsNCgkJCQkJeTMgPSB5MiAtIGNhcmV0U2l6ZTsNCgkJCQl9IGVsc2Ugew0KCQkJCQl4MSA9IHB0WCArIHdpZHRoOw0KCQkJCQl4MiA9IHgxICsgY2FyZXRTaXplOw0KCQkJCQl4MyA9IHgxOw0KDQoJCQkJCXkxID0geTIgLSBjYXJldFNpemU7DQoJCQkJCXkzID0geTIgKyBjYXJldFNpemU7DQoJCQkJfQ0KCQkJfSBlbHNlIHsNCgkJCQlpZiAoeEFsaWduID09PSAnbGVmdCcpIHsNCgkJCQkJeDIgPSBwdFggKyBjb3JuZXJSYWRpdXMgKyAoY2FyZXRTaXplKTsNCgkJCQkJeDEgPSB4MiAtIGNhcmV0U2l6ZTsNCgkJCQkJeDMgPSB4MiArIGNhcmV0U2l6ZTsNCgkJCQl9IGVsc2UgaWYgKHhBbGlnbiA9PT0gJ3JpZ2h0Jykgew0KCQkJCQl4MiA9IHB0WCArIHdpZHRoIC0gY29ybmVyUmFkaXVzIC0gY2FyZXRTaXplOw0KCQkJCQl4MSA9IHgyIC0gY2FyZXRTaXplOw0KCQkJCQl4MyA9IHgyICsgY2FyZXRTaXplOw0KCQkJCX0gZWxzZSB7DQoJCQkJCXgyID0gcHRYICsgKHdpZHRoIC8gMik7DQoJCQkJCXgxID0geDIgLSBjYXJldFNpemU7DQoJCQkJCXgzID0geDIgKyBjYXJldFNpemU7DQoJCQkJfQ0KCQkJCWlmICh5QWxpZ24gPT09ICd0b3AnKSB7DQoJCQkJCXkxID0gcHRZOw0KCQkJCQl5MiA9IHkxIC0gY2FyZXRTaXplOw0KCQkJCQl5MyA9IHkxOw0KCQkJCX0gZWxzZSB7DQoJCQkJCXkxID0gcHRZICsgaGVpZ2h0Ow0KCQkJCQl5MiA9IHkxICsgY2FyZXRTaXplOw0KCQkJCQl5MyA9IHkxOw0KCQkJCQkvLyBpbnZlcnQgZHJhd2luZyBvcmRlcg0KCQkJCQl2YXIgdG1wID0geDM7DQoJCQkJCXgzID0geDE7DQoJCQkJCXgxID0gdG1wOw0KCQkJCX0NCgkJCX0NCgkJCXJldHVybiB7eDE6IHgxLCB4MjogeDIsIHgzOiB4MywgeTE6IHkxLCB5MjogeTIsIHkzOiB5M307DQoJCX0sDQoJCWRyYXdUaXRsZTogZnVuY3Rpb24ocHQsIHZtLCBjdHgsIG9wYWNpdHkpIHsNCgkJCXZhciB0aXRsZSA9IHZtLnRpdGxlOw0KDQoJCQlpZiAodGl0bGUubGVuZ3RoKSB7DQoJCQkJY3R4LnRleHRBbGlnbiA9IHZtLl90aXRsZUFsaWduOw0KCQkJCWN0eC50ZXh0QmFzZWxpbmUgPSAndG9wJzsNCg0KCQkJCXZhciB0aXRsZUZvbnRTaXplID0gdm0udGl0bGVGb250U2l6ZTsNCgkJCQl2YXIgdGl0bGVTcGFjaW5nID0gdm0udGl0bGVTcGFjaW5nOw0KDQoJCQkJY3R4LmZpbGxTdHlsZSA9IG1lcmdlT3BhY2l0eSh2bS50aXRsZUZvbnRDb2xvciwgb3BhY2l0eSk7DQoJCQkJY3R4LmZvbnQgPSBoZWxwZXJzLmZvbnRTdHJpbmcodGl0bGVGb250U2l6ZSwgdm0uX3RpdGxlRm9udFN0eWxlLCB2bS5fdGl0bGVGb250RmFtaWx5KTsNCg0KCQkJCXZhciBpLCBsZW47DQoJCQkJZm9yIChpID0gMCwgbGVuID0gdGl0bGUubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHsNCgkJCQkJY3R4LmZpbGxUZXh0KHRpdGxlW2ldLCBwdC54LCBwdC55KTsNCgkJCQkJcHQueSArPSB0aXRsZUZvbnRTaXplICsgdGl0bGVTcGFjaW5nOyAvLyBMaW5lIEhlaWdodCBhbmQgc3BhY2luZw0KDQoJCQkJCWlmIChpICsgMSA9PT0gdGl0bGUubGVuZ3RoKSB7DQoJCQkJCQlwdC55ICs9IHZtLnRpdGxlTWFyZ2luQm90dG9tIC0gdGl0bGVTcGFjaW5nOyAvLyBJZiBMYXN0LCBhZGQgbWFyZ2luLCByZW1vdmUgc3BhY2luZw0KCQkJCQl9DQoJCQkJfQ0KCQkJfQ0KCQl9LA0KCQlkcmF3Qm9keTogZnVuY3Rpb24ocHQsIHZtLCBjdHgsIG9wYWNpdHkpIHsNCgkJCXZhciBib2R5Rm9udFNpemUgPSB2bS5ib2R5Rm9udFNpemU7DQoJCQl2YXIgYm9keVNwYWNpbmcgPSB2bS5ib2R5U3BhY2luZzsNCgkJCXZhciBib2R5ID0gdm0uYm9keTsNCg0KCQkJY3R4LnRleHRBbGlnbiA9IHZtLl9ib2R5QWxpZ247DQoJCQljdHgudGV4dEJhc2VsaW5lID0gJ3RvcCc7DQoJCQljdHguZm9udCA9IGhlbHBlcnMuZm9udFN0cmluZyhib2R5Rm9udFNpemUsIHZtLl9ib2R5Rm9udFN0eWxlLCB2bS5fYm9keUZvbnRGYW1pbHkpOw0KDQoJCQkvLyBCZWZvcmUgQm9keQ0KCQkJdmFyIHhMaW5lUGFkZGluZyA9IDA7DQoJCQl2YXIgZmlsbExpbmVPZlRleHQgPSBmdW5jdGlvbihsaW5lKSB7DQoJCQkJY3R4LmZpbGxUZXh0KGxpbmUsIHB0LnggKyB4TGluZVBhZGRpbmcsIHB0LnkpOw0KCQkJCXB0LnkgKz0gYm9keUZvbnRTaXplICsgYm9keVNwYWNpbmc7DQoJCQl9Ow0KDQoJCQkvLyBCZWZvcmUgYm9keSBsaW5lcw0KCQkJY3R4LmZpbGxTdHlsZSA9IG1lcmdlT3BhY2l0eSh2bS5ib2R5Rm9udENvbG9yLCBvcGFjaXR5KTsNCgkJCWhlbHBlcnMuZWFjaCh2bS5iZWZvcmVCb2R5LCBmaWxsTGluZU9mVGV4dCk7DQoNCgkJCXZhciBkcmF3Q29sb3JCb3hlcyA9IHZtLmRpc3BsYXlDb2xvcnM7DQoJCQl4TGluZVBhZGRpbmcgPSBkcmF3Q29sb3JCb3hlcyA/IChib2R5Rm9udFNpemUgKyAyKSA6IDA7DQoNCgkJCS8vIERyYXcgYm9keSBsaW5lcyBub3cNCgkJCWhlbHBlcnMuZWFjaChib2R5LCBmdW5jdGlvbihib2R5SXRlbSwgaSkgew0KCQkJCXZhciB0ZXh0Q29sb3IgPSBtZXJnZU9wYWNpdHkodm0ubGFiZWxUZXh0Q29sb3JzW2ldLCBvcGFjaXR5KTsNCgkJCQljdHguZmlsbFN0eWxlID0gdGV4dENvbG9yOw0KCQkJCWhlbHBlcnMuZWFjaChib2R5SXRlbS5iZWZvcmUsIGZpbGxMaW5lT2ZUZXh0KTsNCg0KCQkJCWhlbHBlcnMuZWFjaChib2R5SXRlbS5saW5lcywgZnVuY3Rpb24obGluZSkgew0KCQkJCQkvLyBEcmF3IExlZ2VuZC1saWtlIGJveGVzIGlmIG5lZWRlZA0KCQkJCQlpZiAoZHJhd0NvbG9yQm94ZXMpIHsNCgkJCQkJCS8vIEZpbGwgYSB3aGl0ZSByZWN0IHNvIHRoYXQgY29sb3VycyBtZXJnZSBuaWNlbHkgaWYgdGhlIG9wYWNpdHkgaXMgPCAxDQoJCQkJCQljdHguZmlsbFN0eWxlID0gbWVyZ2VPcGFjaXR5KHZtLmxlZ2VuZENvbG9yQmFja2dyb3VuZCwgb3BhY2l0eSk7DQoJCQkJCQljdHguZmlsbFJlY3QocHQueCwgcHQueSwgYm9keUZvbnRTaXplLCBib2R5Rm9udFNpemUpOw0KDQoJCQkJCQkvLyBCb3JkZXINCgkJCQkJCWN0eC5saW5lV2lkdGggPSAxOw0KCQkJCQkJY3R4LnN0cm9rZVN0eWxlID0gbWVyZ2VPcGFjaXR5KHZtLmxhYmVsQ29sb3JzW2ldLmJvcmRlckNvbG9yLCBvcGFjaXR5KTsNCgkJCQkJCWN0eC5zdHJva2VSZWN0KHB0LngsIHB0LnksIGJvZHlGb250U2l6ZSwgYm9keUZvbnRTaXplKTsNCg0KCQkJCQkJLy8gSW5uZXIgc3F1YXJlDQoJCQkJCQljdHguZmlsbFN0eWxlID0gbWVyZ2VPcGFjaXR5KHZtLmxhYmVsQ29sb3JzW2ldLmJhY2tncm91bmRDb2xvciwgb3BhY2l0eSk7DQoJCQkJCQljdHguZmlsbFJlY3QocHQueCArIDEsIHB0LnkgKyAxLCBib2R5Rm9udFNpemUgLSAyLCBib2R5Rm9udFNpemUgLSAyKTsNCgkJCQkJCWN0eC5maWxsU3R5bGUgPSB0ZXh0Q29sb3I7DQoJCQkJCX0NCg0KCQkJCQlmaWxsTGluZU9mVGV4dChsaW5lKTsNCgkJCQl9KTsNCg0KCQkJCWhlbHBlcnMuZWFjaChib2R5SXRlbS5hZnRlciwgZmlsbExpbmVPZlRleHQpOw0KCQkJfSk7DQoNCgkJCS8vIFJlc2V0IGJhY2sgdG8gMCBmb3IgYWZ0ZXIgYm9keQ0KCQkJeExpbmVQYWRkaW5nID0gMDsNCg0KCQkJLy8gQWZ0ZXIgYm9keSBsaW5lcw0KCQkJaGVscGVycy5lYWNoKHZtLmFmdGVyQm9keSwgZmlsbExpbmVPZlRleHQpOw0KCQkJcHQueSAtPSBib2R5U3BhY2luZzsgLy8gUmVtb3ZlIGxhc3QgYm9keSBzcGFjaW5nDQoJCX0sDQoJCWRyYXdGb290ZXI6IGZ1bmN0aW9uKHB0LCB2bSwgY3R4LCBvcGFjaXR5KSB7DQoJCQl2YXIgZm9vdGVyID0gdm0uZm9vdGVyOw0KDQoJCQlpZiAoZm9vdGVyLmxlbmd0aCkgew0KCQkJCXB0LnkgKz0gdm0uZm9vdGVyTWFyZ2luVG9wOw0KDQoJCQkJY3R4LnRleHRBbGlnbiA9IHZtLl9mb290ZXJBbGlnbjsNCgkJCQljdHgudGV4dEJhc2VsaW5lID0gJ3RvcCc7DQoNCgkJCQljdHguZmlsbFN0eWxlID0gbWVyZ2VPcGFjaXR5KHZtLmZvb3RlckZvbnRDb2xvciwgb3BhY2l0eSk7DQoJCQkJY3R4LmZvbnQgPSBoZWxwZXJzLmZvbnRTdHJpbmcodm0uZm9vdGVyRm9udFNpemUsIHZtLl9mb290ZXJGb250U3R5bGUsIHZtLl9mb290ZXJGb250RmFtaWx5KTsNCg0KCQkJCWhlbHBlcnMuZWFjaChmb290ZXIsIGZ1bmN0aW9uKGxpbmUpIHsNCgkJCQkJY3R4LmZpbGxUZXh0KGxpbmUsIHB0LngsIHB0LnkpOw0KCQkJCQlwdC55ICs9IHZtLmZvb3RlckZvbnRTaXplICsgdm0uZm9vdGVyU3BhY2luZzsNCgkJCQl9KTsNCgkJCX0NCgkJfSwNCgkJZHJhd0JhY2tncm91bmQ6IGZ1bmN0aW9uKHB0LCB2bSwgY3R4LCB0b29sdGlwU2l6ZSwgb3BhY2l0eSkgew0KCQkJY3R4LmZpbGxTdHlsZSA9IG1lcmdlT3BhY2l0eSh2bS5iYWNrZ3JvdW5kQ29sb3IsIG9wYWNpdHkpOw0KCQkJY3R4LnN0cm9rZVN0eWxlID0gbWVyZ2VPcGFjaXR5KHZtLmJvcmRlckNvbG9yLCBvcGFjaXR5KTsNCgkJCWN0eC5saW5lV2lkdGggPSB2bS5ib3JkZXJXaWR0aDsNCgkJCXZhciB4QWxpZ24gPSB2bS54QWxpZ247DQoJCQl2YXIgeUFsaWduID0gdm0ueUFsaWduOw0KCQkJdmFyIHggPSBwdC54Ow0KCQkJdmFyIHkgPSBwdC55Ow0KCQkJdmFyIHdpZHRoID0gdG9vbHRpcFNpemUud2lkdGg7DQoJCQl2YXIgaGVpZ2h0ID0gdG9vbHRpcFNpemUuaGVpZ2h0Ow0KCQkJdmFyIHJhZGl1cyA9IHZtLmNvcm5lclJhZGl1czsNCg0KCQkJY3R4LmJlZ2luUGF0aCgpOw0KCQkJY3R4Lm1vdmVUbyh4ICsgcmFkaXVzLCB5KTsNCgkJCWlmICh5QWxpZ24gPT09ICd0b3AnKSB7DQoJCQkJdGhpcy5kcmF3Q2FyZXQocHQsIHRvb2x0aXBTaXplKTsNCgkJCX0NCgkJCWN0eC5saW5lVG8oeCArIHdpZHRoIC0gcmFkaXVzLCB5KTsNCgkJCWN0eC5xdWFkcmF0aWNDdXJ2ZVRvKHggKyB3aWR0aCwgeSwgeCArIHdpZHRoLCB5ICsgcmFkaXVzKTsNCgkJCWlmICh5QWxpZ24gPT09ICdjZW50ZXInICYmIHhBbGlnbiA9PT0gJ3JpZ2h0Jykgew0KCQkJCXRoaXMuZHJhd0NhcmV0KHB0LCB0b29sdGlwU2l6ZSk7DQoJCQl9DQoJCQljdHgubGluZVRvKHggKyB3aWR0aCwgeSArIGhlaWdodCAtIHJhZGl1cyk7DQoJCQljdHgucXVhZHJhdGljQ3VydmVUbyh4ICsgd2lkdGgsIHkgKyBoZWlnaHQsIHggKyB3aWR0aCAtIHJhZGl1cywgeSArIGhlaWdodCk7DQoJCQlpZiAoeUFsaWduID09PSAnYm90dG9tJykgew0KCQkJCXRoaXMuZHJhd0NhcmV0KHB0LCB0b29sdGlwU2l6ZSk7DQoJCQl9DQoJCQljdHgubGluZVRvKHggKyByYWRpdXMsIHkgKyBoZWlnaHQpOw0KCQkJY3R4LnF1YWRyYXRpY0N1cnZlVG8oeCwgeSArIGhlaWdodCwgeCwgeSArIGhlaWdodCAtIHJhZGl1cyk7DQoJCQlpZiAoeUFsaWduID09PSAnY2VudGVyJyAmJiB4QWxpZ24gPT09ICdsZWZ0Jykgew0KCQkJCXRoaXMuZHJhd0NhcmV0KHB0LCB0b29sdGlwU2l6ZSk7DQoJCQl9DQoJCQljdHgubGluZVRvKHgsIHkgKyByYWRpdXMpOw0KCQkJY3R4LnF1YWRyYXRpY0N1cnZlVG8oeCwgeSwgeCArIHJhZGl1cywgeSk7DQoJCQljdHguY2xvc2VQYXRoKCk7DQoNCgkJCWN0eC5maWxsKCk7DQoNCgkJCWlmICh2bS5ib3JkZXJXaWR0aCA+IDApIHsNCgkJCQljdHguc3Ryb2tlKCk7DQoJCQl9DQoJCX0sDQoJCWRyYXc6IGZ1bmN0aW9uKCkgew0KCQkJdmFyIGN0eCA9IHRoaXMuX2NoYXJ0LmN0eDsNCgkJCXZhciB2bSA9IHRoaXMuX3ZpZXc7DQoNCgkJCWlmICh2bS5vcGFjaXR5ID09PSAwKSB7DQoJCQkJcmV0dXJuOw0KCQkJfQ0KDQoJCQl2YXIgdG9vbHRpcFNpemUgPSB7DQoJCQkJd2lkdGg6IHZtLndpZHRoLA0KCQkJCWhlaWdodDogdm0uaGVpZ2h0DQoJCQl9Ow0KCQkJdmFyIHB0ID0gew0KCQkJCXg6IHZtLngsDQoJCQkJeTogdm0ueQ0KCQkJfTsNCg0KCQkJLy8gSUUxMS9FZGdlIGRvZXMgbm90IGxpa2UgdmVyeSBzbWFsbCBvcGFjaXRpZXMsIHNvIHNuYXAgdG8gMA0KCQkJdmFyIG9wYWNpdHkgPSBNYXRoLmFicyh2bS5vcGFjaXR5IDwgMWUtMykgPyAwIDogdm0ub3BhY2l0eTsNCg0KCQkJLy8gVHJ1dGh5L2ZhbHNleSB2YWx1ZSBmb3IgZW1wdHkgdG9vbHRpcA0KCQkJdmFyIGhhc1Rvb2x0aXBDb250ZW50ID0gdm0udGl0bGUubGVuZ3RoIHx8IHZtLmJlZm9yZUJvZHkubGVuZ3RoIHx8IHZtLmJvZHkubGVuZ3RoIHx8IHZtLmFmdGVyQm9keS5sZW5ndGggfHwgdm0uZm9vdGVyLmxlbmd0aDsNCg0KCQkJaWYgKHRoaXMuX29wdGlvbnMuZW5hYmxlZCAmJiBoYXNUb29sdGlwQ29udGVudCkgew0KCQkJCS8vIERyYXcgQmFja2dyb3VuZA0KCQkJCXRoaXMuZHJhd0JhY2tncm91bmQocHQsIHZtLCBjdHgsIHRvb2x0aXBTaXplLCBvcGFjaXR5KTsNCg0KCQkJCS8vIERyYXcgVGl0bGUsIEJvZHksIGFuZCBGb290ZXINCgkJCQlwdC54ICs9IHZtLnhQYWRkaW5nOw0KCQkJCXB0LnkgKz0gdm0ueVBhZGRpbmc7DQoNCgkJCQkvLyBUaXRsZXMNCgkJCQl0aGlzLmRyYXdUaXRsZShwdCwgdm0sIGN0eCwgb3BhY2l0eSk7DQoNCgkJCQkvLyBCb2R5DQoJCQkJdGhpcy5kcmF3Qm9keShwdCwgdm0sIGN0eCwgb3BhY2l0eSk7DQoNCgkJCQkvLyBGb290ZXINCgkJCQl0aGlzLmRyYXdGb290ZXIocHQsIHZtLCBjdHgsIG9wYWNpdHkpOw0KCQkJfQ0KCQl9LA0KDQoJCS8qKg0KCQkgKiBIYW5kbGUgYW4gZXZlbnQNCgkJICogQHByaXZhdGUNCgkJICogQHBhcmFtIHtJRXZlbnR9IGV2ZW50IC0gVGhlIGV2ZW50IHRvIGhhbmRsZQ0KCQkgKiBAcmV0dXJucyB7Qm9vbGVhbn0gdHJ1ZSBpZiB0aGUgdG9vbHRpcCBjaGFuZ2VkDQoJCSAqLw0KCQloYW5kbGVFdmVudDogZnVuY3Rpb24oZSkgew0KCQkJdmFyIG1lID0gdGhpczsNCgkJCXZhciBvcHRpb25zID0gbWUuX29wdGlvbnM7DQoJCQl2YXIgY2hhbmdlZCA9IGZhbHNlOw0KDQoJCQltZS5fbGFzdEFjdGl2ZSA9IG1lLl9sYXN0QWN0aXZlIHx8IFtdOw0KDQoJCQkvLyBGaW5kIEFjdGl2ZSBFbGVtZW50cyBmb3IgdG9vbHRpcHMNCgkJCWlmIChlLnR5cGUgPT09ICdtb3VzZW91dCcpIHsNCgkJCQltZS5fYWN0aXZlID0gW107DQoJCQl9IGVsc2Ugew0KCQkJCW1lLl9hY3RpdmUgPSBtZS5fY2hhcnQuZ2V0RWxlbWVudHNBdEV2ZW50Rm9yTW9kZShlLCBvcHRpb25zLm1vZGUsIG9wdGlvbnMpOw0KCQkJfQ0KDQoJCQkvLyBSZW1lbWJlciBMYXN0IEFjdGl2ZXMNCgkJCWNoYW5nZWQgPSAhaGVscGVycy5hcnJheUVxdWFscyhtZS5fYWN0aXZlLCBtZS5fbGFzdEFjdGl2ZSk7DQoNCgkJCS8vIElmIHRvb2x0aXAgZGlkbid0IGNoYW5nZSwgZG8gbm90IGhhbmRsZSB0aGUgdGFyZ2V0IGV2ZW50DQoJCQlpZiAoIWNoYW5nZWQpIHsNCgkJCQlyZXR1cm4gZmFsc2U7DQoJCQl9DQoNCgkJCW1lLl9sYXN0QWN0aXZlID0gbWUuX2FjdGl2ZTsNCg0KCQkJaWYgKG9wdGlvbnMuZW5hYmxlZCB8fCBvcHRpb25zLmN1c3RvbSkgew0KCQkJCW1lLl9ldmVudFBvc2l0aW9uID0gew0KCQkJCQl4OiBlLngsDQoJCQkJCXk6IGUueQ0KCQkJCX07DQoNCgkJCQl2YXIgbW9kZWwgPSBtZS5fbW9kZWw7DQoJCQkJbWUudXBkYXRlKHRydWUpOw0KCQkJCW1lLnBpdm90KCk7DQoNCgkJCQkvLyBTZWUgaWYgb3VyIHRvb2x0aXAgcG9zaXRpb24gY2hhbmdlZA0KCQkJCWNoYW5nZWQgfD0gKG1vZGVsLnggIT09IG1lLl9tb2RlbC54KSB8fCAobW9kZWwueSAhPT0gbWUuX21vZGVsLnkpOw0KCQkJfQ0KDQoJCQlyZXR1cm4gY2hhbmdlZDsNCgkJfQ0KCX0pOw0KDQoJLyoqDQoJICogQG5hbWVzcGFjZSBDaGFydC5Ub29sdGlwLnBvc2l0aW9uZXJzDQoJICovDQoJQ2hhcnQuVG9vbHRpcC5wb3NpdGlvbmVycyA9IHsNCgkJLyoqDQoJCSAqIEF2ZXJhZ2UgbW9kZSBwbGFjZXMgdGhlIHRvb2x0aXAgYXQgdGhlIGF2ZXJhZ2UgcG9zaXRpb24gb2YgdGhlIGVsZW1lbnRzIHNob3duDQoJCSAqIEBmdW5jdGlvbiBDaGFydC5Ub29sdGlwLnBvc2l0aW9uZXJzLmF2ZXJhZ2UNCgkJICogQHBhcmFtIGVsZW1lbnRzIHtDaGFydEVsZW1lbnRbXX0gdGhlIGVsZW1lbnRzIGJlaW5nIGRpc3BsYXllZCBpbiB0aGUgdG9vbHRpcA0KCQkgKiBAcmV0dXJucyB7UG9pbnR9IHRvb2x0aXAgcG9zaXRpb24NCgkJICovDQoJCWF2ZXJhZ2U6IGZ1bmN0aW9uKGVsZW1lbnRzKSB7DQoJCQlpZiAoIWVsZW1lbnRzLmxlbmd0aCkgew0KCQkJCXJldHVybiBmYWxzZTsNCgkJCX0NCg0KCQkJdmFyIGksIGxlbjsNCgkJCXZhciB4ID0gMDsNCgkJCXZhciB5ID0gMDsNCgkJCXZhciBjb3VudCA9IDA7DQoNCgkJCWZvciAoaSA9IDAsIGxlbiA9IGVsZW1lbnRzLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7DQoJCQkJdmFyIGVsID0gZWxlbWVudHNbaV07DQoJCQkJaWYgKGVsICYmIGVsLmhhc1ZhbHVlKCkpIHsNCgkJCQkJdmFyIHBvcyA9IGVsLnRvb2x0aXBQb3NpdGlvbigpOw0KCQkJCQl4ICs9IHBvcy54Ow0KCQkJCQl5ICs9IHBvcy55Ow0KCQkJCQkrK2NvdW50Ow0KCQkJCX0NCgkJCX0NCg0KCQkJcmV0dXJuIHsNCgkJCQl4OiBNYXRoLnJvdW5kKHggLyBjb3VudCksDQoJCQkJeTogTWF0aC5yb3VuZCh5IC8gY291bnQpDQoJCQl9Ow0KCQl9LA0KDQoJCS8qKg0KCQkgKiBHZXRzIHRoZSB0b29sdGlwIHBvc2l0aW9uIG5lYXJlc3Qgb2YgdGhlIGl0ZW0gbmVhcmVzdCB0byB0aGUgZXZlbnQgcG9zaXRpb24NCgkJICogQGZ1bmN0aW9uIENoYXJ0LlRvb2x0aXAucG9zaXRpb25lcnMubmVhcmVzdA0KCQkgKiBAcGFyYW0gZWxlbWVudHMge0NoYXJ0LkVsZW1lbnRbXX0gdGhlIHRvb2x0aXAgZWxlbWVudHMNCgkJICogQHBhcmFtIGV2ZW50UG9zaXRpb24ge1BvaW50fSB0aGUgcG9zaXRpb24gb2YgdGhlIGV2ZW50IGluIGNhbnZhcyBjb29yZGluYXRlcw0KCQkgKiBAcmV0dXJucyB7UG9pbnR9IHRoZSB0b29sdGlwIHBvc2l0aW9uDQoJCSAqLw0KCQluZWFyZXN0OiBmdW5jdGlvbihlbGVtZW50cywgZXZlbnRQb3NpdGlvbikgew0KCQkJdmFyIHggPSBldmVudFBvc2l0aW9uLng7DQoJCQl2YXIgeSA9IGV2ZW50UG9zaXRpb24ueTsNCgkJCXZhciBtaW5EaXN0YW5jZSA9IE51bWJlci5QT1NJVElWRV9JTkZJTklUWTsNCgkJCXZhciBpLCBsZW4sIG5lYXJlc3RFbGVtZW50Ow0KDQoJCQlmb3IgKGkgPSAwLCBsZW4gPSBlbGVtZW50cy5sZW5ndGg7IGkgPCBsZW47ICsraSkgew0KCQkJCXZhciBlbCA9IGVsZW1lbnRzW2ldOw0KCQkJCWlmIChlbCAmJiBlbC5oYXNWYWx1ZSgpKSB7DQoJCQkJCXZhciBjZW50ZXIgPSBlbC5nZXRDZW50ZXJQb2ludCgpOw0KCQkJCQl2YXIgZCA9IGhlbHBlcnMuZGlzdGFuY2VCZXR3ZWVuUG9pbnRzKGV2ZW50UG9zaXRpb24sIGNlbnRlcik7DQoNCgkJCQkJaWYgKGQgPCBtaW5EaXN0YW5jZSkgew0KCQkJCQkJbWluRGlzdGFuY2UgPSBkOw0KCQkJCQkJbmVhcmVzdEVsZW1lbnQgPSBlbDsNCgkJCQkJfQ0KCQkJCX0NCgkJCX0NCg0KCQkJaWYgKG5lYXJlc3RFbGVtZW50KSB7DQoJCQkJdmFyIHRwID0gbmVhcmVzdEVsZW1lbnQudG9vbHRpcFBvc2l0aW9uKCk7DQoJCQkJeCA9IHRwLng7DQoJCQkJeSA9IHRwLnk7DQoJCQl9DQoNCgkJCXJldHVybiB7DQoJCQkJeDogeCwNCgkJCQl5OiB5DQoJCQl9Ow0KCQl9DQoJfTsNCn07DQoNCn0seyIyNSI6MjUsIjI2IjoyNiwiNDUiOjQ1fV0sMzY6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpew0KJ3VzZSBzdHJpY3QnOw0KDQp2YXIgZGVmYXVsdHMgPSByZXF1aXJlKDI1KTsNCnZhciBFbGVtZW50ID0gcmVxdWlyZSgyNik7DQp2YXIgaGVscGVycyA9IHJlcXVpcmUoNDUpOw0KDQpkZWZhdWx0cy5fc2V0KCdnbG9iYWwnLCB7DQoJZWxlbWVudHM6IHsNCgkJYXJjOiB7DQoJCQliYWNrZ3JvdW5kQ29sb3I6IGRlZmF1bHRzLmdsb2JhbC5kZWZhdWx0Q29sb3IsDQoJCQlib3JkZXJDb2xvcjogJyNmZmYnLA0KCQkJYm9yZGVyV2lkdGg6IDINCgkJfQ0KCX0NCn0pOw0KDQptb2R1bGUuZXhwb3J0cyA9IEVsZW1lbnQuZXh0ZW5kKHsNCglpbkxhYmVsUmFuZ2U6IGZ1bmN0aW9uKG1vdXNlWCkgew0KCQl2YXIgdm0gPSB0aGlzLl92aWV3Ow0KDQoJCWlmICh2bSkgew0KCQkJcmV0dXJuIChNYXRoLnBvdyhtb3VzZVggLSB2bS54LCAyKSA8IE1hdGgucG93KHZtLnJhZGl1cyArIHZtLmhvdmVyUmFkaXVzLCAyKSk7DQoJCX0NCgkJcmV0dXJuIGZhbHNlOw0KCX0sDQoNCglpblJhbmdlOiBmdW5jdGlvbihjaGFydFgsIGNoYXJ0WSkgew0KCQl2YXIgdm0gPSB0aGlzLl92aWV3Ow0KDQoJCWlmICh2bSkgew0KCQkJdmFyIHBvaW50UmVsYXRpdmVQb3NpdGlvbiA9IGhlbHBlcnMuZ2V0QW5nbGVGcm9tUG9pbnQodm0sIHt4OiBjaGFydFgsIHk6IGNoYXJ0WX0pOw0KCQkJdmFyCWFuZ2xlID0gcG9pbnRSZWxhdGl2ZVBvc2l0aW9uLmFuZ2xlOw0KCQkJdmFyIGRpc3RhbmNlID0gcG9pbnRSZWxhdGl2ZVBvc2l0aW9uLmRpc3RhbmNlOw0KDQoJCQkvLyBTYW5pdGlzZSBhbmdsZSByYW5nZQ0KCQkJdmFyIHN0YXJ0QW5nbGUgPSB2bS5zdGFydEFuZ2xlOw0KCQkJdmFyIGVuZEFuZ2xlID0gdm0uZW5kQW5nbGU7DQoJCQl3aGlsZSAoZW5kQW5nbGUgPCBzdGFydEFuZ2xlKSB7DQoJCQkJZW5kQW5nbGUgKz0gMi4wICogTWF0aC5QSTsNCgkJCX0NCgkJCXdoaWxlIChhbmdsZSA+IGVuZEFuZ2xlKSB7DQoJCQkJYW5nbGUgLT0gMi4wICogTWF0aC5QSTsNCgkJCX0NCgkJCXdoaWxlIChhbmdsZSA8IHN0YXJ0QW5nbGUpIHsNCgkJCQlhbmdsZSArPSAyLjAgKiBNYXRoLlBJOw0KCQkJfQ0KDQoJCQkvLyBDaGVjayBpZiB3aXRoaW4gdGhlIHJhbmdlIG9mIHRoZSBvcGVuL2Nsb3NlIGFuZ2xlDQoJCQl2YXIgYmV0d2VlbkFuZ2xlcyA9IChhbmdsZSA+PSBzdGFydEFuZ2xlICYmIGFuZ2xlIDw9IGVuZEFuZ2xlKTsNCgkJCXZhciB3aXRoaW5SYWRpdXMgPSAoZGlzdGFuY2UgPj0gdm0uaW5uZXJSYWRpdXMgJiYgZGlzdGFuY2UgPD0gdm0ub3V0ZXJSYWRpdXMpOw0KDQoJCQlyZXR1cm4gKGJldHdlZW5BbmdsZXMgJiYgd2l0aGluUmFkaXVzKTsNCgkJfQ0KCQlyZXR1cm4gZmFsc2U7DQoJfSwNCg0KCWdldENlbnRlclBvaW50OiBmdW5jdGlvbigpIHsNCgkJdmFyIHZtID0gdGhpcy5fdmlldzsNCgkJdmFyIGhhbGZBbmdsZSA9ICh2bS5zdGFydEFuZ2xlICsgdm0uZW5kQW5nbGUpIC8gMjsNCgkJdmFyIGhhbGZSYWRpdXMgPSAodm0uaW5uZXJSYWRpdXMgKyB2bS5vdXRlclJhZGl1cykgLyAyOw0KCQlyZXR1cm4gew0KCQkJeDogdm0ueCArIE1hdGguY29zKGhhbGZBbmdsZSkgKiBoYWxmUmFkaXVzLA0KCQkJeTogdm0ueSArIE1hdGguc2luKGhhbGZBbmdsZSkgKiBoYWxmUmFkaXVzDQoJCX07DQoJfSwNCg0KCWdldEFyZWE6IGZ1bmN0aW9uKCkgew0KCQl2YXIgdm0gPSB0aGlzLl92aWV3Ow0KCQlyZXR1cm4gTWF0aC5QSSAqICgodm0uZW5kQW5nbGUgLSB2bS5zdGFydEFuZ2xlKSAvICgyICogTWF0aC5QSSkpICogKE1hdGgucG93KHZtLm91dGVyUmFkaXVzLCAyKSAtIE1hdGgucG93KHZtLmlubmVyUmFkaXVzLCAyKSk7DQoJfSwNCg0KCXRvb2x0aXBQb3NpdGlvbjogZnVuY3Rpb24oKSB7DQoJCXZhciB2bSA9IHRoaXMuX3ZpZXc7DQoJCXZhciBjZW50cmVBbmdsZSA9IHZtLnN0YXJ0QW5nbGUgKyAoKHZtLmVuZEFuZ2xlIC0gdm0uc3RhcnRBbmdsZSkgLyAyKTsNCgkJdmFyIHJhbmdlRnJvbUNlbnRyZSA9ICh2bS5vdXRlclJhZGl1cyAtIHZtLmlubmVyUmFkaXVzKSAvIDIgKyB2bS5pbm5lclJhZGl1czsNCg0KCQlyZXR1cm4gew0KCQkJeDogdm0ueCArIChNYXRoLmNvcyhjZW50cmVBbmdsZSkgKiByYW5nZUZyb21DZW50cmUpLA0KCQkJeTogdm0ueSArIChNYXRoLnNpbihjZW50cmVBbmdsZSkgKiByYW5nZUZyb21DZW50cmUpDQoJCX07DQoJfSwNCg0KCWRyYXc6IGZ1bmN0aW9uKCkgew0KCQl2YXIgY3R4ID0gdGhpcy5fY2hhcnQuY3R4Ow0KCQl2YXIgdm0gPSB0aGlzLl92aWV3Ow0KCQl2YXIgc0EgPSB2bS5zdGFydEFuZ2xlOw0KCQl2YXIgZUEgPSB2bS5lbmRBbmdsZTsNCg0KCQljdHguYmVnaW5QYXRoKCk7DQoNCgkJY3R4LmFyYyh2bS54LCB2bS55LCB2bS5vdXRlclJhZGl1cywgc0EsIGVBKTsNCgkJY3R4LmFyYyh2bS54LCB2bS55LCB2bS5pbm5lclJhZGl1cywgZUEsIHNBLCB0cnVlKTsNCg0KCQljdHguY2xvc2VQYXRoKCk7DQoJCWN0eC5zdHJva2VTdHlsZSA9IHZtLmJvcmRlckNvbG9yOw0KCQljdHgubGluZVdpZHRoID0gdm0uYm9yZGVyV2lkdGg7DQoNCgkJY3R4LmZpbGxTdHlsZSA9IHZtLmJhY2tncm91bmRDb2xvcjsNCg0KCQljdHguZmlsbCgpOw0KCQljdHgubGluZUpvaW4gPSAnYmV2ZWwnOw0KDQoJCWlmICh2bS5ib3JkZXJXaWR0aCkgew0KCQkJY3R4LnN0cm9rZSgpOw0KCQl9DQoJfQ0KfSk7DQoNCn0seyIyNSI6MjUsIjI2IjoyNiwiNDUiOjQ1fV0sMzc6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpew0KJ3VzZSBzdHJpY3QnOw0KDQp2YXIgZGVmYXVsdHMgPSByZXF1aXJlKDI1KTsNCnZhciBFbGVtZW50ID0gcmVxdWlyZSgyNik7DQp2YXIgaGVscGVycyA9IHJlcXVpcmUoNDUpOw0KDQp2YXIgZ2xvYmFsRGVmYXVsdHMgPSBkZWZhdWx0cy5nbG9iYWw7DQoNCmRlZmF1bHRzLl9zZXQoJ2dsb2JhbCcsIHsNCgllbGVtZW50czogew0KCQlsaW5lOiB7DQoJCQl0ZW5zaW9uOiAwLjQsDQoJCQliYWNrZ3JvdW5kQ29sb3I6IGdsb2JhbERlZmF1bHRzLmRlZmF1bHRDb2xvciwNCgkJCWJvcmRlcldpZHRoOiAzLA0KCQkJYm9yZGVyQ29sb3I6IGdsb2JhbERlZmF1bHRzLmRlZmF1bHRDb2xvciwNCgkJCWJvcmRlckNhcFN0eWxlOiAnYnV0dCcsDQoJCQlib3JkZXJEYXNoOiBbXSwNCgkJCWJvcmRlckRhc2hPZmZzZXQ6IDAuMCwNCgkJCWJvcmRlckpvaW5TdHlsZTogJ21pdGVyJywNCgkJCWNhcEJlemllclBvaW50czogdHJ1ZSwNCgkJCWZpbGw6IHRydWUsIC8vIGRvIHdlIGZpbGwgaW4gdGhlIGFyZWEgYmV0d2VlbiB0aGUgbGluZSBhbmQgaXRzIGJhc2UgYXhpcw0KCQl9DQoJfQ0KfSk7DQoNCm1vZHVsZS5leHBvcnRzID0gRWxlbWVudC5leHRlbmQoew0KCWRyYXc6IGZ1bmN0aW9uKCkgew0KCQl2YXIgbWUgPSB0aGlzOw0KCQl2YXIgdm0gPSBtZS5fdmlldzsNCgkJdmFyIGN0eCA9IG1lLl9jaGFydC5jdHg7DQoJCXZhciBzcGFuR2FwcyA9IHZtLnNwYW5HYXBzOw0KCQl2YXIgcG9pbnRzID0gbWUuX2NoaWxkcmVuLnNsaWNlKCk7IC8vIGNsb25lIGFycmF5DQoJCXZhciBnbG9iYWxPcHRpb25MaW5lRWxlbWVudHMgPSBnbG9iYWxEZWZhdWx0cy5lbGVtZW50cy5saW5lOw0KCQl2YXIgbGFzdERyYXduSW5kZXggPSAtMTsNCgkJdmFyIGluZGV4LCBjdXJyZW50LCBwcmV2aW91cywgY3VycmVudFZNOw0KDQoJCS8vIElmIHdlIGFyZSBsb29waW5nLCBhZGRpbmcgdGhlIGZpcnN0IHBvaW50IGFnYWluDQoJCWlmIChtZS5fbG9vcCAmJiBwb2ludHMubGVuZ3RoKSB7DQoJCQlwb2ludHMucHVzaChwb2ludHNbMF0pOw0KCQl9DQoNCgkJY3R4LnNhdmUoKTsNCg0KCQkvLyBTdHJva2UgTGluZSBPcHRpb25zDQoJCWN0eC5saW5lQ2FwID0gdm0uYm9yZGVyQ2FwU3R5bGUgfHwgZ2xvYmFsT3B0aW9uTGluZUVsZW1lbnRzLmJvcmRlckNhcFN0eWxlOw0KDQoJCS8vIElFIDkgYW5kIDEwIGRvIG5vdCBzdXBwb3J0IGxpbmUgZGFzaA0KCQlpZiAoY3R4LnNldExpbmVEYXNoKSB7DQoJCQljdHguc2V0TGluZURhc2godm0uYm9yZGVyRGFzaCB8fCBnbG9iYWxPcHRpb25MaW5lRWxlbWVudHMuYm9yZGVyRGFzaCk7DQoJCX0NCg0KCQljdHgubGluZURhc2hPZmZzZXQgPSB2bS5ib3JkZXJEYXNoT2Zmc2V0IHx8IGdsb2JhbE9wdGlvbkxpbmVFbGVtZW50cy5ib3JkZXJEYXNoT2Zmc2V0Ow0KCQljdHgubGluZUpvaW4gPSB2bS5ib3JkZXJKb2luU3R5bGUgfHwgZ2xvYmFsT3B0aW9uTGluZUVsZW1lbnRzLmJvcmRlckpvaW5TdHlsZTsNCgkJY3R4LmxpbmVXaWR0aCA9IHZtLmJvcmRlcldpZHRoIHx8IGdsb2JhbE9wdGlvbkxpbmVFbGVtZW50cy5ib3JkZXJXaWR0aDsNCgkJY3R4LnN0cm9rZVN0eWxlID0gdm0uYm9yZGVyQ29sb3IgfHwgZ2xvYmFsRGVmYXVsdHMuZGVmYXVsdENvbG9yOw0KDQoJCS8vIFN0cm9rZSBMaW5lDQoJCWN0eC5iZWdpblBhdGgoKTsNCgkJbGFzdERyYXduSW5kZXggPSAtMTsNCg0KCQlmb3IgKGluZGV4ID0gMDsgaW5kZXggPCBwb2ludHMubGVuZ3RoOyArK2luZGV4KSB7DQoJCQljdXJyZW50ID0gcG9pbnRzW2luZGV4XTsNCgkJCXByZXZpb3VzID0gaGVscGVycy5wcmV2aW91c0l0ZW0ocG9pbnRzLCBpbmRleCk7DQoJCQljdXJyZW50Vk0gPSBjdXJyZW50Ll92aWV3Ow0KDQoJCQkvLyBGaXJzdCBwb2ludCBtb3ZlcyB0byBpdCdzIHN0YXJ0aW5nIHBvc2l0aW9uIG5vIG1hdHRlciB3aGF0DQoJCQlpZiAoaW5kZXggPT09IDApIHsNCgkJCQlpZiAoIWN1cnJlbnRWTS5za2lwKSB7DQoJCQkJCWN0eC5tb3ZlVG8oY3VycmVudFZNLngsIGN1cnJlbnRWTS55KTsNCgkJCQkJbGFzdERyYXduSW5kZXggPSBpbmRleDsNCgkJCQl9DQoJCQl9IGVsc2Ugew0KCQkJCXByZXZpb3VzID0gbGFzdERyYXduSW5kZXggPT09IC0xID8gcHJldmlvdXMgOiBwb2ludHNbbGFzdERyYXduSW5kZXhdOw0KDQoJCQkJaWYgKCFjdXJyZW50Vk0uc2tpcCkgew0KCQkJCQlpZiAoKGxhc3REcmF3bkluZGV4ICE9PSAoaW5kZXggLSAxKSAmJiAhc3BhbkdhcHMpIHx8IGxhc3REcmF3bkluZGV4ID09PSAtMSkgew0KCQkJCQkJLy8gVGhlcmUgd2FzIGEgZ2FwIGFuZCB0aGlzIGlzIHRoZSBmaXJzdCBwb2ludCBhZnRlciB0aGUgZ2FwDQoJCQkJCQljdHgubW92ZVRvKGN1cnJlbnRWTS54LCBjdXJyZW50Vk0ueSk7DQoJCQkJCX0gZWxzZSB7DQoJCQkJCQkvLyBMaW5lIHRvIG5leHQgcG9pbnQNCgkJCQkJCWhlbHBlcnMuY2FudmFzLmxpbmVUbyhjdHgsIHByZXZpb3VzLl92aWV3LCBjdXJyZW50Ll92aWV3KTsNCgkJCQkJfQ0KCQkJCQlsYXN0RHJhd25JbmRleCA9IGluZGV4Ow0KCQkJCX0NCgkJCX0NCgkJfQ0KDQoJCWN0eC5zdHJva2UoKTsNCgkJY3R4LnJlc3RvcmUoKTsNCgl9DQp9KTsNCg0KfSx7IjI1IjoyNSwiMjYiOjI2LCI0NSI6NDV9XSwzODpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7DQondXNlIHN0cmljdCc7DQoNCnZhciBkZWZhdWx0cyA9IHJlcXVpcmUoMjUpOw0KdmFyIEVsZW1lbnQgPSByZXF1aXJlKDI2KTsNCnZhciBoZWxwZXJzID0gcmVxdWlyZSg0NSk7DQoNCnZhciBkZWZhdWx0Q29sb3IgPSBkZWZhdWx0cy5nbG9iYWwuZGVmYXVsdENvbG9yOw0KDQpkZWZhdWx0cy5fc2V0KCdnbG9iYWwnLCB7DQoJZWxlbWVudHM6IHsNCgkJcG9pbnQ6IHsNCgkJCXJhZGl1czogMywNCgkJCXBvaW50U3R5bGU6ICdjaXJjbGUnLA0KCQkJYmFja2dyb3VuZENvbG9yOiBkZWZhdWx0Q29sb3IsDQoJCQlib3JkZXJDb2xvcjogZGVmYXVsdENvbG9yLA0KCQkJYm9yZGVyV2lkdGg6IDEsDQoJCQkvLyBIb3Zlcg0KCQkJaGl0UmFkaXVzOiAxLA0KCQkJaG92ZXJSYWRpdXM6IDQsDQoJCQlob3ZlckJvcmRlcldpZHRoOiAxDQoJCX0NCgl9DQp9KTsNCg0KZnVuY3Rpb24geFJhbmdlKG1vdXNlWCkgew0KCXZhciB2bSA9IHRoaXMuX3ZpZXc7DQoJcmV0dXJuIHZtID8gKE1hdGgucG93KG1vdXNlWCAtIHZtLngsIDIpIDwgTWF0aC5wb3codm0ucmFkaXVzICsgdm0uaGl0UmFkaXVzLCAyKSkgOiBmYWxzZTsNCn0NCg0KZnVuY3Rpb24geVJhbmdlKG1vdXNlWSkgew0KCXZhciB2bSA9IHRoaXMuX3ZpZXc7DQoJcmV0dXJuIHZtID8gKE1hdGgucG93KG1vdXNlWSAtIHZtLnksIDIpIDwgTWF0aC5wb3codm0ucmFkaXVzICsgdm0uaGl0UmFkaXVzLCAyKSkgOiBmYWxzZTsNCn0NCg0KbW9kdWxlLmV4cG9ydHMgPSBFbGVtZW50LmV4dGVuZCh7DQoJaW5SYW5nZTogZnVuY3Rpb24obW91c2VYLCBtb3VzZVkpIHsNCgkJdmFyIHZtID0gdGhpcy5fdmlldzsNCgkJcmV0dXJuIHZtID8gKChNYXRoLnBvdyhtb3VzZVggLSB2bS54LCAyKSArIE1hdGgucG93KG1vdXNlWSAtIHZtLnksIDIpKSA8IE1hdGgucG93KHZtLmhpdFJhZGl1cyArIHZtLnJhZGl1cywgMikpIDogZmFsc2U7DQoJfSwNCg0KCWluTGFiZWxSYW5nZTogeFJhbmdlLA0KCWluWFJhbmdlOiB4UmFuZ2UsDQoJaW5ZUmFuZ2U6IHlSYW5nZSwNCg0KCWdldENlbnRlclBvaW50OiBmdW5jdGlvbigpIHsNCgkJdmFyIHZtID0gdGhpcy5fdmlldzsNCgkJcmV0dXJuIHsNCgkJCXg6IHZtLngsDQoJCQl5OiB2bS55DQoJCX07DQoJfSwNCg0KCWdldEFyZWE6IGZ1bmN0aW9uKCkgew0KCQlyZXR1cm4gTWF0aC5QSSAqIE1hdGgucG93KHRoaXMuX3ZpZXcucmFkaXVzLCAyKTsNCgl9LA0KDQoJdG9vbHRpcFBvc2l0aW9uOiBmdW5jdGlvbigpIHsNCgkJdmFyIHZtID0gdGhpcy5fdmlldzsNCgkJcmV0dXJuIHsNCgkJCXg6IHZtLngsDQoJCQl5OiB2bS55LA0KCQkJcGFkZGluZzogdm0ucmFkaXVzICsgdm0uYm9yZGVyV2lkdGgNCgkJfTsNCgl9LA0KDQoJZHJhdzogZnVuY3Rpb24oY2hhcnRBcmVhKSB7DQoJCXZhciB2bSA9IHRoaXMuX3ZpZXc7DQoJCXZhciBtb2RlbCA9IHRoaXMuX21vZGVsOw0KCQl2YXIgY3R4ID0gdGhpcy5fY2hhcnQuY3R4Ow0KCQl2YXIgcG9pbnRTdHlsZSA9IHZtLnBvaW50U3R5bGU7DQoJCXZhciByYWRpdXMgPSB2bS5yYWRpdXM7DQoJCXZhciB4ID0gdm0ueDsNCgkJdmFyIHkgPSB2bS55Ow0KCQl2YXIgY29sb3IgPSBoZWxwZXJzLmNvbG9yOw0KCQl2YXIgZXJyTWFyZ2luID0gMS4wMTsgLy8gMS4wMSBpcyBtYXJnaW4gZm9yIEFjY3VtdWxhdGVkIGVycm9yLiAoRXNwZWNpYWxseSBFZGdlLCBJRS4pDQoJCXZhciByYXRpbyA9IDA7DQoNCgkJaWYgKHZtLnNraXApIHsNCgkJCXJldHVybjsNCgkJfQ0KDQoJCWN0eC5zdHJva2VTdHlsZSA9IHZtLmJvcmRlckNvbG9yIHx8IGRlZmF1bHRDb2xvcjsNCgkJY3R4LmxpbmVXaWR0aCA9IGhlbHBlcnMudmFsdWVPckRlZmF1bHQodm0uYm9yZGVyV2lkdGgsIGRlZmF1bHRzLmdsb2JhbC5lbGVtZW50cy5wb2ludC5ib3JkZXJXaWR0aCk7DQoJCWN0eC5maWxsU3R5bGUgPSB2bS5iYWNrZ3JvdW5kQ29sb3IgfHwgZGVmYXVsdENvbG9yOw0KDQoJCS8vIENsaXBpbmcgZm9yIFBvaW50cy4NCgkJLy8gZ29pbmcgb3V0IGZyb20gaW5uZXIgY2hhckFyZWE/DQoJCWlmICgoY2hhcnRBcmVhICE9PSB1bmRlZmluZWQpICYmICgobW9kZWwueCA8IGNoYXJ0QXJlYS5sZWZ0KSB8fCAoY2hhcnRBcmVhLnJpZ2h0ICogZXJyTWFyZ2luIDwgbW9kZWwueCkgfHwgKG1vZGVsLnkgPCBjaGFydEFyZWEudG9wKSB8fCAoY2hhcnRBcmVhLmJvdHRvbSAqIGVyck1hcmdpbiA8IG1vZGVsLnkpKSkgew0KCQkJLy8gUG9pbnQgZmFkZSBvdXQNCgkJCWlmIChtb2RlbC54IDwgY2hhcnRBcmVhLmxlZnQpIHsNCgkJCQlyYXRpbyA9ICh4IC0gbW9kZWwueCkgLyAoY2hhcnRBcmVhLmxlZnQgLSBtb2RlbC54KTsNCgkJCX0gZWxzZSBpZiAoY2hhcnRBcmVhLnJpZ2h0ICogZXJyTWFyZ2luIDwgbW9kZWwueCkgew0KCQkJCXJhdGlvID0gKG1vZGVsLnggLSB4KSAvIChtb2RlbC54IC0gY2hhcnRBcmVhLnJpZ2h0KTsNCgkJCX0gZWxzZSBpZiAobW9kZWwueSA8IGNoYXJ0QXJlYS50b3ApIHsNCgkJCQlyYXRpbyA9ICh5IC0gbW9kZWwueSkgLyAoY2hhcnRBcmVhLnRvcCAtIG1vZGVsLnkpOw0KCQkJfSBlbHNlIGlmIChjaGFydEFyZWEuYm90dG9tICogZXJyTWFyZ2luIDwgbW9kZWwueSkgew0KCQkJCXJhdGlvID0gKG1vZGVsLnkgLSB5KSAvIChtb2RlbC55IC0gY2hhcnRBcmVhLmJvdHRvbSk7DQoJCQl9DQoJCQlyYXRpbyA9IE1hdGgucm91bmQocmF0aW8gKiAxMDApIC8gMTAwOw0KCQkJY3R4LnN0cm9rZVN0eWxlID0gY29sb3IoY3R4LnN0cm9rZVN0eWxlKS5hbHBoYShyYXRpbykucmdiU3RyaW5nKCk7DQoJCQljdHguZmlsbFN0eWxlID0gY29sb3IoY3R4LmZpbGxTdHlsZSkuYWxwaGEocmF0aW8pLnJnYlN0cmluZygpOw0KCQl9DQoNCgkJaGVscGVycy5jYW52YXMuZHJhd1BvaW50KGN0eCwgcG9pbnRTdHlsZSwgcmFkaXVzLCB4LCB5KTsNCgl9DQp9KTsNCg0KfSx7IjI1IjoyNSwiMjYiOjI2LCI0NSI6NDV9XSwzOTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7DQondXNlIHN0cmljdCc7DQoNCnZhciBkZWZhdWx0cyA9IHJlcXVpcmUoMjUpOw0KdmFyIEVsZW1lbnQgPSByZXF1aXJlKDI2KTsNCg0KZGVmYXVsdHMuX3NldCgnZ2xvYmFsJywgew0KCWVsZW1lbnRzOiB7DQoJCXJlY3RhbmdsZTogew0KCQkJYmFja2dyb3VuZENvbG9yOiBkZWZhdWx0cy5nbG9iYWwuZGVmYXVsdENvbG9yLA0KCQkJYm9yZGVyQ29sb3I6IGRlZmF1bHRzLmdsb2JhbC5kZWZhdWx0Q29sb3IsDQoJCQlib3JkZXJTa2lwcGVkOiAnYm90dG9tJywNCgkJCWJvcmRlcldpZHRoOiAwDQoJCX0NCgl9DQp9KTsNCg0KZnVuY3Rpb24gaXNWZXJ0aWNhbChiYXIpIHsNCglyZXR1cm4gYmFyLl92aWV3LndpZHRoICE9PSB1bmRlZmluZWQ7DQp9DQoNCi8qKg0KICogSGVscGVyIGZ1bmN0aW9uIHRvIGdldCB0aGUgYm91bmRzIG9mIHRoZSBiYXIgcmVnYXJkbGVzcyBvZiB0aGUgb3JpZW50YXRpb24NCiAqIEBwYXJhbSBiYXIge0NoYXJ0LkVsZW1lbnQuUmVjdGFuZ2xlfSB0aGUgYmFyDQogKiBAcmV0dXJuIHtCb3VuZHN9IGJvdW5kcyBvZiB0aGUgYmFyDQogKiBAcHJpdmF0ZQ0KICovDQpmdW5jdGlvbiBnZXRCYXJCb3VuZHMoYmFyKSB7DQoJdmFyIHZtID0gYmFyLl92aWV3Ow0KCXZhciB4MSwgeDIsIHkxLCB5MjsNCg0KCWlmIChpc1ZlcnRpY2FsKGJhcikpIHsNCgkJLy8gdmVydGljYWwNCgkJdmFyIGhhbGZXaWR0aCA9IHZtLndpZHRoIC8gMjsNCgkJeDEgPSB2bS54IC0gaGFsZldpZHRoOw0KCQl4MiA9IHZtLnggKyBoYWxmV2lkdGg7DQoJCXkxID0gTWF0aC5taW4odm0ueSwgdm0uYmFzZSk7DQoJCXkyID0gTWF0aC5tYXgodm0ueSwgdm0uYmFzZSk7DQoJfSBlbHNlIHsNCgkJLy8gaG9yaXpvbnRhbCBiYXINCgkJdmFyIGhhbGZIZWlnaHQgPSB2bS5oZWlnaHQgLyAyOw0KCQl4MSA9IE1hdGgubWluKHZtLngsIHZtLmJhc2UpOw0KCQl4MiA9IE1hdGgubWF4KHZtLngsIHZtLmJhc2UpOw0KCQl5MSA9IHZtLnkgLSBoYWxmSGVpZ2h0Ow0KCQl5MiA9IHZtLnkgKyBoYWxmSGVpZ2h0Ow0KCX0NCg0KCXJldHVybiB7DQoJCWxlZnQ6IHgxLA0KCQl0b3A6IHkxLA0KCQlyaWdodDogeDIsDQoJCWJvdHRvbTogeTINCgl9Ow0KfQ0KDQptb2R1bGUuZXhwb3J0cyA9IEVsZW1lbnQuZXh0ZW5kKHsNCglkcmF3OiBmdW5jdGlvbigpIHsNCgkJdmFyIGN0eCA9IHRoaXMuX2NoYXJ0LmN0eDsNCgkJdmFyIHZtID0gdGhpcy5fdmlldzsNCgkJdmFyIGxlZnQsIHJpZ2h0LCB0b3AsIGJvdHRvbSwgc2lnblgsIHNpZ25ZLCBib3JkZXJTa2lwcGVkOw0KCQl2YXIgYm9yZGVyV2lkdGggPSB2bS5ib3JkZXJXaWR0aDsNCg0KCQlpZiAoIXZtLmhvcml6b250YWwpIHsNCgkJCS8vIGJhcg0KCQkJbGVmdCA9IHZtLnggLSB2bS53aWR0aCAvIDI7DQoJCQlyaWdodCA9IHZtLnggKyB2bS53aWR0aCAvIDI7DQoJCQl0b3AgPSB2bS55Ow0KCQkJYm90dG9tID0gdm0uYmFzZTsNCgkJCXNpZ25YID0gMTsNCgkJCXNpZ25ZID0gYm90dG9tID4gdG9wID8gMSA6IC0xOw0KCQkJYm9yZGVyU2tpcHBlZCA9IHZtLmJvcmRlclNraXBwZWQgfHwgJ2JvdHRvbSc7DQoJCX0gZWxzZSB7DQoJCQkvLyBob3Jpem9udGFsIGJhcg0KCQkJbGVmdCA9IHZtLmJhc2U7DQoJCQlyaWdodCA9IHZtLng7DQoJCQl0b3AgPSB2bS55IC0gdm0uaGVpZ2h0IC8gMjsNCgkJCWJvdHRvbSA9IHZtLnkgKyB2bS5oZWlnaHQgLyAyOw0KCQkJc2lnblggPSByaWdodCA+IGxlZnQgPyAxIDogLTE7DQoJCQlzaWduWSA9IDE7DQoJCQlib3JkZXJTa2lwcGVkID0gdm0uYm9yZGVyU2tpcHBlZCB8fCAnbGVmdCc7DQoJCX0NCg0KCQkvLyBDYW52YXMgZG9lc24ndCBhbGxvdyB1cyB0byBzdHJva2UgaW5zaWRlIHRoZSB3aWR0aCBzbyB3ZSBjYW4NCgkJLy8gYWRqdXN0IHRoZSBzaXplcyB0byBmaXQgaWYgd2UncmUgc2V0dGluZyBhIHN0cm9rZSBvbiB0aGUgbGluZQ0KCQlpZiAoYm9yZGVyV2lkdGgpIHsNCgkJCS8vIGJvcmRlcldpZHRoIHNob2xkIGJlIGxlc3MgdGhhbiBiYXIgd2lkdGggYW5kIGJhciBoZWlnaHQuDQoJCQl2YXIgYmFyU2l6ZSA9IE1hdGgubWluKE1hdGguYWJzKGxlZnQgLSByaWdodCksIE1hdGguYWJzKHRvcCAtIGJvdHRvbSkpOw0KCQkJYm9yZGVyV2lkdGggPSBib3JkZXJXaWR0aCA+IGJhclNpemUgPyBiYXJTaXplIDogYm9yZGVyV2lkdGg7DQoJCQl2YXIgaGFsZlN0cm9rZSA9IGJvcmRlcldpZHRoIC8gMjsNCgkJCS8vIEFkanVzdCBib3JkZXJXaWR0aCB3aGVuIGJhciB0b3AgcG9zaXRpb24gaXMgbmVhciB2bS5iYXNlKHplcm8pLg0KCQkJdmFyIGJvcmRlckxlZnQgPSBsZWZ0ICsgKGJvcmRlclNraXBwZWQgIT09ICdsZWZ0JyA/IGhhbGZTdHJva2UgKiBzaWduWCA6IDApOw0KCQkJdmFyIGJvcmRlclJpZ2h0ID0gcmlnaHQgKyAoYm9yZGVyU2tpcHBlZCAhPT0gJ3JpZ2h0JyA/IC1oYWxmU3Ryb2tlICogc2lnblggOiAwKTsNCgkJCXZhciBib3JkZXJUb3AgPSB0b3AgKyAoYm9yZGVyU2tpcHBlZCAhPT0gJ3RvcCcgPyBoYWxmU3Ryb2tlICogc2lnblkgOiAwKTsNCgkJCXZhciBib3JkZXJCb3R0b20gPSBib3R0b20gKyAoYm9yZGVyU2tpcHBlZCAhPT0gJ2JvdHRvbScgPyAtaGFsZlN0cm9rZSAqIHNpZ25ZIDogMCk7DQoJCQkvLyBub3QgYmVjb21lIGEgdmVydGljYWwgbGluZT8NCgkJCWlmIChib3JkZXJMZWZ0ICE9PSBib3JkZXJSaWdodCkgew0KCQkJCXRvcCA9IGJvcmRlclRvcDsNCgkJCQlib3R0b20gPSBib3JkZXJCb3R0b207DQoJCQl9DQoJCQkvLyBub3QgYmVjb21lIGEgaG9yaXpvbnRhbCBsaW5lPw0KCQkJaWYgKGJvcmRlclRvcCAhPT0gYm9yZGVyQm90dG9tKSB7DQoJCQkJbGVmdCA9IGJvcmRlckxlZnQ7DQoJCQkJcmlnaHQgPSBib3JkZXJSaWdodDsNCgkJCX0NCgkJfQ0KDQoJCWN0eC5iZWdpblBhdGgoKTsNCgkJY3R4LmZpbGxTdHlsZSA9IHZtLmJhY2tncm91bmRDb2xvcjsNCgkJY3R4LnN0cm9rZVN0eWxlID0gdm0uYm9yZGVyQ29sb3I7DQoJCWN0eC5saW5lV2lkdGggPSBib3JkZXJXaWR0aDsNCg0KCQkvLyBDb3JuZXIgcG9pbnRzLCBmcm9tIGJvdHRvbS1sZWZ0IHRvIGJvdHRvbS1yaWdodCBjbG9ja3dpc2UNCgkJLy8gfCAxIDIgfA0KCQkvLyB8IDAgMyB8DQoJCXZhciBjb3JuZXJzID0gWw0KCQkJW2xlZnQsIGJvdHRvbV0sDQoJCQlbbGVmdCwgdG9wXSwNCgkJCVtyaWdodCwgdG9wXSwNCgkJCVtyaWdodCwgYm90dG9tXQ0KCQldOw0KDQoJCS8vIEZpbmQgZmlyc3QgKHN0YXJ0aW5nKSBjb3JuZXIgd2l0aCBmYWxsYmFjayB0byAnYm90dG9tJw0KCQl2YXIgYm9yZGVycyA9IFsnYm90dG9tJywgJ2xlZnQnLCAndG9wJywgJ3JpZ2h0J107DQoJCXZhciBzdGFydENvcm5lciA9IGJvcmRlcnMuaW5kZXhPZihib3JkZXJTa2lwcGVkLCAwKTsNCgkJaWYgKHN0YXJ0Q29ybmVyID09PSAtMSkgew0KCQkJc3RhcnRDb3JuZXIgPSAwOw0KCQl9DQoNCgkJZnVuY3Rpb24gY29ybmVyQXQoaW5kZXgpIHsNCgkJCXJldHVybiBjb3JuZXJzWyhzdGFydENvcm5lciArIGluZGV4KSAlIDRdOw0KCQl9DQoNCgkJLy8gRHJhdyByZWN0YW5nbGUgZnJvbSAnc3RhcnRDb3JuZXInDQoJCXZhciBjb3JuZXIgPSBjb3JuZXJBdCgwKTsNCgkJY3R4Lm1vdmVUbyhjb3JuZXJbMF0sIGNvcm5lclsxXSk7DQoNCgkJZm9yICh2YXIgaSA9IDE7IGkgPCA0OyBpKyspIHsNCgkJCWNvcm5lciA9IGNvcm5lckF0KGkpOw0KCQkJY3R4LmxpbmVUbyhjb3JuZXJbMF0sIGNvcm5lclsxXSk7DQoJCX0NCg0KCQljdHguZmlsbCgpOw0KCQlpZiAoYm9yZGVyV2lkdGgpIHsNCgkJCWN0eC5zdHJva2UoKTsNCgkJfQ0KCX0sDQoNCgloZWlnaHQ6IGZ1bmN0aW9uKCkgew0KCQl2YXIgdm0gPSB0aGlzLl92aWV3Ow0KCQlyZXR1cm4gdm0uYmFzZSAtIHZtLnk7DQoJfSwNCg0KCWluUmFuZ2U6IGZ1bmN0aW9uKG1vdXNlWCwgbW91c2VZKSB7DQoJCXZhciBpblJhbmdlID0gZmFsc2U7DQoNCgkJaWYgKHRoaXMuX3ZpZXcpIHsNCgkJCXZhciBib3VuZHMgPSBnZXRCYXJCb3VuZHModGhpcyk7DQoJCQlpblJhbmdlID0gbW91c2VYID49IGJvdW5kcy5sZWZ0ICYmIG1vdXNlWCA8PSBib3VuZHMucmlnaHQgJiYgbW91c2VZID49IGJvdW5kcy50b3AgJiYgbW91c2VZIDw9IGJvdW5kcy5ib3R0b207DQoJCX0NCg0KCQlyZXR1cm4gaW5SYW5nZTsNCgl9LA0KDQoJaW5MYWJlbFJhbmdlOiBmdW5jdGlvbihtb3VzZVgsIG1vdXNlWSkgew0KCQl2YXIgbWUgPSB0aGlzOw0KCQlpZiAoIW1lLl92aWV3KSB7DQoJCQlyZXR1cm4gZmFsc2U7DQoJCX0NCg0KCQl2YXIgaW5SYW5nZSA9IGZhbHNlOw0KCQl2YXIgYm91bmRzID0gZ2V0QmFyQm91bmRzKG1lKTsNCg0KCQlpZiAoaXNWZXJ0aWNhbChtZSkpIHsNCgkJCWluUmFuZ2UgPSBtb3VzZVggPj0gYm91bmRzLmxlZnQgJiYgbW91c2VYIDw9IGJvdW5kcy5yaWdodDsNCgkJfSBlbHNlIHsNCgkJCWluUmFuZ2UgPSBtb3VzZVkgPj0gYm91bmRzLnRvcCAmJiBtb3VzZVkgPD0gYm91bmRzLmJvdHRvbTsNCgkJfQ0KDQoJCXJldHVybiBpblJhbmdlOw0KCX0sDQoNCglpblhSYW5nZTogZnVuY3Rpb24obW91c2VYKSB7DQoJCXZhciBib3VuZHMgPSBnZXRCYXJCb3VuZHModGhpcyk7DQoJCXJldHVybiBtb3VzZVggPj0gYm91bmRzLmxlZnQgJiYgbW91c2VYIDw9IGJvdW5kcy5yaWdodDsNCgl9LA0KDQoJaW5ZUmFuZ2U6IGZ1bmN0aW9uKG1vdXNlWSkgew0KCQl2YXIgYm91bmRzID0gZ2V0QmFyQm91bmRzKHRoaXMpOw0KCQlyZXR1cm4gbW91c2VZID49IGJvdW5kcy50b3AgJiYgbW91c2VZIDw9IGJvdW5kcy5ib3R0b207DQoJfSwNCg0KCWdldENlbnRlclBvaW50OiBmdW5jdGlvbigpIHsNCgkJdmFyIHZtID0gdGhpcy5fdmlldzsNCgkJdmFyIHgsIHk7DQoJCWlmIChpc1ZlcnRpY2FsKHRoaXMpKSB7DQoJCQl4ID0gdm0ueDsNCgkJCXkgPSAodm0ueSArIHZtLmJhc2UpIC8gMjsNCgkJfSBlbHNlIHsNCgkJCXggPSAodm0ueCArIHZtLmJhc2UpIC8gMjsNCgkJCXkgPSB2bS55Ow0KCQl9DQoNCgkJcmV0dXJuIHt4OiB4LCB5OiB5fTsNCgl9LA0KDQoJZ2V0QXJlYTogZnVuY3Rpb24oKSB7DQoJCXZhciB2bSA9IHRoaXMuX3ZpZXc7DQoJCXJldHVybiB2bS53aWR0aCAqIE1hdGguYWJzKHZtLnkgLSB2bS5iYXNlKTsNCgl9LA0KDQoJdG9vbHRpcFBvc2l0aW9uOiBmdW5jdGlvbigpIHsNCgkJdmFyIHZtID0gdGhpcy5fdmlldzsNCgkJcmV0dXJuIHsNCgkJCXg6IHZtLngsDQoJCQl5OiB2bS55DQoJCX07DQoJfQ0KfSk7DQoNCn0seyIyNSI6MjUsIjI2IjoyNn1dLDQwOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsNCid1c2Ugc3RyaWN0JzsNCg0KbW9kdWxlLmV4cG9ydHMgPSB7fTsNCm1vZHVsZS5leHBvcnRzLkFyYyA9IHJlcXVpcmUoMzYpOw0KbW9kdWxlLmV4cG9ydHMuTGluZSA9IHJlcXVpcmUoMzcpOw0KbW9kdWxlLmV4cG9ydHMuUG9pbnQgPSByZXF1aXJlKDM4KTsNCm1vZHVsZS5leHBvcnRzLlJlY3RhbmdsZSA9IHJlcXVpcmUoMzkpOw0KDQp9LHsiMzYiOjM2LCIzNyI6MzcsIjM4IjozOCwiMzkiOjM5fV0sNDE6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpew0KJ3VzZSBzdHJpY3QnOw0KDQp2YXIgaGVscGVycyA9IHJlcXVpcmUoNDIpOw0KDQovKioNCiAqIEBuYW1lc3BhY2UgQ2hhcnQuaGVscGVycy5jYW52YXMNCiAqLw0KdmFyIGV4cG9ydHMgPSBtb2R1bGUuZXhwb3J0cyA9IHsNCgkvKioNCgkgKiBDbGVhcnMgdGhlIGVudGlyZSBjYW52YXMgYXNzb2NpYXRlZCB0byB0aGUgZ2l2ZW4gYGNoYXJ0YC4NCgkgKiBAcGFyYW0ge0NoYXJ0fSBjaGFydCAtIFRoZSBjaGFydCBmb3Igd2hpY2ggdG8gY2xlYXIgdGhlIGNhbnZhcy4NCgkgKi8NCgljbGVhcjogZnVuY3Rpb24oY2hhcnQpIHsNCgkJY2hhcnQuY3R4LmNsZWFyUmVjdCgwLCAwLCBjaGFydC53aWR0aCwgY2hhcnQuaGVpZ2h0KTsNCgl9LA0KDQoJLyoqDQoJICogQ3JlYXRlcyBhICJwYXRoIiBmb3IgYSByZWN0YW5nbGUgd2l0aCByb3VuZGVkIGNvcm5lcnMgYXQgcG9zaXRpb24gKHgsIHkpIHdpdGggYQ0KCSAqIGdpdmVuIHNpemUgKHdpZHRoLCBoZWlnaHQpIGFuZCB0aGUgc2FtZSBgcmFkaXVzYCBmb3IgYWxsIGNvcm5lcnMuDQoJICogQHBhcmFtIHtDYW52YXNSZW5kZXJpbmdDb250ZXh0MkR9IGN0eCAtIFRoZSBjYW52YXMgMkQgQ29udGV4dC4NCgkgKiBAcGFyYW0ge051bWJlcn0geCAtIFRoZSB4IGF4aXMgb2YgdGhlIGNvb3JkaW5hdGUgZm9yIHRoZSByZWN0YW5nbGUgc3RhcnRpbmcgcG9pbnQuDQoJICogQHBhcmFtIHtOdW1iZXJ9IHkgLSBUaGUgeSBheGlzIG9mIHRoZSBjb29yZGluYXRlIGZvciB0aGUgcmVjdGFuZ2xlIHN0YXJ0aW5nIHBvaW50Lg0KCSAqIEBwYXJhbSB7TnVtYmVyfSB3aWR0aCAtIFRoZSByZWN0YW5nbGUncyB3aWR0aC4NCgkgKiBAcGFyYW0ge051bWJlcn0gaGVpZ2h0IC0gVGhlIHJlY3RhbmdsZSdzIGhlaWdodC4NCgkgKiBAcGFyYW0ge051bWJlcn0gcmFkaXVzIC0gVGhlIHJvdW5kZWQgYW1vdW50IChpbiBwaXhlbHMpIGZvciB0aGUgZm91ciBjb3JuZXJzLg0KCSAqIEB0b2RvIGhhbmRsZSBgcmFkaXVzYCBhcyB0b3AtbGVmdCwgdG9wLXJpZ2h0LCBib3R0b20tcmlnaHQsIGJvdHRvbS1sZWZ0IGFycmF5L29iamVjdD8NCgkgKi8NCglyb3VuZGVkUmVjdDogZnVuY3Rpb24oY3R4LCB4LCB5LCB3aWR0aCwgaGVpZ2h0LCByYWRpdXMpIHsNCgkJaWYgKHJhZGl1cykgew0KCQkJdmFyIHJ4ID0gTWF0aC5taW4ocmFkaXVzLCB3aWR0aCAvIDIpOw0KCQkJdmFyIHJ5ID0gTWF0aC5taW4ocmFkaXVzLCBoZWlnaHQgLyAyKTsNCg0KCQkJY3R4Lm1vdmVUbyh4ICsgcngsIHkpOw0KCQkJY3R4LmxpbmVUbyh4ICsgd2lkdGggLSByeCwgeSk7DQoJCQljdHgucXVhZHJhdGljQ3VydmVUbyh4ICsgd2lkdGgsIHksIHggKyB3aWR0aCwgeSArIHJ5KTsNCgkJCWN0eC5saW5lVG8oeCArIHdpZHRoLCB5ICsgaGVpZ2h0IC0gcnkpOw0KCQkJY3R4LnF1YWRyYXRpY0N1cnZlVG8oeCArIHdpZHRoLCB5ICsgaGVpZ2h0LCB4ICsgd2lkdGggLSByeCwgeSArIGhlaWdodCk7DQoJCQljdHgubGluZVRvKHggKyByeCwgeSArIGhlaWdodCk7DQoJCQljdHgucXVhZHJhdGljQ3VydmVUbyh4LCB5ICsgaGVpZ2h0LCB4LCB5ICsgaGVpZ2h0IC0gcnkpOw0KCQkJY3R4LmxpbmVUbyh4LCB5ICsgcnkpOw0KCQkJY3R4LnF1YWRyYXRpY0N1cnZlVG8oeCwgeSwgeCArIHJ4LCB5KTsNCgkJfSBlbHNlIHsNCgkJCWN0eC5yZWN0KHgsIHksIHdpZHRoLCBoZWlnaHQpOw0KCQl9DQoJfSwNCg0KCWRyYXdQb2ludDogZnVuY3Rpb24oY3R4LCBzdHlsZSwgcmFkaXVzLCB4LCB5KSB7DQoJCXZhciB0eXBlLCBlZGdlTGVuZ3RoLCB4T2Zmc2V0LCB5T2Zmc2V0LCBoZWlnaHQsIHNpemU7DQoNCgkJaWYgKHN0eWxlICYmIHR5cGVvZiBzdHlsZSA9PT0gJ29iamVjdCcpIHsNCgkJCXR5cGUgPSBzdHlsZS50b1N0cmluZygpOw0KCQkJaWYgKHR5cGUgPT09ICdbb2JqZWN0IEhUTUxJbWFnZUVsZW1lbnRdJyB8fCB0eXBlID09PSAnW29iamVjdCBIVE1MQ2FudmFzRWxlbWVudF0nKSB7DQoJCQkJY3R4LmRyYXdJbWFnZShzdHlsZSwgeCAtIHN0eWxlLndpZHRoIC8gMiwgeSAtIHN0eWxlLmhlaWdodCAvIDIsIHN0eWxlLndpZHRoLCBzdHlsZS5oZWlnaHQpOw0KCQkJCXJldHVybjsNCgkJCX0NCgkJfQ0KDQoJCWlmIChpc05hTihyYWRpdXMpIHx8IHJhZGl1cyA8PSAwKSB7DQoJCQlyZXR1cm47DQoJCX0NCg0KCQlzd2l0Y2ggKHN0eWxlKSB7DQoJCS8vIERlZmF1bHQgaW5jbHVkZXMgY2lyY2xlDQoJCWRlZmF1bHQ6DQoJCQljdHguYmVnaW5QYXRoKCk7DQoJCQljdHguYXJjKHgsIHksIHJhZGl1cywgMCwgTWF0aC5QSSAqIDIpOw0KCQkJY3R4LmNsb3NlUGF0aCgpOw0KCQkJY3R4LmZpbGwoKTsNCgkJCWJyZWFrOw0KCQljYXNlICd0cmlhbmdsZSc6DQoJCQljdHguYmVnaW5QYXRoKCk7DQoJCQllZGdlTGVuZ3RoID0gMyAqIHJhZGl1cyAvIE1hdGguc3FydCgzKTsNCgkJCWhlaWdodCA9IGVkZ2VMZW5ndGggKiBNYXRoLnNxcnQoMykgLyAyOw0KCQkJY3R4Lm1vdmVUbyh4IC0gZWRnZUxlbmd0aCAvIDIsIHkgKyBoZWlnaHQgLyAzKTsNCgkJCWN0eC5saW5lVG8oeCArIGVkZ2VMZW5ndGggLyAyLCB5ICsgaGVpZ2h0IC8gMyk7DQoJCQljdHgubGluZVRvKHgsIHkgLSAyICogaGVpZ2h0IC8gMyk7DQoJCQljdHguY2xvc2VQYXRoKCk7DQoJCQljdHguZmlsbCgpOw0KCQkJYnJlYWs7DQoJCWNhc2UgJ3JlY3QnOg0KCQkJc2l6ZSA9IDEgLyBNYXRoLlNRUlQyICogcmFkaXVzOw0KCQkJY3R4LmJlZ2luUGF0aCgpOw0KCQkJY3R4LmZpbGxSZWN0KHggLSBzaXplLCB5IC0gc2l6ZSwgMiAqIHNpemUsIDIgKiBzaXplKTsNCgkJCWN0eC5zdHJva2VSZWN0KHggLSBzaXplLCB5IC0gc2l6ZSwgMiAqIHNpemUsIDIgKiBzaXplKTsNCgkJCWJyZWFrOw0KCQljYXNlICdyZWN0Um91bmRlZCc6DQoJCQl2YXIgb2Zmc2V0ID0gcmFkaXVzIC8gTWF0aC5TUVJUMjsNCgkJCXZhciBsZWZ0WCA9IHggLSBvZmZzZXQ7DQoJCQl2YXIgdG9wWSA9IHkgLSBvZmZzZXQ7DQoJCQl2YXIgc2lkZVNpemUgPSBNYXRoLlNRUlQyICogcmFkaXVzOw0KCQkJY3R4LmJlZ2luUGF0aCgpOw0KCQkJdGhpcy5yb3VuZGVkUmVjdChjdHgsIGxlZnRYLCB0b3BZLCBzaWRlU2l6ZSwgc2lkZVNpemUsIHJhZGl1cyAvIDIpOw0KCQkJY3R4LmNsb3NlUGF0aCgpOw0KCQkJY3R4LmZpbGwoKTsNCgkJCWJyZWFrOw0KCQljYXNlICdyZWN0Um90JzoNCgkJCXNpemUgPSAxIC8gTWF0aC5TUVJUMiAqIHJhZGl1czsNCgkJCWN0eC5iZWdpblBhdGgoKTsNCgkJCWN0eC5tb3ZlVG8oeCAtIHNpemUsIHkpOw0KCQkJY3R4LmxpbmVUbyh4LCB5ICsgc2l6ZSk7DQoJCQljdHgubGluZVRvKHggKyBzaXplLCB5KTsNCgkJCWN0eC5saW5lVG8oeCwgeSAtIHNpemUpOw0KCQkJY3R4LmNsb3NlUGF0aCgpOw0KCQkJY3R4LmZpbGwoKTsNCgkJCWJyZWFrOw0KCQljYXNlICdjcm9zcyc6DQoJCQljdHguYmVnaW5QYXRoKCk7DQoJCQljdHgubW92ZVRvKHgsIHkgKyByYWRpdXMpOw0KCQkJY3R4LmxpbmVUbyh4LCB5IC0gcmFkaXVzKTsNCgkJCWN0eC5tb3ZlVG8oeCAtIHJhZGl1cywgeSk7DQoJCQljdHgubGluZVRvKHggKyByYWRpdXMsIHkpOw0KCQkJY3R4LmNsb3NlUGF0aCgpOw0KCQkJYnJlYWs7DQoJCWNhc2UgJ2Nyb3NzUm90JzoNCgkJCWN0eC5iZWdpblBhdGgoKTsNCgkJCXhPZmZzZXQgPSBNYXRoLmNvcyhNYXRoLlBJIC8gNCkgKiByYWRpdXM7DQoJCQl5T2Zmc2V0ID0gTWF0aC5zaW4oTWF0aC5QSSAvIDQpICogcmFkaXVzOw0KCQkJY3R4Lm1vdmVUbyh4IC0geE9mZnNldCwgeSAtIHlPZmZzZXQpOw0KCQkJY3R4LmxpbmVUbyh4ICsgeE9mZnNldCwgeSArIHlPZmZzZXQpOw0KCQkJY3R4Lm1vdmVUbyh4IC0geE9mZnNldCwgeSArIHlPZmZzZXQpOw0KCQkJY3R4LmxpbmVUbyh4ICsgeE9mZnNldCwgeSAtIHlPZmZzZXQpOw0KCQkJY3R4LmNsb3NlUGF0aCgpOw0KCQkJYnJlYWs7DQoJCWNhc2UgJ3N0YXInOg0KCQkJY3R4LmJlZ2luUGF0aCgpOw0KCQkJY3R4Lm1vdmVUbyh4LCB5ICsgcmFkaXVzKTsNCgkJCWN0eC5saW5lVG8oeCwgeSAtIHJhZGl1cyk7DQoJCQljdHgubW92ZVRvKHggLSByYWRpdXMsIHkpOw0KCQkJY3R4LmxpbmVUbyh4ICsgcmFkaXVzLCB5KTsNCgkJCXhPZmZzZXQgPSBNYXRoLmNvcyhNYXRoLlBJIC8gNCkgKiByYWRpdXM7DQoJCQl5T2Zmc2V0ID0gTWF0aC5zaW4oTWF0aC5QSSAvIDQpICogcmFkaXVzOw0KCQkJY3R4Lm1vdmVUbyh4IC0geE9mZnNldCwgeSAtIHlPZmZzZXQpOw0KCQkJY3R4LmxpbmVUbyh4ICsgeE9mZnNldCwgeSArIHlPZmZzZXQpOw0KCQkJY3R4Lm1vdmVUbyh4IC0geE9mZnNldCwgeSArIHlPZmZzZXQpOw0KCQkJY3R4LmxpbmVUbyh4ICsgeE9mZnNldCwgeSAtIHlPZmZzZXQpOw0KCQkJY3R4LmNsb3NlUGF0aCgpOw0KCQkJYnJlYWs7DQoJCWNhc2UgJ2xpbmUnOg0KCQkJY3R4LmJlZ2luUGF0aCgpOw0KCQkJY3R4Lm1vdmVUbyh4IC0gcmFkaXVzLCB5KTsNCgkJCWN0eC5saW5lVG8oeCArIHJhZGl1cywgeSk7DQoJCQljdHguY2xvc2VQYXRoKCk7DQoJCQlicmVhazsNCgkJY2FzZSAnZGFzaCc6DQoJCQljdHguYmVnaW5QYXRoKCk7DQoJCQljdHgubW92ZVRvKHgsIHkpOw0KCQkJY3R4LmxpbmVUbyh4ICsgcmFkaXVzLCB5KTsNCgkJCWN0eC5jbG9zZVBhdGgoKTsNCgkJCWJyZWFrOw0KCQl9DQoNCgkJY3R4LnN0cm9rZSgpOw0KCX0sDQoNCgljbGlwQXJlYTogZnVuY3Rpb24oY3R4LCBhcmVhKSB7DQoJCWN0eC5zYXZlKCk7DQoJCWN0eC5iZWdpblBhdGgoKTsNCgkJY3R4LnJlY3QoYXJlYS5sZWZ0LCBhcmVhLnRvcCwgYXJlYS5yaWdodCAtIGFyZWEubGVmdCwgYXJlYS5ib3R0b20gLSBhcmVhLnRvcCk7DQoJCWN0eC5jbGlwKCk7DQoJfSwNCg0KCXVuY2xpcEFyZWE6IGZ1bmN0aW9uKGN0eCkgew0KCQljdHgucmVzdG9yZSgpOw0KCX0sDQoNCglsaW5lVG86IGZ1bmN0aW9uKGN0eCwgcHJldmlvdXMsIHRhcmdldCwgZmxpcCkgew0KCQlpZiAodGFyZ2V0LnN0ZXBwZWRMaW5lKSB7DQoJCQlpZiAoKHRhcmdldC5zdGVwcGVkTGluZSA9PT0gJ2FmdGVyJyAmJiAhZmxpcCkgfHwgKHRhcmdldC5zdGVwcGVkTGluZSAhPT0gJ2FmdGVyJyAmJiBmbGlwKSkgew0KCQkJCWN0eC5saW5lVG8ocHJldmlvdXMueCwgdGFyZ2V0LnkpOw0KCQkJfSBlbHNlIHsNCgkJCQljdHgubGluZVRvKHRhcmdldC54LCBwcmV2aW91cy55KTsNCgkJCX0NCgkJCWN0eC5saW5lVG8odGFyZ2V0LngsIHRhcmdldC55KTsNCgkJCXJldHVybjsNCgkJfQ0KDQoJCWlmICghdGFyZ2V0LnRlbnNpb24pIHsNCgkJCWN0eC5saW5lVG8odGFyZ2V0LngsIHRhcmdldC55KTsNCgkJCXJldHVybjsNCgkJfQ0KDQoJCWN0eC5iZXppZXJDdXJ2ZVRvKA0KCQkJZmxpcCA/IHByZXZpb3VzLmNvbnRyb2xQb2ludFByZXZpb3VzWCA6IHByZXZpb3VzLmNvbnRyb2xQb2ludE5leHRYLA0KCQkJZmxpcCA/IHByZXZpb3VzLmNvbnRyb2xQb2ludFByZXZpb3VzWSA6IHByZXZpb3VzLmNvbnRyb2xQb2ludE5leHRZLA0KCQkJZmxpcCA/IHRhcmdldC5jb250cm9sUG9pbnROZXh0WCA6IHRhcmdldC5jb250cm9sUG9pbnRQcmV2aW91c1gsDQoJCQlmbGlwID8gdGFyZ2V0LmNvbnRyb2xQb2ludE5leHRZIDogdGFyZ2V0LmNvbnRyb2xQb2ludFByZXZpb3VzWSwNCgkJCXRhcmdldC54LA0KCQkJdGFyZ2V0LnkpOw0KCX0NCn07DQoNCi8vIERFUFJFQ0FUSU9OUw0KDQovKioNCiAqIFByb3ZpZGVkIGZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5LCB1c2UgQ2hhcnQuaGVscGVycy5jYW52YXMuY2xlYXIgaW5zdGVhZC4NCiAqIEBuYW1lc3BhY2UgQ2hhcnQuaGVscGVycy5jbGVhcg0KICogQGRlcHJlY2F0ZWQgc2luY2UgdmVyc2lvbiAyLjcuMA0KICogQHRvZG8gcmVtb3ZlIGF0IHZlcnNpb24gMw0KICogQHByaXZhdGUNCiAqLw0KaGVscGVycy5jbGVhciA9IGV4cG9ydHMuY2xlYXI7DQoNCi8qKg0KICogUHJvdmlkZWQgZm9yIGJhY2t3YXJkIGNvbXBhdGliaWxpdHksIHVzZSBDaGFydC5oZWxwZXJzLmNhbnZhcy5yb3VuZGVkUmVjdCBpbnN0ZWFkLg0KICogQG5hbWVzcGFjZSBDaGFydC5oZWxwZXJzLmRyYXdSb3VuZGVkUmVjdGFuZ2xlDQogKiBAZGVwcmVjYXRlZCBzaW5jZSB2ZXJzaW9uIDIuNy4wDQogKiBAdG9kbyByZW1vdmUgYXQgdmVyc2lvbiAzDQogKiBAcHJpdmF0ZQ0KICovDQpoZWxwZXJzLmRyYXdSb3VuZGVkUmVjdGFuZ2xlID0gZnVuY3Rpb24oY3R4KSB7DQoJY3R4LmJlZ2luUGF0aCgpOw0KCWV4cG9ydHMucm91bmRlZFJlY3QuYXBwbHkoZXhwb3J0cywgYXJndW1lbnRzKTsNCgljdHguY2xvc2VQYXRoKCk7DQp9Ow0KDQp9LHsiNDIiOjQyfV0sNDI6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpew0KJ3VzZSBzdHJpY3QnOw0KDQovKioNCiAqIEBuYW1lc3BhY2UgQ2hhcnQuaGVscGVycw0KICovDQp2YXIgaGVscGVycyA9IHsNCgkvKioNCgkgKiBBbiBlbXB0eSBmdW5jdGlvbiB0aGF0IGNhbiBiZSB1c2VkLCBmb3IgZXhhbXBsZSwgZm9yIG9wdGlvbmFsIGNhbGxiYWNrLg0KCSAqLw0KCW5vb3A6IGZ1bmN0aW9uKCkge30sDQoNCgkvKioNCgkgKiBSZXR1cm5zIGEgdW5pcXVlIGlkLCBzZXF1ZW50aWFsbHkgZ2VuZXJhdGVkIGZyb20gYSBnbG9iYWwgdmFyaWFibGUuDQoJICogQHJldHVybnMge051bWJlcn0NCgkgKiBAZnVuY3Rpb24NCgkgKi8NCgl1aWQ6IChmdW5jdGlvbigpIHsNCgkJdmFyIGlkID0gMDsNCgkJcmV0dXJuIGZ1bmN0aW9uKCkgew0KCQkJcmV0dXJuIGlkKys7DQoJCX07DQoJfSgpKSwNCg0KCS8qKg0KCSAqIFJldHVybnMgdHJ1ZSBpZiBgdmFsdWVgIGlzIG5laXRoZXIgbnVsbCBub3IgdW5kZWZpbmVkLCBlbHNlIHJldHVybnMgZmFsc2UuDQoJICogQHBhcmFtIHsqfSB2YWx1ZSAtIFRoZSB2YWx1ZSB0byB0ZXN0Lg0KCSAqIEByZXR1cm5zIHtCb29sZWFufQ0KCSAqIEBzaW5jZSAyLjcuMA0KCSAqLw0KCWlzTnVsbE9yVW5kZWY6IGZ1bmN0aW9uKHZhbHVlKSB7DQoJCXJldHVybiB2YWx1ZSA9PT0gbnVsbCB8fCB0eXBlb2YgdmFsdWUgPT09ICd1bmRlZmluZWQnOw0KCX0sDQoNCgkvKioNCgkgKiBSZXR1cm5zIHRydWUgaWYgYHZhbHVlYCBpcyBhbiBhcnJheSwgZWxzZSByZXR1cm5zIGZhbHNlLg0KCSAqIEBwYXJhbSB7Kn0gdmFsdWUgLSBUaGUgdmFsdWUgdG8gdGVzdC4NCgkgKiBAcmV0dXJucyB7Qm9vbGVhbn0NCgkgKiBAZnVuY3Rpb24NCgkgKi8NCglpc0FycmF5OiBBcnJheS5pc0FycmF5ID8gQXJyYXkuaXNBcnJheSA6IGZ1bmN0aW9uKHZhbHVlKSB7DQoJCXJldHVybiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodmFsdWUpID09PSAnW29iamVjdCBBcnJheV0nOw0KCX0sDQoNCgkvKioNCgkgKiBSZXR1cm5zIHRydWUgaWYgYHZhbHVlYCBpcyBhbiBvYmplY3QgKGV4Y2x1ZGluZyBudWxsKSwgZWxzZSByZXR1cm5zIGZhbHNlLg0KCSAqIEBwYXJhbSB7Kn0gdmFsdWUgLSBUaGUgdmFsdWUgdG8gdGVzdC4NCgkgKiBAcmV0dXJucyB7Qm9vbGVhbn0NCgkgKiBAc2luY2UgMi43LjANCgkgKi8NCglpc09iamVjdDogZnVuY3Rpb24odmFsdWUpIHsNCgkJcmV0dXJuIHZhbHVlICE9PSBudWxsICYmIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2YWx1ZSkgPT09ICdbb2JqZWN0IE9iamVjdF0nOw0KCX0sDQoNCgkvKioNCgkgKiBSZXR1cm5zIGB2YWx1ZWAgaWYgZGVmaW5lZCwgZWxzZSByZXR1cm5zIGBkZWZhdWx0VmFsdWVgLg0KCSAqIEBwYXJhbSB7Kn0gdmFsdWUgLSBUaGUgdmFsdWUgdG8gcmV0dXJuIGlmIGRlZmluZWQuDQoJICogQHBhcmFtIHsqfSBkZWZhdWx0VmFsdWUgLSBUaGUgdmFsdWUgdG8gcmV0dXJuIGlmIGB2YWx1ZWAgaXMgdW5kZWZpbmVkLg0KCSAqIEByZXR1cm5zIHsqfQ0KCSAqLw0KCXZhbHVlT3JEZWZhdWx0OiBmdW5jdGlvbih2YWx1ZSwgZGVmYXVsdFZhbHVlKSB7DQoJCXJldHVybiB0eXBlb2YgdmFsdWUgPT09ICd1bmRlZmluZWQnID8gZGVmYXVsdFZhbHVlIDogdmFsdWU7DQoJfSwNCg0KCS8qKg0KCSAqIFJldHVybnMgdmFsdWUgYXQgdGhlIGdpdmVuIGBpbmRleGAgaW4gYXJyYXkgaWYgZGVmaW5lZCwgZWxzZSByZXR1cm5zIGBkZWZhdWx0VmFsdWVgLg0KCSAqIEBwYXJhbSB7QXJyYXl9IHZhbHVlIC0gVGhlIGFycmF5IHRvIGxvb2t1cCBmb3IgdmFsdWUgYXQgYGluZGV4YC4NCgkgKiBAcGFyYW0ge051bWJlcn0gaW5kZXggLSBUaGUgaW5kZXggaW4gYHZhbHVlYCB0byBsb29rdXAgZm9yIHZhbHVlLg0KCSAqIEBwYXJhbSB7Kn0gZGVmYXVsdFZhbHVlIC0gVGhlIHZhbHVlIHRvIHJldHVybiBpZiBgdmFsdWVbaW5kZXhdYCBpcyB1bmRlZmluZWQuDQoJICogQHJldHVybnMgeyp9DQoJICovDQoJdmFsdWVBdEluZGV4T3JEZWZhdWx0OiBmdW5jdGlvbih2YWx1ZSwgaW5kZXgsIGRlZmF1bHRWYWx1ZSkgew0KCQlyZXR1cm4gaGVscGVycy52YWx1ZU9yRGVmYXVsdChoZWxwZXJzLmlzQXJyYXkodmFsdWUpID8gdmFsdWVbaW5kZXhdIDogdmFsdWUsIGRlZmF1bHRWYWx1ZSk7DQoJfSwNCg0KCS8qKg0KCSAqIENhbGxzIGBmbmAgd2l0aCB0aGUgZ2l2ZW4gYGFyZ3NgIGluIHRoZSBzY29wZSBkZWZpbmVkIGJ5IGB0aGlzQXJnYCBhbmQgcmV0dXJucyB0aGUNCgkgKiB2YWx1ZSByZXR1cm5lZCBieSBgZm5gLiBJZiBgZm5gIGlzIG5vdCBhIGZ1bmN0aW9uLCB0aGlzIG1ldGhvZCByZXR1cm5zIHVuZGVmaW5lZC4NCgkgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbiAtIFRoZSBmdW5jdGlvbiB0byBjYWxsLg0KCSAqIEBwYXJhbSB7QXJyYXl8dW5kZWZpbmVkfG51bGx9IGFyZ3MgLSBUaGUgYXJndW1lbnRzIHdpdGggd2hpY2ggYGZuYCBzaG91bGQgYmUgY2FsbGVkLg0KCSAqIEBwYXJhbSB7T2JqZWN0fSBbdGhpc0FyZ10gLSBUaGUgdmFsdWUgb2YgYHRoaXNgIHByb3ZpZGVkIGZvciB0aGUgY2FsbCB0byBgZm5gLg0KCSAqIEByZXR1cm5zIHsqfQ0KCSAqLw0KCWNhbGxiYWNrOiBmdW5jdGlvbihmbiwgYXJncywgdGhpc0FyZykgew0KCQlpZiAoZm4gJiYgdHlwZW9mIGZuLmNhbGwgPT09ICdmdW5jdGlvbicpIHsNCgkJCXJldHVybiBmbi5hcHBseSh0aGlzQXJnLCBhcmdzKTsNCgkJfQ0KCX0sDQoNCgkvKioNCgkgKiBOb3RlKFNCKSBmb3IgcGVyZm9ybWFuY2Ugc2FrZSwgdGhpcyBtZXRob2Qgc2hvdWxkIG9ubHkgYmUgdXNlZCB3aGVuIGxvb3BhYmxlIHR5cGUNCgkgKiBpcyB1bmtub3duIG9yIGluIG5vbmUgaW50ZW5zaXZlIGNvZGUgKG5vdCBjYWxsZWQgb2Z0ZW4gYW5kIHNtYWxsIGxvb3BhYmxlKS4gRWxzZQ0KCSAqIGl0J3MgcHJlZmVyYWJsZSB0byB1c2UgYSByZWd1bGFyIGZvcigpIGxvb3AgYW5kIHNhdmUgZXh0cmEgZnVuY3Rpb24gY2FsbHMuDQoJICogQHBhcmFtIHtPYmplY3R8QXJyYXl9IGxvb3BhYmxlIC0gVGhlIG9iamVjdCBvciBhcnJheSB0byBiZSBpdGVyYXRlZC4NCgkgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbiAtIFRoZSBmdW5jdGlvbiB0byBjYWxsIGZvciBlYWNoIGl0ZW0uDQoJICogQHBhcmFtIHtPYmplY3R9IFt0aGlzQXJnXSAtIFRoZSB2YWx1ZSBvZiBgdGhpc2AgcHJvdmlkZWQgZm9yIHRoZSBjYWxsIHRvIGBmbmAuDQoJICogQHBhcmFtIHtCb29sZWFufSBbcmV2ZXJzZV0gLSBJZiB0cnVlLCBpdGVyYXRlcyBiYWNrd2FyZCBvbiB0aGUgbG9vcGFibGUuDQoJICovDQoJZWFjaDogZnVuY3Rpb24obG9vcGFibGUsIGZuLCB0aGlzQXJnLCByZXZlcnNlKSB7DQoJCXZhciBpLCBsZW4sIGtleXM7DQoJCWlmIChoZWxwZXJzLmlzQXJyYXkobG9vcGFibGUpKSB7DQoJCQlsZW4gPSBsb29wYWJsZS5sZW5ndGg7DQoJCQlpZiAocmV2ZXJzZSkgew0KCQkJCWZvciAoaSA9IGxlbiAtIDE7IGkgPj0gMDsgaS0tKSB7DQoJCQkJCWZuLmNhbGwodGhpc0FyZywgbG9vcGFibGVbaV0sIGkpOw0KCQkJCX0NCgkJCX0gZWxzZSB7DQoJCQkJZm9yIChpID0gMDsgaSA8IGxlbjsgaSsrKSB7DQoJCQkJCWZuLmNhbGwodGhpc0FyZywgbG9vcGFibGVbaV0sIGkpOw0KCQkJCX0NCgkJCX0NCgkJfSBlbHNlIGlmIChoZWxwZXJzLmlzT2JqZWN0KGxvb3BhYmxlKSkgew0KCQkJa2V5cyA9IE9iamVjdC5rZXlzKGxvb3BhYmxlKTsNCgkJCWxlbiA9IGtleXMubGVuZ3RoOw0KCQkJZm9yIChpID0gMDsgaSA8IGxlbjsgaSsrKSB7DQoJCQkJZm4uY2FsbCh0aGlzQXJnLCBsb29wYWJsZVtrZXlzW2ldXSwga2V5c1tpXSk7DQoJCQl9DQoJCX0NCgl9LA0KDQoJLyoqDQoJICogUmV0dXJucyB0cnVlIGlmIHRoZSBgYTBgIGFuZCBgYTFgIGFycmF5cyBoYXZlIHRoZSBzYW1lIGNvbnRlbnQsIGVsc2UgcmV0dXJucyBmYWxzZS4NCgkgKiBAc2VlIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9hLzE0ODUzOTc0DQoJICogQHBhcmFtIHtBcnJheX0gYTAgLSBUaGUgYXJyYXkgdG8gY29tcGFyZQ0KCSAqIEBwYXJhbSB7QXJyYXl9IGExIC0gVGhlIGFycmF5IHRvIGNvbXBhcmUNCgkgKiBAcmV0dXJucyB7Qm9vbGVhbn0NCgkgKi8NCglhcnJheUVxdWFsczogZnVuY3Rpb24oYTAsIGExKSB7DQoJCXZhciBpLCBpbGVuLCB2MCwgdjE7DQoNCgkJaWYgKCFhMCB8fCAhYTEgfHwgYTAubGVuZ3RoICE9PSBhMS5sZW5ndGgpIHsNCgkJCXJldHVybiBmYWxzZTsNCgkJfQ0KDQoJCWZvciAoaSA9IDAsIGlsZW4gPSBhMC5sZW5ndGg7IGkgPCBpbGVuOyArK2kpIHsNCgkJCXYwID0gYTBbaV07DQoJCQl2MSA9IGExW2ldOw0KDQoJCQlpZiAodjAgaW5zdGFuY2VvZiBBcnJheSAmJiB2MSBpbnN0YW5jZW9mIEFycmF5KSB7DQoJCQkJaWYgKCFoZWxwZXJzLmFycmF5RXF1YWxzKHYwLCB2MSkpIHsNCgkJCQkJcmV0dXJuIGZhbHNlOw0KCQkJCX0NCgkJCX0gZWxzZSBpZiAodjAgIT09IHYxKSB7DQoJCQkJLy8gTk9URTogdHdvIGRpZmZlcmVudCBvYmplY3QgaW5zdGFuY2VzIHdpbGwgbmV2ZXIgYmUgZXF1YWw6IHt4OjIwfSAhPSB7eDoyMH0NCgkJCQlyZXR1cm4gZmFsc2U7DQoJCQl9DQoJCX0NCg0KCQlyZXR1cm4gdHJ1ZTsNCgl9LA0KDQoJLyoqDQoJICogUmV0dXJucyBhIGRlZXAgY29weSBvZiBgc291cmNlYCB3aXRob3V0IGtlZXBpbmcgcmVmZXJlbmNlcyBvbiBvYmplY3RzIGFuZCBhcnJheXMuDQoJICogQHBhcmFtIHsqfSBzb3VyY2UgLSBUaGUgdmFsdWUgdG8gY2xvbmUuDQoJICogQHJldHVybnMgeyp9DQoJICovDQoJY2xvbmU6IGZ1bmN0aW9uKHNvdXJjZSkgew0KCQlpZiAoaGVscGVycy5pc0FycmF5KHNvdXJjZSkpIHsNCgkJCXJldHVybiBzb3VyY2UubWFwKGhlbHBlcnMuY2xvbmUpOw0KCQl9DQoNCgkJaWYgKGhlbHBlcnMuaXNPYmplY3Qoc291cmNlKSkgew0KCQkJdmFyIHRhcmdldCA9IHt9Ow0KCQkJdmFyIGtleXMgPSBPYmplY3Qua2V5cyhzb3VyY2UpOw0KCQkJdmFyIGtsZW4gPSBrZXlzLmxlbmd0aDsNCgkJCXZhciBrID0gMDsNCg0KCQkJZm9yICg7IGsgPCBrbGVuOyArK2spIHsNCgkJCQl0YXJnZXRba2V5c1trXV0gPSBoZWxwZXJzLmNsb25lKHNvdXJjZVtrZXlzW2tdXSk7DQoJCQl9DQoNCgkJCXJldHVybiB0YXJnZXQ7DQoJCX0NCg0KCQlyZXR1cm4gc291cmNlOw0KCX0sDQoNCgkvKioNCgkgKiBUaGUgZGVmYXVsdCBtZXJnZXIgd2hlbiBDaGFydC5oZWxwZXJzLm1lcmdlIGlzIGNhbGxlZCB3aXRob3V0IG1lcmdlciBvcHRpb24uDQoJICogTm90ZShTQik6IHRoaXMgbWV0aG9kIGlzIGFsc28gdXNlZCBieSBjb25maWdNZXJnZSBhbmQgc2NhbGVNZXJnZSBhcyBmYWxsYmFjay4NCgkgKiBAcHJpdmF0ZQ0KCSAqLw0KCV9tZXJnZXI6IGZ1bmN0aW9uKGtleSwgdGFyZ2V0LCBzb3VyY2UsIG9wdGlvbnMpIHsNCgkJdmFyIHR2YWwgPSB0YXJnZXRba2V5XTsNCgkJdmFyIHN2YWwgPSBzb3VyY2Vba2V5XTsNCg0KCQlpZiAoaGVscGVycy5pc09iamVjdCh0dmFsKSAmJiBoZWxwZXJzLmlzT2JqZWN0KHN2YWwpKSB7DQoJCQloZWxwZXJzLm1lcmdlKHR2YWwsIHN2YWwsIG9wdGlvbnMpOw0KCQl9IGVsc2Ugew0KCQkJdGFyZ2V0W2tleV0gPSBoZWxwZXJzLmNsb25lKHN2YWwpOw0KCQl9DQoJfSwNCg0KCS8qKg0KCSAqIE1lcmdlcyBzb3VyY2Vba2V5XSBpbiB0YXJnZXRba2V5XSBvbmx5IGlmIHRhcmdldFtrZXldIGlzIHVuZGVmaW5lZC4NCgkgKiBAcHJpdmF0ZQ0KCSAqLw0KCV9tZXJnZXJJZjogZnVuY3Rpb24oa2V5LCB0YXJnZXQsIHNvdXJjZSkgew0KCQl2YXIgdHZhbCA9IHRhcmdldFtrZXldOw0KCQl2YXIgc3ZhbCA9IHNvdXJjZVtrZXldOw0KDQoJCWlmIChoZWxwZXJzLmlzT2JqZWN0KHR2YWwpICYmIGhlbHBlcnMuaXNPYmplY3Qoc3ZhbCkpIHsNCgkJCWhlbHBlcnMubWVyZ2VJZih0dmFsLCBzdmFsKTsNCgkJfSBlbHNlIGlmICghdGFyZ2V0Lmhhc093blByb3BlcnR5KGtleSkpIHsNCgkJCXRhcmdldFtrZXldID0gaGVscGVycy5jbG9uZShzdmFsKTsNCgkJfQ0KCX0sDQoNCgkvKioNCgkgKiBSZWN1cnNpdmVseSBkZWVwIGNvcGllcyBgc291cmNlYCBwcm9wZXJ0aWVzIGludG8gYHRhcmdldGAgd2l0aCB0aGUgZ2l2ZW4gYG9wdGlvbnNgLg0KCSAqIElNUE9SVEFOVDogYHRhcmdldGAgaXMgbm90IGNsb25lZCBhbmQgd2lsbCBiZSB1cGRhdGVkIHdpdGggYHNvdXJjZWAgcHJvcGVydGllcy4NCgkgKiBAcGFyYW0ge09iamVjdH0gdGFyZ2V0IC0gVGhlIHRhcmdldCBvYmplY3QgaW4gd2hpY2ggYWxsIHNvdXJjZXMgYXJlIG1lcmdlZCBpbnRvLg0KCSAqIEBwYXJhbSB7T2JqZWN0fEFycmF5KE9iamVjdCl9IHNvdXJjZSAtIE9iamVjdChzKSB0byBtZXJnZSBpbnRvIGB0YXJnZXRgLg0KCSAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc10gLSBNZXJnaW5nIG9wdGlvbnM6DQoJICogQHBhcmFtIHtGdW5jdGlvbn0gW29wdGlvbnMubWVyZ2VyXSAtIFRoZSBtZXJnZSBtZXRob2QgKGtleSwgdGFyZ2V0LCBzb3VyY2UsIG9wdGlvbnMpDQoJICogQHJldHVybnMge09iamVjdH0gVGhlIGB0YXJnZXRgIG9iamVjdC4NCgkgKi8NCgltZXJnZTogZnVuY3Rpb24odGFyZ2V0LCBzb3VyY2UsIG9wdGlvbnMpIHsNCgkJdmFyIHNvdXJjZXMgPSBoZWxwZXJzLmlzQXJyYXkoc291cmNlKSA/IHNvdXJjZSA6IFtzb3VyY2VdOw0KCQl2YXIgaWxlbiA9IHNvdXJjZXMubGVuZ3RoOw0KCQl2YXIgbWVyZ2UsIGksIGtleXMsIGtsZW4sIGs7DQoNCgkJaWYgKCFoZWxwZXJzLmlzT2JqZWN0KHRhcmdldCkpIHsNCgkJCXJldHVybiB0YXJnZXQ7DQoJCX0NCg0KCQlvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsNCgkJbWVyZ2UgPSBvcHRpb25zLm1lcmdlciB8fCBoZWxwZXJzLl9tZXJnZXI7DQoNCgkJZm9yIChpID0gMDsgaSA8IGlsZW47ICsraSkgew0KCQkJc291cmNlID0gc291cmNlc1tpXTsNCgkJCWlmICghaGVscGVycy5pc09iamVjdChzb3VyY2UpKSB7DQoJCQkJY29udGludWU7DQoJCQl9DQoNCgkJCWtleXMgPSBPYmplY3Qua2V5cyhzb3VyY2UpOw0KCQkJZm9yIChrID0gMCwga2xlbiA9IGtleXMubGVuZ3RoOyBrIDwga2xlbjsgKytrKSB7DQoJCQkJbWVyZ2Uoa2V5c1trXSwgdGFyZ2V0LCBzb3VyY2UsIG9wdGlvbnMpOw0KCQkJfQ0KCQl9DQoNCgkJcmV0dXJuIHRhcmdldDsNCgl9LA0KDQoJLyoqDQoJICogUmVjdXJzaXZlbHkgZGVlcCBjb3BpZXMgYHNvdXJjZWAgcHJvcGVydGllcyBpbnRvIGB0YXJnZXRgICpvbmx5KiBpZiBub3QgZGVmaW5lZCBpbiB0YXJnZXQuDQoJICogSU1QT1JUQU5UOiBgdGFyZ2V0YCBpcyBub3QgY2xvbmVkIGFuZCB3aWxsIGJlIHVwZGF0ZWQgd2l0aCBgc291cmNlYCBwcm9wZXJ0aWVzLg0KCSAqIEBwYXJhbSB7T2JqZWN0fSB0YXJnZXQgLSBUaGUgdGFyZ2V0IG9iamVjdCBpbiB3aGljaCBhbGwgc291cmNlcyBhcmUgbWVyZ2VkIGludG8uDQoJICogQHBhcmFtIHtPYmplY3R8QXJyYXkoT2JqZWN0KX0gc291cmNlIC0gT2JqZWN0KHMpIHRvIG1lcmdlIGludG8gYHRhcmdldGAuDQoJICogQHJldHVybnMge09iamVjdH0gVGhlIGB0YXJnZXRgIG9iamVjdC4NCgkgKi8NCgltZXJnZUlmOiBmdW5jdGlvbih0YXJnZXQsIHNvdXJjZSkgew0KCQlyZXR1cm4gaGVscGVycy5tZXJnZSh0YXJnZXQsIHNvdXJjZSwge21lcmdlcjogaGVscGVycy5fbWVyZ2VySWZ9KTsNCgl9LA0KDQoJLyoqDQoJICogQXBwbGllcyB0aGUgY29udGVudHMgb2YgdHdvIG9yIG1vcmUgb2JqZWN0cyB0b2dldGhlciBpbnRvIHRoZSBmaXJzdCBvYmplY3QuDQoJICogQHBhcmFtIHtPYmplY3R9IHRhcmdldCAtIFRoZSB0YXJnZXQgb2JqZWN0IGluIHdoaWNoIGFsbCBvYmplY3RzIGFyZSBtZXJnZWQgaW50by4NCgkgKiBAcGFyYW0ge09iamVjdH0gYXJnMSAtIE9iamVjdCBjb250YWluaW5nIGFkZGl0aW9uYWwgcHJvcGVydGllcyB0byBtZXJnZSBpbiB0YXJnZXQuDQoJICogQHBhcmFtIHtPYmplY3R9IGFyZ04gLSBBZGRpdGlvbmFsIG9iamVjdHMgY29udGFpbmluZyBwcm9wZXJ0aWVzIHRvIG1lcmdlIGluIHRhcmdldC4NCgkgKiBAcmV0dXJucyB7T2JqZWN0fSBUaGUgYHRhcmdldGAgb2JqZWN0Lg0KCSAqLw0KCWV4dGVuZDogZnVuY3Rpb24odGFyZ2V0KSB7DQoJCXZhciBzZXRGbiA9IGZ1bmN0aW9uKHZhbHVlLCBrZXkpIHsNCgkJCXRhcmdldFtrZXldID0gdmFsdWU7DQoJCX07DQoJCWZvciAodmFyIGkgPSAxLCBpbGVuID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IGlsZW47ICsraSkgew0KCQkJaGVscGVycy5lYWNoKGFyZ3VtZW50c1tpXSwgc2V0Rm4pOw0KCQl9DQoJCXJldHVybiB0YXJnZXQ7DQoJfSwNCg0KCS8qKg0KCSAqIEJhc2ljIGphdmFzY3JpcHQgaW5oZXJpdGFuY2UgYmFzZWQgb24gdGhlIG1vZGVsIGNyZWF0ZWQgaW4gQmFja2JvbmUuanMNCgkgKi8NCglpbmhlcml0czogZnVuY3Rpb24oZXh0ZW5zaW9ucykgew0KCQl2YXIgbWUgPSB0aGlzOw0KCQl2YXIgQ2hhcnRFbGVtZW50ID0gKGV4dGVuc2lvbnMgJiYgZXh0ZW5zaW9ucy5oYXNPd25Qcm9wZXJ0eSgnY29uc3RydWN0b3InKSkgPyBleHRlbnNpb25zLmNvbnN0cnVjdG9yIDogZnVuY3Rpb24oKSB7DQoJCQlyZXR1cm4gbWUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsNCgkJfTsNCg0KCQl2YXIgU3Vycm9nYXRlID0gZnVuY3Rpb24oKSB7DQoJCQl0aGlzLmNvbnN0cnVjdG9yID0gQ2hhcnRFbGVtZW50Ow0KCQl9Ow0KDQoJCVN1cnJvZ2F0ZS5wcm90b3R5cGUgPSBtZS5wcm90b3R5cGU7DQoJCUNoYXJ0RWxlbWVudC5wcm90b3R5cGUgPSBuZXcgU3Vycm9nYXRlKCk7DQoJCUNoYXJ0RWxlbWVudC5leHRlbmQgPSBoZWxwZXJzLmluaGVyaXRzOw0KDQoJCWlmIChleHRlbnNpb25zKSB7DQoJCQloZWxwZXJzLmV4dGVuZChDaGFydEVsZW1lbnQucHJvdG90eXBlLCBleHRlbnNpb25zKTsNCgkJfQ0KDQoJCUNoYXJ0RWxlbWVudC5fX3N1cGVyX18gPSBtZS5wcm90b3R5cGU7DQoJCXJldHVybiBDaGFydEVsZW1lbnQ7DQoJfQ0KfTsNCg0KbW9kdWxlLmV4cG9ydHMgPSBoZWxwZXJzOw0KDQovLyBERVBSRUNBVElPTlMNCg0KLyoqDQogKiBQcm92aWRlZCBmb3IgYmFja3dhcmQgY29tcGF0aWJpbGl0eSwgdXNlIENoYXJ0LmhlbHBlcnMuY2FsbGJhY2sgaW5zdGVhZC4NCiAqIEBmdW5jdGlvbiBDaGFydC5oZWxwZXJzLmNhbGxDYWxsYmFjaw0KICogQGRlcHJlY2F0ZWQgc2luY2UgdmVyc2lvbiAyLjYuMA0KICogQHRvZG8gcmVtb3ZlIGF0IHZlcnNpb24gMw0KICogQHByaXZhdGUNCiAqLw0KaGVscGVycy5jYWxsQ2FsbGJhY2sgPSBoZWxwZXJzLmNhbGxiYWNrOw0KDQovKioNCiAqIFByb3ZpZGVkIGZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5LCB1c2UgQXJyYXkucHJvdG90eXBlLmluZGV4T2YgaW5zdGVhZC4NCiAqIEFycmF5LnByb3RvdHlwZS5pbmRleE9mIGNvbXBhdGliaWxpdHk6IENocm9tZSwgT3BlcmEsIFNhZmFyaSwgRkYxLjUrLCBJRTkrDQogKiBAZnVuY3Rpb24gQ2hhcnQuaGVscGVycy5pbmRleE9mDQogKiBAZGVwcmVjYXRlZCBzaW5jZSB2ZXJzaW9uIDIuNy4wDQogKiBAdG9kbyByZW1vdmUgYXQgdmVyc2lvbiAzDQogKiBAcHJpdmF0ZQ0KICovDQpoZWxwZXJzLmluZGV4T2YgPSBmdW5jdGlvbihhcnJheSwgaXRlbSwgZnJvbUluZGV4KSB7DQoJcmV0dXJuIEFycmF5LnByb3RvdHlwZS5pbmRleE9mLmNhbGwoYXJyYXksIGl0ZW0sIGZyb21JbmRleCk7DQp9Ow0KDQovKioNCiAqIFByb3ZpZGVkIGZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5LCB1c2UgQ2hhcnQuaGVscGVycy52YWx1ZU9yRGVmYXVsdCBpbnN0ZWFkLg0KICogQGZ1bmN0aW9uIENoYXJ0LmhlbHBlcnMuZ2V0VmFsdWVPckRlZmF1bHQNCiAqIEBkZXByZWNhdGVkIHNpbmNlIHZlcnNpb24gMi43LjANCiAqIEB0b2RvIHJlbW92ZSBhdCB2ZXJzaW9uIDMNCiAqIEBwcml2YXRlDQogKi8NCmhlbHBlcnMuZ2V0VmFsdWVPckRlZmF1bHQgPSBoZWxwZXJzLnZhbHVlT3JEZWZhdWx0Ow0KDQovKioNCiAqIFByb3ZpZGVkIGZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5LCB1c2UgQ2hhcnQuaGVscGVycy52YWx1ZUF0SW5kZXhPckRlZmF1bHQgaW5zdGVhZC4NCiAqIEBmdW5jdGlvbiBDaGFydC5oZWxwZXJzLmdldFZhbHVlQXRJbmRleE9yRGVmYXVsdA0KICogQGRlcHJlY2F0ZWQgc2luY2UgdmVyc2lvbiAyLjcuMA0KICogQHRvZG8gcmVtb3ZlIGF0IHZlcnNpb24gMw0KICogQHByaXZhdGUNCiAqLw0KaGVscGVycy5nZXRWYWx1ZUF0SW5kZXhPckRlZmF1bHQgPSBoZWxwZXJzLnZhbHVlQXRJbmRleE9yRGVmYXVsdDsNCg0KfSx7fV0sNDM6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpew0KJ3VzZSBzdHJpY3QnOw0KDQp2YXIgaGVscGVycyA9IHJlcXVpcmUoNDIpOw0KDQovKioNCiAqIEVhc2luZyBmdW5jdGlvbnMgYWRhcHRlZCBmcm9tIFJvYmVydCBQZW5uZXIncyBlYXNpbmcgZXF1YXRpb25zLg0KICogQG5hbWVzcGFjZSBDaGFydC5oZWxwZXJzLmVhc2luZ0VmZmVjdHMNCiAqIEBzZWUgaHR0cDovL3d3dy5yb2JlcnRwZW5uZXIuY29tL2Vhc2luZy8NCiAqLw0KdmFyIGVmZmVjdHMgPSB7DQoJbGluZWFyOiBmdW5jdGlvbih0KSB7DQoJCXJldHVybiB0Ow0KCX0sDQoNCgllYXNlSW5RdWFkOiBmdW5jdGlvbih0KSB7DQoJCXJldHVybiB0ICogdDsNCgl9LA0KDQoJZWFzZU91dFF1YWQ6IGZ1bmN0aW9uKHQpIHsNCgkJcmV0dXJuIC10ICogKHQgLSAyKTsNCgl9LA0KDQoJZWFzZUluT3V0UXVhZDogZnVuY3Rpb24odCkgew0KCQlpZiAoKHQgLz0gMC41KSA8IDEpIHsNCgkJCXJldHVybiAwLjUgKiB0ICogdDsNCgkJfQ0KCQlyZXR1cm4gLTAuNSAqICgoLS10KSAqICh0IC0gMikgLSAxKTsNCgl9LA0KDQoJZWFzZUluQ3ViaWM6IGZ1bmN0aW9uKHQpIHsNCgkJcmV0dXJuIHQgKiB0ICogdDsNCgl9LA0KDQoJZWFzZU91dEN1YmljOiBmdW5jdGlvbih0KSB7DQoJCXJldHVybiAodCA9IHQgLSAxKSAqIHQgKiB0ICsgMTsNCgl9LA0KDQoJZWFzZUluT3V0Q3ViaWM6IGZ1bmN0aW9uKHQpIHsNCgkJaWYgKCh0IC89IDAuNSkgPCAxKSB7DQoJCQlyZXR1cm4gMC41ICogdCAqIHQgKiB0Ow0KCQl9DQoJCXJldHVybiAwLjUgKiAoKHQgLT0gMikgKiB0ICogdCArIDIpOw0KCX0sDQoNCgllYXNlSW5RdWFydDogZnVuY3Rpb24odCkgew0KCQlyZXR1cm4gdCAqIHQgKiB0ICogdDsNCgl9LA0KDQoJZWFzZU91dFF1YXJ0OiBmdW5jdGlvbih0KSB7DQoJCXJldHVybiAtKCh0ID0gdCAtIDEpICogdCAqIHQgKiB0IC0gMSk7DQoJfSwNCg0KCWVhc2VJbk91dFF1YXJ0OiBmdW5jdGlvbih0KSB7DQoJCWlmICgodCAvPSAwLjUpIDwgMSkgew0KCQkJcmV0dXJuIDAuNSAqIHQgKiB0ICogdCAqIHQ7DQoJCX0NCgkJcmV0dXJuIC0wLjUgKiAoKHQgLT0gMikgKiB0ICogdCAqIHQgLSAyKTsNCgl9LA0KDQoJZWFzZUluUXVpbnQ6IGZ1bmN0aW9uKHQpIHsNCgkJcmV0dXJuIHQgKiB0ICogdCAqIHQgKiB0Ow0KCX0sDQoNCgllYXNlT3V0UXVpbnQ6IGZ1bmN0aW9uKHQpIHsNCgkJcmV0dXJuICh0ID0gdCAtIDEpICogdCAqIHQgKiB0ICogdCArIDE7DQoJfSwNCg0KCWVhc2VJbk91dFF1aW50OiBmdW5jdGlvbih0KSB7DQoJCWlmICgodCAvPSAwLjUpIDwgMSkgew0KCQkJcmV0dXJuIDAuNSAqIHQgKiB0ICogdCAqIHQgKiB0Ow0KCQl9DQoJCXJldHVybiAwLjUgKiAoKHQgLT0gMikgKiB0ICogdCAqIHQgKiB0ICsgMik7DQoJfSwNCg0KCWVhc2VJblNpbmU6IGZ1bmN0aW9uKHQpIHsNCgkJcmV0dXJuIC1NYXRoLmNvcyh0ICogKE1hdGguUEkgLyAyKSkgKyAxOw0KCX0sDQoNCgllYXNlT3V0U2luZTogZnVuY3Rpb24odCkgew0KCQlyZXR1cm4gTWF0aC5zaW4odCAqIChNYXRoLlBJIC8gMikpOw0KCX0sDQoNCgllYXNlSW5PdXRTaW5lOiBmdW5jdGlvbih0KSB7DQoJCXJldHVybiAtMC41ICogKE1hdGguY29zKE1hdGguUEkgKiB0KSAtIDEpOw0KCX0sDQoNCgllYXNlSW5FeHBvOiBmdW5jdGlvbih0KSB7DQoJCXJldHVybiAodCA9PT0gMCkgPyAwIDogTWF0aC5wb3coMiwgMTAgKiAodCAtIDEpKTsNCgl9LA0KDQoJZWFzZU91dEV4cG86IGZ1bmN0aW9uKHQpIHsNCgkJcmV0dXJuICh0ID09PSAxKSA/IDEgOiAtTWF0aC5wb3coMiwgLTEwICogdCkgKyAxOw0KCX0sDQoNCgllYXNlSW5PdXRFeHBvOiBmdW5jdGlvbih0KSB7DQoJCWlmICh0ID09PSAwKSB7DQoJCQlyZXR1cm4gMDsNCgkJfQ0KCQlpZiAodCA9PT0gMSkgew0KCQkJcmV0dXJuIDE7DQoJCX0NCgkJaWYgKCh0IC89IDAuNSkgPCAxKSB7DQoJCQlyZXR1cm4gMC41ICogTWF0aC5wb3coMiwgMTAgKiAodCAtIDEpKTsNCgkJfQ0KCQlyZXR1cm4gMC41ICogKC1NYXRoLnBvdygyLCAtMTAgKiAtLXQpICsgMik7DQoJfSwNCg0KCWVhc2VJbkNpcmM6IGZ1bmN0aW9uKHQpIHsNCgkJaWYgKHQgPj0gMSkgew0KCQkJcmV0dXJuIHQ7DQoJCX0NCgkJcmV0dXJuIC0oTWF0aC5zcXJ0KDEgLSB0ICogdCkgLSAxKTsNCgl9LA0KDQoJZWFzZU91dENpcmM6IGZ1bmN0aW9uKHQpIHsNCgkJcmV0dXJuIE1hdGguc3FydCgxIC0gKHQgPSB0IC0gMSkgKiB0KTsNCgl9LA0KDQoJZWFzZUluT3V0Q2lyYzogZnVuY3Rpb24odCkgew0KCQlpZiAoKHQgLz0gMC41KSA8IDEpIHsNCgkJCXJldHVybiAtMC41ICogKE1hdGguc3FydCgxIC0gdCAqIHQpIC0gMSk7DQoJCX0NCgkJcmV0dXJuIDAuNSAqIChNYXRoLnNxcnQoMSAtICh0IC09IDIpICogdCkgKyAxKTsNCgl9LA0KDQoJZWFzZUluRWxhc3RpYzogZnVuY3Rpb24odCkgew0KCQl2YXIgcyA9IDEuNzAxNTg7DQoJCXZhciBwID0gMDsNCgkJdmFyIGEgPSAxOw0KCQlpZiAodCA9PT0gMCkgew0KCQkJcmV0dXJuIDA7DQoJCX0NCgkJaWYgKHQgPT09IDEpIHsNCgkJCXJldHVybiAxOw0KCQl9DQoJCWlmICghcCkgew0KCQkJcCA9IDAuMzsNCgkJfQ0KCQlpZiAoYSA8IDEpIHsNCgkJCWEgPSAxOw0KCQkJcyA9IHAgLyA0Ow0KCQl9IGVsc2Ugew0KCQkJcyA9IHAgLyAoMiAqIE1hdGguUEkpICogTWF0aC5hc2luKDEgLyBhKTsNCgkJfQ0KCQlyZXR1cm4gLShhICogTWF0aC5wb3coMiwgMTAgKiAodCAtPSAxKSkgKiBNYXRoLnNpbigodCAtIHMpICogKDIgKiBNYXRoLlBJKSAvIHApKTsNCgl9LA0KDQoJZWFzZU91dEVsYXN0aWM6IGZ1bmN0aW9uKHQpIHsNCgkJdmFyIHMgPSAxLjcwMTU4Ow0KCQl2YXIgcCA9IDA7DQoJCXZhciBhID0gMTsNCgkJaWYgKHQgPT09IDApIHsNCgkJCXJldHVybiAwOw0KCQl9DQoJCWlmICh0ID09PSAxKSB7DQoJCQlyZXR1cm4gMTsNCgkJfQ0KCQlpZiAoIXApIHsNCgkJCXAgPSAwLjM7DQoJCX0NCgkJaWYgKGEgPCAxKSB7DQoJCQlhID0gMTsNCgkJCXMgPSBwIC8gNDsNCgkJfSBlbHNlIHsNCgkJCXMgPSBwIC8gKDIgKiBNYXRoLlBJKSAqIE1hdGguYXNpbigxIC8gYSk7DQoJCX0NCgkJcmV0dXJuIGEgKiBNYXRoLnBvdygyLCAtMTAgKiB0KSAqIE1hdGguc2luKCh0IC0gcykgKiAoMiAqIE1hdGguUEkpIC8gcCkgKyAxOw0KCX0sDQoNCgllYXNlSW5PdXRFbGFzdGljOiBmdW5jdGlvbih0KSB7DQoJCXZhciBzID0gMS43MDE1ODsNCgkJdmFyIHAgPSAwOw0KCQl2YXIgYSA9IDE7DQoJCWlmICh0ID09PSAwKSB7DQoJCQlyZXR1cm4gMDsNCgkJfQ0KCQlpZiAoKHQgLz0gMC41KSA9PT0gMikgew0KCQkJcmV0dXJuIDE7DQoJCX0NCgkJaWYgKCFwKSB7DQoJCQlwID0gMC40NTsNCgkJfQ0KCQlpZiAoYSA8IDEpIHsNCgkJCWEgPSAxOw0KCQkJcyA9IHAgLyA0Ow0KCQl9IGVsc2Ugew0KCQkJcyA9IHAgLyAoMiAqIE1hdGguUEkpICogTWF0aC5hc2luKDEgLyBhKTsNCgkJfQ0KCQlpZiAodCA8IDEpIHsNCgkJCXJldHVybiAtMC41ICogKGEgKiBNYXRoLnBvdygyLCAxMCAqICh0IC09IDEpKSAqIE1hdGguc2luKCh0IC0gcykgKiAoMiAqIE1hdGguUEkpIC8gcCkpOw0KCQl9DQoJCXJldHVybiBhICogTWF0aC5wb3coMiwgLTEwICogKHQgLT0gMSkpICogTWF0aC5zaW4oKHQgLSBzKSAqICgyICogTWF0aC5QSSkgLyBwKSAqIDAuNSArIDE7DQoJfSwNCgllYXNlSW5CYWNrOiBmdW5jdGlvbih0KSB7DQoJCXZhciBzID0gMS43MDE1ODsNCgkJcmV0dXJuIHQgKiB0ICogKChzICsgMSkgKiB0IC0gcyk7DQoJfSwNCg0KCWVhc2VPdXRCYWNrOiBmdW5jdGlvbih0KSB7DQoJCXZhciBzID0gMS43MDE1ODsNCgkJcmV0dXJuICh0ID0gdCAtIDEpICogdCAqICgocyArIDEpICogdCArIHMpICsgMTsNCgl9LA0KDQoJZWFzZUluT3V0QmFjazogZnVuY3Rpb24odCkgew0KCQl2YXIgcyA9IDEuNzAxNTg7DQoJCWlmICgodCAvPSAwLjUpIDwgMSkgew0KCQkJcmV0dXJuIDAuNSAqICh0ICogdCAqICgoKHMgKj0gKDEuNTI1KSkgKyAxKSAqIHQgLSBzKSk7DQoJCX0NCgkJcmV0dXJuIDAuNSAqICgodCAtPSAyKSAqIHQgKiAoKChzICo9ICgxLjUyNSkpICsgMSkgKiB0ICsgcykgKyAyKTsNCgl9LA0KDQoJZWFzZUluQm91bmNlOiBmdW5jdGlvbih0KSB7DQoJCXJldHVybiAxIC0gZWZmZWN0cy5lYXNlT3V0Qm91bmNlKDEgLSB0KTsNCgl9LA0KDQoJZWFzZU91dEJvdW5jZTogZnVuY3Rpb24odCkgew0KCQlpZiAodCA8ICgxIC8gMi43NSkpIHsNCgkJCXJldHVybiA3LjU2MjUgKiB0ICogdDsNCgkJfQ0KCQlpZiAodCA8ICgyIC8gMi43NSkpIHsNCgkJCXJldHVybiA3LjU2MjUgKiAodCAtPSAoMS41IC8gMi43NSkpICogdCArIDAuNzU7DQoJCX0NCgkJaWYgKHQgPCAoMi41IC8gMi43NSkpIHsNCgkJCXJldHVybiA3LjU2MjUgKiAodCAtPSAoMi4yNSAvIDIuNzUpKSAqIHQgKyAwLjkzNzU7DQoJCX0NCgkJcmV0dXJuIDcuNTYyNSAqICh0IC09ICgyLjYyNSAvIDIuNzUpKSAqIHQgKyAwLjk4NDM3NTsNCgl9LA0KDQoJZWFzZUluT3V0Qm91bmNlOiBmdW5jdGlvbih0KSB7DQoJCWlmICh0IDwgMC41KSB7DQoJCQlyZXR1cm4gZWZmZWN0cy5lYXNlSW5Cb3VuY2UodCAqIDIpICogMC41Ow0KCQl9DQoJCXJldHVybiBlZmZlY3RzLmVhc2VPdXRCb3VuY2UodCAqIDIgLSAxKSAqIDAuNSArIDAuNTsNCgl9DQp9Ow0KDQptb2R1bGUuZXhwb3J0cyA9IHsNCgllZmZlY3RzOiBlZmZlY3RzDQp9Ow0KDQovLyBERVBSRUNBVElPTlMNCg0KLyoqDQogKiBQcm92aWRlZCBmb3IgYmFja3dhcmQgY29tcGF0aWJpbGl0eSwgdXNlIENoYXJ0LmhlbHBlcnMuZWFzaW5nLmVmZmVjdHMgaW5zdGVhZC4NCiAqIEBmdW5jdGlvbiBDaGFydC5oZWxwZXJzLmVhc2luZ0VmZmVjdHMNCiAqIEBkZXByZWNhdGVkIHNpbmNlIHZlcnNpb24gMi43LjANCiAqIEB0b2RvIHJlbW92ZSBhdCB2ZXJzaW9uIDMNCiAqIEBwcml2YXRlDQogKi8NCmhlbHBlcnMuZWFzaW5nRWZmZWN0cyA9IGVmZmVjdHM7DQoNCn0seyI0MiI6NDJ9XSw0NDpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7DQondXNlIHN0cmljdCc7DQoNCnZhciBoZWxwZXJzID0gcmVxdWlyZSg0Mik7DQoNCi8qKg0KICogQGFsaWFzIENoYXJ0LmhlbHBlcnMub3B0aW9ucw0KICogQG5hbWVzcGFjZQ0KICovDQptb2R1bGUuZXhwb3J0cyA9IHsNCgkvKioNCgkgKiBDb252ZXJ0cyB0aGUgZ2l2ZW4gbGluZSBoZWlnaHQgYHZhbHVlYCBpbiBwaXhlbHMgZm9yIGEgc3BlY2lmaWMgZm9udCBgc2l6ZWAuDQoJICogQHBhcmFtIHtOdW1iZXJ8U3RyaW5nfSB2YWx1ZSAtIFRoZSBsaW5lSGVpZ2h0IHRvIHBhcnNlIChlZy4gMS42LCAnMTRweCcsICc3NSUnLCAnMS42ZW0nKS4NCgkgKiBAcGFyYW0ge051bWJlcn0gc2l6ZSAtIFRoZSBmb250IHNpemUgKGluIHBpeGVscykgdXNlZCB0byByZXNvbHZlIHJlbGF0aXZlIGB2YWx1ZWAuDQoJICogQHJldHVybnMge051bWJlcn0gVGhlIGVmZmVjdGl2ZSBsaW5lIGhlaWdodCBpbiBwaXhlbHMgKHNpemUgKiAxLjIgaWYgdmFsdWUgaXMgaW52YWxpZCkuDQoJICogQHNlZSBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9DU1MvbGluZS1oZWlnaHQNCgkgKiBAc2luY2UgMi43LjANCgkgKi8NCgl0b0xpbmVIZWlnaHQ6IGZ1bmN0aW9uKHZhbHVlLCBzaXplKSB7DQoJCXZhciBtYXRjaGVzID0gKCcnICsgdmFsdWUpLm1hdGNoKC9eKG5vcm1hbHwoXGQrKD86XC5cZCspPykocHh8ZW18JSk/KSQvKTsNCgkJaWYgKCFtYXRjaGVzIHx8IG1hdGNoZXNbMV0gPT09ICdub3JtYWwnKSB7DQoJCQlyZXR1cm4gc2l6ZSAqIDEuMjsNCgkJfQ0KDQoJCXZhbHVlID0gK21hdGNoZXNbMl07DQoNCgkJc3dpdGNoIChtYXRjaGVzWzNdKSB7DQoJCWNhc2UgJ3B4JzoNCgkJCXJldHVybiB2YWx1ZTsNCgkJY2FzZSAnJSc6DQoJCQl2YWx1ZSAvPSAxMDA7DQoJCQlicmVhazsNCgkJZGVmYXVsdDoNCgkJCWJyZWFrOw0KCQl9DQoNCgkJcmV0dXJuIHNpemUgKiB2YWx1ZTsNCgl9LA0KDQoJLyoqDQoJICogQ29udmVydHMgdGhlIGdpdmVuIHZhbHVlIGludG8gYSBwYWRkaW5nIG9iamVjdCB3aXRoIHByZS1jb21wdXRlZCB3aWR0aC9oZWlnaHQuDQoJICogQHBhcmFtIHtOdW1iZXJ8T2JqZWN0fSB2YWx1ZSAtIElmIGEgbnVtYmVyLCBzZXQgdGhlIHZhbHVlIHRvIGFsbCBUUkJMIGNvbXBvbmVudCwNCgkgKiAgZWxzZSwgaWYgYW5kIG9iamVjdCwgdXNlIGRlZmluZWQgcHJvcGVydGllcyBhbmQgc2V0cyB1bmRlZmluZWQgb25lcyB0byAwLg0KCSAqIEByZXR1cm5zIHtPYmplY3R9IFRoZSBwYWRkaW5nIHZhbHVlcyAodG9wLCByaWdodCwgYm90dG9tLCBsZWZ0LCB3aWR0aCwgaGVpZ2h0KQ0KCSAqIEBzaW5jZSAyLjcuMA0KCSAqLw0KCXRvUGFkZGluZzogZnVuY3Rpb24odmFsdWUpIHsNCgkJdmFyIHQsIHIsIGIsIGw7DQoNCgkJaWYgKGhlbHBlcnMuaXNPYmplY3QodmFsdWUpKSB7DQoJCQl0ID0gK3ZhbHVlLnRvcCB8fCAwOw0KCQkJciA9ICt2YWx1ZS5yaWdodCB8fCAwOw0KCQkJYiA9ICt2YWx1ZS5ib3R0b20gfHwgMDsNCgkJCWwgPSArdmFsdWUubGVmdCB8fCAwOw0KCQl9IGVsc2Ugew0KCQkJdCA9IHIgPSBiID0gbCA9ICt2YWx1ZSB8fCAwOw0KCQl9DQoNCgkJcmV0dXJuIHsNCgkJCXRvcDogdCwNCgkJCXJpZ2h0OiByLA0KCQkJYm90dG9tOiBiLA0KCQkJbGVmdDogbCwNCgkJCWhlaWdodDogdCArIGIsDQoJCQl3aWR0aDogbCArIHINCgkJfTsNCgl9LA0KDQoJLyoqDQoJICogRXZhbHVhdGVzIHRoZSBnaXZlbiBgaW5wdXRzYCBzZXF1ZW50aWFsbHkgYW5kIHJldHVybnMgdGhlIGZpcnN0IGRlZmluZWQgdmFsdWUuDQoJICogQHBhcmFtIHtBcnJheVtdfSBpbnB1dHMgLSBBbiBhcnJheSBvZiB2YWx1ZXMsIGZhbGxpbmcgYmFjayB0byB0aGUgbGFzdCB2YWx1ZS4NCgkgKiBAcGFyYW0ge09iamVjdH0gW2NvbnRleHRdIC0gSWYgZGVmaW5lZCBhbmQgdGhlIGN1cnJlbnQgdmFsdWUgaXMgYSBmdW5jdGlvbiwgdGhlIHZhbHVlDQoJICogaXMgY2FsbGVkIHdpdGggYGNvbnRleHRgIGFzIGZpcnN0IGFyZ3VtZW50IGFuZCB0aGUgcmVzdWx0IGJlY29tZXMgdGhlIG5ldyBpbnB1dC4NCgkgKiBAcGFyYW0ge051bWJlcn0gW2luZGV4XSAtIElmIGRlZmluZWQgYW5kIHRoZSBjdXJyZW50IHZhbHVlIGlzIGFuIGFycmF5LCB0aGUgdmFsdWUNCgkgKiBhdCBgaW5kZXhgIGJlY29tZSB0aGUgbmV3IGlucHV0Lg0KCSAqIEBzaW5jZSAyLjcuMA0KCSAqLw0KCXJlc29sdmU6IGZ1bmN0aW9uKGlucHV0cywgY29udGV4dCwgaW5kZXgpIHsNCgkJdmFyIGksIGlsZW4sIHZhbHVlOw0KDQoJCWZvciAoaSA9IDAsIGlsZW4gPSBpbnB1dHMubGVuZ3RoOyBpIDwgaWxlbjsgKytpKSB7DQoJCQl2YWx1ZSA9IGlucHV0c1tpXTsNCgkJCWlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7DQoJCQkJY29udGludWU7DQoJCQl9DQoJCQlpZiAoY29udGV4dCAhPT0gdW5kZWZpbmVkICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykgew0KCQkJCXZhbHVlID0gdmFsdWUoY29udGV4dCk7DQoJCQl9DQoJCQlpZiAoaW5kZXggIT09IHVuZGVmaW5lZCAmJiBoZWxwZXJzLmlzQXJyYXkodmFsdWUpKSB7DQoJCQkJdmFsdWUgPSB2YWx1ZVtpbmRleF07DQoJCQl9DQoJCQlpZiAodmFsdWUgIT09IHVuZGVmaW5lZCkgew0KCQkJCXJldHVybiB2YWx1ZTsNCgkJCX0NCgkJfQ0KCX0NCn07DQoNCn0seyI0MiI6NDJ9XSw0NTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7DQondXNlIHN0cmljdCc7DQoNCm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZSg0Mik7DQptb2R1bGUuZXhwb3J0cy5lYXNpbmcgPSByZXF1aXJlKDQzKTsNCm1vZHVsZS5leHBvcnRzLmNhbnZhcyA9IHJlcXVpcmUoNDEpOw0KbW9kdWxlLmV4cG9ydHMub3B0aW9ucyA9IHJlcXVpcmUoNDQpOw0KDQp9LHsiNDEiOjQxLCI0MiI6NDIsIjQzIjo0MywiNDQiOjQ0fV0sNDY6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpew0KLyoqDQogKiBQbGF0Zm9ybSBmYWxsYmFjayBpbXBsZW1lbnRhdGlvbiAobWluaW1hbCkuDQogKiBAc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9jaGFydGpzL0NoYXJ0LmpzL3B1bGwvNDU5MSNpc3N1ZWNvbW1lbnQtMzE5NTc1OTM5DQogKi8NCg0KbW9kdWxlLmV4cG9ydHMgPSB7DQoJYWNxdWlyZUNvbnRleHQ6IGZ1bmN0aW9uKGl0ZW0pIHsNCgkJaWYgKGl0ZW0gJiYgaXRlbS5jYW52YXMpIHsNCgkJCS8vIFN1cHBvcnQgZm9yIGFueSBvYmplY3QgYXNzb2NpYXRlZCB0byBhIGNhbnZhcyAoaW5jbHVkaW5nIGEgY29udGV4dDJkKQ0KCQkJaXRlbSA9IGl0ZW0uY2FudmFzOw0KCQl9DQoNCgkJcmV0dXJuIGl0ZW0gJiYgaXRlbS5nZXRDb250ZXh0KCcyZCcpIHx8IG51bGw7DQoJfQ0KfTsNCg0KfSx7fV0sNDc6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpew0KLyoqDQogKiBDaGFydC5QbGF0Zm9ybSBpbXBsZW1lbnRhdGlvbiBmb3IgdGFyZ2V0aW5nIGEgd2ViIGJyb3dzZXINCiAqLw0KDQondXNlIHN0cmljdCc7DQoNCnZhciBoZWxwZXJzID0gcmVxdWlyZSg0NSk7DQoNCnZhciBFWFBBTkRPX0tFWSA9ICckY2hhcnRqcyc7DQp2YXIgQ1NTX1BSRUZJWCA9ICdjaGFydGpzLSc7DQp2YXIgQ1NTX1JFTkRFUl9NT05JVE9SID0gQ1NTX1BSRUZJWCArICdyZW5kZXItbW9uaXRvcic7DQp2YXIgQ1NTX1JFTkRFUl9BTklNQVRJT04gPSBDU1NfUFJFRklYICsgJ3JlbmRlci1hbmltYXRpb24nOw0KdmFyIEFOSU1BVElPTl9TVEFSVF9FVkVOVFMgPSBbJ2FuaW1hdGlvbnN0YXJ0JywgJ3dlYmtpdEFuaW1hdGlvblN0YXJ0J107DQoNCi8qKg0KICogRE9NIGV2ZW50IHR5cGVzIC0+IENoYXJ0LmpzIGV2ZW50IHR5cGVzLg0KICogTm90ZTogb25seSBldmVudHMgd2l0aCBkaWZmZXJlbnQgdHlwZXMgYXJlIG1hcHBlZC4NCiAqIEBzZWUgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvRXZlbnRzDQogKi8NCnZhciBFVkVOVF9UWVBFUyA9IHsNCgl0b3VjaHN0YXJ0OiAnbW91c2Vkb3duJywNCgl0b3VjaG1vdmU6ICdtb3VzZW1vdmUnLA0KCXRvdWNoZW5kOiAnbW91c2V1cCcsDQoJcG9pbnRlcmVudGVyOiAnbW91c2VlbnRlcicsDQoJcG9pbnRlcmRvd246ICdtb3VzZWRvd24nLA0KCXBvaW50ZXJtb3ZlOiAnbW91c2Vtb3ZlJywNCglwb2ludGVydXA6ICdtb3VzZXVwJywNCglwb2ludGVybGVhdmU6ICdtb3VzZW91dCcsDQoJcG9pbnRlcm91dDogJ21vdXNlb3V0Jw0KfTsNCg0KLyoqDQogKiBUaGUgInVzZWQiIHNpemUgaXMgdGhlIGZpbmFsIHZhbHVlIG9mIGEgZGltZW5zaW9uIHByb3BlcnR5IGFmdGVyIGFsbCBjYWxjdWxhdGlvbnMgaGF2ZQ0KICogYmVlbiBwZXJmb3JtZWQuIFRoaXMgbWV0aG9kIHVzZXMgdGhlIGNvbXB1dGVkIHN0eWxlIG9mIGBlbGVtZW50YCBidXQgcmV0dXJucyB1bmRlZmluZWQNCiAqIGlmIHRoZSBjb21wdXRlZCBzdHlsZSBpcyBub3QgZXhwcmVzc2VkIGluIHBpeGVscy4gVGhhdCBjYW4gaGFwcGVuIGluIHNvbWUgY2FzZXMgd2hlcmUNCiAqIGBlbGVtZW50YCBoYXMgYSBzaXplIHJlbGF0aXZlIHRvIGl0cyBwYXJlbnQgYW5kIHRoaXMgbGFzdCBvbmUgaXMgbm90IHlldCBkaXNwbGF5ZWQsDQogKiBmb3IgZXhhbXBsZSBiZWNhdXNlIG9mIGBkaXNwbGF5OiBub25lYCBvbiBhIHBhcmVudCBub2RlLg0KICogQHNlZSBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9DU1MvdXNlZF92YWx1ZQ0KICogQHJldHVybnMge051bWJlcn0gU2l6ZSBpbiBwaXhlbHMgb3IgdW5kZWZpbmVkIGlmIHVua25vd24uDQogKi8NCmZ1bmN0aW9uIHJlYWRVc2VkU2l6ZShlbGVtZW50LCBwcm9wZXJ0eSkgew0KCXZhciB2YWx1ZSA9IGhlbHBlcnMuZ2V0U3R5bGUoZWxlbWVudCwgcHJvcGVydHkpOw0KCXZhciBtYXRjaGVzID0gdmFsdWUgJiYgdmFsdWUubWF0Y2goL14oXGQrKShcLlxkKyk/cHgkLyk7DQoJcmV0dXJuIG1hdGNoZXMgPyBOdW1iZXIobWF0Y2hlc1sxXSkgOiB1bmRlZmluZWQ7DQp9DQoNCi8qKg0KICogSW5pdGlhbGl6ZXMgdGhlIGNhbnZhcyBzdHlsZSBhbmQgcmVuZGVyIHNpemUgd2l0aG91dCBtb2RpZnlpbmcgdGhlIGNhbnZhcyBkaXNwbGF5IHNpemUsDQogKiBzaW5jZSByZXNwb25zaXZlbmVzcyBpcyBoYW5kbGVkIGJ5IHRoZSBjb250cm9sbGVyLnJlc2l6ZSgpIG1ldGhvZC4gVGhlIGNvbmZpZyBpcyB1c2VkDQogKiB0byBkZXRlcm1pbmUgdGhlIGFzcGVjdCByYXRpbyB0byBhcHBseSBpbiBjYXNlIG5vIGV4cGxpY2l0IGhlaWdodCBoYXMgYmVlbiBzcGVjaWZpZWQuDQogKi8NCmZ1bmN0aW9uIGluaXRDYW52YXMoY2FudmFzLCBjb25maWcpIHsNCgl2YXIgc3R5bGUgPSBjYW52YXMuc3R5bGU7DQoNCgkvLyBOT1RFKFNCKSBjYW52YXMuZ2V0QXR0cmlidXRlKCd3aWR0aCcpICE9PSBjYW52YXMud2lkdGg6IGluIHRoZSBmaXJzdCBjYXNlIGl0DQoJLy8gcmV0dXJucyBudWxsIG9yICcnIGlmIG5vIGV4cGxpY2l0IHZhbHVlIGhhcyBiZWVuIHNldCB0byB0aGUgY2FudmFzIGF0dHJpYnV0ZS4NCgl2YXIgcmVuZGVySGVpZ2h0ID0gY2FudmFzLmdldEF0dHJpYnV0ZSgnaGVpZ2h0Jyk7DQoJdmFyIHJlbmRlcldpZHRoID0gY2FudmFzLmdldEF0dHJpYnV0ZSgnd2lkdGgnKTsNCg0KCS8vIENoYXJ0LmpzIG1vZGlmaWVzIHNvbWUgY2FudmFzIHZhbHVlcyB0aGF0IHdlIHdhbnQgdG8gcmVzdG9yZSBvbiBkZXN0cm95DQoJY2FudmFzW0VYUEFORE9fS0VZXSA9IHsNCgkJaW5pdGlhbDogew0KCQkJaGVpZ2h0OiByZW5kZXJIZWlnaHQsDQoJCQl3aWR0aDogcmVuZGVyV2lkdGgsDQoJCQlzdHlsZTogew0KCQkJCWRpc3BsYXk6IHN0eWxlLmRpc3BsYXksDQoJCQkJaGVpZ2h0OiBzdHlsZS5oZWlnaHQsDQoJCQkJd2lkdGg6IHN0eWxlLndpZHRoDQoJCQl9DQoJCX0NCgl9Ow0KDQoJLy8gRm9yY2UgY2FudmFzIHRvIGRpc3BsYXkgYXMgYmxvY2sgdG8gYXZvaWQgZXh0cmEgc3BhY2UgY2F1c2VkIGJ5IGlubGluZQ0KCS8vIGVsZW1lbnRzLCB3aGljaCB3b3VsZCBpbnRlcmZlcmUgd2l0aCB0aGUgcmVzcG9uc2l2ZSByZXNpemUgcHJvY2Vzcy4NCgkvLyBodHRwczovL2dpdGh1Yi5jb20vY2hhcnRqcy9DaGFydC5qcy9pc3N1ZXMvMjUzOA0KCXN0eWxlLmRpc3BsYXkgPSBzdHlsZS5kaXNwbGF5IHx8ICdibG9jayc7DQoNCglpZiAocmVuZGVyV2lkdGggPT09IG51bGwgfHwgcmVuZGVyV2lkdGggPT09ICcnKSB7DQoJCXZhciBkaXNwbGF5V2lkdGggPSByZWFkVXNlZFNpemUoY2FudmFzLCAnd2lkdGgnKTsNCgkJaWYgKGRpc3BsYXlXaWR0aCAhPT0gdW5kZWZpbmVkKSB7DQoJCQljYW52YXMud2lkdGggPSBkaXNwbGF5V2lkdGg7DQoJCX0NCgl9DQoNCglpZiAocmVuZGVySGVpZ2h0ID09PSBudWxsIHx8IHJlbmRlckhlaWdodCA9PT0gJycpIHsNCgkJaWYgKGNhbnZhcy5zdHlsZS5oZWlnaHQgPT09ICcnKSB7DQoJCQkvLyBJZiBubyBleHBsaWNpdCByZW5kZXIgaGVpZ2h0IGFuZCBzdHlsZSBoZWlnaHQsIGxldCdzIGFwcGx5IHRoZSBhc3BlY3QgcmF0aW8sDQoJCQkvLyB3aGljaCBvbmUgY2FuIGJlIHNwZWNpZmllZCBieSB0aGUgdXNlciBidXQgYWxzbyBieSBjaGFydHMgYXMgZGVmYXVsdCBvcHRpb24NCgkJCS8vIChpLmUuIG9wdGlvbnMuYXNwZWN0UmF0aW8pLiBJZiBub3Qgc3BlY2lmaWVkLCB1c2UgY2FudmFzIGFzcGVjdCByYXRpbyBvZiAyLg0KCQkJY2FudmFzLmhlaWdodCA9IGNhbnZhcy53aWR0aCAvIChjb25maWcub3B0aW9ucy5hc3BlY3RSYXRpbyB8fCAyKTsNCgkJfSBlbHNlIHsNCgkJCXZhciBkaXNwbGF5SGVpZ2h0ID0gcmVhZFVzZWRTaXplKGNhbnZhcywgJ2hlaWdodCcpOw0KCQkJaWYgKGRpc3BsYXlXaWR0aCAhPT0gdW5kZWZpbmVkKSB7DQoJCQkJY2FudmFzLmhlaWdodCA9IGRpc3BsYXlIZWlnaHQ7DQoJCQl9DQoJCX0NCgl9DQoNCglyZXR1cm4gY2FudmFzOw0KfQ0KDQovKioNCiAqIERldGVjdHMgc3VwcG9ydCBmb3Igb3B0aW9ucyBvYmplY3QgYXJndW1lbnQgaW4gYWRkRXZlbnRMaXN0ZW5lci4NCiAqIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9FdmVudFRhcmdldC9hZGRFdmVudExpc3RlbmVyI1NhZmVseV9kZXRlY3Rpbmdfb3B0aW9uX3N1cHBvcnQNCiAqIEBwcml2YXRlDQogKi8NCnZhciBzdXBwb3J0c0V2ZW50TGlzdGVuZXJPcHRpb25zID0gKGZ1bmN0aW9uKCkgew0KCXZhciBzdXBwb3J0cyA9IGZhbHNlOw0KCXRyeSB7DQoJCXZhciBvcHRpb25zID0gT2JqZWN0LmRlZmluZVByb3BlcnR5KHt9LCAncGFzc2l2ZScsIHsNCgkJCWdldDogZnVuY3Rpb24oKSB7DQoJCQkJc3VwcG9ydHMgPSB0cnVlOw0KCQkJfQ0KCQl9KTsNCgkJd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2UnLCBudWxsLCBvcHRpb25zKTsNCgl9IGNhdGNoIChlKSB7DQoJCS8vIGNvbnRpbnVlIHJlZ2FyZGxlc3Mgb2YgZXJyb3INCgl9DQoJcmV0dXJuIHN1cHBvcnRzOw0KfSgpKTsNCg0KLy8gRGVmYXVsdCBwYXNzaXZlIHRvIHRydWUgYXMgZXhwZWN0ZWQgYnkgQ2hyb21lIGZvciAndG91Y2hzdGFydCcgYW5kICd0b3VjaGVuZCcgZXZlbnRzLg0KLy8gaHR0cHM6Ly9naXRodWIuY29tL2NoYXJ0anMvQ2hhcnQuanMvaXNzdWVzLzQyODcNCnZhciBldmVudExpc3RlbmVyT3B0aW9ucyA9IHN1cHBvcnRzRXZlbnRMaXN0ZW5lck9wdGlvbnMgPyB7cGFzc2l2ZTogdHJ1ZX0gOiBmYWxzZTsNCg0KZnVuY3Rpb24gYWRkRXZlbnRMaXN0ZW5lcihub2RlLCB0eXBlLCBsaXN0ZW5lcikgew0KCW5vZGUuYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lciwgZXZlbnRMaXN0ZW5lck9wdGlvbnMpOw0KfQ0KDQpmdW5jdGlvbiByZW1vdmVFdmVudExpc3RlbmVyKG5vZGUsIHR5cGUsIGxpc3RlbmVyKSB7DQoJbm9kZS5yZW1vdmVFdmVudExpc3RlbmVyKHR5cGUsIGxpc3RlbmVyLCBldmVudExpc3RlbmVyT3B0aW9ucyk7DQp9DQoNCmZ1bmN0aW9uIGNyZWF0ZUV2ZW50KHR5cGUsIGNoYXJ0LCB4LCB5LCBuYXRpdmVFdmVudCkgew0KCXJldHVybiB7DQoJCXR5cGU6IHR5cGUsDQoJCWNoYXJ0OiBjaGFydCwNCgkJbmF0aXZlOiBuYXRpdmVFdmVudCB8fCBudWxsLA0KCQl4OiB4ICE9PSB1bmRlZmluZWQgPyB4IDogbnVsbCwNCgkJeTogeSAhPT0gdW5kZWZpbmVkID8geSA6IG51bGwsDQoJfTsNCn0NCg0KZnVuY3Rpb24gZnJvbU5hdGl2ZUV2ZW50KGV2ZW50LCBjaGFydCkgew0KCXZhciB0eXBlID0gRVZFTlRfVFlQRVNbZXZlbnQudHlwZV0gfHwgZXZlbnQudHlwZTsNCgl2YXIgcG9zID0gaGVscGVycy5nZXRSZWxhdGl2ZVBvc2l0aW9uKGV2ZW50LCBjaGFydCk7DQoJcmV0dXJuIGNyZWF0ZUV2ZW50KHR5cGUsIGNoYXJ0LCBwb3MueCwgcG9zLnksIGV2ZW50KTsNCn0NCg0KZnVuY3Rpb24gdGhyb3R0bGVkKGZuLCB0aGlzQXJnKSB7DQoJdmFyIHRpY2tpbmcgPSBmYWxzZTsNCgl2YXIgYXJncyA9IFtdOw0KDQoJcmV0dXJuIGZ1bmN0aW9uKCkgew0KCQlhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKTsNCgkJdGhpc0FyZyA9IHRoaXNBcmcgfHwgdGhpczsNCg0KCQlpZiAoIXRpY2tpbmcpIHsNCgkJCXRpY2tpbmcgPSB0cnVlOw0KCQkJaGVscGVycy5yZXF1ZXN0QW5pbUZyYW1lLmNhbGwod2luZG93LCBmdW5jdGlvbigpIHsNCgkJCQl0aWNraW5nID0gZmFsc2U7DQoJCQkJZm4uYXBwbHkodGhpc0FyZywgYXJncyk7DQoJCQl9KTsNCgkJfQ0KCX07DQp9DQoNCi8vIEltcGxlbWVudGF0aW9uIGJhc2VkIG9uIGh0dHBzOi8vZ2l0aHViLmNvbS9tYXJjai9jc3MtZWxlbWVudC1xdWVyaWVzDQpmdW5jdGlvbiBjcmVhdGVSZXNpemVyKGhhbmRsZXIpIHsNCgl2YXIgcmVzaXplciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOw0KCXZhciBjbHMgPSBDU1NfUFJFRklYICsgJ3NpemUtbW9uaXRvcic7DQoJdmFyIG1heFNpemUgPSAxMDAwMDAwOw0KCXZhciBzdHlsZSA9DQoJCSdwb3NpdGlvbjphYnNvbHV0ZTsnICsNCgkJJ2xlZnQ6MDsnICsNCgkJJ3RvcDowOycgKw0KCQkncmlnaHQ6MDsnICsNCgkJJ2JvdHRvbTowOycgKw0KCQknb3ZlcmZsb3c6aGlkZGVuOycgKw0KCQkncG9pbnRlci1ldmVudHM6bm9uZTsnICsNCgkJJ3Zpc2liaWxpdHk6aGlkZGVuOycgKw0KCQknei1pbmRleDotMTsnOw0KDQoJcmVzaXplci5zdHlsZS5jc3NUZXh0ID0gc3R5bGU7DQoJcmVzaXplci5jbGFzc05hbWUgPSBjbHM7DQoJcmVzaXplci5pbm5lckhUTUwgPQ0KCQknPGRpdiBjbGFzcz0iJyArIGNscyArICctZXhwYW5kIiBzdHlsZT0iJyArIHN0eWxlICsgJyI+JyArDQoJCQknPGRpdiBzdHlsZT0iJyArDQoJCQkJJ3Bvc2l0aW9uOmFic29sdXRlOycgKw0KCQkJCSd3aWR0aDonICsgbWF4U2l6ZSArICdweDsnICsNCgkJCQknaGVpZ2h0OicgKyBtYXhTaXplICsgJ3B4OycgKw0KCQkJCSdsZWZ0OjA7JyArDQoJCQkJJ3RvcDowIj4nICsNCgkJCSc8L2Rpdj4nICsNCgkJJzwvZGl2PicgKw0KCQknPGRpdiBjbGFzcz0iJyArIGNscyArICctc2hyaW5rIiBzdHlsZT0iJyArIHN0eWxlICsgJyI+JyArDQoJCQknPGRpdiBzdHlsZT0iJyArDQoJCQkJJ3Bvc2l0aW9uOmFic29sdXRlOycgKw0KCQkJCSd3aWR0aDoyMDAlOycgKw0KCQkJCSdoZWlnaHQ6MjAwJTsnICsNCgkJCQknbGVmdDowOyAnICsNCgkJCQkndG9wOjAiPicgKw0KCQkJJzwvZGl2PicgKw0KCQknPC9kaXY+JzsNCg0KCXZhciBleHBhbmQgPSByZXNpemVyLmNoaWxkTm9kZXNbMF07DQoJdmFyIHNocmluayA9IHJlc2l6ZXIuY2hpbGROb2Rlc1sxXTsNCg0KCXJlc2l6ZXIuX3Jlc2V0ID0gZnVuY3Rpb24oKSB7DQoJCWV4cGFuZC5zY3JvbGxMZWZ0ID0gbWF4U2l6ZTsNCgkJZXhwYW5kLnNjcm9sbFRvcCA9IG1heFNpemU7DQoJCXNocmluay5zY3JvbGxMZWZ0ID0gbWF4U2l6ZTsNCgkJc2hyaW5rLnNjcm9sbFRvcCA9IG1heFNpemU7DQoJfTsNCgl2YXIgb25TY3JvbGwgPSBmdW5jdGlvbigpIHsNCgkJcmVzaXplci5fcmVzZXQoKTsNCgkJaGFuZGxlcigpOw0KCX07DQoNCglhZGRFdmVudExpc3RlbmVyKGV4cGFuZCwgJ3Njcm9sbCcsIG9uU2Nyb2xsLmJpbmQoZXhwYW5kLCAnZXhwYW5kJykpOw0KCWFkZEV2ZW50TGlzdGVuZXIoc2hyaW5rLCAnc2Nyb2xsJywgb25TY3JvbGwuYmluZChzaHJpbmssICdzaHJpbmsnKSk7DQoNCglyZXR1cm4gcmVzaXplcjsNCn0NCg0KLy8gaHR0cHM6Ly9kYXZpZHdhbHNoLm5hbWUvZGV0ZWN0LW5vZGUtaW5zZXJ0aW9uDQpmdW5jdGlvbiB3YXRjaEZvclJlbmRlcihub2RlLCBoYW5kbGVyKSB7DQoJdmFyIGV4cGFuZG8gPSBub2RlW0VYUEFORE9fS0VZXSB8fCAobm9kZVtFWFBBTkRPX0tFWV0gPSB7fSk7DQoJdmFyIHByb3h5ID0gZXhwYW5kby5yZW5kZXJQcm94eSA9IGZ1bmN0aW9uKGUpIHsNCgkJaWYgKGUuYW5pbWF0aW9uTmFtZSA9PT0gQ1NTX1JFTkRFUl9BTklNQVRJT04pIHsNCgkJCWhhbmRsZXIoKTsNCgkJfQ0KCX07DQoNCgloZWxwZXJzLmVhY2goQU5JTUFUSU9OX1NUQVJUX0VWRU5UUywgZnVuY3Rpb24odHlwZSkgew0KCQlhZGRFdmVudExpc3RlbmVyKG5vZGUsIHR5cGUsIHByb3h5KTsNCgl9KTsNCg0KCS8vICM0NzM3OiBDaHJvbWUgbWlnaHQgc2tpcCB0aGUgQ1NTIGFuaW1hdGlvbiB3aGVuIHRoZSBDU1NfUkVOREVSX01PTklUT1IgY2xhc3MNCgkvLyBpcyByZW1vdmVkIHRoZW4gYWRkZWQgYmFjayBpbW1lZGlhdGVseSAoc2FtZSBhbmltYXRpb24gZnJhbWU/KS4gQWNjZXNzaW5nIHRoZQ0KCS8vIGBvZmZzZXRQYXJlbnRgIHByb3BlcnR5IHdpbGwgZm9yY2UgYSByZWZsb3cgYW5kIHJlLWV2YWx1YXRlIHRoZSBDU1MgYW5pbWF0aW9uLg0KCS8vIGh0dHBzOi8vZ2lzdC5naXRodWIuY29tL3BhdWxpcmlzaC81ZDUyZmIwODFiMzU3MGM4MWUzYSNib3gtbWV0cmljcw0KCS8vIGh0dHBzOi8vZ2l0aHViLmNvbS9jaGFydGpzL0NoYXJ0LmpzL2lzc3Vlcy80NzM3DQoJZXhwYW5kby5yZWZsb3cgPSAhIW5vZGUub2Zmc2V0UGFyZW50Ow0KDQoJbm9kZS5jbGFzc0xpc3QuYWRkKENTU19SRU5ERVJfTU9OSVRPUik7DQp9DQoNCmZ1bmN0aW9uIHVud2F0Y2hGb3JSZW5kZXIobm9kZSkgew0KCXZhciBleHBhbmRvID0gbm9kZVtFWFBBTkRPX0tFWV0gfHwge307DQoJdmFyIHByb3h5ID0gZXhwYW5kby5yZW5kZXJQcm94eTsNCg0KCWlmIChwcm94eSkgew0KCQloZWxwZXJzLmVhY2goQU5JTUFUSU9OX1NUQVJUX0VWRU5UUywgZnVuY3Rpb24odHlwZSkgew0KCQkJcmVtb3ZlRXZlbnRMaXN0ZW5lcihub2RlLCB0eXBlLCBwcm94eSk7DQoJCX0pOw0KDQoJCWRlbGV0ZSBleHBhbmRvLnJlbmRlclByb3h5Ow0KCX0NCg0KCW5vZGUuY2xhc3NMaXN0LnJlbW92ZShDU1NfUkVOREVSX01PTklUT1IpOw0KfQ0KDQpmdW5jdGlvbiBhZGRSZXNpemVMaXN0ZW5lcihub2RlLCBsaXN0ZW5lciwgY2hhcnQpIHsNCgl2YXIgZXhwYW5kbyA9IG5vZGVbRVhQQU5ET19LRVldIHx8IChub2RlW0VYUEFORE9fS0VZXSA9IHt9KTsNCg0KCS8vIExldCdzIGtlZXAgdHJhY2sgb2YgdGhpcyBhZGRlZCByZXNpemVyIGFuZCB0aHVzIGF2b2lkIERPTSBxdWVyeSB3aGVuIHJlbW92aW5nIGl0Lg0KCXZhciByZXNpemVyID0gZXhwYW5kby5yZXNpemVyID0gY3JlYXRlUmVzaXplcih0aHJvdHRsZWQoZnVuY3Rpb24oKSB7DQoJCWlmIChleHBhbmRvLnJlc2l6ZXIpIHsNCgkJCXJldHVybiBsaXN0ZW5lcihjcmVhdGVFdmVudCgncmVzaXplJywgY2hhcnQpKTsNCgkJfQ0KCX0pKTsNCg0KCS8vIFRoZSByZXNpemVyIG5lZWRzIHRvIGJlIGF0dGFjaGVkIHRvIHRoZSBub2RlIHBhcmVudCwgc28gd2UgZmlyc3QgbmVlZCB0byBiZQ0KCS8vIHN1cmUgdGhhdCBgbm9kZWAgaXMgYXR0YWNoZWQgdG8gdGhlIERPTSBiZWZvcmUgaW5qZWN0aW5nIHRoZSByZXNpemVyIGVsZW1lbnQuDQoJd2F0Y2hGb3JSZW5kZXIobm9kZSwgZnVuY3Rpb24oKSB7DQoJCWlmIChleHBhbmRvLnJlc2l6ZXIpIHsNCgkJCXZhciBjb250YWluZXIgPSBub2RlLnBhcmVudE5vZGU7DQoJCQlpZiAoY29udGFpbmVyICYmIGNvbnRhaW5lciAhPT0gcmVzaXplci5wYXJlbnROb2RlKSB7DQoJCQkJY29udGFpbmVyLmluc2VydEJlZm9yZShyZXNpemVyLCBjb250YWluZXIuZmlyc3RDaGlsZCk7DQoJCQl9DQoNCgkJCS8vIFRoZSBjb250YWluZXIgc2l6ZSBtaWdodCBoYXZlIGNoYW5nZWQsIGxldCdzIHJlc2V0IHRoZSByZXNpemVyIHN0YXRlLg0KCQkJcmVzaXplci5fcmVzZXQoKTsNCgkJfQ0KCX0pOw0KfQ0KDQpmdW5jdGlvbiByZW1vdmVSZXNpemVMaXN0ZW5lcihub2RlKSB7DQoJdmFyIGV4cGFuZG8gPSBub2RlW0VYUEFORE9fS0VZXSB8fCB7fTsNCgl2YXIgcmVzaXplciA9IGV4cGFuZG8ucmVzaXplcjsNCg0KCWRlbGV0ZSBleHBhbmRvLnJlc2l6ZXI7DQoJdW53YXRjaEZvclJlbmRlcihub2RlKTsNCg0KCWlmIChyZXNpemVyICYmIHJlc2l6ZXIucGFyZW50Tm9kZSkgew0KCQlyZXNpemVyLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQocmVzaXplcik7DQoJfQ0KfQ0KDQpmdW5jdGlvbiBpbmplY3RDU1MocGxhdGZvcm0sIGNzcykgew0KCS8vIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xLzM5MjIxMzkNCgl2YXIgc3R5bGUgPSBwbGF0Zm9ybS5fc3R5bGUgfHwgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3R5bGUnKTsNCglpZiAoIXBsYXRmb3JtLl9zdHlsZSkgew0KCQlwbGF0Zm9ybS5fc3R5bGUgPSBzdHlsZTsNCgkJY3NzID0gJy8qIENoYXJ0LmpzICovXG4nICsgY3NzOw0KCQlzdHlsZS5zZXRBdHRyaWJ1dGUoJ3R5cGUnLCAndGV4dC9jc3MnKTsNCgkJZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2hlYWQnKVswXS5hcHBlbmRDaGlsZChzdHlsZSk7DQoJfQ0KDQoJc3R5bGUuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoY3NzKSk7DQp9DQoNCm1vZHVsZS5leHBvcnRzID0gew0KCS8qKg0KCSAqIFRoaXMgcHJvcGVydHkgaG9sZHMgd2hldGhlciB0aGlzIHBsYXRmb3JtIGlzIGVuYWJsZWQgZm9yIHRoZSBjdXJyZW50IGVudmlyb25tZW50Lg0KCSAqIEN1cnJlbnRseSB1c2VkIGJ5IHBsYXRmb3JtLmpzIHRvIHNlbGVjdCB0aGUgcHJvcGVyIGltcGxlbWVudGF0aW9uLg0KCSAqIEBwcml2YXRlDQoJICovDQoJX2VuYWJsZWQ6IHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmIHR5cGVvZiBkb2N1bWVudCAhPT0gJ3VuZGVmaW5lZCcsDQoNCglpbml0aWFsaXplOiBmdW5jdGlvbigpIHsNCgkJdmFyIGtleWZyYW1lcyA9ICdmcm9te29wYWNpdHk6MC45OX10b3tvcGFjaXR5OjF9JzsNCg0KCQlpbmplY3RDU1ModGhpcywNCgkJCS8vIERPTSByZW5kZXJpbmcgZGV0ZWN0aW9uDQoJCQkvLyBodHRwczovL2Rhdmlkd2Fsc2gubmFtZS9kZXRlY3Qtbm9kZS1pbnNlcnRpb24NCgkJCSdALXdlYmtpdC1rZXlmcmFtZXMgJyArIENTU19SRU5ERVJfQU5JTUFUSU9OICsgJ3snICsga2V5ZnJhbWVzICsgJ30nICsNCgkJCSdAa2V5ZnJhbWVzICcgKyBDU1NfUkVOREVSX0FOSU1BVElPTiArICd7JyArIGtleWZyYW1lcyArICd9JyArDQoJCQknLicgKyBDU1NfUkVOREVSX01PTklUT1IgKyAneycgKw0KCQkJCSctd2Via2l0LWFuaW1hdGlvbjonICsgQ1NTX1JFTkRFUl9BTklNQVRJT04gKyAnIDAuMDAxczsnICsNCgkJCQknYW5pbWF0aW9uOicgKyBDU1NfUkVOREVSX0FOSU1BVElPTiArICcgMC4wMDFzOycgKw0KCQkJJ30nDQoJCSk7DQoJfSwNCg0KCWFjcXVpcmVDb250ZXh0OiBmdW5jdGlvbihpdGVtLCBjb25maWcpIHsNCgkJaWYgKHR5cGVvZiBpdGVtID09PSAnc3RyaW5nJykgew0KCQkJaXRlbSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGl0ZW0pOw0KCQl9IGVsc2UgaWYgKGl0ZW0ubGVuZ3RoKSB7DQoJCQkvLyBTdXBwb3J0IGZvciBhcnJheSBiYXNlZCBxdWVyaWVzIChzdWNoIGFzIGpRdWVyeSkNCgkJCWl0ZW0gPSBpdGVtWzBdOw0KCQl9DQoNCgkJaWYgKGl0ZW0gJiYgaXRlbS5jYW52YXMpIHsNCgkJCS8vIFN1cHBvcnQgZm9yIGFueSBvYmplY3QgYXNzb2NpYXRlZCB0byBhIGNhbnZhcyAoaW5jbHVkaW5nIGEgY29udGV4dDJkKQ0KCQkJaXRlbSA9IGl0ZW0uY2FudmFzOw0KCQl9DQoNCgkJLy8gVG8gcHJldmVudCBjYW52YXMgZmluZ2VycHJpbnRpbmcsIHNvbWUgYWRkLW9ucyB1bmRlZmluZSB0aGUgZ2V0Q29udGV4dA0KCQkvLyBtZXRob2QsIGZvciBleGFtcGxlOiBodHRwczovL2dpdGh1Yi5jb20va2thcHNuZXIvQ2FudmFzQmxvY2tlcg0KCQkvLyBodHRwczovL2dpdGh1Yi5jb20vY2hhcnRqcy9DaGFydC5qcy9pc3N1ZXMvMjgwNw0KCQl2YXIgY29udGV4dCA9IGl0ZW0gJiYgaXRlbS5nZXRDb250ZXh0ICYmIGl0ZW0uZ2V0Q29udGV4dCgnMmQnKTsNCg0KCQkvLyBgaW5zdGFuY2VvZiBIVE1MQ2FudmFzRWxlbWVudC9DYW52YXNSZW5kZXJpbmdDb250ZXh0MkRgIGZhaWxzIHdoZW4gdGhlIGl0ZW0gaXMNCgkJLy8gaW5zaWRlIGFuIGlmcmFtZSBvciB3aGVuIHJ1bm5pbmcgaW4gYSBwcm90ZWN0ZWQgZW52aXJvbm1lbnQuIFdlIGNvdWxkIGd1ZXNzIHRoZQ0KCQkvLyB0eXBlcyBmcm9tIHRoZWlyIHRvU3RyaW5nKCkgdmFsdWUgYnV0IGxldCdzIGtlZXAgdGhpbmdzIGZsZXhpYmxlIGFuZCBhc3N1bWUgaXQncw0KCQkvLyBhIHN1ZmZpY2llbnQgY29uZGl0aW9uIGlmIHRoZSBpdGVtIGhhcyBhIGNvbnRleHQyRCB3aGljaCBoYXMgaXRlbSBhcyBgY2FudmFzYC4NCgkJLy8gaHR0cHM6Ly9naXRodWIuY29tL2NoYXJ0anMvQ2hhcnQuanMvaXNzdWVzLzM4ODcNCgkJLy8gaHR0cHM6Ly9naXRodWIuY29tL2NoYXJ0anMvQ2hhcnQuanMvaXNzdWVzLzQxMDINCgkJLy8gaHR0cHM6Ly9naXRodWIuY29tL2NoYXJ0anMvQ2hhcnQuanMvaXNzdWVzLzQxNTINCgkJaWYgKGNvbnRleHQgJiYgY29udGV4dC5jYW52YXMgPT09IGl0ZW0pIHsNCgkJCWluaXRDYW52YXMoaXRlbSwgY29uZmlnKTsNCgkJCXJldHVybiBjb250ZXh0Ow0KCQl9DQoNCgkJcmV0dXJuIG51bGw7DQoJfSwNCg0KCXJlbGVhc2VDb250ZXh0OiBmdW5jdGlvbihjb250ZXh0KSB7DQoJCXZhciBjYW52YXMgPSBjb250ZXh0LmNhbnZhczsNCgkJaWYgKCFjYW52YXNbRVhQQU5ET19LRVldKSB7DQoJCQlyZXR1cm47DQoJCX0NCg0KCQl2YXIgaW5pdGlhbCA9IGNhbnZhc1tFWFBBTkRPX0tFWV0uaW5pdGlhbDsNCgkJWydoZWlnaHQnLCAnd2lkdGgnXS5mb3JFYWNoKGZ1bmN0aW9uKHByb3ApIHsNCgkJCXZhciB2YWx1ZSA9IGluaXRpYWxbcHJvcF07DQoJCQlpZiAoaGVscGVycy5pc051bGxPclVuZGVmKHZhbHVlKSkgew0KCQkJCWNhbnZhcy5yZW1vdmVBdHRyaWJ1dGUocHJvcCk7DQoJCQl9IGVsc2Ugew0KCQkJCWNhbnZhcy5zZXRBdHRyaWJ1dGUocHJvcCwgdmFsdWUpOw0KCQkJfQ0KCQl9KTsNCg0KCQloZWxwZXJzLmVhY2goaW5pdGlhbC5zdHlsZSB8fCB7fSwgZnVuY3Rpb24odmFsdWUsIGtleSkgew0KCQkJY2FudmFzLnN0eWxlW2tleV0gPSB2YWx1ZTsNCgkJfSk7DQoNCgkJLy8gVGhlIGNhbnZhcyByZW5kZXIgc2l6ZSBtaWdodCBoYXZlIGJlZW4gY2hhbmdlZCAoYW5kIHRodXMgdGhlIHN0YXRlIHN0YWNrIGRpc2NhcmRlZCksDQoJCS8vIHdlIGNhbid0IHVzZSBzYXZlKCkgYW5kIHJlc3RvcmUoKSB0byByZXN0b3JlIHRoZSBpbml0aWFsIHN0YXRlLiBTbyBtYWtlIHN1cmUgdGhhdCBhdA0KCQkvLyBsZWFzdCB0aGUgY2FudmFzIGNvbnRleHQgaXMgcmVzZXQgdG8gdGhlIGRlZmF1bHQgc3RhdGUgYnkgc2V0dGluZyB0aGUgY2FudmFzIHdpZHRoLg0KCQkvLyBodHRwczovL3d3dy53My5vcmcvVFIvMjAxMS9XRC1odG1sNS0yMDExMDUyNS90aGUtY2FudmFzLWVsZW1lbnQuaHRtbA0KCQljYW52YXMud2lkdGggPSBjYW52YXMud2lkdGg7DQoNCgkJZGVsZXRlIGNhbnZhc1tFWFBBTkRPX0tFWV07DQoJfSwNCg0KCWFkZEV2ZW50TGlzdGVuZXI6IGZ1bmN0aW9uKGNoYXJ0LCB0eXBlLCBsaXN0ZW5lcikgew0KCQl2YXIgY2FudmFzID0gY2hhcnQuY2FudmFzOw0KCQlpZiAodHlwZSA9PT0gJ3Jlc2l6ZScpIHsNCgkJCS8vIE5vdGU6IHRoZSByZXNpemUgZXZlbnQgaXMgbm90IHN1cHBvcnRlZCBvbiBhbGwgYnJvd3NlcnMuDQoJCQlhZGRSZXNpemVMaXN0ZW5lcihjYW52YXMsIGxpc3RlbmVyLCBjaGFydCk7DQoJCQlyZXR1cm47DQoJCX0NCg0KCQl2YXIgZXhwYW5kbyA9IGxpc3RlbmVyW0VYUEFORE9fS0VZXSB8fCAobGlzdGVuZXJbRVhQQU5ET19LRVldID0ge30pOw0KCQl2YXIgcHJveGllcyA9IGV4cGFuZG8ucHJveGllcyB8fCAoZXhwYW5kby5wcm94aWVzID0ge30pOw0KCQl2YXIgcHJveHkgPSBwcm94aWVzW2NoYXJ0LmlkICsgJ18nICsgdHlwZV0gPSBmdW5jdGlvbihldmVudCkgew0KCQkJbGlzdGVuZXIoZnJvbU5hdGl2ZUV2ZW50KGV2ZW50LCBjaGFydCkpOw0KCQl9Ow0KDQoJCWFkZEV2ZW50TGlzdGVuZXIoY2FudmFzLCB0eXBlLCBwcm94eSk7DQoJfSwNCg0KCXJlbW92ZUV2ZW50TGlzdGVuZXI6IGZ1bmN0aW9uKGNoYXJ0LCB0eXBlLCBsaXN0ZW5lcikgew0KCQl2YXIgY2FudmFzID0gY2hhcnQuY2FudmFzOw0KCQlpZiAodHlwZSA9PT0gJ3Jlc2l6ZScpIHsNCgkJCS8vIE5vdGU6IHRoZSByZXNpemUgZXZlbnQgaXMgbm90IHN1cHBvcnRlZCBvbiBhbGwgYnJvd3NlcnMuDQoJCQlyZW1vdmVSZXNpemVMaXN0ZW5lcihjYW52YXMsIGxpc3RlbmVyKTsNCgkJCXJldHVybjsNCgkJfQ0KDQoJCXZhciBleHBhbmRvID0gbGlzdGVuZXJbRVhQQU5ET19LRVldIHx8IHt9Ow0KCQl2YXIgcHJveGllcyA9IGV4cGFuZG8ucHJveGllcyB8fCB7fTsNCgkJdmFyIHByb3h5ID0gcHJveGllc1tjaGFydC5pZCArICdfJyArIHR5cGVdOw0KCQlpZiAoIXByb3h5KSB7DQoJCQlyZXR1cm47DQoJCX0NCg0KCQlyZW1vdmVFdmVudExpc3RlbmVyKGNhbnZhcywgdHlwZSwgcHJveHkpOw0KCX0NCn07DQoNCi8vIERFUFJFQ0FUSU9OUw0KDQovKioNCiAqIFByb3ZpZGVkIGZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5LCB1c2UgRXZlbnRUYXJnZXQuYWRkRXZlbnRMaXN0ZW5lciBpbnN0ZWFkLg0KICogRXZlbnRUYXJnZXQuYWRkRXZlbnRMaXN0ZW5lciBjb21wYXRpYmlsaXR5OiBDaHJvbWUsIE9wZXJhIDcsIFNhZmFyaSwgRkYxLjUrLCBJRTkrDQogKiBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9FdmVudFRhcmdldC9hZGRFdmVudExpc3RlbmVyDQogKiBAZnVuY3Rpb24gQ2hhcnQuaGVscGVycy5hZGRFdmVudA0KICogQGRlcHJlY2F0ZWQgc2luY2UgdmVyc2lvbiAyLjcuMA0KICogQHRvZG8gcmVtb3ZlIGF0IHZlcnNpb24gMw0KICogQHByaXZhdGUNCiAqLw0KaGVscGVycy5hZGRFdmVudCA9IGFkZEV2ZW50TGlzdGVuZXI7DQoNCi8qKg0KICogUHJvdmlkZWQgZm9yIGJhY2t3YXJkIGNvbXBhdGliaWxpdHksIHVzZSBFdmVudFRhcmdldC5yZW1vdmVFdmVudExpc3RlbmVyIGluc3RlYWQuDQogKiBFdmVudFRhcmdldC5yZW1vdmVFdmVudExpc3RlbmVyIGNvbXBhdGliaWxpdHk6IENocm9tZSwgT3BlcmEgNywgU2FmYXJpLCBGRjEuNSssIElFOSsNCiAqIEBzZWUgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL0V2ZW50VGFyZ2V0L3JlbW92ZUV2ZW50TGlzdGVuZXINCiAqIEBmdW5jdGlvbiBDaGFydC5oZWxwZXJzLnJlbW92ZUV2ZW50DQogKiBAZGVwcmVjYXRlZCBzaW5jZSB2ZXJzaW9uIDIuNy4wDQogKiBAdG9kbyByZW1vdmUgYXQgdmVyc2lvbiAzDQogKiBAcHJpdmF0ZQ0KICovDQpoZWxwZXJzLnJlbW92ZUV2ZW50ID0gcmVtb3ZlRXZlbnRMaXN0ZW5lcjsNCg0KfSx7IjQ1Ijo0NX1dLDQ4OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsNCid1c2Ugc3RyaWN0JzsNCg0KdmFyIGhlbHBlcnMgPSByZXF1aXJlKDQ1KTsNCnZhciBiYXNpYyA9IHJlcXVpcmUoNDYpOw0KdmFyIGRvbSA9IHJlcXVpcmUoNDcpOw0KDQovLyBAVE9ETyBNYWtlIHBvc3NpYmxlIHRvIHNlbGVjdCBhbm90aGVyIHBsYXRmb3JtIGF0IGJ1aWxkIHRpbWUuDQp2YXIgaW1wbGVtZW50YXRpb24gPSBkb20uX2VuYWJsZWQgPyBkb20gOiBiYXNpYzsNCg0KLyoqDQogKiBAbmFtZXNwYWNlIENoYXJ0LnBsYXRmb3JtDQogKiBAc2VlIGh0dHBzOi8vY2hhcnRqcy5naXRib29rcy5pby9wcm9wb3NhbHMvY29udGVudC9QbGF0Zm9ybS5odG1sDQogKiBAc2luY2UgMi40LjANCiAqLw0KbW9kdWxlLmV4cG9ydHMgPSBoZWxwZXJzLmV4dGVuZCh7DQoJLyoqDQoJICogQHNpbmNlIDIuNy4wDQoJICovDQoJaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7fSwNCg0KCS8qKg0KCSAqIENhbGxlZCBhdCBjaGFydCBjb25zdHJ1Y3Rpb24gdGltZSwgcmV0dXJucyBhIGNvbnRleHQyZCBpbnN0YW5jZSBpbXBsZW1lbnRpbmcNCgkgKiB0aGUgW1czQyBDYW52YXMgMkQgQ29udGV4dCBBUEkgc3RhbmRhcmRde0BsaW5rIGh0dHBzOi8vd3d3LnczLm9yZy9UUi8yZGNvbnRleHQvfS4NCgkgKiBAcGFyYW0geyp9IGl0ZW0gLSBUaGUgbmF0aXZlIGl0ZW0gZnJvbSB3aGljaCB0byBhY3F1aXJlIGNvbnRleHQgKHBsYXRmb3JtIHNwZWNpZmljKQ0KCSAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIC0gVGhlIGNoYXJ0IG9wdGlvbnMNCgkgKiBAcmV0dXJucyB7Q2FudmFzUmVuZGVyaW5nQ29udGV4dDJEfSBjb250ZXh0MmQgaW5zdGFuY2UNCgkgKi8NCglhY3F1aXJlQ29udGV4dDogZnVuY3Rpb24oKSB7fSwNCg0KCS8qKg0KCSAqIENhbGxlZCBhdCBjaGFydCBkZXN0cnVjdGlvbiB0aW1lLCByZWxlYXNlcyBhbnkgcmVzb3VyY2VzIGFzc29jaWF0ZWQgdG8gdGhlIGNvbnRleHQNCgkgKiBwcmV2aW91c2x5IHJldHVybmVkIGJ5IHRoZSBhY3F1aXJlQ29udGV4dCgpIG1ldGhvZC4NCgkgKiBAcGFyYW0ge0NhbnZhc1JlbmRlcmluZ0NvbnRleHQyRH0gY29udGV4dCAtIFRoZSBjb250ZXh0MmQgaW5zdGFuY2UNCgkgKiBAcmV0dXJucyB7Qm9vbGVhbn0gdHJ1ZSBpZiB0aGUgbWV0aG9kIHN1Y2NlZWRlZCwgZWxzZSBmYWxzZQ0KCSAqLw0KCXJlbGVhc2VDb250ZXh0OiBmdW5jdGlvbigpIHt9LA0KDQoJLyoqDQoJICogUmVnaXN0ZXJzIHRoZSBzcGVjaWZpZWQgbGlzdGVuZXIgb24gdGhlIGdpdmVuIGNoYXJ0Lg0KCSAqIEBwYXJhbSB7Q2hhcnR9IGNoYXJ0IC0gQ2hhcnQgZnJvbSB3aGljaCB0byBsaXN0ZW4gZm9yIGV2ZW50DQoJICogQHBhcmFtIHtTdHJpbmd9IHR5cGUgLSBUaGUgKHtAbGluayBJRXZlbnR9KSB0eXBlIHRvIGxpc3RlbiBmb3INCgkgKiBAcGFyYW0ge0Z1bmN0aW9ufSBsaXN0ZW5lciAtIFJlY2VpdmVzIGEgbm90aWZpY2F0aW9uIChhbiBvYmplY3QgdGhhdCBpbXBsZW1lbnRzDQoJICogdGhlIHtAbGluayBJRXZlbnR9IGludGVyZmFjZSkgd2hlbiBhbiBldmVudCBvZiB0aGUgc3BlY2lmaWVkIHR5cGUgb2NjdXJzLg0KCSAqLw0KCWFkZEV2ZW50TGlzdGVuZXI6IGZ1bmN0aW9uKCkge30sDQoNCgkvKioNCgkgKiBSZW1vdmVzIHRoZSBzcGVjaWZpZWQgbGlzdGVuZXIgcHJldmlvdXNseSByZWdpc3RlcmVkIHdpdGggYWRkRXZlbnRMaXN0ZW5lci4NCgkgKiBAcGFyYW0ge0NoYXJ0fSBjaGFydCAtQ2hhcnQgZnJvbSB3aGljaCB0byByZW1vdmUgdGhlIGxpc3RlbmVyDQoJICogQHBhcmFtIHtTdHJpbmd9IHR5cGUgLSBUaGUgKHtAbGluayBJRXZlbnR9KSB0eXBlIHRvIHJlbW92ZQ0KCSAqIEBwYXJhbSB7RnVuY3Rpb259IGxpc3RlbmVyIC0gVGhlIGxpc3RlbmVyIGZ1bmN0aW9uIHRvIHJlbW92ZSBmcm9tIHRoZSBldmVudCB0YXJnZXQuDQoJICovDQoJcmVtb3ZlRXZlbnRMaXN0ZW5lcjogZnVuY3Rpb24oKSB7fQ0KDQp9LCBpbXBsZW1lbnRhdGlvbik7DQoNCi8qKg0KICogQGludGVyZmFjZSBJUGxhdGZvcm0NCiAqIEFsbG93cyBhYnN0cmFjdGluZyBwbGF0Zm9ybSBkZXBlbmRlbmNpZXMgYXdheSBmcm9tIHRoZSBjaGFydA0KICogQGJvcnJvd3MgQ2hhcnQucGxhdGZvcm0uYWNxdWlyZUNvbnRleHQgYXMgYWNxdWlyZUNvbnRleHQNCiAqIEBib3Jyb3dzIENoYXJ0LnBsYXRmb3JtLnJlbGVhc2VDb250ZXh0IGFzIHJlbGVhc2VDb250ZXh0DQogKiBAYm9ycm93cyBDaGFydC5wbGF0Zm9ybS5hZGRFdmVudExpc3RlbmVyIGFzIGFkZEV2ZW50TGlzdGVuZXINCiAqIEBib3Jyb3dzIENoYXJ0LnBsYXRmb3JtLnJlbW92ZUV2ZW50TGlzdGVuZXIgYXMgcmVtb3ZlRXZlbnRMaXN0ZW5lcg0KICovDQoNCi8qKg0KICogQGludGVyZmFjZSBJRXZlbnQNCiAqIEBwcm9wIHtTdHJpbmd9IHR5cGUgLSBUaGUgZXZlbnQgdHlwZSBuYW1lLCBwb3NzaWJsZSB2YWx1ZXMgYXJlOg0KICogJ2NvbnRleHRtZW51JywgJ21vdXNlZW50ZXInLCAnbW91c2Vkb3duJywgJ21vdXNlbW92ZScsICdtb3VzZXVwJywgJ21vdXNlb3V0JywNCiAqICdjbGljaycsICdkYmxjbGljaycsICdrZXlkb3duJywgJ2tleXByZXNzJywgJ2tleXVwJyBhbmQgJ3Jlc2l6ZScNCiAqIEBwcm9wIHsqfSBuYXRpdmUgLSBUaGUgb3JpZ2luYWwgbmF0aXZlIGV2ZW50IChudWxsIGZvciBlbXVsYXRlZCBldmVudHMsIGUuZy4gJ3Jlc2l6ZScpDQogKiBAcHJvcCB7TnVtYmVyfSB4IC0gVGhlIG1vdXNlIHggcG9zaXRpb24sIHJlbGF0aXZlIHRvIHRoZSBjYW52YXMgKG51bGwgZm9yIGluY29tcGF0aWJsZSBldmVudHMpDQogKiBAcHJvcCB7TnVtYmVyfSB5IC0gVGhlIG1vdXNlIHkgcG9zaXRpb24sIHJlbGF0aXZlIHRvIHRoZSBjYW52YXMgKG51bGwgZm9yIGluY29tcGF0aWJsZSBldmVudHMpDQogKi8NCg0KfSx7IjQ1Ijo0NSwiNDYiOjQ2LCI0NyI6NDd9XSw0OTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7DQovKioNCiAqIFBsdWdpbiBiYXNlZCBvbiBkaXNjdXNzaW9uIGZyb20gdGhlIGZvbGxvd2luZyBDaGFydC5qcyBpc3N1ZXM6DQogKiBAc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9jaGFydGpzL0NoYXJ0LmpzL2lzc3Vlcy8yMzgwI2lzc3VlY29tbWVudC0yNzk5NjE1NjkNCiAqIEBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2NoYXJ0anMvQ2hhcnQuanMvaXNzdWVzLzI0NDAjaXNzdWVjb21tZW50LTI1NjQ2MTg5Nw0KICovDQoNCid1c2Ugc3RyaWN0JzsNCg0KdmFyIGRlZmF1bHRzID0gcmVxdWlyZSgyNSk7DQp2YXIgZWxlbWVudHMgPSByZXF1aXJlKDQwKTsNCnZhciBoZWxwZXJzID0gcmVxdWlyZSg0NSk7DQoNCmRlZmF1bHRzLl9zZXQoJ2dsb2JhbCcsIHsNCglwbHVnaW5zOiB7DQoJCWZpbGxlcjogew0KCQkJcHJvcGFnYXRlOiB0cnVlDQoJCX0NCgl9DQp9KTsNCg0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbigpIHsNCg0KCXZhciBtYXBwZXJzID0gew0KCQlkYXRhc2V0OiBmdW5jdGlvbihzb3VyY2UpIHsNCgkJCXZhciBpbmRleCA9IHNvdXJjZS5maWxsOw0KCQkJdmFyIGNoYXJ0ID0gc291cmNlLmNoYXJ0Ow0KCQkJdmFyIG1ldGEgPSBjaGFydC5nZXREYXRhc2V0TWV0YShpbmRleCk7DQoJCQl2YXIgdmlzaWJsZSA9IG1ldGEgJiYgY2hhcnQuaXNEYXRhc2V0VmlzaWJsZShpbmRleCk7DQoJCQl2YXIgcG9pbnRzID0gKHZpc2libGUgJiYgbWV0YS5kYXRhc2V0Ll9jaGlsZHJlbikgfHwgW107DQoJCQl2YXIgbGVuZ3RoID0gcG9pbnRzLmxlbmd0aCB8fCAwOw0KDQoJCQlyZXR1cm4gIWxlbmd0aCA/IG51bGwgOiBmdW5jdGlvbihwb2ludCwgaSkgew0KCQkJCXJldHVybiAoaSA8IGxlbmd0aCAmJiBwb2ludHNbaV0uX3ZpZXcpIHx8IG51bGw7DQoJCQl9Ow0KCQl9LA0KDQoJCWJvdW5kYXJ5OiBmdW5jdGlvbihzb3VyY2UpIHsNCgkJCXZhciBib3VuZGFyeSA9IHNvdXJjZS5ib3VuZGFyeTsNCgkJCXZhciB4ID0gYm91bmRhcnkgPyBib3VuZGFyeS54IDogbnVsbDsNCgkJCXZhciB5ID0gYm91bmRhcnkgPyBib3VuZGFyeS55IDogbnVsbDsNCg0KCQkJcmV0dXJuIGZ1bmN0aW9uKHBvaW50KSB7DQoJCQkJcmV0dXJuIHsNCgkJCQkJeDogeCA9PT0gbnVsbCA/IHBvaW50LnggOiB4LA0KCQkJCQl5OiB5ID09PSBudWxsID8gcG9pbnQueSA6IHksDQoJCQkJfTsNCgkJCX07DQoJCX0NCgl9Ow0KDQoJLy8gQHRvZG8gaWYgKGZpbGxbMF0gPT09ICcjJykNCglmdW5jdGlvbiBkZWNvZGVGaWxsKGVsLCBpbmRleCwgY291bnQpIHsNCgkJdmFyIG1vZGVsID0gZWwuX21vZGVsIHx8IHt9Ow0KCQl2YXIgZmlsbCA9IG1vZGVsLmZpbGw7DQoJCXZhciB0YXJnZXQ7DQoNCgkJaWYgKGZpbGwgPT09IHVuZGVmaW5lZCkgew0KCQkJZmlsbCA9ICEhbW9kZWwuYmFja2dyb3VuZENvbG9yOw0KCQl9DQoNCgkJaWYgKGZpbGwgPT09IGZhbHNlIHx8IGZpbGwgPT09IG51bGwpIHsNCgkJCXJldHVybiBmYWxzZTsNCgkJfQ0KDQoJCWlmIChmaWxsID09PSB0cnVlKSB7DQoJCQlyZXR1cm4gJ29yaWdpbic7DQoJCX0NCg0KCQl0YXJnZXQgPSBwYXJzZUZsb2F0KGZpbGwsIDEwKTsNCgkJaWYgKGlzRmluaXRlKHRhcmdldCkgJiYgTWF0aC5mbG9vcih0YXJnZXQpID09PSB0YXJnZXQpIHsNCgkJCWlmIChmaWxsWzBdID09PSAnLScgfHwgZmlsbFswXSA9PT0gJysnKSB7DQoJCQkJdGFyZ2V0ID0gaW5kZXggKyB0YXJnZXQ7DQoJCQl9DQoNCgkJCWlmICh0YXJnZXQgPT09IGluZGV4IHx8IHRhcmdldCA8IDAgfHwgdGFyZ2V0ID49IGNvdW50KSB7DQoJCQkJcmV0dXJuIGZhbHNlOw0KCQkJfQ0KDQoJCQlyZXR1cm4gdGFyZ2V0Ow0KCQl9DQoNCgkJc3dpdGNoIChmaWxsKSB7DQoJCS8vIGNvbXBhdGliaWxpdHkNCgkJY2FzZSAnYm90dG9tJzoNCgkJCXJldHVybiAnc3RhcnQnOw0KCQljYXNlICd0b3AnOg0KCQkJcmV0dXJuICdlbmQnOw0KCQljYXNlICd6ZXJvJzoNCgkJCXJldHVybiAnb3JpZ2luJzsNCgkJLy8gc3VwcG9ydGVkIGJvdW5kYXJpZXMNCgkJY2FzZSAnb3JpZ2luJzoNCgkJY2FzZSAnc3RhcnQnOg0KCQljYXNlICdlbmQnOg0KCQkJcmV0dXJuIGZpbGw7DQoJCS8vIGludmFsaWQgZmlsbCB2YWx1ZXMNCgkJZGVmYXVsdDoNCgkJCXJldHVybiBmYWxzZTsNCgkJfQ0KCX0NCg0KCWZ1bmN0aW9uIGNvbXB1dGVCb3VuZGFyeShzb3VyY2UpIHsNCgkJdmFyIG1vZGVsID0gc291cmNlLmVsLl9tb2RlbCB8fCB7fTsNCgkJdmFyIHNjYWxlID0gc291cmNlLmVsLl9zY2FsZSB8fCB7fTsNCgkJdmFyIGZpbGwgPSBzb3VyY2UuZmlsbDsNCgkJdmFyIHRhcmdldCA9IG51bGw7DQoJCXZhciBob3Jpem9udGFsOw0KDQoJCWlmIChpc0Zpbml0ZShmaWxsKSkgew0KCQkJcmV0dXJuIG51bGw7DQoJCX0NCg0KCQkvLyBCYWNrd2FyZCBjb21wYXRpYmlsaXR5OiB1bnRpbCB2Mywgd2Ugc3RpbGwgbmVlZCB0byBzdXBwb3J0IGJvdW5kYXJ5IHZhbHVlcyBzZXQgb24NCgkJLy8gdGhlIG1vZGVsIChzY2FsZVRvcCwgc2NhbGVCb3R0b20gYW5kIHNjYWxlWmVybykgYmVjYXVzZSBzb21lIGV4dGVybmFsIHBsdWdpbnMgYW5kDQoJCS8vIGNvbnRyb2xsZXJzIG1pZ2h0IHN0aWxsIHVzZSBpdCAoZS5nLiB0aGUgU21pdGggY2hhcnQpLg0KDQoJCWlmIChmaWxsID09PSAnc3RhcnQnKSB7DQoJCQl0YXJnZXQgPSBtb2RlbC5zY2FsZUJvdHRvbSA9PT0gdW5kZWZpbmVkID8gc2NhbGUuYm90dG9tIDogbW9kZWwuc2NhbGVCb3R0b207DQoJCX0gZWxzZSBpZiAoZmlsbCA9PT0gJ2VuZCcpIHsNCgkJCXRhcmdldCA9IG1vZGVsLnNjYWxlVG9wID09PSB1bmRlZmluZWQgPyBzY2FsZS50b3AgOiBtb2RlbC5zY2FsZVRvcDsNCgkJfSBlbHNlIGlmIChtb2RlbC5zY2FsZVplcm8gIT09IHVuZGVmaW5lZCkgew0KCQkJdGFyZ2V0ID0gbW9kZWwuc2NhbGVaZXJvOw0KCQl9IGVsc2UgaWYgKHNjYWxlLmdldEJhc2VQb3NpdGlvbikgew0KCQkJdGFyZ2V0ID0gc2NhbGUuZ2V0QmFzZVBvc2l0aW9uKCk7DQoJCX0gZWxzZSBpZiAoc2NhbGUuZ2V0QmFzZVBpeGVsKSB7DQoJCQl0YXJnZXQgPSBzY2FsZS5nZXRCYXNlUGl4ZWwoKTsNCgkJfQ0KDQoJCWlmICh0YXJnZXQgIT09IHVuZGVmaW5lZCAmJiB0YXJnZXQgIT09IG51bGwpIHsNCgkJCWlmICh0YXJnZXQueCAhPT0gdW5kZWZpbmVkICYmIHRhcmdldC55ICE9PSB1bmRlZmluZWQpIHsNCgkJCQlyZXR1cm4gdGFyZ2V0Ow0KCQkJfQ0KDQoJCQlpZiAodHlwZW9mIHRhcmdldCA9PT0gJ251bWJlcicgJiYgaXNGaW5pdGUodGFyZ2V0KSkgew0KCQkJCWhvcml6b250YWwgPSBzY2FsZS5pc0hvcml6b250YWwoKTsNCgkJCQlyZXR1cm4gew0KCQkJCQl4OiBob3Jpem9udGFsID8gdGFyZ2V0IDogbnVsbCwNCgkJCQkJeTogaG9yaXpvbnRhbCA/IG51bGwgOiB0YXJnZXQNCgkJCQl9Ow0KCQkJfQ0KCQl9DQoNCgkJcmV0dXJuIG51bGw7DQoJfQ0KDQoJZnVuY3Rpb24gcmVzb2x2ZVRhcmdldChzb3VyY2VzLCBpbmRleCwgcHJvcGFnYXRlKSB7DQoJCXZhciBzb3VyY2UgPSBzb3VyY2VzW2luZGV4XTsNCgkJdmFyIGZpbGwgPSBzb3VyY2UuZmlsbDsNCgkJdmFyIHZpc2l0ZWQgPSBbaW5kZXhdOw0KCQl2YXIgdGFyZ2V0Ow0KDQoJCWlmICghcHJvcGFnYXRlKSB7DQoJCQlyZXR1cm4gZmlsbDsNCgkJfQ0KDQoJCXdoaWxlIChmaWxsICE9PSBmYWxzZSAmJiB2aXNpdGVkLmluZGV4T2YoZmlsbCkgPT09IC0xKSB7DQoJCQlpZiAoIWlzRmluaXRlKGZpbGwpKSB7DQoJCQkJcmV0dXJuIGZpbGw7DQoJCQl9DQoNCgkJCXRhcmdldCA9IHNvdXJjZXNbZmlsbF07DQoJCQlpZiAoIXRhcmdldCkgew0KCQkJCXJldHVybiBmYWxzZTsNCgkJCX0NCg0KCQkJaWYgKHRhcmdldC52aXNpYmxlKSB7DQoJCQkJcmV0dXJuIGZpbGw7DQoJCQl9DQoNCgkJCXZpc2l0ZWQucHVzaChmaWxsKTsNCgkJCWZpbGwgPSB0YXJnZXQuZmlsbDsNCgkJfQ0KDQoJCXJldHVybiBmYWxzZTsNCgl9DQoNCglmdW5jdGlvbiBjcmVhdGVNYXBwZXIoc291cmNlKSB7DQoJCXZhciBmaWxsID0gc291cmNlLmZpbGw7DQoJCXZhciB0eXBlID0gJ2RhdGFzZXQnOw0KDQoJCWlmIChmaWxsID09PSBmYWxzZSkgew0KCQkJcmV0dXJuIG51bGw7DQoJCX0NCg0KCQlpZiAoIWlzRmluaXRlKGZpbGwpKSB7DQoJCQl0eXBlID0gJ2JvdW5kYXJ5JzsNCgkJfQ0KDQoJCXJldHVybiBtYXBwZXJzW3R5cGVdKHNvdXJjZSk7DQoJfQ0KDQoJZnVuY3Rpb24gaXNEcmF3YWJsZShwb2ludCkgew0KCQlyZXR1cm4gcG9pbnQgJiYgIXBvaW50LnNraXA7DQoJfQ0KDQoJZnVuY3Rpb24gZHJhd0FyZWEoY3R4LCBjdXJ2ZTAsIGN1cnZlMSwgbGVuMCwgbGVuMSkgew0KCQl2YXIgaTsNCg0KCQlpZiAoIWxlbjAgfHwgIWxlbjEpIHsNCgkJCXJldHVybjsNCgkJfQ0KDQoJCS8vIGJ1aWxkaW5nIGZpcnN0IGFyZWEgY3VydmUgKG5vcm1hbCkNCgkJY3R4Lm1vdmVUbyhjdXJ2ZTBbMF0ueCwgY3VydmUwWzBdLnkpOw0KCQlmb3IgKGkgPSAxOyBpIDwgbGVuMDsgKytpKSB7DQoJCQloZWxwZXJzLmNhbnZhcy5saW5lVG8oY3R4LCBjdXJ2ZTBbaSAtIDFdLCBjdXJ2ZTBbaV0pOw0KCQl9DQoNCgkJLy8gam9pbmluZyB0aGUgdHdvIGFyZWEgY3VydmVzDQoJCWN0eC5saW5lVG8oY3VydmUxW2xlbjEgLSAxXS54LCBjdXJ2ZTFbbGVuMSAtIDFdLnkpOw0KDQoJCS8vIGJ1aWxkaW5nIG9wcG9zaXRlIGFyZWEgY3VydmUgKHJldmVyc2UpDQoJCWZvciAoaSA9IGxlbjEgLSAxOyBpID4gMDsgLS1pKSB7DQoJCQloZWxwZXJzLmNhbnZhcy5saW5lVG8oY3R4LCBjdXJ2ZTFbaV0sIGN1cnZlMVtpIC0gMV0sIHRydWUpOw0KCQl9DQoJfQ0KDQoJZnVuY3Rpb24gZG9GaWxsKGN0eCwgcG9pbnRzLCBtYXBwZXIsIHZpZXcsIGNvbG9yLCBsb29wKSB7DQoJCXZhciBjb3VudCA9IHBvaW50cy5sZW5ndGg7DQoJCXZhciBzcGFuID0gdmlldy5zcGFuR2FwczsNCgkJdmFyIGN1cnZlMCA9IFtdOw0KCQl2YXIgY3VydmUxID0gW107DQoJCXZhciBsZW4wID0gMDsNCgkJdmFyIGxlbjEgPSAwOw0KCQl2YXIgaSwgaWxlbiwgaW5kZXgsIHAwLCBwMSwgZDAsIGQxOw0KDQoJCWN0eC5iZWdpblBhdGgoKTsNCg0KCQlmb3IgKGkgPSAwLCBpbGVuID0gKGNvdW50ICsgISFsb29wKTsgaSA8IGlsZW47ICsraSkgew0KCQkJaW5kZXggPSBpICUgY291bnQ7DQoJCQlwMCA9IHBvaW50c1tpbmRleF0uX3ZpZXc7DQoJCQlwMSA9IG1hcHBlcihwMCwgaW5kZXgsIHZpZXcpOw0KCQkJZDAgPSBpc0RyYXdhYmxlKHAwKTsNCgkJCWQxID0gaXNEcmF3YWJsZShwMSk7DQoNCgkJCWlmIChkMCAmJiBkMSkgew0KCQkJCWxlbjAgPSBjdXJ2ZTAucHVzaChwMCk7DQoJCQkJbGVuMSA9IGN1cnZlMS5wdXNoKHAxKTsNCgkJCX0gZWxzZSBpZiAobGVuMCAmJiBsZW4xKSB7DQoJCQkJaWYgKCFzcGFuKSB7DQoJCQkJCWRyYXdBcmVhKGN0eCwgY3VydmUwLCBjdXJ2ZTEsIGxlbjAsIGxlbjEpOw0KCQkJCQlsZW4wID0gbGVuMSA9IDA7DQoJCQkJCWN1cnZlMCA9IFtdOw0KCQkJCQljdXJ2ZTEgPSBbXTsNCgkJCQl9IGVsc2Ugew0KCQkJCQlpZiAoZDApIHsNCgkJCQkJCWN1cnZlMC5wdXNoKHAwKTsNCgkJCQkJfQ0KCQkJCQlpZiAoZDEpIHsNCgkJCQkJCWN1cnZlMS5wdXNoKHAxKTsNCgkJCQkJfQ0KCQkJCX0NCgkJCX0NCgkJfQ0KDQoJCWRyYXdBcmVhKGN0eCwgY3VydmUwLCBjdXJ2ZTEsIGxlbjAsIGxlbjEpOw0KDQoJCWN0eC5jbG9zZVBhdGgoKTsNCgkJY3R4LmZpbGxTdHlsZSA9IGNvbG9yOw0KCQljdHguZmlsbCgpOw0KCX0NCg0KCXJldHVybiB7DQoJCWlkOiAnZmlsbGVyJywNCg0KCQlhZnRlckRhdGFzZXRzVXBkYXRlOiBmdW5jdGlvbihjaGFydCwgb3B0aW9ucykgew0KCQkJdmFyIGNvdW50ID0gKGNoYXJ0LmRhdGEuZGF0YXNldHMgfHwgW10pLmxlbmd0aDsNCgkJCXZhciBwcm9wYWdhdGUgPSBvcHRpb25zLnByb3BhZ2F0ZTsNCgkJCXZhciBzb3VyY2VzID0gW107DQoJCQl2YXIgbWV0YSwgaSwgZWwsIHNvdXJjZTsNCg0KCQkJZm9yIChpID0gMDsgaSA8IGNvdW50OyArK2kpIHsNCgkJCQltZXRhID0gY2hhcnQuZ2V0RGF0YXNldE1ldGEoaSk7DQoJCQkJZWwgPSBtZXRhLmRhdGFzZXQ7DQoJCQkJc291cmNlID0gbnVsbDsNCg0KCQkJCWlmIChlbCAmJiBlbC5fbW9kZWwgJiYgZWwgaW5zdGFuY2VvZiBlbGVtZW50cy5MaW5lKSB7DQoJCQkJCXNvdXJjZSA9IHsNCgkJCQkJCXZpc2libGU6IGNoYXJ0LmlzRGF0YXNldFZpc2libGUoaSksDQoJCQkJCQlmaWxsOiBkZWNvZGVGaWxsKGVsLCBpLCBjb3VudCksDQoJCQkJCQljaGFydDogY2hhcnQsDQoJCQkJCQllbDogZWwNCgkJCQkJfTsNCgkJCQl9DQoNCgkJCQltZXRhLiRmaWxsZXIgPSBzb3VyY2U7DQoJCQkJc291cmNlcy5wdXNoKHNvdXJjZSk7DQoJCQl9DQoNCgkJCWZvciAoaSA9IDA7IGkgPCBjb3VudDsgKytpKSB7DQoJCQkJc291cmNlID0gc291cmNlc1tpXTsNCgkJCQlpZiAoIXNvdXJjZSkgew0KCQkJCQljb250aW51ZTsNCgkJCQl9DQoNCgkJCQlzb3VyY2UuZmlsbCA9IHJlc29sdmVUYXJnZXQoc291cmNlcywgaSwgcHJvcGFnYXRlKTsNCgkJCQlzb3VyY2UuYm91bmRhcnkgPSBjb21wdXRlQm91bmRhcnkoc291cmNlKTsNCgkJCQlzb3VyY2UubWFwcGVyID0gY3JlYXRlTWFwcGVyKHNvdXJjZSk7DQoJCQl9DQoJCX0sDQoNCgkJYmVmb3JlRGF0YXNldERyYXc6IGZ1bmN0aW9uKGNoYXJ0LCBhcmdzKSB7DQoJCQl2YXIgbWV0YSA9IGFyZ3MubWV0YS4kZmlsbGVyOw0KCQkJaWYgKCFtZXRhKSB7DQoJCQkJcmV0dXJuOw0KCQkJfQ0KDQoJCQl2YXIgY3R4ID0gY2hhcnQuY3R4Ow0KCQkJdmFyIGVsID0gbWV0YS5lbDsNCgkJCXZhciB2aWV3ID0gZWwuX3ZpZXc7DQoJCQl2YXIgcG9pbnRzID0gZWwuX2NoaWxkcmVuIHx8IFtdOw0KCQkJdmFyIG1hcHBlciA9IG1ldGEubWFwcGVyOw0KCQkJdmFyIGNvbG9yID0gdmlldy5iYWNrZ3JvdW5kQ29sb3IgfHwgZGVmYXVsdHMuZ2xvYmFsLmRlZmF1bHRDb2xvcjsNCg0KCQkJaWYgKG1hcHBlciAmJiBjb2xvciAmJiBwb2ludHMubGVuZ3RoKSB7DQoJCQkJaGVscGVycy5jYW52YXMuY2xpcEFyZWEoY3R4LCBjaGFydC5jaGFydEFyZWEpOw0KCQkJCWRvRmlsbChjdHgsIHBvaW50cywgbWFwcGVyLCB2aWV3LCBjb2xvciwgZWwuX2xvb3ApOw0KCQkJCWhlbHBlcnMuY2FudmFzLnVuY2xpcEFyZWEoY3R4KTsNCgkJCX0NCgkJfQ0KCX07DQp9Ow0KDQp9LHsiMjUiOjI1LCI0MCI6NDAsIjQ1Ijo0NX1dLDUwOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsNCid1c2Ugc3RyaWN0JzsNCg0KdmFyIGRlZmF1bHRzID0gcmVxdWlyZSgyNSk7DQp2YXIgRWxlbWVudCA9IHJlcXVpcmUoMjYpOw0KdmFyIGhlbHBlcnMgPSByZXF1aXJlKDQ1KTsNCg0KZGVmYXVsdHMuX3NldCgnZ2xvYmFsJywgew0KCWxlZ2VuZDogew0KCQlkaXNwbGF5OiB0cnVlLA0KCQlwb3NpdGlvbjogJ3RvcCcsDQoJCWZ1bGxXaWR0aDogdHJ1ZSwNCgkJcmV2ZXJzZTogZmFsc2UsDQoJCXdlaWdodDogMTAwMCwNCg0KCQkvLyBhIGNhbGxiYWNrIHRoYXQgd2lsbCBoYW5kbGUNCgkJb25DbGljazogZnVuY3Rpb24oZSwgbGVnZW5kSXRlbSkgew0KCQkJdmFyIGluZGV4ID0gbGVnZW5kSXRlbS5kYXRhc2V0SW5kZXg7DQoJCQl2YXIgY2kgPSB0aGlzLmNoYXJ0Ow0KCQkJdmFyIG1ldGEgPSBjaS5nZXREYXRhc2V0TWV0YShpbmRleCk7DQoNCgkJCS8vIFNlZSBjb250cm9sbGVyLmlzRGF0YXNldFZpc2libGUgY29tbWVudA0KCQkJbWV0YS5oaWRkZW4gPSBtZXRhLmhpZGRlbiA9PT0gbnVsbCA/ICFjaS5kYXRhLmRhdGFzZXRzW2luZGV4XS5oaWRkZW4gOiBudWxsOw0KDQoJCQkvLyBXZSBoaWQgYSBkYXRhc2V0IC4uLiByZXJlbmRlciB0aGUgY2hhcnQNCgkJCWNpLnVwZGF0ZSgpOw0KCQl9LA0KDQoJCW9uSG92ZXI6IG51bGwsDQoNCgkJbGFiZWxzOiB7DQoJCQlib3hXaWR0aDogNDAsDQoJCQlwYWRkaW5nOiAxMCwNCgkJCS8vIEdlbmVyYXRlcyBsYWJlbHMgc2hvd24gaW4gdGhlIGxlZ2VuZA0KCQkJLy8gVmFsaWQgcHJvcGVydGllcyB0byByZXR1cm46DQoJCQkvLyB0ZXh0IDogdGV4dCB0byBkaXNwbGF5DQoJCQkvLyBmaWxsU3R5bGUgOiBmaWxsIG9mIGNvbG91cmVkIGJveA0KCQkJLy8gc3Ryb2tlU3R5bGU6IHN0cm9rZSBvZiBjb2xvdXJlZCBib3gNCgkJCS8vIGhpZGRlbiA6IGlmIHRoaXMgbGVnZW5kIGl0ZW0gcmVmZXJzIHRvIGEgaGlkZGVuIGl0ZW0NCgkJCS8vIGxpbmVDYXAgOiBjYXAgc3R5bGUgZm9yIGxpbmUNCgkJCS8vIGxpbmVEYXNoDQoJCQkvLyBsaW5lRGFzaE9mZnNldCA6DQoJCQkvLyBsaW5lSm9pbiA6DQoJCQkvLyBsaW5lV2lkdGggOg0KCQkJZ2VuZXJhdGVMYWJlbHM6IGZ1bmN0aW9uKGNoYXJ0KSB7DQoJCQkJdmFyIGRhdGEgPSBjaGFydC5kYXRhOw0KCQkJCXJldHVybiBoZWxwZXJzLmlzQXJyYXkoZGF0YS5kYXRhc2V0cykgPyBkYXRhLmRhdGFzZXRzLm1hcChmdW5jdGlvbihkYXRhc2V0LCBpKSB7DQoJCQkJCXJldHVybiB7DQoJCQkJCQl0ZXh0OiBkYXRhc2V0LmxhYmVsLA0KCQkJCQkJZmlsbFN0eWxlOiAoIWhlbHBlcnMuaXNBcnJheShkYXRhc2V0LmJhY2tncm91bmRDb2xvcikgPyBkYXRhc2V0LmJhY2tncm91bmRDb2xvciA6IGRhdGFzZXQuYmFja2dyb3VuZENvbG9yWzBdKSwNCgkJCQkJCWhpZGRlbjogIWNoYXJ0LmlzRGF0YXNldFZpc2libGUoaSksDQoJCQkJCQlsaW5lQ2FwOiBkYXRhc2V0LmJvcmRlckNhcFN0eWxlLA0KCQkJCQkJbGluZURhc2g6IGRhdGFzZXQuYm9yZGVyRGFzaCwNCgkJCQkJCWxpbmVEYXNoT2Zmc2V0OiBkYXRhc2V0LmJvcmRlckRhc2hPZmZzZXQsDQoJCQkJCQlsaW5lSm9pbjogZGF0YXNldC5ib3JkZXJKb2luU3R5bGUsDQoJCQkJCQlsaW5lV2lkdGg6IGRhdGFzZXQuYm9yZGVyV2lkdGgsDQoJCQkJCQlzdHJva2VTdHlsZTogZGF0YXNldC5ib3JkZXJDb2xvciwNCgkJCQkJCXBvaW50U3R5bGU6IGRhdGFzZXQucG9pbnRTdHlsZSwNCg0KCQkJCQkJLy8gQmVsb3cgaXMgZXh0cmEgZGF0YSB1c2VkIGZvciB0b2dnbGluZyB0aGUgZGF0YXNldHMNCgkJCQkJCWRhdGFzZXRJbmRleDogaQ0KCQkJCQl9Ow0KCQkJCX0sIHRoaXMpIDogW107DQoJCQl9DQoJCX0NCgl9LA0KDQoJbGVnZW5kQ2FsbGJhY2s6IGZ1bmN0aW9uKGNoYXJ0KSB7DQoJCXZhciB0ZXh0ID0gW107DQoJCXRleHQucHVzaCgnPHVsIGNsYXNzPSInICsgY2hhcnQuaWQgKyAnLWxlZ2VuZCI+Jyk7DQoJCWZvciAodmFyIGkgPSAwOyBpIDwgY2hhcnQuZGF0YS5kYXRhc2V0cy5sZW5ndGg7IGkrKykgew0KCQkJdGV4dC5wdXNoKCc8bGk+PHNwYW4gc3R5bGU9ImJhY2tncm91bmQtY29sb3I6JyArIGNoYXJ0LmRhdGEuZGF0YXNldHNbaV0uYmFja2dyb3VuZENvbG9yICsgJyI+PC9zcGFuPicpOw0KCQkJaWYgKGNoYXJ0LmRhdGEuZGF0YXNldHNbaV0ubGFiZWwpIHsNCgkJCQl0ZXh0LnB1c2goY2hhcnQuZGF0YS5kYXRhc2V0c1tpXS5sYWJlbCk7DQoJCQl9DQoJCQl0ZXh0LnB1c2goJzwvbGk+Jyk7DQoJCX0NCgkJdGV4dC5wdXNoKCc8L3VsPicpOw0KCQlyZXR1cm4gdGV4dC5qb2luKCcnKTsNCgl9DQp9KTsNCg0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihDaGFydCkgew0KDQoJdmFyIGxheW91dCA9IENoYXJ0LmxheW91dFNlcnZpY2U7DQoJdmFyIG5vb3AgPSBoZWxwZXJzLm5vb3A7DQoNCgkvKioNCgkgKiBIZWxwZXIgZnVuY3Rpb24gdG8gZ2V0IHRoZSBib3ggd2lkdGggYmFzZWQgb24gdGhlIHVzZVBvaW50U3R5bGUgb3B0aW9uDQoJICogQHBhcmFtIGxhYmVsb3B0cyB7T2JqZWN0fSB0aGUgbGFiZWwgb3B0aW9ucyBvbiB0aGUgbGVnZW5kDQoJICogQHBhcmFtIGZvbnRTaXplIHtOdW1iZXJ9IHRoZSBsYWJlbCBmb250IHNpemUNCgkgKiBAcmV0dXJuIHtOdW1iZXJ9IHdpZHRoIG9mIHRoZSBjb2xvciBib3ggYXJlYQ0KCSAqLw0KCWZ1bmN0aW9uIGdldEJveFdpZHRoKGxhYmVsT3B0cywgZm9udFNpemUpIHsNCgkJcmV0dXJuIGxhYmVsT3B0cy51c2VQb2ludFN0eWxlID8NCgkJCWZvbnRTaXplICogTWF0aC5TUVJUMiA6DQoJCQlsYWJlbE9wdHMuYm94V2lkdGg7DQoJfQ0KDQoJQ2hhcnQuTGVnZW5kID0gRWxlbWVudC5leHRlbmQoew0KDQoJCWluaXRpYWxpemU6IGZ1bmN0aW9uKGNvbmZpZykgew0KCQkJaGVscGVycy5leHRlbmQodGhpcywgY29uZmlnKTsNCg0KCQkJLy8gQ29udGFpbnMgaGl0IGJveGVzIGZvciBlYWNoIGRhdGFzZXQgKGluIGRhdGFzZXQgb3JkZXIpDQoJCQl0aGlzLmxlZ2VuZEhpdEJveGVzID0gW107DQoNCgkJCS8vIEFyZSB3ZSBpbiBkb3VnaG51dCBtb2RlIHdoaWNoIGhhcyBhIGRpZmZlcmVudCBkYXRhIHR5cGUNCgkJCXRoaXMuZG91Z2hudXRNb2RlID0gZmFsc2U7DQoJCX0sDQoNCgkJLy8gVGhlc2UgbWV0aG9kcyBhcmUgb3JkZXJlZCBieSBsaWZlY3ljbGUuIFV0aWxpdGllcyB0aGVuIGZvbGxvdy4NCgkJLy8gQW55IGZ1bmN0aW9uIGRlZmluZWQgaGVyZSBpcyBpbmhlcml0ZWQgYnkgYWxsIGxlZ2VuZCB0eXBlcy4NCgkJLy8gQW55IGZ1bmN0aW9uIGNhbiBiZSBleHRlbmRlZCBieSB0aGUgbGVnZW5kIHR5cGUNCg0KCQliZWZvcmVVcGRhdGU6IG5vb3AsDQoJCXVwZGF0ZTogZnVuY3Rpb24obWF4V2lkdGgsIG1heEhlaWdodCwgbWFyZ2lucykgew0KCQkJdmFyIG1lID0gdGhpczsNCg0KCQkJLy8gVXBkYXRlIExpZmVjeWNsZSAtIFByb2JhYmx5IGRvbid0IHdhbnQgdG8gZXZlciBleHRlbmQgb3Igb3ZlcndyaXRlIHRoaXMgZnVuY3Rpb24gOykNCgkJCW1lLmJlZm9yZVVwZGF0ZSgpOw0KDQoJCQkvLyBBYnNvcmIgdGhlIG1hc3RlciBtZWFzdXJlbWVudHMNCgkJCW1lLm1heFdpZHRoID0gbWF4V2lkdGg7DQoJCQltZS5tYXhIZWlnaHQgPSBtYXhIZWlnaHQ7DQoJCQltZS5tYXJnaW5zID0gbWFyZ2luczsNCg0KCQkJLy8gRGltZW5zaW9ucw0KCQkJbWUuYmVmb3JlU2V0RGltZW5zaW9ucygpOw0KCQkJbWUuc2V0RGltZW5zaW9ucygpOw0KCQkJbWUuYWZ0ZXJTZXREaW1lbnNpb25zKCk7DQoJCQkvLyBMYWJlbHMNCgkJCW1lLmJlZm9yZUJ1aWxkTGFiZWxzKCk7DQoJCQltZS5idWlsZExhYmVscygpOw0KCQkJbWUuYWZ0ZXJCdWlsZExhYmVscygpOw0KDQoJCQkvLyBGaXQNCgkJCW1lLmJlZm9yZUZpdCgpOw0KCQkJbWUuZml0KCk7DQoJCQltZS5hZnRlckZpdCgpOw0KCQkJLy8NCgkJCW1lLmFmdGVyVXBkYXRlKCk7DQoNCgkJCXJldHVybiBtZS5taW5TaXplOw0KCQl9LA0KCQlhZnRlclVwZGF0ZTogbm9vcCwNCg0KCQkvLw0KDQoJCWJlZm9yZVNldERpbWVuc2lvbnM6IG5vb3AsDQoJCXNldERpbWVuc2lvbnM6IGZ1bmN0aW9uKCkgew0KCQkJdmFyIG1lID0gdGhpczsNCgkJCS8vIFNldCB0aGUgdW5jb25zdHJhaW5lZCBkaW1lbnNpb24gYmVmb3JlIGxhYmVsIHJvdGF0aW9uDQoJCQlpZiAobWUuaXNIb3Jpem9udGFsKCkpIHsNCgkJCQkvLyBSZXNldCBwb3NpdGlvbiBiZWZvcmUgY2FsY3VsYXRpbmcgcm90YXRpb24NCgkJCQltZS53aWR0aCA9IG1lLm1heFdpZHRoOw0KCQkJCW1lLmxlZnQgPSAwOw0KCQkJCW1lLnJpZ2h0ID0gbWUud2lkdGg7DQoJCQl9IGVsc2Ugew0KCQkJCW1lLmhlaWdodCA9IG1lLm1heEhlaWdodDsNCg0KCQkJCS8vIFJlc2V0IHBvc2l0aW9uIGJlZm9yZSBjYWxjdWxhdGluZyByb3RhdGlvbg0KCQkJCW1lLnRvcCA9IDA7DQoJCQkJbWUuYm90dG9tID0gbWUuaGVpZ2h0Ow0KCQkJfQ0KDQoJCQkvLyBSZXNldCBwYWRkaW5nDQoJCQltZS5wYWRkaW5nTGVmdCA9IDA7DQoJCQltZS5wYWRkaW5nVG9wID0gMDsNCgkJCW1lLnBhZGRpbmdSaWdodCA9IDA7DQoJCQltZS5wYWRkaW5nQm90dG9tID0gMDsNCg0KCQkJLy8gUmVzZXQgbWluU2l6ZQ0KCQkJbWUubWluU2l6ZSA9IHsNCgkJCQl3aWR0aDogMCwNCgkJCQloZWlnaHQ6IDANCgkJCX07DQoJCX0sDQoJCWFmdGVyU2V0RGltZW5zaW9uczogbm9vcCwNCg0KCQkvLw0KDQoJCWJlZm9yZUJ1aWxkTGFiZWxzOiBub29wLA0KCQlidWlsZExhYmVsczogZnVuY3Rpb24oKSB7DQoJCQl2YXIgbWUgPSB0aGlzOw0KCQkJdmFyIGxhYmVsT3B0cyA9IG1lLm9wdGlvbnMubGFiZWxzIHx8IHt9Ow0KCQkJdmFyIGxlZ2VuZEl0ZW1zID0gaGVscGVycy5jYWxsYmFjayhsYWJlbE9wdHMuZ2VuZXJhdGVMYWJlbHMsIFttZS5jaGFydF0sIG1lKSB8fCBbXTsNCg0KCQkJaWYgKGxhYmVsT3B0cy5maWx0ZXIpIHsNCgkJCQlsZWdlbmRJdGVtcyA9IGxlZ2VuZEl0ZW1zLmZpbHRlcihmdW5jdGlvbihpdGVtKSB7DQoJCQkJCXJldHVybiBsYWJlbE9wdHMuZmlsdGVyKGl0ZW0sIG1lLmNoYXJ0LmRhdGEpOw0KCQkJCX0pOw0KCQkJfQ0KDQoJCQlpZiAobWUub3B0aW9ucy5yZXZlcnNlKSB7DQoJCQkJbGVnZW5kSXRlbXMucmV2ZXJzZSgpOw0KCQkJfQ0KDQoJCQltZS5sZWdlbmRJdGVtcyA9IGxlZ2VuZEl0ZW1zOw0KCQl9LA0KCQlhZnRlckJ1aWxkTGFiZWxzOiBub29wLA0KDQoJCS8vDQoNCgkJYmVmb3JlRml0OiBub29wLA0KCQlmaXQ6IGZ1bmN0aW9uKCkgew0KCQkJdmFyIG1lID0gdGhpczsNCgkJCXZhciBvcHRzID0gbWUub3B0aW9uczsNCgkJCXZhciBsYWJlbE9wdHMgPSBvcHRzLmxhYmVsczsNCgkJCXZhciBkaXNwbGF5ID0gb3B0cy5kaXNwbGF5Ow0KDQoJCQl2YXIgY3R4ID0gbWUuY3R4Ow0KDQoJCQl2YXIgZ2xvYmFsRGVmYXVsdCA9IGRlZmF1bHRzLmdsb2JhbDsNCgkJCXZhciB2YWx1ZU9yRGVmYXVsdCA9IGhlbHBlcnMudmFsdWVPckRlZmF1bHQ7DQoJCQl2YXIgZm9udFNpemUgPSB2YWx1ZU9yRGVmYXVsdChsYWJlbE9wdHMuZm9udFNpemUsIGdsb2JhbERlZmF1bHQuZGVmYXVsdEZvbnRTaXplKTsNCgkJCXZhciBmb250U3R5bGUgPSB2YWx1ZU9yRGVmYXVsdChsYWJlbE9wdHMuZm9udFN0eWxlLCBnbG9iYWxEZWZhdWx0LmRlZmF1bHRGb250U3R5bGUpOw0KCQkJdmFyIGZvbnRGYW1pbHkgPSB2YWx1ZU9yRGVmYXVsdChsYWJlbE9wdHMuZm9udEZhbWlseSwgZ2xvYmFsRGVmYXVsdC5kZWZhdWx0Rm9udEZhbWlseSk7DQoJCQl2YXIgbGFiZWxGb250ID0gaGVscGVycy5mb250U3RyaW5nKGZvbnRTaXplLCBmb250U3R5bGUsIGZvbnRGYW1pbHkpOw0KDQoJCQkvLyBSZXNldCBoaXQgYm94ZXMNCgkJCXZhciBoaXRib3hlcyA9IG1lLmxlZ2VuZEhpdEJveGVzID0gW107DQoNCgkJCXZhciBtaW5TaXplID0gbWUubWluU2l6ZTsNCgkJCXZhciBpc0hvcml6b250YWwgPSBtZS5pc0hvcml6b250YWwoKTsNCg0KCQkJaWYgKGlzSG9yaXpvbnRhbCkgew0KCQkJCW1pblNpemUud2lkdGggPSBtZS5tYXhXaWR0aDsgLy8gZmlsbCBhbGwgdGhlIHdpZHRoDQoJCQkJbWluU2l6ZS5oZWlnaHQgPSBkaXNwbGF5ID8gMTAgOiAwOw0KCQkJfSBlbHNlIHsNCgkJCQltaW5TaXplLndpZHRoID0gZGlzcGxheSA/IDEwIDogMDsNCgkJCQltaW5TaXplLmhlaWdodCA9IG1lLm1heEhlaWdodDsgLy8gZmlsbCBhbGwgdGhlIGhlaWdodA0KCQkJfQ0KDQoJCQkvLyBJbmNyZWFzZSBzaXplcyBoZXJlDQoJCQlpZiAoZGlzcGxheSkgew0KCQkJCWN0eC5mb250ID0gbGFiZWxGb250Ow0KDQoJCQkJaWYgKGlzSG9yaXpvbnRhbCkgew0KCQkJCQkvLyBMYWJlbHMNCg0KCQkJCQkvLyBXaWR0aCBvZiBlYWNoIGxpbmUgb2YgbGVnZW5kIGJveGVzLiBMYWJlbHMgd3JhcCBvbnRvIG11bHRpcGxlIGxpbmVzIHdoZW4gdGhlcmUgYXJlIHRvbyBtYW55IHRvIGZpdCBvbiBvbmUNCgkJCQkJdmFyIGxpbmVXaWR0aHMgPSBtZS5saW5lV2lkdGhzID0gWzBdOw0KCQkJCQl2YXIgdG90YWxIZWlnaHQgPSBtZS5sZWdlbmRJdGVtcy5sZW5ndGggPyBmb250U2l6ZSArIChsYWJlbE9wdHMucGFkZGluZykgOiAwOw0KDQoJCQkJCWN0eC50ZXh0QWxpZ24gPSAnbGVmdCc7DQoJCQkJCWN0eC50ZXh0QmFzZWxpbmUgPSAndG9wJzsNCg0KCQkJCQloZWxwZXJzLmVhY2gobWUubGVnZW5kSXRlbXMsIGZ1bmN0aW9uKGxlZ2VuZEl0ZW0sIGkpIHsNCgkJCQkJCXZhciBib3hXaWR0aCA9IGdldEJveFdpZHRoKGxhYmVsT3B0cywgZm9udFNpemUpOw0KCQkJCQkJdmFyIHdpZHRoID0gYm94V2lkdGggKyAoZm9udFNpemUgLyAyKSArIGN0eC5tZWFzdXJlVGV4dChsZWdlbmRJdGVtLnRleHQpLndpZHRoOw0KDQoJCQkJCQlpZiAobGluZVdpZHRoc1tsaW5lV2lkdGhzLmxlbmd0aCAtIDFdICsgd2lkdGggKyBsYWJlbE9wdHMucGFkZGluZyA+PSBtZS53aWR0aCkgew0KCQkJCQkJCXRvdGFsSGVpZ2h0ICs9IGZvbnRTaXplICsgKGxhYmVsT3B0cy5wYWRkaW5nKTsNCgkJCQkJCQlsaW5lV2lkdGhzW2xpbmVXaWR0aHMubGVuZ3RoXSA9IG1lLmxlZnQ7DQoJCQkJCQl9DQoNCgkJCQkJCS8vIFN0b3JlIHRoZSBoaXRib3ggd2lkdGggYW5kIGhlaWdodCBoZXJlLiBGaW5hbCBwb3NpdGlvbiB3aWxsIGJlIHVwZGF0ZWQgaW4gYGRyYXdgDQoJCQkJCQloaXRib3hlc1tpXSA9IHsNCgkJCQkJCQlsZWZ0OiAwLA0KCQkJCQkJCXRvcDogMCwNCgkJCQkJCQl3aWR0aDogd2lkdGgsDQoJCQkJCQkJaGVpZ2h0OiBmb250U2l6ZQ0KCQkJCQkJfTsNCg0KCQkJCQkJbGluZVdpZHRoc1tsaW5lV2lkdGhzLmxlbmd0aCAtIDFdICs9IHdpZHRoICsgbGFiZWxPcHRzLnBhZGRpbmc7DQoJCQkJCX0pOw0KDQoJCQkJCW1pblNpemUuaGVpZ2h0ICs9IHRvdGFsSGVpZ2h0Ow0KDQoJCQkJfSBlbHNlIHsNCgkJCQkJdmFyIHZQYWRkaW5nID0gbGFiZWxPcHRzLnBhZGRpbmc7DQoJCQkJCXZhciBjb2x1bW5XaWR0aHMgPSBtZS5jb2x1bW5XaWR0aHMgPSBbXTsNCgkJCQkJdmFyIHRvdGFsV2lkdGggPSBsYWJlbE9wdHMucGFkZGluZzsNCgkJCQkJdmFyIGN1cnJlbnRDb2xXaWR0aCA9IDA7DQoJCQkJCXZhciBjdXJyZW50Q29sSGVpZ2h0ID0gMDsNCgkJCQkJdmFyIGl0ZW1IZWlnaHQgPSBmb250U2l6ZSArIHZQYWRkaW5nOw0KDQoJCQkJCWhlbHBlcnMuZWFjaChtZS5sZWdlbmRJdGVtcywgZnVuY3Rpb24obGVnZW5kSXRlbSwgaSkgew0KCQkJCQkJdmFyIGJveFdpZHRoID0gZ2V0Qm94V2lkdGgobGFiZWxPcHRzLCBmb250U2l6ZSk7DQoJCQkJCQl2YXIgaXRlbVdpZHRoID0gYm94V2lkdGggKyAoZm9udFNpemUgLyAyKSArIGN0eC5tZWFzdXJlVGV4dChsZWdlbmRJdGVtLnRleHQpLndpZHRoOw0KDQoJCQkJCQkvLyBJZiB0b28gdGFsbCwgZ28gdG8gbmV3IGNvbHVtbg0KCQkJCQkJaWYgKGN1cnJlbnRDb2xIZWlnaHQgKyBpdGVtSGVpZ2h0ID4gbWluU2l6ZS5oZWlnaHQpIHsNCgkJCQkJCQl0b3RhbFdpZHRoICs9IGN1cnJlbnRDb2xXaWR0aCArIGxhYmVsT3B0cy5wYWRkaW5nOw0KCQkJCQkJCWNvbHVtbldpZHRocy5wdXNoKGN1cnJlbnRDb2xXaWR0aCk7IC8vIHByZXZpb3VzIGNvbHVtbiB3aWR0aA0KDQoJCQkJCQkJY3VycmVudENvbFdpZHRoID0gMDsNCgkJCQkJCQljdXJyZW50Q29sSGVpZ2h0ID0gMDsNCgkJCQkJCX0NCg0KCQkJCQkJLy8gR2V0IG1heCB3aWR0aA0KCQkJCQkJY3VycmVudENvbFdpZHRoID0gTWF0aC5tYXgoY3VycmVudENvbFdpZHRoLCBpdGVtV2lkdGgpOw0KCQkJCQkJY3VycmVudENvbEhlaWdodCArPSBpdGVtSGVpZ2h0Ow0KDQoJCQkJCQkvLyBTdG9yZSB0aGUgaGl0Ym94IHdpZHRoIGFuZCBoZWlnaHQgaGVyZS4gRmluYWwgcG9zaXRpb24gd2lsbCBiZSB1cGRhdGVkIGluIGBkcmF3YA0KCQkJCQkJaGl0Ym94ZXNbaV0gPSB7DQoJCQkJCQkJbGVmdDogMCwNCgkJCQkJCQl0b3A6IDAsDQoJCQkJCQkJd2lkdGg6IGl0ZW1XaWR0aCwNCgkJCQkJCQloZWlnaHQ6IGZvbnRTaXplDQoJCQkJCQl9Ow0KCQkJCQl9KTsNCg0KCQkJCQl0b3RhbFdpZHRoICs9IGN1cnJlbnRDb2xXaWR0aDsNCgkJCQkJY29sdW1uV2lkdGhzLnB1c2goY3VycmVudENvbFdpZHRoKTsNCgkJCQkJbWluU2l6ZS53aWR0aCArPSB0b3RhbFdpZHRoOw0KCQkJCX0NCgkJCX0NCg0KCQkJbWUud2lkdGggPSBtaW5TaXplLndpZHRoOw0KCQkJbWUuaGVpZ2h0ID0gbWluU2l6ZS5oZWlnaHQ7DQoJCX0sDQoJCWFmdGVyRml0OiBub29wLA0KDQoJCS8vIFNoYXJlZCBNZXRob2RzDQoJCWlzSG9yaXpvbnRhbDogZnVuY3Rpb24oKSB7DQoJCQlyZXR1cm4gdGhpcy5vcHRpb25zLnBvc2l0aW9uID09PSAndG9wJyB8fCB0aGlzLm9wdGlvbnMucG9zaXRpb24gPT09ICdib3R0b20nOw0KCQl9LA0KDQoJCS8vIEFjdHVhbGx5IGRyYXcgdGhlIGxlZ2VuZCBvbiB0aGUgY2FudmFzDQoJCWRyYXc6IGZ1bmN0aW9uKCkgew0KCQkJdmFyIG1lID0gdGhpczsNCgkJCXZhciBvcHRzID0gbWUub3B0aW9uczsNCgkJCXZhciBsYWJlbE9wdHMgPSBvcHRzLmxhYmVsczsNCgkJCXZhciBnbG9iYWxEZWZhdWx0ID0gZGVmYXVsdHMuZ2xvYmFsOw0KCQkJdmFyIGxpbmVEZWZhdWx0ID0gZ2xvYmFsRGVmYXVsdC5lbGVtZW50cy5saW5lOw0KCQkJdmFyIGxlZ2VuZFdpZHRoID0gbWUud2lkdGg7DQoJCQl2YXIgbGluZVdpZHRocyA9IG1lLmxpbmVXaWR0aHM7DQoNCgkJCWlmIChvcHRzLmRpc3BsYXkpIHsNCgkJCQl2YXIgY3R4ID0gbWUuY3R4Ow0KCQkJCXZhciB2YWx1ZU9yRGVmYXVsdCA9IGhlbHBlcnMudmFsdWVPckRlZmF1bHQ7DQoJCQkJdmFyIGZvbnRDb2xvciA9IHZhbHVlT3JEZWZhdWx0KGxhYmVsT3B0cy5mb250Q29sb3IsIGdsb2JhbERlZmF1bHQuZGVmYXVsdEZvbnRDb2xvcik7DQoJCQkJdmFyIGZvbnRTaXplID0gdmFsdWVPckRlZmF1bHQobGFiZWxPcHRzLmZvbnRTaXplLCBnbG9iYWxEZWZhdWx0LmRlZmF1bHRGb250U2l6ZSk7DQoJCQkJdmFyIGZvbnRTdHlsZSA9IHZhbHVlT3JEZWZhdWx0KGxhYmVsT3B0cy5mb250U3R5bGUsIGdsb2JhbERlZmF1bHQuZGVmYXVsdEZvbnRTdHlsZSk7DQoJCQkJdmFyIGZvbnRGYW1pbHkgPSB2YWx1ZU9yRGVmYXVsdChsYWJlbE9wdHMuZm9udEZhbWlseSwgZ2xvYmFsRGVmYXVsdC5kZWZhdWx0Rm9udEZhbWlseSk7DQoJCQkJdmFyIGxhYmVsRm9udCA9IGhlbHBlcnMuZm9udFN0cmluZyhmb250U2l6ZSwgZm9udFN0eWxlLCBmb250RmFtaWx5KTsNCgkJCQl2YXIgY3Vyc29yOw0KDQoJCQkJLy8gQ2FudmFzIHNldHVwDQoJCQkJY3R4LnRleHRBbGlnbiA9ICdsZWZ0JzsNCgkJCQljdHgudGV4dEJhc2VsaW5lID0gJ21pZGRsZSc7DQoJCQkJY3R4LmxpbmVXaWR0aCA9IDAuNTsNCgkJCQljdHguc3Ryb2tlU3R5bGUgPSBmb250Q29sb3I7IC8vIGZvciBzdHJpa2V0aHJvdWdoIGVmZmVjdA0KCQkJCWN0eC5maWxsU3R5bGUgPSBmb250Q29sb3I7IC8vIHJlbmRlciBpbiBjb3JyZWN0IGNvbG91cg0KCQkJCWN0eC5mb250ID0gbGFiZWxGb250Ow0KDQoJCQkJdmFyIGJveFdpZHRoID0gZ2V0Qm94V2lkdGgobGFiZWxPcHRzLCBmb250U2l6ZSk7DQoJCQkJdmFyIGhpdGJveGVzID0gbWUubGVnZW5kSGl0Qm94ZXM7DQoNCgkJCQkvLyBjdXJyZW50IHBvc2l0aW9uDQoJCQkJdmFyIGRyYXdMZWdlbmRCb3ggPSBmdW5jdGlvbih4LCB5LCBsZWdlbmRJdGVtKSB7DQoJCQkJCWlmIChpc05hTihib3hXaWR0aCkgfHwgYm94V2lkdGggPD0gMCkgew0KCQkJCQkJcmV0dXJuOw0KCQkJCQl9DQoNCgkJCQkJLy8gU2V0IHRoZSBjdHggZm9yIHRoZSBib3gNCgkJCQkJY3R4LnNhdmUoKTsNCg0KCQkJCQljdHguZmlsbFN0eWxlID0gdmFsdWVPckRlZmF1bHQobGVnZW5kSXRlbS5maWxsU3R5bGUsIGdsb2JhbERlZmF1bHQuZGVmYXVsdENvbG9yKTsNCgkJCQkJY3R4LmxpbmVDYXAgPSB2YWx1ZU9yRGVmYXVsdChsZWdlbmRJdGVtLmxpbmVDYXAsIGxpbmVEZWZhdWx0LmJvcmRlckNhcFN0eWxlKTsNCgkJCQkJY3R4LmxpbmVEYXNoT2Zmc2V0ID0gdmFsdWVPckRlZmF1bHQobGVnZW5kSXRlbS5saW5lRGFzaE9mZnNldCwgbGluZURlZmF1bHQuYm9yZGVyRGFzaE9mZnNldCk7DQoJCQkJCWN0eC5saW5lSm9pbiA9IHZhbHVlT3JEZWZhdWx0KGxlZ2VuZEl0ZW0ubGluZUpvaW4sIGxpbmVEZWZhdWx0LmJvcmRlckpvaW5TdHlsZSk7DQoJCQkJCWN0eC5saW5lV2lkdGggPSB2YWx1ZU9yRGVmYXVsdChsZWdlbmRJdGVtLmxpbmVXaWR0aCwgbGluZURlZmF1bHQuYm9yZGVyV2lkdGgpOw0KCQkJCQljdHguc3Ryb2tlU3R5bGUgPSB2YWx1ZU9yRGVmYXVsdChsZWdlbmRJdGVtLnN0cm9rZVN0eWxlLCBnbG9iYWxEZWZhdWx0LmRlZmF1bHRDb2xvcik7DQoJCQkJCXZhciBpc0xpbmVXaWR0aFplcm8gPSAodmFsdWVPckRlZmF1bHQobGVnZW5kSXRlbS5saW5lV2lkdGgsIGxpbmVEZWZhdWx0LmJvcmRlcldpZHRoKSA9PT0gMCk7DQoNCgkJCQkJaWYgKGN0eC5zZXRMaW5lRGFzaCkgew0KCQkJCQkJLy8gSUUgOSBhbmQgMTAgZG8gbm90IHN1cHBvcnQgbGluZSBkYXNoDQoJCQkJCQljdHguc2V0TGluZURhc2godmFsdWVPckRlZmF1bHQobGVnZW5kSXRlbS5saW5lRGFzaCwgbGluZURlZmF1bHQuYm9yZGVyRGFzaCkpOw0KCQkJCQl9DQoNCgkJCQkJaWYgKG9wdHMubGFiZWxzICYmIG9wdHMubGFiZWxzLnVzZVBvaW50U3R5bGUpIHsNCgkJCQkJCS8vIFJlY2FsY3VsYXRlIHggYW5kIHkgZm9yIGRyYXdQb2ludCgpIGJlY2F1c2UgaXRzIGV4cGVjdGluZw0KCQkJCQkJLy8geCBhbmQgeSB0byBiZSBjZW50ZXIgb2YgZmlndXJlIChpbnN0ZWFkIG9mIHRvcCBsZWZ0KQ0KCQkJCQkJdmFyIHJhZGl1cyA9IGZvbnRTaXplICogTWF0aC5TUVJUMiAvIDI7DQoJCQkJCQl2YXIgb2ZmU2V0ID0gcmFkaXVzIC8gTWF0aC5TUVJUMjsNCgkJCQkJCXZhciBjZW50ZXJYID0geCArIG9mZlNldDsNCgkJCQkJCXZhciBjZW50ZXJZID0geSArIG9mZlNldDsNCg0KCQkJCQkJLy8gRHJhdyBwb2ludFN0eWxlIGFzIGxlZ2VuZCBzeW1ib2wNCgkJCQkJCWhlbHBlcnMuY2FudmFzLmRyYXdQb2ludChjdHgsIGxlZ2VuZEl0ZW0ucG9pbnRTdHlsZSwgcmFkaXVzLCBjZW50ZXJYLCBjZW50ZXJZKTsNCgkJCQkJfSBlbHNlIHsNCgkJCQkJCS8vIERyYXcgYm94IGFzIGxlZ2VuZCBzeW1ib2wNCgkJCQkJCWlmICghaXNMaW5lV2lkdGhaZXJvKSB7DQoJCQkJCQkJY3R4LnN0cm9rZVJlY3QoeCwgeSwgYm94V2lkdGgsIGZvbnRTaXplKTsNCgkJCQkJCX0NCgkJCQkJCWN0eC5maWxsUmVjdCh4LCB5LCBib3hXaWR0aCwgZm9udFNpemUpOw0KCQkJCQl9DQoNCgkJCQkJY3R4LnJlc3RvcmUoKTsNCgkJCQl9Ow0KCQkJCXZhciBmaWxsVGV4dCA9IGZ1bmN0aW9uKHgsIHksIGxlZ2VuZEl0ZW0sIHRleHRXaWR0aCkgew0KCQkJCQl2YXIgaGFsZkZvbnRTaXplID0gZm9udFNpemUgLyAyOw0KCQkJCQl2YXIgeExlZnQgPSBib3hXaWR0aCArIGhhbGZGb250U2l6ZSArIHg7DQoJCQkJCXZhciB5TWlkZGxlID0geSArIGhhbGZGb250U2l6ZTsNCg0KCQkJCQljdHguZmlsbFRleHQobGVnZW5kSXRlbS50ZXh0LCB4TGVmdCwgeU1pZGRsZSk7DQoNCgkJCQkJaWYgKGxlZ2VuZEl0ZW0uaGlkZGVuKSB7DQoJCQkJCQkvLyBTdHJpa2V0aHJvdWdoIHRoZSB0ZXh0IGlmIGhpZGRlbg0KCQkJCQkJY3R4LmJlZ2luUGF0aCgpOw0KCQkJCQkJY3R4LmxpbmVXaWR0aCA9IDI7DQoJCQkJCQljdHgubW92ZVRvKHhMZWZ0LCB5TWlkZGxlKTsNCgkJCQkJCWN0eC5saW5lVG8oeExlZnQgKyB0ZXh0V2lkdGgsIHlNaWRkbGUpOw0KCQkJCQkJY3R4LnN0cm9rZSgpOw0KCQkJCQl9DQoJCQkJfTsNCg0KCQkJCS8vIEhvcml6b250YWwNCgkJCQl2YXIgaXNIb3Jpem9udGFsID0gbWUuaXNIb3Jpem9udGFsKCk7DQoJCQkJaWYgKGlzSG9yaXpvbnRhbCkgew0KCQkJCQljdXJzb3IgPSB7DQoJCQkJCQl4OiBtZS5sZWZ0ICsgKChsZWdlbmRXaWR0aCAtIGxpbmVXaWR0aHNbMF0pIC8gMiksDQoJCQkJCQl5OiBtZS50b3AgKyBsYWJlbE9wdHMucGFkZGluZywNCgkJCQkJCWxpbmU6IDANCgkJCQkJfTsNCgkJCQl9IGVsc2Ugew0KCQkJCQljdXJzb3IgPSB7DQoJCQkJCQl4OiBtZS5sZWZ0ICsgbGFiZWxPcHRzLnBhZGRpbmcsDQoJCQkJCQl5OiBtZS50b3AgKyBsYWJlbE9wdHMucGFkZGluZywNCgkJCQkJCWxpbmU6IDANCgkJCQkJfTsNCgkJCQl9DQoNCgkJCQl2YXIgaXRlbUhlaWdodCA9IGZvbnRTaXplICsgbGFiZWxPcHRzLnBhZGRpbmc7DQoJCQkJaGVscGVycy5lYWNoKG1lLmxlZ2VuZEl0ZW1zLCBmdW5jdGlvbihsZWdlbmRJdGVtLCBpKSB7DQoJCQkJCXZhciB0ZXh0V2lkdGggPSBjdHgubWVhc3VyZVRleHQobGVnZW5kSXRlbS50ZXh0KS53aWR0aDsNCgkJCQkJdmFyIHdpZHRoID0gYm94V2lkdGggKyAoZm9udFNpemUgLyAyKSArIHRleHRXaWR0aDsNCgkJCQkJdmFyIHggPSBjdXJzb3IueDsNCgkJCQkJdmFyIHkgPSBjdXJzb3IueTsNCg0KCQkJCQlpZiAoaXNIb3Jpem9udGFsKSB7DQoJCQkJCQlpZiAoeCArIHdpZHRoID49IGxlZ2VuZFdpZHRoKSB7DQoJCQkJCQkJeSA9IGN1cnNvci55ICs9IGl0ZW1IZWlnaHQ7DQoJCQkJCQkJY3Vyc29yLmxpbmUrKzsNCgkJCQkJCQl4ID0gY3Vyc29yLnggPSBtZS5sZWZ0ICsgKChsZWdlbmRXaWR0aCAtIGxpbmVXaWR0aHNbY3Vyc29yLmxpbmVdKSAvIDIpOw0KCQkJCQkJfQ0KCQkJCQl9IGVsc2UgaWYgKHkgKyBpdGVtSGVpZ2h0ID4gbWUuYm90dG9tKSB7DQoJCQkJCQl4ID0gY3Vyc29yLnggPSB4ICsgbWUuY29sdW1uV2lkdGhzW2N1cnNvci5saW5lXSArIGxhYmVsT3B0cy5wYWRkaW5nOw0KCQkJCQkJeSA9IGN1cnNvci55ID0gbWUudG9wICsgbGFiZWxPcHRzLnBhZGRpbmc7DQoJCQkJCQljdXJzb3IubGluZSsrOw0KCQkJCQl9DQoNCgkJCQkJZHJhd0xlZ2VuZEJveCh4LCB5LCBsZWdlbmRJdGVtKTsNCg0KCQkJCQloaXRib3hlc1tpXS5sZWZ0ID0geDsNCgkJCQkJaGl0Ym94ZXNbaV0udG9wID0geTsNCg0KCQkJCQkvLyBGaWxsIHRoZSBhY3R1YWwgbGFiZWwNCgkJCQkJZmlsbFRleHQoeCwgeSwgbGVnZW5kSXRlbSwgdGV4dFdpZHRoKTsNCg0KCQkJCQlpZiAoaXNIb3Jpem9udGFsKSB7DQoJCQkJCQljdXJzb3IueCArPSB3aWR0aCArIChsYWJlbE9wdHMucGFkZGluZyk7DQoJCQkJCX0gZWxzZSB7DQoJCQkJCQljdXJzb3IueSArPSBpdGVtSGVpZ2h0Ow0KCQkJCQl9DQoNCgkJCQl9KTsNCgkJCX0NCgkJfSwNCg0KCQkvKioNCgkJICogSGFuZGxlIGFuIGV2ZW50DQoJCSAqIEBwcml2YXRlDQoJCSAqIEBwYXJhbSB7SUV2ZW50fSBldmVudCAtIFRoZSBldmVudCB0byBoYW5kbGUNCgkJICogQHJldHVybiB7Qm9vbGVhbn0gdHJ1ZSBpZiBhIGNoYW5nZSBvY2N1cmVkDQoJCSAqLw0KCQloYW5kbGVFdmVudDogZnVuY3Rpb24oZSkgew0KCQkJdmFyIG1lID0gdGhpczsNCgkJCXZhciBvcHRzID0gbWUub3B0aW9uczsNCgkJCXZhciB0eXBlID0gZS50eXBlID09PSAnbW91c2V1cCcgPyAnY2xpY2snIDogZS50eXBlOw0KCQkJdmFyIGNoYW5nZWQgPSBmYWxzZTsNCg0KCQkJaWYgKHR5cGUgPT09ICdtb3VzZW1vdmUnKSB7DQoJCQkJaWYgKCFvcHRzLm9uSG92ZXIpIHsNCgkJCQkJcmV0dXJuOw0KCQkJCX0NCgkJCX0gZWxzZSBpZiAodHlwZSA9PT0gJ2NsaWNrJykgew0KCQkJCWlmICghb3B0cy5vbkNsaWNrKSB7DQoJCQkJCXJldHVybjsNCgkJCQl9DQoJCQl9IGVsc2Ugew0KCQkJCXJldHVybjsNCgkJCX0NCg0KCQkJLy8gQ2hhcnQgZXZlbnQgYWxyZWFkeSBoYXMgcmVsYXRpdmUgcG9zaXRpb24gaW4gaXQNCgkJCXZhciB4ID0gZS54Ow0KCQkJdmFyIHkgPSBlLnk7DQoNCgkJCWlmICh4ID49IG1lLmxlZnQgJiYgeCA8PSBtZS5yaWdodCAmJiB5ID49IG1lLnRvcCAmJiB5IDw9IG1lLmJvdHRvbSkgew0KCQkJCS8vIFNlZSBpZiB3ZSBhcmUgdG91Y2hpbmcgb25lIG9mIHRoZSBkYXRhc2V0IGJveGVzDQoJCQkJdmFyIGxoID0gbWUubGVnZW5kSGl0Qm94ZXM7DQoJCQkJZm9yICh2YXIgaSA9IDA7IGkgPCBsaC5sZW5ndGg7ICsraSkgew0KCQkJCQl2YXIgaGl0Qm94ID0gbGhbaV07DQoNCgkJCQkJaWYgKHggPj0gaGl0Qm94LmxlZnQgJiYgeCA8PSBoaXRCb3gubGVmdCArIGhpdEJveC53aWR0aCAmJiB5ID49IGhpdEJveC50b3AgJiYgeSA8PSBoaXRCb3gudG9wICsgaGl0Qm94LmhlaWdodCkgew0KCQkJCQkJLy8gVG91Y2hpbmcgYW4gZWxlbWVudA0KCQkJCQkJaWYgKHR5cGUgPT09ICdjbGljaycpIHsNCgkJCQkJCQkvLyB1c2UgZS5uYXRpdmUgZm9yIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5DQoJCQkJCQkJb3B0cy5vbkNsaWNrLmNhbGwobWUsIGUubmF0aXZlLCBtZS5sZWdlbmRJdGVtc1tpXSk7DQoJCQkJCQkJY2hhbmdlZCA9IHRydWU7DQoJCQkJCQkJYnJlYWs7DQoJCQkJCQl9IGVsc2UgaWYgKHR5cGUgPT09ICdtb3VzZW1vdmUnKSB7DQoJCQkJCQkJLy8gdXNlIGUubmF0aXZlIGZvciBiYWNrd2FyZHMgY29tcGF0aWJpbGl0eQ0KCQkJCQkJCW9wdHMub25Ib3Zlci5jYWxsKG1lLCBlLm5hdGl2ZSwgbWUubGVnZW5kSXRlbXNbaV0pOw0KCQkJCQkJCWNoYW5nZWQgPSB0cnVlOw0KCQkJCQkJCWJyZWFrOw0KCQkJCQkJfQ0KCQkJCQl9DQoJCQkJfQ0KCQkJfQ0KDQoJCQlyZXR1cm4gY2hhbmdlZDsNCgkJfQ0KCX0pOw0KDQoJZnVuY3Rpb24gY3JlYXRlTmV3TGVnZW5kQW5kQXR0YWNoKGNoYXJ0LCBsZWdlbmRPcHRzKSB7DQoJCXZhciBsZWdlbmQgPSBuZXcgQ2hhcnQuTGVnZW5kKHsNCgkJCWN0eDogY2hhcnQuY3R4LA0KCQkJb3B0aW9uczogbGVnZW5kT3B0cywNCgkJCWNoYXJ0OiBjaGFydA0KCQl9KTsNCg0KCQlsYXlvdXQuY29uZmlndXJlKGNoYXJ0LCBsZWdlbmQsIGxlZ2VuZE9wdHMpOw0KCQlsYXlvdXQuYWRkQm94KGNoYXJ0LCBsZWdlbmQpOw0KCQljaGFydC5sZWdlbmQgPSBsZWdlbmQ7DQoJfQ0KDQoJcmV0dXJuIHsNCgkJaWQ6ICdsZWdlbmQnLA0KDQoJCWJlZm9yZUluaXQ6IGZ1bmN0aW9uKGNoYXJ0KSB7DQoJCQl2YXIgbGVnZW5kT3B0cyA9IGNoYXJ0Lm9wdGlvbnMubGVnZW5kOw0KDQoJCQlpZiAobGVnZW5kT3B0cykgew0KCQkJCWNyZWF0ZU5ld0xlZ2VuZEFuZEF0dGFjaChjaGFydCwgbGVnZW5kT3B0cyk7DQoJCQl9DQoJCX0sDQoNCgkJYmVmb3JlVXBkYXRlOiBmdW5jdGlvbihjaGFydCkgew0KCQkJdmFyIGxlZ2VuZE9wdHMgPSBjaGFydC5vcHRpb25zLmxlZ2VuZDsNCgkJCXZhciBsZWdlbmQgPSBjaGFydC5sZWdlbmQ7DQoNCgkJCWlmIChsZWdlbmRPcHRzKSB7DQoJCQkJaGVscGVycy5tZXJnZUlmKGxlZ2VuZE9wdHMsIGRlZmF1bHRzLmdsb2JhbC5sZWdlbmQpOw0KDQoJCQkJaWYgKGxlZ2VuZCkgew0KCQkJCQlsYXlvdXQuY29uZmlndXJlKGNoYXJ0LCBsZWdlbmQsIGxlZ2VuZE9wdHMpOw0KCQkJCQlsZWdlbmQub3B0aW9ucyA9IGxlZ2VuZE9wdHM7DQoJCQkJfSBlbHNlIHsNCgkJCQkJY3JlYXRlTmV3TGVnZW5kQW5kQXR0YWNoKGNoYXJ0LCBsZWdlbmRPcHRzKTsNCgkJCQl9DQoJCQl9IGVsc2UgaWYgKGxlZ2VuZCkgew0KCQkJCWxheW91dC5yZW1vdmVCb3goY2hhcnQsIGxlZ2VuZCk7DQoJCQkJZGVsZXRlIGNoYXJ0LmxlZ2VuZDsNCgkJCX0NCgkJfSwNCg0KCQlhZnRlckV2ZW50OiBmdW5jdGlvbihjaGFydCwgZSkgew0KCQkJdmFyIGxlZ2VuZCA9IGNoYXJ0LmxlZ2VuZDsNCgkJCWlmIChsZWdlbmQpIHsNCgkJCQlsZWdlbmQuaGFuZGxlRXZlbnQoZSk7DQoJCQl9DQoJCX0NCgl9Ow0KfTsNCg0KfSx7IjI1IjoyNSwiMjYiOjI2LCI0NSI6NDV9XSw1MTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7DQondXNlIHN0cmljdCc7DQoNCnZhciBkZWZhdWx0cyA9IHJlcXVpcmUoMjUpOw0KdmFyIEVsZW1lbnQgPSByZXF1aXJlKDI2KTsNCnZhciBoZWxwZXJzID0gcmVxdWlyZSg0NSk7DQoNCmRlZmF1bHRzLl9zZXQoJ2dsb2JhbCcsIHsNCgl0aXRsZTogew0KCQlkaXNwbGF5OiBmYWxzZSwNCgkJZm9udFN0eWxlOiAnYm9sZCcsDQoJCWZ1bGxXaWR0aDogdHJ1ZSwNCgkJbGluZUhlaWdodDogMS4yLA0KCQlwYWRkaW5nOiAxMCwNCgkJcG9zaXRpb246ICd0b3AnLA0KCQl0ZXh0OiAnJywNCgkJd2VpZ2h0OiAyMDAwICAgICAgICAgLy8gYnkgZGVmYXVsdCBncmVhdGVyIHRoYW4gbGVnZW5kICgxMDAwKSB0byBiZSBhYm92ZQ0KCX0NCn0pOw0KDQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKENoYXJ0KSB7DQoNCgl2YXIgbGF5b3V0ID0gQ2hhcnQubGF5b3V0U2VydmljZTsNCgl2YXIgbm9vcCA9IGhlbHBlcnMubm9vcDsNCg0KCUNoYXJ0LlRpdGxlID0gRWxlbWVudC5leHRlbmQoew0KCQlpbml0aWFsaXplOiBmdW5jdGlvbihjb25maWcpIHsNCgkJCXZhciBtZSA9IHRoaXM7DQoJCQloZWxwZXJzLmV4dGVuZChtZSwgY29uZmlnKTsNCg0KCQkJLy8gQ29udGFpbnMgaGl0IGJveGVzIGZvciBlYWNoIGRhdGFzZXQgKGluIGRhdGFzZXQgb3JkZXIpDQoJCQltZS5sZWdlbmRIaXRCb3hlcyA9IFtdOw0KCQl9LA0KDQoJCS8vIFRoZXNlIG1ldGhvZHMgYXJlIG9yZGVyZWQgYnkgbGlmZWN5Y2xlLiBVdGlsaXRpZXMgdGhlbiBmb2xsb3cuDQoNCgkJYmVmb3JlVXBkYXRlOiBub29wLA0KCQl1cGRhdGU6IGZ1bmN0aW9uKG1heFdpZHRoLCBtYXhIZWlnaHQsIG1hcmdpbnMpIHsNCgkJCXZhciBtZSA9IHRoaXM7DQoNCgkJCS8vIFVwZGF0ZSBMaWZlY3ljbGUgLSBQcm9iYWJseSBkb24ndCB3YW50IHRvIGV2ZXIgZXh0ZW5kIG9yIG92ZXJ3cml0ZSB0aGlzIGZ1bmN0aW9uIDspDQoJCQltZS5iZWZvcmVVcGRhdGUoKTsNCg0KCQkJLy8gQWJzb3JiIHRoZSBtYXN0ZXIgbWVhc3VyZW1lbnRzDQoJCQltZS5tYXhXaWR0aCA9IG1heFdpZHRoOw0KCQkJbWUubWF4SGVpZ2h0ID0gbWF4SGVpZ2h0Ow0KCQkJbWUubWFyZ2lucyA9IG1hcmdpbnM7DQoNCgkJCS8vIERpbWVuc2lvbnMNCgkJCW1lLmJlZm9yZVNldERpbWVuc2lvbnMoKTsNCgkJCW1lLnNldERpbWVuc2lvbnMoKTsNCgkJCW1lLmFmdGVyU2V0RGltZW5zaW9ucygpOw0KCQkJLy8gTGFiZWxzDQoJCQltZS5iZWZvcmVCdWlsZExhYmVscygpOw0KCQkJbWUuYnVpbGRMYWJlbHMoKTsNCgkJCW1lLmFmdGVyQnVpbGRMYWJlbHMoKTsNCg0KCQkJLy8gRml0DQoJCQltZS5iZWZvcmVGaXQoKTsNCgkJCW1lLmZpdCgpOw0KCQkJbWUuYWZ0ZXJGaXQoKTsNCgkJCS8vDQoJCQltZS5hZnRlclVwZGF0ZSgpOw0KDQoJCQlyZXR1cm4gbWUubWluU2l6ZTsNCg0KCQl9LA0KCQlhZnRlclVwZGF0ZTogbm9vcCwNCg0KCQkvLw0KDQoJCWJlZm9yZVNldERpbWVuc2lvbnM6IG5vb3AsDQoJCXNldERpbWVuc2lvbnM6IGZ1bmN0aW9uKCkgew0KCQkJdmFyIG1lID0gdGhpczsNCgkJCS8vIFNldCB0aGUgdW5jb25zdHJhaW5lZCBkaW1lbnNpb24gYmVmb3JlIGxhYmVsIHJvdGF0aW9uDQoJCQlpZiAobWUuaXNIb3Jpem9udGFsKCkpIHsNCgkJCQkvLyBSZXNldCBwb3NpdGlvbiBiZWZvcmUgY2FsY3VsYXRpbmcgcm90YXRpb24NCgkJCQltZS53aWR0aCA9IG1lLm1heFdpZHRoOw0KCQkJCW1lLmxlZnQgPSAwOw0KCQkJCW1lLnJpZ2h0ID0gbWUud2lkdGg7DQoJCQl9IGVsc2Ugew0KCQkJCW1lLmhlaWdodCA9IG1lLm1heEhlaWdodDsNCg0KCQkJCS8vIFJlc2V0IHBvc2l0aW9uIGJlZm9yZSBjYWxjdWxhdGluZyByb3RhdGlvbg0KCQkJCW1lLnRvcCA9IDA7DQoJCQkJbWUuYm90dG9tID0gbWUuaGVpZ2h0Ow0KCQkJfQ0KDQoJCQkvLyBSZXNldCBwYWRkaW5nDQoJCQltZS5wYWRkaW5nTGVmdCA9IDA7DQoJCQltZS5wYWRkaW5nVG9wID0gMDsNCgkJCW1lLnBhZGRpbmdSaWdodCA9IDA7DQoJCQltZS5wYWRkaW5nQm90dG9tID0gMDsNCg0KCQkJLy8gUmVzZXQgbWluU2l6ZQ0KCQkJbWUubWluU2l6ZSA9IHsNCgkJCQl3aWR0aDogMCwNCgkJCQloZWlnaHQ6IDANCgkJCX07DQoJCX0sDQoJCWFmdGVyU2V0RGltZW5zaW9uczogbm9vcCwNCg0KCQkvLw0KDQoJCWJlZm9yZUJ1aWxkTGFiZWxzOiBub29wLA0KCQlidWlsZExhYmVsczogbm9vcCwNCgkJYWZ0ZXJCdWlsZExhYmVsczogbm9vcCwNCg0KCQkvLw0KDQoJCWJlZm9yZUZpdDogbm9vcCwNCgkJZml0OiBmdW5jdGlvbigpIHsNCgkJCXZhciBtZSA9IHRoaXM7DQoJCQl2YXIgdmFsdWVPckRlZmF1bHQgPSBoZWxwZXJzLnZhbHVlT3JEZWZhdWx0Ow0KCQkJdmFyIG9wdHMgPSBtZS5vcHRpb25zOw0KCQkJdmFyIGRpc3BsYXkgPSBvcHRzLmRpc3BsYXk7DQoJCQl2YXIgZm9udFNpemUgPSB2YWx1ZU9yRGVmYXVsdChvcHRzLmZvbnRTaXplLCBkZWZhdWx0cy5nbG9iYWwuZGVmYXVsdEZvbnRTaXplKTsNCgkJCXZhciBtaW5TaXplID0gbWUubWluU2l6ZTsNCgkJCXZhciBsaW5lQ291bnQgPSBoZWxwZXJzLmlzQXJyYXkob3B0cy50ZXh0KSA/IG9wdHMudGV4dC5sZW5ndGggOiAxOw0KCQkJdmFyIGxpbmVIZWlnaHQgPSBoZWxwZXJzLm9wdGlvbnMudG9MaW5lSGVpZ2h0KG9wdHMubGluZUhlaWdodCwgZm9udFNpemUpOw0KCQkJdmFyIHRleHRTaXplID0gZGlzcGxheSA/IChsaW5lQ291bnQgKiBsaW5lSGVpZ2h0KSArIChvcHRzLnBhZGRpbmcgKiAyKSA6IDA7DQoNCgkJCWlmIChtZS5pc0hvcml6b250YWwoKSkgew0KCQkJCW1pblNpemUud2lkdGggPSBtZS5tYXhXaWR0aDsgLy8gZmlsbCBhbGwgdGhlIHdpZHRoDQoJCQkJbWluU2l6ZS5oZWlnaHQgPSB0ZXh0U2l6ZTsNCgkJCX0gZWxzZSB7DQoJCQkJbWluU2l6ZS53aWR0aCA9IHRleHRTaXplOw0KCQkJCW1pblNpemUuaGVpZ2h0ID0gbWUubWF4SGVpZ2h0OyAvLyBmaWxsIGFsbCB0aGUgaGVpZ2h0DQoJCQl9DQoNCgkJCW1lLndpZHRoID0gbWluU2l6ZS53aWR0aDsNCgkJCW1lLmhlaWdodCA9IG1pblNpemUuaGVpZ2h0Ow0KDQoJCX0sDQoJCWFmdGVyRml0OiBub29wLA0KDQoJCS8vIFNoYXJlZCBNZXRob2RzDQoJCWlzSG9yaXpvbnRhbDogZnVuY3Rpb24oKSB7DQoJCQl2YXIgcG9zID0gdGhpcy5vcHRpb25zLnBvc2l0aW9uOw0KCQkJcmV0dXJuIHBvcyA9PT0gJ3RvcCcgfHwgcG9zID09PSAnYm90dG9tJzsNCgkJfSwNCg0KCQkvLyBBY3R1YWxseSBkcmF3IHRoZSB0aXRsZSBibG9jayBvbiB0aGUgY2FudmFzDQoJCWRyYXc6IGZ1bmN0aW9uKCkgew0KCQkJdmFyIG1lID0gdGhpczsNCgkJCXZhciBjdHggPSBtZS5jdHg7DQoJCQl2YXIgdmFsdWVPckRlZmF1bHQgPSBoZWxwZXJzLnZhbHVlT3JEZWZhdWx0Ow0KCQkJdmFyIG9wdHMgPSBtZS5vcHRpb25zOw0KCQkJdmFyIGdsb2JhbERlZmF1bHRzID0gZGVmYXVsdHMuZ2xvYmFsOw0KDQoJCQlpZiAob3B0cy5kaXNwbGF5KSB7DQoJCQkJdmFyIGZvbnRTaXplID0gdmFsdWVPckRlZmF1bHQob3B0cy5mb250U2l6ZSwgZ2xvYmFsRGVmYXVsdHMuZGVmYXVsdEZvbnRTaXplKTsNCgkJCQl2YXIgZm9udFN0eWxlID0gdmFsdWVPckRlZmF1bHQob3B0cy5mb250U3R5bGUsIGdsb2JhbERlZmF1bHRzLmRlZmF1bHRGb250U3R5bGUpOw0KCQkJCXZhciBmb250RmFtaWx5ID0gdmFsdWVPckRlZmF1bHQob3B0cy5mb250RmFtaWx5LCBnbG9iYWxEZWZhdWx0cy5kZWZhdWx0Rm9udEZhbWlseSk7DQoJCQkJdmFyIHRpdGxlRm9udCA9IGhlbHBlcnMuZm9udFN0cmluZyhmb250U2l6ZSwgZm9udFN0eWxlLCBmb250RmFtaWx5KTsNCgkJCQl2YXIgbGluZUhlaWdodCA9IGhlbHBlcnMub3B0aW9ucy50b0xpbmVIZWlnaHQob3B0cy5saW5lSGVpZ2h0LCBmb250U2l6ZSk7DQoJCQkJdmFyIG9mZnNldCA9IGxpbmVIZWlnaHQgLyAyICsgb3B0cy5wYWRkaW5nOw0KCQkJCXZhciByb3RhdGlvbiA9IDA7DQoJCQkJdmFyIHRvcCA9IG1lLnRvcDsNCgkJCQl2YXIgbGVmdCA9IG1lLmxlZnQ7DQoJCQkJdmFyIGJvdHRvbSA9IG1lLmJvdHRvbTsNCgkJCQl2YXIgcmlnaHQgPSBtZS5yaWdodDsNCgkJCQl2YXIgbWF4V2lkdGgsIHRpdGxlWCwgdGl0bGVZOw0KDQoJCQkJY3R4LmZpbGxTdHlsZSA9IHZhbHVlT3JEZWZhdWx0KG9wdHMuZm9udENvbG9yLCBnbG9iYWxEZWZhdWx0cy5kZWZhdWx0Rm9udENvbG9yKTsgLy8gcmVuZGVyIGluIGNvcnJlY3QgY29sb3VyDQoJCQkJY3R4LmZvbnQgPSB0aXRsZUZvbnQ7DQoNCgkJCQkvLyBIb3Jpem9udGFsDQoJCQkJaWYgKG1lLmlzSG9yaXpvbnRhbCgpKSB7DQoJCQkJCXRpdGxlWCA9IGxlZnQgKyAoKHJpZ2h0IC0gbGVmdCkgLyAyKTsgLy8gbWlkcG9pbnQgb2YgdGhlIHdpZHRoDQoJCQkJCXRpdGxlWSA9IHRvcCArIG9mZnNldDsNCgkJCQkJbWF4V2lkdGggPSByaWdodCAtIGxlZnQ7DQoJCQkJfSBlbHNlIHsNCgkJCQkJdGl0bGVYID0gb3B0cy5wb3NpdGlvbiA9PT0gJ2xlZnQnID8gbGVmdCArIG9mZnNldCA6IHJpZ2h0IC0gb2Zmc2V0Ow0KCQkJCQl0aXRsZVkgPSB0b3AgKyAoKGJvdHRvbSAtIHRvcCkgLyAyKTsNCgkJCQkJbWF4V2lkdGggPSBib3R0b20gLSB0b3A7DQoJCQkJCXJvdGF0aW9uID0gTWF0aC5QSSAqIChvcHRzLnBvc2l0aW9uID09PSAnbGVmdCcgPyAtMC41IDogMC41KTsNCgkJCQl9DQoNCgkJCQljdHguc2F2ZSgpOw0KCQkJCWN0eC50cmFuc2xhdGUodGl0bGVYLCB0aXRsZVkpOw0KCQkJCWN0eC5yb3RhdGUocm90YXRpb24pOw0KCQkJCWN0eC50ZXh0QWxpZ24gPSAnY2VudGVyJzsNCgkJCQljdHgudGV4dEJhc2VsaW5lID0gJ21pZGRsZSc7DQoNCgkJCQl2YXIgdGV4dCA9IG9wdHMudGV4dDsNCgkJCQlpZiAoaGVscGVycy5pc0FycmF5KHRleHQpKSB7DQoJCQkJCXZhciB5ID0gMDsNCgkJCQkJZm9yICh2YXIgaSA9IDA7IGkgPCB0ZXh0Lmxlbmd0aDsgKytpKSB7DQoJCQkJCQljdHguZmlsbFRleHQodGV4dFtpXSwgMCwgeSwgbWF4V2lkdGgpOw0KCQkJCQkJeSArPSBsaW5lSGVpZ2h0Ow0KCQkJCQl9DQoJCQkJfSBlbHNlIHsNCgkJCQkJY3R4LmZpbGxUZXh0KHRleHQsIDAsIDAsIG1heFdpZHRoKTsNCgkJCQl9DQoNCgkJCQljdHgucmVzdG9yZSgpOw0KCQkJfQ0KCQl9DQoJfSk7DQoNCglmdW5jdGlvbiBjcmVhdGVOZXdUaXRsZUJsb2NrQW5kQXR0YWNoKGNoYXJ0LCB0aXRsZU9wdHMpIHsNCgkJdmFyIHRpdGxlID0gbmV3IENoYXJ0LlRpdGxlKHsNCgkJCWN0eDogY2hhcnQuY3R4LA0KCQkJb3B0aW9uczogdGl0bGVPcHRzLA0KCQkJY2hhcnQ6IGNoYXJ0DQoJCX0pOw0KDQoJCWxheW91dC5jb25maWd1cmUoY2hhcnQsIHRpdGxlLCB0aXRsZU9wdHMpOw0KCQlsYXlvdXQuYWRkQm94KGNoYXJ0LCB0aXRsZSk7DQoJCWNoYXJ0LnRpdGxlQmxvY2sgPSB0aXRsZTsNCgl9DQoNCglyZXR1cm4gew0KCQlpZDogJ3RpdGxlJywNCg0KCQliZWZvcmVJbml0OiBmdW5jdGlvbihjaGFydCkgew0KCQkJdmFyIHRpdGxlT3B0cyA9IGNoYXJ0Lm9wdGlvbnMudGl0bGU7DQoNCgkJCWlmICh0aXRsZU9wdHMpIHsNCgkJCQljcmVhdGVOZXdUaXRsZUJsb2NrQW5kQXR0YWNoKGNoYXJ0LCB0aXRsZU9wdHMpOw0KCQkJfQ0KCQl9LA0KDQoJCWJlZm9yZVVwZGF0ZTogZnVuY3Rpb24oY2hhcnQpIHsNCgkJCXZhciB0aXRsZU9wdHMgPSBjaGFydC5vcHRpb25zLnRpdGxlOw0KCQkJdmFyIHRpdGxlQmxvY2sgPSBjaGFydC50aXRsZUJsb2NrOw0KDQoJCQlpZiAodGl0bGVPcHRzKSB7DQoJCQkJaGVscGVycy5tZXJnZUlmKHRpdGxlT3B0cywgZGVmYXVsdHMuZ2xvYmFsLnRpdGxlKTsNCg0KCQkJCWlmICh0aXRsZUJsb2NrKSB7DQoJCQkJCWxheW91dC5jb25maWd1cmUoY2hhcnQsIHRpdGxlQmxvY2ssIHRpdGxlT3B0cyk7DQoJCQkJCXRpdGxlQmxvY2sub3B0aW9ucyA9IHRpdGxlT3B0czsNCgkJCQl9IGVsc2Ugew0KCQkJCQljcmVhdGVOZXdUaXRsZUJsb2NrQW5kQXR0YWNoKGNoYXJ0LCB0aXRsZU9wdHMpOw0KCQkJCX0NCgkJCX0gZWxzZSBpZiAodGl0bGVCbG9jaykgew0KCQkJCUNoYXJ0LmxheW91dFNlcnZpY2UucmVtb3ZlQm94KGNoYXJ0LCB0aXRsZUJsb2NrKTsNCgkJCQlkZWxldGUgY2hhcnQudGl0bGVCbG9jazsNCgkJCX0NCgkJfQ0KCX07DQp9Ow0KDQp9LHsiMjUiOjI1LCIyNiI6MjYsIjQ1Ijo0NX1dLDUyOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsNCid1c2Ugc3RyaWN0JzsNCg0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihDaGFydCkgew0KDQoJLy8gRGVmYXVsdCBjb25maWcgZm9yIGEgY2F0ZWdvcnkgc2NhbGUNCgl2YXIgZGVmYXVsdENvbmZpZyA9IHsNCgkJcG9zaXRpb246ICdib3R0b20nDQoJfTsNCg0KCXZhciBEYXRhc2V0U2NhbGUgPSBDaGFydC5TY2FsZS5leHRlbmQoew0KCQkvKioNCgkJKiBJbnRlcm5hbCBmdW5jdGlvbiB0byBnZXQgdGhlIGNvcnJlY3QgbGFiZWxzLiBJZiBkYXRhLnhMYWJlbHMgb3IgZGF0YS55TGFiZWxzIGFyZSBkZWZpbmVkLCB1c2UgdGhvc2UNCgkJKiBlbHNlIGZhbGwgYmFjayB0byBkYXRhLmxhYmVscw0KCQkqIEBwcml2YXRlDQoJCSovDQoJCWdldExhYmVsczogZnVuY3Rpb24oKSB7DQoJCQl2YXIgZGF0YSA9IHRoaXMuY2hhcnQuZGF0YTsNCgkJCXJldHVybiB0aGlzLm9wdGlvbnMubGFiZWxzIHx8ICh0aGlzLmlzSG9yaXpvbnRhbCgpID8gZGF0YS54TGFiZWxzIDogZGF0YS55TGFiZWxzKSB8fCBkYXRhLmxhYmVsczsNCgkJfSwNCg0KCQlkZXRlcm1pbmVEYXRhTGltaXRzOiBmdW5jdGlvbigpIHsNCgkJCXZhciBtZSA9IHRoaXM7DQoJCQl2YXIgbGFiZWxzID0gbWUuZ2V0TGFiZWxzKCk7DQoJCQltZS5taW5JbmRleCA9IDA7DQoJCQltZS5tYXhJbmRleCA9IGxhYmVscy5sZW5ndGggLSAxOw0KCQkJdmFyIGZpbmRJbmRleDsNCg0KCQkJaWYgKG1lLm9wdGlvbnMudGlja3MubWluICE9PSB1bmRlZmluZWQpIHsNCgkJCQkvLyB1c2VyIHNwZWNpZmllZCBtaW4gdmFsdWUNCgkJCQlmaW5kSW5kZXggPSBsYWJlbHMuaW5kZXhPZihtZS5vcHRpb25zLnRpY2tzLm1pbik7DQoJCQkJbWUubWluSW5kZXggPSBmaW5kSW5kZXggIT09IC0xID8gZmluZEluZGV4IDogbWUubWluSW5kZXg7DQoJCQl9DQoNCgkJCWlmIChtZS5vcHRpb25zLnRpY2tzLm1heCAhPT0gdW5kZWZpbmVkKSB7DQoJCQkJLy8gdXNlciBzcGVjaWZpZWQgbWF4IHZhbHVlDQoJCQkJZmluZEluZGV4ID0gbGFiZWxzLmluZGV4T2YobWUub3B0aW9ucy50aWNrcy5tYXgpOw0KCQkJCW1lLm1heEluZGV4ID0gZmluZEluZGV4ICE9PSAtMSA/IGZpbmRJbmRleCA6IG1lLm1heEluZGV4Ow0KCQkJfQ0KDQoJCQltZS5taW4gPSBsYWJlbHNbbWUubWluSW5kZXhdOw0KCQkJbWUubWF4ID0gbGFiZWxzW21lLm1heEluZGV4XTsNCgkJfSwNCg0KCQlidWlsZFRpY2tzOiBmdW5jdGlvbigpIHsNCgkJCXZhciBtZSA9IHRoaXM7DQoJCQl2YXIgbGFiZWxzID0gbWUuZ2V0TGFiZWxzKCk7DQoJCQkvLyBJZiB3ZSBhcmUgdmlld2luZyBzb21lIHN1YnNldCBvZiBsYWJlbHMsIHNsaWNlIHRoZSBvcmlnaW5hbCBhcnJheQ0KCQkJbWUudGlja3MgPSAobWUubWluSW5kZXggPT09IDAgJiYgbWUubWF4SW5kZXggPT09IGxhYmVscy5sZW5ndGggLSAxKSA/IGxhYmVscyA6IGxhYmVscy5zbGljZShtZS5taW5JbmRleCwgbWUubWF4SW5kZXggKyAxKTsNCgkJfSwNCg0KCQlnZXRMYWJlbEZvckluZGV4OiBmdW5jdGlvbihpbmRleCwgZGF0YXNldEluZGV4KSB7DQoJCQl2YXIgbWUgPSB0aGlzOw0KCQkJdmFyIGRhdGEgPSBtZS5jaGFydC5kYXRhOw0KCQkJdmFyIGlzSG9yaXpvbnRhbCA9IG1lLmlzSG9yaXpvbnRhbCgpOw0KDQoJCQlpZiAoZGF0YS55TGFiZWxzICYmICFpc0hvcml6b250YWwpIHsNCgkJCQlyZXR1cm4gbWUuZ2V0UmlnaHRWYWx1ZShkYXRhLmRhdGFzZXRzW2RhdGFzZXRJbmRleF0uZGF0YVtpbmRleF0pOw0KCQkJfQ0KCQkJcmV0dXJuIG1lLnRpY2tzW2luZGV4IC0gbWUubWluSW5kZXhdOw0KCQl9LA0KDQoJCS8vIFVzZWQgdG8gZ2V0IGRhdGEgdmFsdWUgbG9jYXRpb25zLiAgVmFsdWUgY2FuIGVpdGhlciBiZSBhbiBpbmRleCBvciBhIG51bWVyaWNhbCB2YWx1ZQ0KCQlnZXRQaXhlbEZvclZhbHVlOiBmdW5jdGlvbih2YWx1ZSwgaW5kZXgpIHsNCgkJCXZhciBtZSA9IHRoaXM7DQoJCQl2YXIgb2Zmc2V0ID0gbWUub3B0aW9ucy5vZmZzZXQ7DQoJCQkvLyAxIGlzIGFkZGVkIGJlY2F1c2Ugd2UgbmVlZCB0aGUgbGVuZ3RoIGJ1dCB3ZSBoYXZlIHRoZSBpbmRleGVzDQoJCQl2YXIgb2Zmc2V0QW10ID0gTWF0aC5tYXgoKG1lLm1heEluZGV4ICsgMSAtIG1lLm1pbkluZGV4IC0gKG9mZnNldCA/IDAgOiAxKSksIDEpOw0KDQoJCQkvLyBJZiB2YWx1ZSBpcyBhIGRhdGEgb2JqZWN0LCB0aGVuIGluZGV4IGlzIHRoZSBpbmRleCBpbiB0aGUgZGF0YSBhcnJheSwNCgkJCS8vIG5vdCB0aGUgaW5kZXggb2YgdGhlIHNjYWxlLiBXZSBuZWVkIHRvIGNoYW5nZSB0aGF0Lg0KCQkJdmFyIHZhbHVlQ2F0ZWdvcnk7DQoJCQlpZiAodmFsdWUgIT09IHVuZGVmaW5lZCAmJiB2YWx1ZSAhPT0gbnVsbCkgew0KCQkJCXZhbHVlQ2F0ZWdvcnkgPSBtZS5pc0hvcml6b250YWwoKSA/IHZhbHVlLnggOiB2YWx1ZS55Ow0KCQkJfQ0KCQkJaWYgKHZhbHVlQ2F0ZWdvcnkgIT09IHVuZGVmaW5lZCB8fCAodmFsdWUgIT09IHVuZGVmaW5lZCAmJiBpc05hTihpbmRleCkpKSB7DQoJCQkJdmFyIGxhYmVscyA9IG1lLmdldExhYmVscygpOw0KCQkJCXZhbHVlID0gdmFsdWVDYXRlZ29yeSB8fCB2YWx1ZTsNCgkJCQl2YXIgaWR4ID0gbGFiZWxzLmluZGV4T2YodmFsdWUpOw0KCQkJCWluZGV4ID0gaWR4ICE9PSAtMSA/IGlkeCA6IGluZGV4Ow0KCQkJfQ0KDQoJCQlpZiAobWUuaXNIb3Jpem9udGFsKCkpIHsNCgkJCQl2YXIgdmFsdWVXaWR0aCA9IG1lLndpZHRoIC8gb2Zmc2V0QW10Ow0KCQkJCXZhciB3aWR0aE9mZnNldCA9ICh2YWx1ZVdpZHRoICogKGluZGV4IC0gbWUubWluSW5kZXgpKTsNCg0KCQkJCWlmIChvZmZzZXQpIHsNCgkJCQkJd2lkdGhPZmZzZXQgKz0gKHZhbHVlV2lkdGggLyAyKTsNCgkJCQl9DQoNCgkJCQlyZXR1cm4gbWUubGVmdCArIE1hdGgucm91bmQod2lkdGhPZmZzZXQpOw0KCQkJfQ0KCQkJdmFyIHZhbHVlSGVpZ2h0ID0gbWUuaGVpZ2h0IC8gb2Zmc2V0QW10Ow0KCQkJdmFyIGhlaWdodE9mZnNldCA9ICh2YWx1ZUhlaWdodCAqIChpbmRleCAtIG1lLm1pbkluZGV4KSk7DQoNCgkJCWlmIChvZmZzZXQpIHsNCgkJCQloZWlnaHRPZmZzZXQgKz0gKHZhbHVlSGVpZ2h0IC8gMik7DQoJCQl9DQoNCgkJCXJldHVybiBtZS50b3AgKyBNYXRoLnJvdW5kKGhlaWdodE9mZnNldCk7DQoJCX0sDQoJCWdldFBpeGVsRm9yVGljazogZnVuY3Rpb24oaW5kZXgpIHsNCgkJCXJldHVybiB0aGlzLmdldFBpeGVsRm9yVmFsdWUodGhpcy50aWNrc1tpbmRleF0sIGluZGV4ICsgdGhpcy5taW5JbmRleCwgbnVsbCk7DQoJCX0sDQoJCWdldFZhbHVlRm9yUGl4ZWw6IGZ1bmN0aW9uKHBpeGVsKSB7DQoJCQl2YXIgbWUgPSB0aGlzOw0KCQkJdmFyIG9mZnNldCA9IG1lLm9wdGlvbnMub2Zmc2V0Ow0KCQkJdmFyIHZhbHVlOw0KCQkJdmFyIG9mZnNldEFtdCA9IE1hdGgubWF4KChtZS5fdGlja3MubGVuZ3RoIC0gKG9mZnNldCA/IDAgOiAxKSksIDEpOw0KCQkJdmFyIGhvcnogPSBtZS5pc0hvcml6b250YWwoKTsNCgkJCXZhciB2YWx1ZURpbWVuc2lvbiA9IChob3J6ID8gbWUud2lkdGggOiBtZS5oZWlnaHQpIC8gb2Zmc2V0QW10Ow0KDQoJCQlwaXhlbCAtPSBob3J6ID8gbWUubGVmdCA6IG1lLnRvcDsNCg0KCQkJaWYgKG9mZnNldCkgew0KCQkJCXBpeGVsIC09ICh2YWx1ZURpbWVuc2lvbiAvIDIpOw0KCQkJfQ0KDQoJCQlpZiAocGl4ZWwgPD0gMCkgew0KCQkJCXZhbHVlID0gMDsNCgkJCX0gZWxzZSB7DQoJCQkJdmFsdWUgPSBNYXRoLnJvdW5kKHBpeGVsIC8gdmFsdWVEaW1lbnNpb24pOw0KCQkJfQ0KDQoJCQlyZXR1cm4gdmFsdWUgKyBtZS5taW5JbmRleDsNCgkJfSwNCgkJZ2V0QmFzZVBpeGVsOiBmdW5jdGlvbigpIHsNCgkJCXJldHVybiB0aGlzLmJvdHRvbTsNCgkJfQ0KCX0pOw0KDQoJQ2hhcnQuc2NhbGVTZXJ2aWNlLnJlZ2lzdGVyU2NhbGVUeXBlKCdjYXRlZ29yeScsIERhdGFzZXRTY2FsZSwgZGVmYXVsdENvbmZpZyk7DQoNCn07DQoNCn0se31dLDUzOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsNCid1c2Ugc3RyaWN0JzsNCg0KdmFyIGRlZmF1bHRzID0gcmVxdWlyZSgyNSk7DQp2YXIgaGVscGVycyA9IHJlcXVpcmUoNDUpOw0KdmFyIFRpY2tzID0gcmVxdWlyZSgzNCk7DQoNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oQ2hhcnQpIHsNCg0KCXZhciBkZWZhdWx0Q29uZmlnID0gew0KCQlwb3NpdGlvbjogJ2xlZnQnLA0KCQl0aWNrczogew0KCQkJY2FsbGJhY2s6IFRpY2tzLmZvcm1hdHRlcnMubGluZWFyDQoJCX0NCgl9Ow0KDQoJdmFyIExpbmVhclNjYWxlID0gQ2hhcnQuTGluZWFyU2NhbGVCYXNlLmV4dGVuZCh7DQoNCgkJZGV0ZXJtaW5lRGF0YUxpbWl0czogZnVuY3Rpb24oKSB7DQoJCQl2YXIgbWUgPSB0aGlzOw0KCQkJdmFyIG9wdHMgPSBtZS5vcHRpb25zOw0KCQkJdmFyIGNoYXJ0ID0gbWUuY2hhcnQ7DQoJCQl2YXIgZGF0YSA9IGNoYXJ0LmRhdGE7DQoJCQl2YXIgZGF0YXNldHMgPSBkYXRhLmRhdGFzZXRzOw0KCQkJdmFyIGlzSG9yaXpvbnRhbCA9IG1lLmlzSG9yaXpvbnRhbCgpOw0KCQkJdmFyIERFRkFVTFRfTUlOID0gMDsNCgkJCXZhciBERUZBVUxUX01BWCA9IDE7DQoNCgkJCWZ1bmN0aW9uIElETWF0Y2hlcyhtZXRhKSB7DQoJCQkJcmV0dXJuIGlzSG9yaXpvbnRhbCA/IG1ldGEueEF4aXNJRCA9PT0gbWUuaWQgOiBtZXRhLnlBeGlzSUQgPT09IG1lLmlkOw0KCQkJfQ0KDQoJCQkvLyBGaXJzdCBDYWxjdWxhdGUgdGhlIHJhbmdlDQoJCQltZS5taW4gPSBudWxsOw0KCQkJbWUubWF4ID0gbnVsbDsNCg0KCQkJdmFyIGhhc1N0YWNrcyA9IG9wdHMuc3RhY2tlZDsNCgkJCWlmIChoYXNTdGFja3MgPT09IHVuZGVmaW5lZCkgew0KCQkJCWhlbHBlcnMuZWFjaChkYXRhc2V0cywgZnVuY3Rpb24oZGF0YXNldCwgZGF0YXNldEluZGV4KSB7DQoJCQkJCWlmIChoYXNTdGFja3MpIHsNCgkJCQkJCXJldHVybjsNCgkJCQkJfQ0KDQoJCQkJCXZhciBtZXRhID0gY2hhcnQuZ2V0RGF0YXNldE1ldGEoZGF0YXNldEluZGV4KTsNCgkJCQkJaWYgKGNoYXJ0LmlzRGF0YXNldFZpc2libGUoZGF0YXNldEluZGV4KSAmJiBJRE1hdGNoZXMobWV0YSkgJiYNCgkJCQkJCW1ldGEuc3RhY2sgIT09IHVuZGVmaW5lZCkgew0KCQkJCQkJaGFzU3RhY2tzID0gdHJ1ZTsNCgkJCQkJfQ0KCQkJCX0pOw0KCQkJfQ0KDQoJCQlpZiAob3B0cy5zdGFja2VkIHx8IGhhc1N0YWNrcykgew0KCQkJCXZhciB2YWx1ZXNQZXJTdGFjayA9IHt9Ow0KDQoJCQkJaGVscGVycy5lYWNoKGRhdGFzZXRzLCBmdW5jdGlvbihkYXRhc2V0LCBkYXRhc2V0SW5kZXgpIHsNCgkJCQkJdmFyIG1ldGEgPSBjaGFydC5nZXREYXRhc2V0TWV0YShkYXRhc2V0SW5kZXgpOw0KCQkJCQl2YXIga2V5ID0gWw0KCQkJCQkJbWV0YS50eXBlLA0KCQkJCQkJLy8gd2UgaGF2ZSBhIHNlcGFyYXRlIHN0YWNrIGZvciBzdGFjaz11bmRlZmluZWQgZGF0YXNldHMgd2hlbiB0aGUgb3B0cy5zdGFja2VkIGlzIHVuZGVmaW5lZA0KCQkJCQkJKChvcHRzLnN0YWNrZWQgPT09IHVuZGVmaW5lZCAmJiBtZXRhLnN0YWNrID09PSB1bmRlZmluZWQpID8gZGF0YXNldEluZGV4IDogJycpLA0KCQkJCQkJbWV0YS5zdGFjaw0KCQkJCQldLmpvaW4oJy4nKTsNCg0KCQkJCQlpZiAodmFsdWVzUGVyU3RhY2tba2V5XSA9PT0gdW5kZWZpbmVkKSB7DQoJCQkJCQl2YWx1ZXNQZXJTdGFja1trZXldID0gew0KCQkJCQkJCXBvc2l0aXZlVmFsdWVzOiBbXSwNCgkJCQkJCQluZWdhdGl2ZVZhbHVlczogW10NCgkJCQkJCX07DQoJCQkJCX0NCg0KCQkJCQkvLyBTdG9yZSB0aGVzZSBwZXIgdHlwZQ0KCQkJCQl2YXIgcG9zaXRpdmVWYWx1ZXMgPSB2YWx1ZXNQZXJTdGFja1trZXldLnBvc2l0aXZlVmFsdWVzOw0KCQkJCQl2YXIgbmVnYXRpdmVWYWx1ZXMgPSB2YWx1ZXNQZXJTdGFja1trZXldLm5lZ2F0aXZlVmFsdWVzOw0KDQoJCQkJCWlmIChjaGFydC5pc0RhdGFzZXRWaXNpYmxlKGRhdGFzZXRJbmRleCkgJiYgSURNYXRjaGVzKG1ldGEpKSB7DQoJCQkJCQloZWxwZXJzLmVhY2goZGF0YXNldC5kYXRhLCBmdW5jdGlvbihyYXdWYWx1ZSwgaW5kZXgpIHsNCgkJCQkJCQl2YXIgdmFsdWUgPSArbWUuZ2V0UmlnaHRWYWx1ZShyYXdWYWx1ZSk7DQoJCQkJCQkJaWYgKGlzTmFOKHZhbHVlKSB8fCBtZXRhLmRhdGFbaW5kZXhdLmhpZGRlbikgew0KCQkJCQkJCQlyZXR1cm47DQoJCQkJCQkJfQ0KDQoJCQkJCQkJcG9zaXRpdmVWYWx1ZXNbaW5kZXhdID0gcG9zaXRpdmVWYWx1ZXNbaW5kZXhdIHx8IDA7DQoJCQkJCQkJbmVnYXRpdmVWYWx1ZXNbaW5kZXhdID0gbmVnYXRpdmVWYWx1ZXNbaW5kZXhdIHx8IDA7DQoNCgkJCQkJCQlpZiAob3B0cy5yZWxhdGl2ZVBvaW50cykgew0KCQkJCQkJCQlwb3NpdGl2ZVZhbHVlc1tpbmRleF0gPSAxMDA7DQoJCQkJCQkJfSBlbHNlIGlmICh2YWx1ZSA8IDApIHsNCgkJCQkJCQkJbmVnYXRpdmVWYWx1ZXNbaW5kZXhdICs9IHZhbHVlOw0KCQkJCQkJCX0gZWxzZSB7DQoJCQkJCQkJCXBvc2l0aXZlVmFsdWVzW2luZGV4XSArPSB2YWx1ZTsNCgkJCQkJCQl9DQoJCQkJCQl9KTsNCgkJCQkJfQ0KCQkJCX0pOw0KDQoJCQkJaGVscGVycy5lYWNoKHZhbHVlc1BlclN0YWNrLCBmdW5jdGlvbih2YWx1ZXNGb3JUeXBlKSB7DQoJCQkJCXZhciB2YWx1ZXMgPSB2YWx1ZXNGb3JUeXBlLnBvc2l0aXZlVmFsdWVzLmNvbmNhdCh2YWx1ZXNGb3JUeXBlLm5lZ2F0aXZlVmFsdWVzKTsNCgkJCQkJdmFyIG1pblZhbCA9IGhlbHBlcnMubWluKHZhbHVlcyk7DQoJCQkJCXZhciBtYXhWYWwgPSBoZWxwZXJzLm1heCh2YWx1ZXMpOw0KCQkJCQltZS5taW4gPSBtZS5taW4gPT09IG51bGwgPyBtaW5WYWwgOiBNYXRoLm1pbihtZS5taW4sIG1pblZhbCk7DQoJCQkJCW1lLm1heCA9IG1lLm1heCA9PT0gbnVsbCA/IG1heFZhbCA6IE1hdGgubWF4KG1lLm1heCwgbWF4VmFsKTsNCgkJCQl9KTsNCg0KCQkJfSBlbHNlIHsNCgkJCQloZWxwZXJzLmVhY2goZGF0YXNldHMsIGZ1bmN0aW9uKGRhdGFzZXQsIGRhdGFzZXRJbmRleCkgew0KCQkJCQl2YXIgbWV0YSA9IGNoYXJ0LmdldERhdGFzZXRNZXRhKGRhdGFzZXRJbmRleCk7DQoJCQkJCWlmIChjaGFydC5pc0RhdGFzZXRWaXNpYmxlKGRhdGFzZXRJbmRleCkgJiYgSURNYXRjaGVzKG1ldGEpKSB7DQoJCQkJCQloZWxwZXJzLmVhY2goZGF0YXNldC5kYXRhLCBmdW5jdGlvbihyYXdWYWx1ZSwgaW5kZXgpIHsNCgkJCQkJCQl2YXIgdmFsdWUgPSArbWUuZ2V0UmlnaHRWYWx1ZShyYXdWYWx1ZSk7DQoJCQkJCQkJaWYgKGlzTmFOKHZhbHVlKSB8fCBtZXRhLmRhdGFbaW5kZXhdLmhpZGRlbikgew0KCQkJCQkJCQlyZXR1cm47DQoJCQkJCQkJfQ0KDQoJCQkJCQkJaWYgKG1lLm1pbiA9PT0gbnVsbCkgew0KCQkJCQkJCQltZS5taW4gPSB2YWx1ZTsNCgkJCQkJCQl9IGVsc2UgaWYgKHZhbHVlIDwgbWUubWluKSB7DQoJCQkJCQkJCW1lLm1pbiA9IHZhbHVlOw0KCQkJCQkJCX0NCg0KCQkJCQkJCWlmIChtZS5tYXggPT09IG51bGwpIHsNCgkJCQkJCQkJbWUubWF4ID0gdmFsdWU7DQoJCQkJCQkJfSBlbHNlIGlmICh2YWx1ZSA+IG1lLm1heCkgew0KCQkJCQkJCQltZS5tYXggPSB2YWx1ZTsNCgkJCQkJCQl9DQoJCQkJCQl9KTsNCgkJCQkJfQ0KCQkJCX0pOw0KCQkJfQ0KDQoJCQltZS5taW4gPSBpc0Zpbml0ZShtZS5taW4pICYmICFpc05hTihtZS5taW4pID8gbWUubWluIDogREVGQVVMVF9NSU47DQoJCQltZS5tYXggPSBpc0Zpbml0ZShtZS5tYXgpICYmICFpc05hTihtZS5tYXgpID8gbWUubWF4IDogREVGQVVMVF9NQVg7DQoNCgkJCS8vIENvbW1vbiBiYXNlIGltcGxlbWVudGF0aW9uIHRvIGhhbmRsZSB0aWNrcy5taW4sIHRpY2tzLm1heCwgdGlja3MuYmVnaW5BdFplcm8NCgkJCXRoaXMuaGFuZGxlVGlja1JhbmdlT3B0aW9ucygpOw0KCQl9LA0KCQlnZXRUaWNrTGltaXQ6IGZ1bmN0aW9uKCkgew0KCQkJdmFyIG1heFRpY2tzOw0KCQkJdmFyIG1lID0gdGhpczsNCgkJCXZhciB0aWNrT3B0cyA9IG1lLm9wdGlvbnMudGlja3M7DQoNCgkJCWlmIChtZS5pc0hvcml6b250YWwoKSkgew0KCQkJCW1heFRpY2tzID0gTWF0aC5taW4odGlja09wdHMubWF4VGlja3NMaW1pdCA/IHRpY2tPcHRzLm1heFRpY2tzTGltaXQgOiAxMSwgTWF0aC5jZWlsKG1lLndpZHRoIC8gNTApKTsNCgkJCX0gZWxzZSB7DQoJCQkJLy8gVGhlIGZhY3RvciBvZiAyIHVzZWQgdG8gc2NhbGUgdGhlIGZvbnQgc2l6ZSBoYXMgYmVlbiBleHBlcmltZW50YWxseSBkZXRlcm1pbmVkLg0KCQkJCXZhciB0aWNrRm9udFNpemUgPSBoZWxwZXJzLnZhbHVlT3JEZWZhdWx0KHRpY2tPcHRzLmZvbnRTaXplLCBkZWZhdWx0cy5nbG9iYWwuZGVmYXVsdEZvbnRTaXplKTsNCgkJCQltYXhUaWNrcyA9IE1hdGgubWluKHRpY2tPcHRzLm1heFRpY2tzTGltaXQgPyB0aWNrT3B0cy5tYXhUaWNrc0xpbWl0IDogMTEsIE1hdGguY2VpbChtZS5oZWlnaHQgLyAoMiAqIHRpY2tGb250U2l6ZSkpKTsNCgkJCX0NCg0KCQkJcmV0dXJuIG1heFRpY2tzOw0KCQl9LA0KCQkvLyBDYWxsZWQgYWZ0ZXIgdGhlIHRpY2tzIGFyZSBidWlsdC4gV2UgbmVlZA0KCQloYW5kbGVEaXJlY3Rpb25hbENoYW5nZXM6IGZ1bmN0aW9uKCkgew0KCQkJaWYgKCF0aGlzLmlzSG9yaXpvbnRhbCgpKSB7DQoJCQkJLy8gV2UgYXJlIGluIGEgdmVydGljYWwgb3JpZW50YXRpb24uIFRoZSB0b3AgdmFsdWUgaXMgdGhlIGhpZ2hlc3QuIFNvIHJldmVyc2UgdGhlIGFycmF5DQoJCQkJdGhpcy50aWNrcy5yZXZlcnNlKCk7DQoJCQl9DQoJCX0sDQoJCWdldExhYmVsRm9ySW5kZXg6IGZ1bmN0aW9uKGluZGV4LCBkYXRhc2V0SW5kZXgpIHsNCgkJCXJldHVybiArdGhpcy5nZXRSaWdodFZhbHVlKHRoaXMuY2hhcnQuZGF0YS5kYXRhc2V0c1tkYXRhc2V0SW5kZXhdLmRhdGFbaW5kZXhdKTsNCgkJfSwNCgkJLy8gVXRpbHMNCgkJZ2V0UGl4ZWxGb3JWYWx1ZTogZnVuY3Rpb24odmFsdWUpIHsNCgkJCS8vIFRoaXMgbXVzdCBiZSBjYWxsZWQgYWZ0ZXIgZml0IGhhcyBiZWVuIHJ1biBzbyB0aGF0DQoJCQkvLyB0aGlzLmxlZnQsIHRoaXMudG9wLCB0aGlzLnJpZ2h0LCBhbmQgdGhpcy5ib3R0b20gaGF2ZSBiZWVuIGRlZmluZWQNCgkJCXZhciBtZSA9IHRoaXM7DQoJCQl2YXIgc3RhcnQgPSBtZS5zdGFydDsNCg0KCQkJdmFyIHJpZ2h0VmFsdWUgPSArbWUuZ2V0UmlnaHRWYWx1ZSh2YWx1ZSk7DQoJCQl2YXIgcGl4ZWw7DQoJCQl2YXIgcmFuZ2UgPSBtZS5lbmQgLSBzdGFydDsNCg0KCQkJaWYgKG1lLmlzSG9yaXpvbnRhbCgpKSB7DQoJCQkJcGl4ZWwgPSBtZS5sZWZ0ICsgKG1lLndpZHRoIC8gcmFuZ2UgKiAocmlnaHRWYWx1ZSAtIHN0YXJ0KSk7DQoJCQkJcmV0dXJuIE1hdGgucm91bmQocGl4ZWwpOw0KCQkJfQ0KDQoJCQlwaXhlbCA9IG1lLmJvdHRvbSAtIChtZS5oZWlnaHQgLyByYW5nZSAqIChyaWdodFZhbHVlIC0gc3RhcnQpKTsNCgkJCXJldHVybiBNYXRoLnJvdW5kKHBpeGVsKTsNCgkJfSwNCgkJZ2V0VmFsdWVGb3JQaXhlbDogZnVuY3Rpb24ocGl4ZWwpIHsNCgkJCXZhciBtZSA9IHRoaXM7DQoJCQl2YXIgaXNIb3Jpem9udGFsID0gbWUuaXNIb3Jpem9udGFsKCk7DQoJCQl2YXIgaW5uZXJEaW1lbnNpb24gPSBpc0hvcml6b250YWwgPyBtZS53aWR0aCA6IG1lLmhlaWdodDsNCgkJCXZhciBvZmZzZXQgPSAoaXNIb3Jpem9udGFsID8gcGl4ZWwgLSBtZS5sZWZ0IDogbWUuYm90dG9tIC0gcGl4ZWwpIC8gaW5uZXJEaW1lbnNpb247DQoJCQlyZXR1cm4gbWUuc3RhcnQgKyAoKG1lLmVuZCAtIG1lLnN0YXJ0KSAqIG9mZnNldCk7DQoJCX0sDQoJCWdldFBpeGVsRm9yVGljazogZnVuY3Rpb24oaW5kZXgpIHsNCgkJCXJldHVybiB0aGlzLmdldFBpeGVsRm9yVmFsdWUodGhpcy50aWNrc0FzTnVtYmVyc1tpbmRleF0pOw0KCQl9DQoJfSk7DQoJQ2hhcnQuc2NhbGVTZXJ2aWNlLnJlZ2lzdGVyU2NhbGVUeXBlKCdsaW5lYXInLCBMaW5lYXJTY2FsZSwgZGVmYXVsdENvbmZpZyk7DQoNCn07DQoNCn0seyIyNSI6MjUsIjM0IjozNCwiNDUiOjQ1fV0sNTQ6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpew0KJ3VzZSBzdHJpY3QnOw0KDQp2YXIgaGVscGVycyA9IHJlcXVpcmUoNDUpOw0KdmFyIFRpY2tzID0gcmVxdWlyZSgzNCk7DQoNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oQ2hhcnQpIHsNCg0KCXZhciBub29wID0gaGVscGVycy5ub29wOw0KDQoJQ2hhcnQuTGluZWFyU2NhbGVCYXNlID0gQ2hhcnQuU2NhbGUuZXh0ZW5kKHsNCgkJZ2V0UmlnaHRWYWx1ZTogZnVuY3Rpb24odmFsdWUpIHsNCgkJCWlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7DQoJCQkJcmV0dXJuICt2YWx1ZTsNCgkJCX0NCgkJCXJldHVybiBDaGFydC5TY2FsZS5wcm90b3R5cGUuZ2V0UmlnaHRWYWx1ZS5jYWxsKHRoaXMsIHZhbHVlKTsNCgkJfSwNCg0KCQloYW5kbGVUaWNrUmFuZ2VPcHRpb25zOiBmdW5jdGlvbigpIHsNCgkJCXZhciBtZSA9IHRoaXM7DQoJCQl2YXIgb3B0cyA9IG1lLm9wdGlvbnM7DQoJCQl2YXIgdGlja09wdHMgPSBvcHRzLnRpY2tzOw0KDQoJCQkvLyBJZiB3ZSBhcmUgZm9yY2luZyBpdCB0byBiZWdpbiBhdCAwLCBidXQgMCB3aWxsIGFscmVhZHkgYmUgcmVuZGVyZWQgb24gdGhlIGNoYXJ0LA0KCQkJLy8gZG8gbm90aGluZyBzaW5jZSB0aGF0IHdvdWxkIG1ha2UgdGhlIGNoYXJ0IHdlaXJkLiBJZiB0aGUgdXNlciByZWFsbHkgd2FudHMgYSB3ZWlyZCBjaGFydA0KCQkJLy8gYXhpcywgdGhleSBjYW4gbWFudWFsbHkgb3ZlcnJpZGUgaXQNCgkJCWlmICh0aWNrT3B0cy5iZWdpbkF0WmVybykgew0KCQkJCXZhciBtaW5TaWduID0gaGVscGVycy5zaWduKG1lLm1pbik7DQoJCQkJdmFyIG1heFNpZ24gPSBoZWxwZXJzLnNpZ24obWUubWF4KTsNCg0KCQkJCWlmIChtaW5TaWduIDwgMCAmJiBtYXhTaWduIDwgMCkgew0KCQkJCQkvLyBtb3ZlIHRoZSB0b3AgdXAgdG8gMA0KCQkJCQltZS5tYXggPSAwOw0KCQkJCX0gZWxzZSBpZiAobWluU2lnbiA+IDAgJiYgbWF4U2lnbiA+IDApIHsNCgkJCQkJLy8gbW92ZSB0aGUgYm90dG9tIGRvd24gdG8gMA0KCQkJCQltZS5taW4gPSAwOw0KCQkJCX0NCgkJCX0NCg0KCQkJdmFyIHNldE1pbiA9IHRpY2tPcHRzLm1pbiAhPT0gdW5kZWZpbmVkIHx8IHRpY2tPcHRzLnN1Z2dlc3RlZE1pbiAhPT0gdW5kZWZpbmVkOw0KCQkJdmFyIHNldE1heCA9IHRpY2tPcHRzLm1heCAhPT0gdW5kZWZpbmVkIHx8IHRpY2tPcHRzLnN1Z2dlc3RlZE1heCAhPT0gdW5kZWZpbmVkOw0KDQoJCQlpZiAodGlja09wdHMubWluICE9PSB1bmRlZmluZWQpIHsNCgkJCQltZS5taW4gPSB0aWNrT3B0cy5taW47DQoJCQl9IGVsc2UgaWYgKHRpY2tPcHRzLnN1Z2dlc3RlZE1pbiAhPT0gdW5kZWZpbmVkKSB7DQoJCQkJaWYgKG1lLm1pbiA9PT0gbnVsbCkgew0KCQkJCQltZS5taW4gPSB0aWNrT3B0cy5zdWdnZXN0ZWRNaW47DQoJCQkJfSBlbHNlIHsNCgkJCQkJbWUubWluID0gTWF0aC5taW4obWUubWluLCB0aWNrT3B0cy5zdWdnZXN0ZWRNaW4pOw0KCQkJCX0NCgkJCX0NCg0KCQkJaWYgKHRpY2tPcHRzLm1heCAhPT0gdW5kZWZpbmVkKSB7DQoJCQkJbWUubWF4ID0gdGlja09wdHMubWF4Ow0KCQkJfSBlbHNlIGlmICh0aWNrT3B0cy5zdWdnZXN0ZWRNYXggIT09IHVuZGVmaW5lZCkgew0KCQkJCWlmIChtZS5tYXggPT09IG51bGwpIHsNCgkJCQkJbWUubWF4ID0gdGlja09wdHMuc3VnZ2VzdGVkTWF4Ow0KCQkJCX0gZWxzZSB7DQoJCQkJCW1lLm1heCA9IE1hdGgubWF4KG1lLm1heCwgdGlja09wdHMuc3VnZ2VzdGVkTWF4KTsNCgkJCQl9DQoJCQl9DQoNCgkJCWlmIChzZXRNaW4gIT09IHNldE1heCkgew0KCQkJCS8vIFdlIHNldCB0aGUgbWluIG9yIHRoZSBtYXggYnV0IG5vdCBib3RoLg0KCQkJCS8vIFNvIGVuc3VyZSB0aGF0IG91ciByYW5nZSBpcyBnb29kDQoJCQkJLy8gSW52ZXJ0ZWQgb3IgMCBsZW5ndGggcmFuZ2UgY2FuIGhhcHBlbiB3aGVuDQoJCQkJLy8gdGlja3MubWluIGlzIHNldCwgYW5kIG5vIGRhdGFzZXRzIGFyZSB2aXNpYmxlDQoJCQkJaWYgKG1lLm1pbiA+PSBtZS5tYXgpIHsNCgkJCQkJaWYgKHNldE1pbikgew0KCQkJCQkJbWUubWF4ID0gbWUubWluICsgMTsNCgkJCQkJfSBlbHNlIHsNCgkJCQkJCW1lLm1pbiA9IG1lLm1heCAtIDE7DQoJCQkJCX0NCgkJCQl9DQoJCQl9DQoNCgkJCWlmIChtZS5taW4gPT09IG1lLm1heCkgew0KCQkJCW1lLm1heCsrOw0KDQoJCQkJaWYgKCF0aWNrT3B0cy5iZWdpbkF0WmVybykgew0KCQkJCQltZS5taW4tLTsNCgkJCQl9DQoJCQl9DQoJCX0sDQoJCWdldFRpY2tMaW1pdDogbm9vcCwNCgkJaGFuZGxlRGlyZWN0aW9uYWxDaGFuZ2VzOiBub29wLA0KDQoJCWJ1aWxkVGlja3M6IGZ1bmN0aW9uKCkgew0KCQkJdmFyIG1lID0gdGhpczsNCgkJCXZhciBvcHRzID0gbWUub3B0aW9uczsNCgkJCXZhciB0aWNrT3B0cyA9IG9wdHMudGlja3M7DQoNCgkJCS8vIEZpZ3VyZSBvdXQgd2hhdCB0aGUgbWF4IG51bWJlciBvZiB0aWNrcyB3ZSBjYW4gc3VwcG9ydCBpdCBpcyBiYXNlZCBvbiB0aGUgc2l6ZSBvZg0KCQkJLy8gdGhlIGF4aXMgYXJlYS4gRm9yIG5vdywgd2Ugc2F5IHRoYXQgdGhlIG1pbmltdW0gdGljayBzcGFjaW5nIGluIHBpeGVscyBtdXN0IGJlIDUwDQoJCQkvLyBXZSBhbHNvIGxpbWl0IHRoZSBtYXhpbXVtIG51bWJlciBvZiB0aWNrcyB0byAxMSB3aGljaCBnaXZlcyBhIG5pY2UgMTAgc3F1YXJlcyBvbg0KCQkJLy8gdGhlIGdyYXBoLiBNYWtlIHN1cmUgd2UgYWx3YXlzIGhhdmUgYXQgbGVhc3QgMiB0aWNrcw0KCQkJdmFyIG1heFRpY2tzID0gbWUuZ2V0VGlja0xpbWl0KCk7DQoJCQltYXhUaWNrcyA9IE1hdGgubWF4KDIsIG1heFRpY2tzKTsNCg0KCQkJdmFyIG51bWVyaWNHZW5lcmF0b3JPcHRpb25zID0gew0KCQkJCW1heFRpY2tzOiBtYXhUaWNrcywNCgkJCQltaW46IHRpY2tPcHRzLm1pbiwNCgkJCQltYXg6IHRpY2tPcHRzLm1heCwNCgkJCQlzdGVwU2l6ZTogaGVscGVycy52YWx1ZU9yRGVmYXVsdCh0aWNrT3B0cy5maXhlZFN0ZXBTaXplLCB0aWNrT3B0cy5zdGVwU2l6ZSkNCgkJCX07DQoJCQl2YXIgdGlja3MgPSBtZS50aWNrcyA9IFRpY2tzLmdlbmVyYXRvcnMubGluZWFyKG51bWVyaWNHZW5lcmF0b3JPcHRpb25zLCBtZSk7DQoNCgkJCW1lLmhhbmRsZURpcmVjdGlvbmFsQ2hhbmdlcygpOw0KDQoJCQkvLyBBdCB0aGlzIHBvaW50LCB3ZSBuZWVkIHRvIHVwZGF0ZSBvdXIgbWF4IGFuZCBtaW4gZ2l2ZW4gdGhlIHRpY2sgdmFsdWVzIHNpbmNlIHdlIGhhdmUgZXhwYW5kZWQgdGhlDQoJCQkvLyByYW5nZSBvZiB0aGUgc2NhbGUNCgkJCW1lLm1heCA9IGhlbHBlcnMubWF4KHRpY2tzKTsNCgkJCW1lLm1pbiA9IGhlbHBlcnMubWluKHRpY2tzKTsNCg0KCQkJaWYgKHRpY2tPcHRzLnJldmVyc2UpIHsNCgkJCQl0aWNrcy5yZXZlcnNlKCk7DQoNCgkJCQltZS5zdGFydCA9IG1lLm1heDsNCgkJCQltZS5lbmQgPSBtZS5taW47DQoJCQl9IGVsc2Ugew0KCQkJCW1lLnN0YXJ0ID0gbWUubWluOw0KCQkJCW1lLmVuZCA9IG1lLm1heDsNCgkJCX0NCgkJfSwNCgkJY29udmVydFRpY2tzVG9MYWJlbHM6IGZ1bmN0aW9uKCkgew0KCQkJdmFyIG1lID0gdGhpczsNCgkJCW1lLnRpY2tzQXNOdW1iZXJzID0gbWUudGlja3Muc2xpY2UoKTsNCgkJCW1lLnplcm9MaW5lSW5kZXggPSBtZS50aWNrcy5pbmRleE9mKDApOw0KDQoJCQlDaGFydC5TY2FsZS5wcm90b3R5cGUuY29udmVydFRpY2tzVG9MYWJlbHMuY2FsbChtZSk7DQoJCX0NCgl9KTsNCn07DQoNCn0seyIzNCI6MzQsIjQ1Ijo0NX1dLDU1OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsNCid1c2Ugc3RyaWN0JzsNCg0KdmFyIGhlbHBlcnMgPSByZXF1aXJlKDQ1KTsNCnZhciBUaWNrcyA9IHJlcXVpcmUoMzQpOw0KDQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKENoYXJ0KSB7DQoNCgl2YXIgZGVmYXVsdENvbmZpZyA9IHsNCgkJcG9zaXRpb246ICdsZWZ0JywNCg0KCQkvLyBsYWJlbCBzZXR0aW5ncw0KCQl0aWNrczogew0KCQkJY2FsbGJhY2s6IFRpY2tzLmZvcm1hdHRlcnMubG9nYXJpdGhtaWMNCgkJfQ0KCX07DQoNCgl2YXIgTG9nYXJpdGhtaWNTY2FsZSA9IENoYXJ0LlNjYWxlLmV4dGVuZCh7DQoJCWRldGVybWluZURhdGFMaW1pdHM6IGZ1bmN0aW9uKCkgew0KCQkJdmFyIG1lID0gdGhpczsNCgkJCXZhciBvcHRzID0gbWUub3B0aW9uczsNCgkJCXZhciB0aWNrT3B0cyA9IG9wdHMudGlja3M7DQoJCQl2YXIgY2hhcnQgPSBtZS5jaGFydDsNCgkJCXZhciBkYXRhID0gY2hhcnQuZGF0YTsNCgkJCXZhciBkYXRhc2V0cyA9IGRhdGEuZGF0YXNldHM7DQoJCQl2YXIgdmFsdWVPckRlZmF1bHQgPSBoZWxwZXJzLnZhbHVlT3JEZWZhdWx0Ow0KCQkJdmFyIGlzSG9yaXpvbnRhbCA9IG1lLmlzSG9yaXpvbnRhbCgpOw0KCQkJZnVuY3Rpb24gSURNYXRjaGVzKG1ldGEpIHsNCgkJCQlyZXR1cm4gaXNIb3Jpem9udGFsID8gbWV0YS54QXhpc0lEID09PSBtZS5pZCA6IG1ldGEueUF4aXNJRCA9PT0gbWUuaWQ7DQoJCQl9DQoNCgkJCS8vIENhbGN1bGF0ZSBSYW5nZQ0KCQkJbWUubWluID0gbnVsbDsNCgkJCW1lLm1heCA9IG51bGw7DQoJCQltZS5taW5Ob3RaZXJvID0gbnVsbDsNCg0KCQkJdmFyIGhhc1N0YWNrcyA9IG9wdHMuc3RhY2tlZDsNCgkJCWlmIChoYXNTdGFja3MgPT09IHVuZGVmaW5lZCkgew0KCQkJCWhlbHBlcnMuZWFjaChkYXRhc2V0cywgZnVuY3Rpb24oZGF0YXNldCwgZGF0YXNldEluZGV4KSB7DQoJCQkJCWlmIChoYXNTdGFja3MpIHsNCgkJCQkJCXJldHVybjsNCgkJCQkJfQ0KDQoJCQkJCXZhciBtZXRhID0gY2hhcnQuZ2V0RGF0YXNldE1ldGEoZGF0YXNldEluZGV4KTsNCgkJCQkJaWYgKGNoYXJ0LmlzRGF0YXNldFZpc2libGUoZGF0YXNldEluZGV4KSAmJiBJRE1hdGNoZXMobWV0YSkgJiYNCgkJCQkJCW1ldGEuc3RhY2sgIT09IHVuZGVmaW5lZCkgew0KCQkJCQkJaGFzU3RhY2tzID0gdHJ1ZTsNCgkJCQkJfQ0KCQkJCX0pOw0KCQkJfQ0KDQoJCQlpZiAob3B0cy5zdGFja2VkIHx8IGhhc1N0YWNrcykgew0KCQkJCXZhciB2YWx1ZXNQZXJTdGFjayA9IHt9Ow0KDQoJCQkJaGVscGVycy5lYWNoKGRhdGFzZXRzLCBmdW5jdGlvbihkYXRhc2V0LCBkYXRhc2V0SW5kZXgpIHsNCgkJCQkJdmFyIG1ldGEgPSBjaGFydC5nZXREYXRhc2V0TWV0YShkYXRhc2V0SW5kZXgpOw0KCQkJCQl2YXIga2V5ID0gWw0KCQkJCQkJbWV0YS50eXBlLA0KCQkJCQkJLy8gd2UgaGF2ZSBhIHNlcGFyYXRlIHN0YWNrIGZvciBzdGFjaz11bmRlZmluZWQgZGF0YXNldHMgd2hlbiB0aGUgb3B0cy5zdGFja2VkIGlzIHVuZGVmaW5lZA0KCQkJCQkJKChvcHRzLnN0YWNrZWQgPT09IHVuZGVmaW5lZCAmJiBtZXRhLnN0YWNrID09PSB1bmRlZmluZWQpID8gZGF0YXNldEluZGV4IDogJycpLA0KCQkJCQkJbWV0YS5zdGFjaw0KCQkJCQldLmpvaW4oJy4nKTsNCg0KCQkJCQlpZiAoY2hhcnQuaXNEYXRhc2V0VmlzaWJsZShkYXRhc2V0SW5kZXgpICYmIElETWF0Y2hlcyhtZXRhKSkgew0KCQkJCQkJaWYgKHZhbHVlc1BlclN0YWNrW2tleV0gPT09IHVuZGVmaW5lZCkgew0KCQkJCQkJCXZhbHVlc1BlclN0YWNrW2tleV0gPSBbXTsNCgkJCQkJCX0NCg0KCQkJCQkJaGVscGVycy5lYWNoKGRhdGFzZXQuZGF0YSwgZnVuY3Rpb24ocmF3VmFsdWUsIGluZGV4KSB7DQoJCQkJCQkJdmFyIHZhbHVlcyA9IHZhbHVlc1BlclN0YWNrW2tleV07DQoJCQkJCQkJdmFyIHZhbHVlID0gK21lLmdldFJpZ2h0VmFsdWUocmF3VmFsdWUpOw0KCQkJCQkJCWlmIChpc05hTih2YWx1ZSkgfHwgbWV0YS5kYXRhW2luZGV4XS5oaWRkZW4pIHsNCgkJCQkJCQkJcmV0dXJuOw0KCQkJCQkJCX0NCg0KCQkJCQkJCXZhbHVlc1tpbmRleF0gPSB2YWx1ZXNbaW5kZXhdIHx8IDA7DQoNCgkJCQkJCQlpZiAob3B0cy5yZWxhdGl2ZVBvaW50cykgew0KCQkJCQkJCQl2YWx1ZXNbaW5kZXhdID0gMTAwOw0KCQkJCQkJCX0gZWxzZSB7DQoJCQkJCQkJCS8vIERvbid0IG5lZWQgdG8gc3BsaXQgcG9zaXRpdmUgYW5kIG5lZ2F0aXZlIHNpbmNlIHRoZSBsb2cgc2NhbGUgY2FuJ3QgaGFuZGxlIGEgMCBjcm9zc2luZw0KCQkJCQkJCQl2YWx1ZXNbaW5kZXhdICs9IHZhbHVlOw0KCQkJCQkJCX0NCgkJCQkJCX0pOw0KCQkJCQl9DQoJCQkJfSk7DQoNCgkJCQloZWxwZXJzLmVhY2godmFsdWVzUGVyU3RhY2ssIGZ1bmN0aW9uKHZhbHVlc0ZvclR5cGUpIHsNCgkJCQkJdmFyIG1pblZhbCA9IGhlbHBlcnMubWluKHZhbHVlc0ZvclR5cGUpOw0KCQkJCQl2YXIgbWF4VmFsID0gaGVscGVycy5tYXgodmFsdWVzRm9yVHlwZSk7DQoJCQkJCW1lLm1pbiA9IG1lLm1pbiA9PT0gbnVsbCA/IG1pblZhbCA6IE1hdGgubWluKG1lLm1pbiwgbWluVmFsKTsNCgkJCQkJbWUubWF4ID0gbWUubWF4ID09PSBudWxsID8gbWF4VmFsIDogTWF0aC5tYXgobWUubWF4LCBtYXhWYWwpOw0KCQkJCX0pOw0KDQoJCQl9IGVsc2Ugew0KCQkJCWhlbHBlcnMuZWFjaChkYXRhc2V0cywgZnVuY3Rpb24oZGF0YXNldCwgZGF0YXNldEluZGV4KSB7DQoJCQkJCXZhciBtZXRhID0gY2hhcnQuZ2V0RGF0YXNldE1ldGEoZGF0YXNldEluZGV4KTsNCgkJCQkJaWYgKGNoYXJ0LmlzRGF0YXNldFZpc2libGUoZGF0YXNldEluZGV4KSAmJiBJRE1hdGNoZXMobWV0YSkpIHsNCgkJCQkJCWhlbHBlcnMuZWFjaChkYXRhc2V0LmRhdGEsIGZ1bmN0aW9uKHJhd1ZhbHVlLCBpbmRleCkgew0KCQkJCQkJCXZhciB2YWx1ZSA9ICttZS5nZXRSaWdodFZhbHVlKHJhd1ZhbHVlKTsNCgkJCQkJCQlpZiAoaXNOYU4odmFsdWUpIHx8IG1ldGEuZGF0YVtpbmRleF0uaGlkZGVuKSB7DQoJCQkJCQkJCXJldHVybjsNCgkJCQkJCQl9DQoNCgkJCQkJCQlpZiAobWUubWluID09PSBudWxsKSB7DQoJCQkJCQkJCW1lLm1pbiA9IHZhbHVlOw0KCQkJCQkJCX0gZWxzZSBpZiAodmFsdWUgPCBtZS5taW4pIHsNCgkJCQkJCQkJbWUubWluID0gdmFsdWU7DQoJCQkJCQkJfQ0KDQoJCQkJCQkJaWYgKG1lLm1heCA9PT0gbnVsbCkgew0KCQkJCQkJCQltZS5tYXggPSB2YWx1ZTsNCgkJCQkJCQl9IGVsc2UgaWYgKHZhbHVlID4gbWUubWF4KSB7DQoJCQkJCQkJCW1lLm1heCA9IHZhbHVlOw0KCQkJCQkJCX0NCg0KCQkJCQkJCWlmICh2YWx1ZSAhPT0gMCAmJiAobWUubWluTm90WmVybyA9PT0gbnVsbCB8fCB2YWx1ZSA8IG1lLm1pbk5vdFplcm8pKSB7DQoJCQkJCQkJCW1lLm1pbk5vdFplcm8gPSB2YWx1ZTsNCgkJCQkJCQl9DQoJCQkJCQl9KTsNCgkJCQkJfQ0KCQkJCX0pOw0KCQkJfQ0KDQoJCQltZS5taW4gPSB2YWx1ZU9yRGVmYXVsdCh0aWNrT3B0cy5taW4sIG1lLm1pbik7DQoJCQltZS5tYXggPSB2YWx1ZU9yRGVmYXVsdCh0aWNrT3B0cy5tYXgsIG1lLm1heCk7DQoNCgkJCWlmIChtZS5taW4gPT09IG1lLm1heCkgew0KCQkJCWlmIChtZS5taW4gIT09IDAgJiYgbWUubWluICE9PSBudWxsKSB7DQoJCQkJCW1lLm1pbiA9IE1hdGgucG93KDEwLCBNYXRoLmZsb29yKGhlbHBlcnMubG9nMTAobWUubWluKSkgLSAxKTsNCgkJCQkJbWUubWF4ID0gTWF0aC5wb3coMTAsIE1hdGguZmxvb3IoaGVscGVycy5sb2cxMChtZS5tYXgpKSArIDEpOw0KCQkJCX0gZWxzZSB7DQoJCQkJCW1lLm1pbiA9IDE7DQoJCQkJCW1lLm1heCA9IDEwOw0KCQkJCX0NCgkJCX0NCgkJfSwNCgkJYnVpbGRUaWNrczogZnVuY3Rpb24oKSB7DQoJCQl2YXIgbWUgPSB0aGlzOw0KCQkJdmFyIG9wdHMgPSBtZS5vcHRpb25zOw0KCQkJdmFyIHRpY2tPcHRzID0gb3B0cy50aWNrczsNCg0KCQkJdmFyIGdlbmVyYXRpb25PcHRpb25zID0gew0KCQkJCW1pbjogdGlja09wdHMubWluLA0KCQkJCW1heDogdGlja09wdHMubWF4DQoJCQl9Ow0KCQkJdmFyIHRpY2tzID0gbWUudGlja3MgPSBUaWNrcy5nZW5lcmF0b3JzLmxvZ2FyaXRobWljKGdlbmVyYXRpb25PcHRpb25zLCBtZSk7DQoNCgkJCWlmICghbWUuaXNIb3Jpem9udGFsKCkpIHsNCgkJCQkvLyBXZSBhcmUgaW4gYSB2ZXJ0aWNhbCBvcmllbnRhdGlvbi4gVGhlIHRvcCB2YWx1ZSBpcyB0aGUgaGlnaGVzdC4gU28gcmV2ZXJzZSB0aGUgYXJyYXkNCgkJCQl0aWNrcy5yZXZlcnNlKCk7DQoJCQl9DQoNCgkJCS8vIEF0IHRoaXMgcG9pbnQsIHdlIG5lZWQgdG8gdXBkYXRlIG91ciBtYXggYW5kIG1pbiBnaXZlbiB0aGUgdGljayB2YWx1ZXMgc2luY2Ugd2UgaGF2ZSBleHBhbmRlZCB0aGUNCgkJCS8vIHJhbmdlIG9mIHRoZSBzY2FsZQ0KCQkJbWUubWF4ID0gaGVscGVycy5tYXgodGlja3MpOw0KCQkJbWUubWluID0gaGVscGVycy5taW4odGlja3MpOw0KDQoJCQlpZiAodGlja09wdHMucmV2ZXJzZSkgew0KCQkJCXRpY2tzLnJldmVyc2UoKTsNCg0KCQkJCW1lLnN0YXJ0ID0gbWUubWF4Ow0KCQkJCW1lLmVuZCA9IG1lLm1pbjsNCgkJCX0gZWxzZSB7DQoJCQkJbWUuc3RhcnQgPSBtZS5taW47DQoJCQkJbWUuZW5kID0gbWUubWF4Ow0KCQkJfQ0KCQl9LA0KCQljb252ZXJ0VGlja3NUb0xhYmVsczogZnVuY3Rpb24oKSB7DQoJCQl0aGlzLnRpY2tWYWx1ZXMgPSB0aGlzLnRpY2tzLnNsaWNlKCk7DQoNCgkJCUNoYXJ0LlNjYWxlLnByb3RvdHlwZS5jb252ZXJ0VGlja3NUb0xhYmVscy5jYWxsKHRoaXMpOw0KCQl9LA0KCQkvLyBHZXQgdGhlIGNvcnJlY3QgdG9vbHRpcCBsYWJlbA0KCQlnZXRMYWJlbEZvckluZGV4OiBmdW5jdGlvbihpbmRleCwgZGF0YXNldEluZGV4KSB7DQoJCQlyZXR1cm4gK3RoaXMuZ2V0UmlnaHRWYWx1ZSh0aGlzLmNoYXJ0LmRhdGEuZGF0YXNldHNbZGF0YXNldEluZGV4XS5kYXRhW2luZGV4XSk7DQoJCX0sDQoJCWdldFBpeGVsRm9yVGljazogZnVuY3Rpb24oaW5kZXgpIHsNCgkJCXJldHVybiB0aGlzLmdldFBpeGVsRm9yVmFsdWUodGhpcy50aWNrVmFsdWVzW2luZGV4XSk7DQoJCX0sDQoJCWdldFBpeGVsRm9yVmFsdWU6IGZ1bmN0aW9uKHZhbHVlKSB7DQoJCQl2YXIgbWUgPSB0aGlzOw0KCQkJdmFyIHN0YXJ0ID0gbWUuc3RhcnQ7DQoJCQl2YXIgbmV3VmFsID0gK21lLmdldFJpZ2h0VmFsdWUodmFsdWUpOw0KCQkJdmFyIG9wdHMgPSBtZS5vcHRpb25zOw0KCQkJdmFyIHRpY2tPcHRzID0gb3B0cy50aWNrczsNCgkJCXZhciBpbm5lckRpbWVuc2lvbiwgcGl4ZWwsIHJhbmdlOw0KDQoJCQlpZiAobWUuaXNIb3Jpem9udGFsKCkpIHsNCgkJCQlyYW5nZSA9IGhlbHBlcnMubG9nMTAobWUuZW5kKSAtIGhlbHBlcnMubG9nMTAoc3RhcnQpOyAvLyB0b2RvOiBpZiBzdGFydCA9PT0gMA0KCQkJCWlmIChuZXdWYWwgPT09IDApIHsNCgkJCQkJcGl4ZWwgPSBtZS5sZWZ0Ow0KCQkJCX0gZWxzZSB7DQoJCQkJCWlubmVyRGltZW5zaW9uID0gbWUud2lkdGg7DQoJCQkJCXBpeGVsID0gbWUubGVmdCArIChpbm5lckRpbWVuc2lvbiAvIHJhbmdlICogKGhlbHBlcnMubG9nMTAobmV3VmFsKSAtIGhlbHBlcnMubG9nMTAoc3RhcnQpKSk7DQoJCQkJfQ0KCQkJfSBlbHNlIHsNCgkJCQkvLyBCb3R0b20gLSB0b3Agc2luY2UgcGl4ZWxzIGluY3JlYXNlIGRvd253YXJkIG9uIGEgc2NyZWVuDQoJCQkJaW5uZXJEaW1lbnNpb24gPSBtZS5oZWlnaHQ7DQoJCQkJaWYgKHN0YXJ0ID09PSAwICYmICF0aWNrT3B0cy5yZXZlcnNlKSB7DQoJCQkJCXJhbmdlID0gaGVscGVycy5sb2cxMChtZS5lbmQpIC0gaGVscGVycy5sb2cxMChtZS5taW5Ob3RaZXJvKTsNCgkJCQkJaWYgKG5ld1ZhbCA9PT0gc3RhcnQpIHsNCgkJCQkJCXBpeGVsID0gbWUuYm90dG9tOw0KCQkJCQl9IGVsc2UgaWYgKG5ld1ZhbCA9PT0gbWUubWluTm90WmVybykgew0KCQkJCQkJcGl4ZWwgPSBtZS5ib3R0b20gLSBpbm5lckRpbWVuc2lvbiAqIDAuMDI7DQoJCQkJCX0gZWxzZSB7DQoJCQkJCQlwaXhlbCA9IG1lLmJvdHRvbSAtIGlubmVyRGltZW5zaW9uICogMC4wMiAtIChpbm5lckRpbWVuc2lvbiAqIDAuOTggLyByYW5nZSAqIChoZWxwZXJzLmxvZzEwKG5ld1ZhbCkgLSBoZWxwZXJzLmxvZzEwKG1lLm1pbk5vdFplcm8pKSk7DQoJCQkJCX0NCgkJCQl9IGVsc2UgaWYgKG1lLmVuZCA9PT0gMCAmJiB0aWNrT3B0cy5yZXZlcnNlKSB7DQoJCQkJCXJhbmdlID0gaGVscGVycy5sb2cxMChtZS5zdGFydCkgLSBoZWxwZXJzLmxvZzEwKG1lLm1pbk5vdFplcm8pOw0KCQkJCQlpZiAobmV3VmFsID09PSBtZS5lbmQpIHsNCgkJCQkJCXBpeGVsID0gbWUudG9wOw0KCQkJCQl9IGVsc2UgaWYgKG5ld1ZhbCA9PT0gbWUubWluTm90WmVybykgew0KCQkJCQkJcGl4ZWwgPSBtZS50b3AgKyBpbm5lckRpbWVuc2lvbiAqIDAuMDI7DQoJCQkJCX0gZWxzZSB7DQoJCQkJCQlwaXhlbCA9IG1lLnRvcCArIGlubmVyRGltZW5zaW9uICogMC4wMiArIChpbm5lckRpbWVuc2lvbiAqIDAuOTggLyByYW5nZSAqIChoZWxwZXJzLmxvZzEwKG5ld1ZhbCkgLSBoZWxwZXJzLmxvZzEwKG1lLm1pbk5vdFplcm8pKSk7DQoJCQkJCX0NCgkJCQl9IGVsc2UgaWYgKG5ld1ZhbCA9PT0gMCkgew0KCQkJCQlwaXhlbCA9IHRpY2tPcHRzLnJldmVyc2UgPyBtZS50b3AgOiBtZS5ib3R0b207DQoJCQkJfSBlbHNlIHsNCgkJCQkJcmFuZ2UgPSBoZWxwZXJzLmxvZzEwKG1lLmVuZCkgLSBoZWxwZXJzLmxvZzEwKHN0YXJ0KTsNCgkJCQkJaW5uZXJEaW1lbnNpb24gPSBtZS5oZWlnaHQ7DQoJCQkJCXBpeGVsID0gbWUuYm90dG9tIC0gKGlubmVyRGltZW5zaW9uIC8gcmFuZ2UgKiAoaGVscGVycy5sb2cxMChuZXdWYWwpIC0gaGVscGVycy5sb2cxMChzdGFydCkpKTsNCgkJCQl9DQoJCQl9DQoJCQlyZXR1cm4gcGl4ZWw7DQoJCX0sDQoJCWdldFZhbHVlRm9yUGl4ZWw6IGZ1bmN0aW9uKHBpeGVsKSB7DQoJCQl2YXIgbWUgPSB0aGlzOw0KCQkJdmFyIHJhbmdlID0gaGVscGVycy5sb2cxMChtZS5lbmQpIC0gaGVscGVycy5sb2cxMChtZS5zdGFydCk7DQoJCQl2YXIgdmFsdWUsIGlubmVyRGltZW5zaW9uOw0KDQoJCQlpZiAobWUuaXNIb3Jpem9udGFsKCkpIHsNCgkJCQlpbm5lckRpbWVuc2lvbiA9IG1lLndpZHRoOw0KCQkJCXZhbHVlID0gbWUuc3RhcnQgKiBNYXRoLnBvdygxMCwgKHBpeGVsIC0gbWUubGVmdCkgKiByYW5nZSAvIGlubmVyRGltZW5zaW9uKTsNCgkJCX0gZWxzZSB7IC8vIHRvZG86IGlmIHN0YXJ0ID09PSAwDQoJCQkJaW5uZXJEaW1lbnNpb24gPSBtZS5oZWlnaHQ7DQoJCQkJdmFsdWUgPSBNYXRoLnBvdygxMCwgKG1lLmJvdHRvbSAtIHBpeGVsKSAqIHJhbmdlIC8gaW5uZXJEaW1lbnNpb24pIC8gbWUuc3RhcnQ7DQoJCQl9DQoJCQlyZXR1cm4gdmFsdWU7DQoJCX0NCgl9KTsNCglDaGFydC5zY2FsZVNlcnZpY2UucmVnaXN0ZXJTY2FsZVR5cGUoJ2xvZ2FyaXRobWljJywgTG9nYXJpdGhtaWNTY2FsZSwgZGVmYXVsdENvbmZpZyk7DQoNCn07DQoNCn0seyIzNCI6MzQsIjQ1Ijo0NX1dLDU2OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsNCid1c2Ugc3RyaWN0JzsNCg0KdmFyIGRlZmF1bHRzID0gcmVxdWlyZSgyNSk7DQp2YXIgaGVscGVycyA9IHJlcXVpcmUoNDUpOw0KdmFyIFRpY2tzID0gcmVxdWlyZSgzNCk7DQoNCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oQ2hhcnQpIHsNCg0KCXZhciBnbG9iYWxEZWZhdWx0cyA9IGRlZmF1bHRzLmdsb2JhbDsNCg0KCXZhciBkZWZhdWx0Q29uZmlnID0gew0KCQlkaXNwbGF5OiB0cnVlLA0KDQoJCS8vIEJvb2xlYW4gLSBXaGV0aGVyIHRvIGFuaW1hdGUgc2NhbGluZyB0aGUgY2hhcnQgZnJvbSB0aGUgY2VudHJlDQoJCWFuaW1hdGU6IHRydWUsDQoJCXBvc2l0aW9uOiAnY2hhcnRBcmVhJywNCg0KCQlhbmdsZUxpbmVzOiB7DQoJCQlkaXNwbGF5OiB0cnVlLA0KCQkJY29sb3I6ICdyZ2JhKDAsIDAsIDAsIDAuMSknLA0KCQkJbGluZVdpZHRoOiAxDQoJCX0sDQoNCgkJZ3JpZExpbmVzOiB7DQoJCQljaXJjdWxhcjogZmFsc2UNCgkJfSwNCg0KCQkvLyBsYWJlbCBzZXR0aW5ncw0KCQl0aWNrczogew0KCQkJLy8gQm9vbGVhbiAtIFNob3cgYSBiYWNrZHJvcCB0byB0aGUgc2NhbGUgbGFiZWwNCgkJCXNob3dMYWJlbEJhY2tkcm9wOiB0cnVlLA0KDQoJCQkvLyBTdHJpbmcgLSBUaGUgY29sb3VyIG9mIHRoZSBsYWJlbCBiYWNrZHJvcA0KCQkJYmFja2Ryb3BDb2xvcjogJ3JnYmEoMjU1LDI1NSwyNTUsMC43NSknLA0KDQoJCQkvLyBOdW1iZXIgLSBUaGUgYmFja2Ryb3AgcGFkZGluZyBhYm92ZSAmIGJlbG93IHRoZSBsYWJlbCBpbiBwaXhlbHMNCgkJCWJhY2tkcm9wUGFkZGluZ1k6IDIsDQoNCgkJCS8vIE51bWJlciAtIFRoZSBiYWNrZHJvcCBwYWRkaW5nIHRvIHRoZSBzaWRlIG9mIHRoZSBsYWJlbCBpbiBwaXhlbHMNCgkJCWJhY2tkcm9wUGFkZGluZ1g6IDIsDQoNCgkJCWNhbGxiYWNrOiBUaWNrcy5mb3JtYXR0ZXJzLmxpbmVhcg0KCQl9LA0KDQoJCXBvaW50TGFiZWxzOiB7DQoJCQkvLyBCb29sZWFuIC0gaWYgdHJ1ZSwgc2hvdyBwb2ludCBsYWJlbHMNCgkJCWRpc3BsYXk6IHRydWUsDQoNCgkJCS8vIE51bWJlciAtIFBvaW50IGxhYmVsIGZvbnQgc2l6ZSBpbiBwaXhlbHMNCgkJCWZvbnRTaXplOiAxMCwNCg0KCQkJLy8gRnVuY3Rpb24gLSBVc2VkIHRvIGNvbnZlcnQgcG9pbnQgbGFiZWxzDQoJCQljYWxsYmFjazogZnVuY3Rpb24obGFiZWwpIHsNCgkJCQlyZXR1cm4gbGFiZWw7DQoJCQl9DQoJCX0NCgl9Ow0KDQoJZnVuY3Rpb24gZ2V0VmFsdWVDb3VudChzY2FsZSkgew0KCQl2YXIgb3B0cyA9IHNjYWxlLm9wdGlvbnM7DQoJCXJldHVybiBvcHRzLmFuZ2xlTGluZXMuZGlzcGxheSB8fCBvcHRzLnBvaW50TGFiZWxzLmRpc3BsYXkgPyBzY2FsZS5jaGFydC5kYXRhLmxhYmVscy5sZW5ndGggOiAwOw0KCX0NCg0KCWZ1bmN0aW9uIGdldFBvaW50TGFiZWxGb250T3B0aW9ucyhzY2FsZSkgew0KCQl2YXIgcG9pbnRMYWJlbE9wdGlvbnMgPSBzY2FsZS5vcHRpb25zLnBvaW50TGFiZWxzOw0KCQl2YXIgZm9udFNpemUgPSBoZWxwZXJzLnZhbHVlT3JEZWZhdWx0KHBvaW50TGFiZWxPcHRpb25zLmZvbnRTaXplLCBnbG9iYWxEZWZhdWx0cy5kZWZhdWx0Rm9udFNpemUpOw0KCQl2YXIgZm9udFN0eWxlID0gaGVscGVycy52YWx1ZU9yRGVmYXVsdChwb2ludExhYmVsT3B0aW9ucy5mb250U3R5bGUsIGdsb2JhbERlZmF1bHRzLmRlZmF1bHRGb250U3R5bGUpOw0KCQl2YXIgZm9udEZhbWlseSA9IGhlbHBlcnMudmFsdWVPckRlZmF1bHQocG9pbnRMYWJlbE9wdGlvbnMuZm9udEZhbWlseSwgZ2xvYmFsRGVmYXVsdHMuZGVmYXVsdEZvbnRGYW1pbHkpOw0KCQl2YXIgZm9udCA9IGhlbHBlcnMuZm9udFN0cmluZyhmb250U2l6ZSwgZm9udFN0eWxlLCBmb250RmFtaWx5KTsNCg0KCQlyZXR1cm4gew0KCQkJc2l6ZTogZm9udFNpemUsDQoJCQlzdHlsZTogZm9udFN0eWxlLA0KCQkJZmFtaWx5OiBmb250RmFtaWx5LA0KCQkJZm9udDogZm9udA0KCQl9Ow0KCX0NCg0KCWZ1bmN0aW9uIG1lYXN1cmVMYWJlbFNpemUoY3R4LCBmb250U2l6ZSwgbGFiZWwpIHsNCgkJaWYgKGhlbHBlcnMuaXNBcnJheShsYWJlbCkpIHsNCgkJCXJldHVybiB7DQoJCQkJdzogaGVscGVycy5sb25nZXN0VGV4dChjdHgsIGN0eC5mb250LCBsYWJlbCksDQoJCQkJaDogKGxhYmVsLmxlbmd0aCAqIGZvbnRTaXplKSArICgobGFiZWwubGVuZ3RoIC0gMSkgKiAxLjUgKiBmb250U2l6ZSkNCgkJCX07DQoJCX0NCg0KCQlyZXR1cm4gew0KCQkJdzogY3R4Lm1lYXN1cmVUZXh0KGxhYmVsKS53aWR0aCwNCgkJCWg6IGZvbnRTaXplDQoJCX07DQoJfQ0KDQoJZnVuY3Rpb24gZGV0ZXJtaW5lTGltaXRzKGFuZ2xlLCBwb3MsIHNpemUsIG1pbiwgbWF4KSB7DQoJCWlmIChhbmdsZSA9PT0gbWluIHx8IGFuZ2xlID09PSBtYXgpIHsNCgkJCXJldHVybiB7DQoJCQkJc3RhcnQ6IHBvcyAtIChzaXplIC8gMiksDQoJCQkJZW5kOiBwb3MgKyAoc2l6ZSAvIDIpDQoJCQl9Ow0KCQl9IGVsc2UgaWYgKGFuZ2xlIDwgbWluIHx8IGFuZ2xlID4gbWF4KSB7DQoJCQlyZXR1cm4gew0KCQkJCXN0YXJ0OiBwb3MgLSBzaXplIC0gNSwNCgkJCQllbmQ6IHBvcw0KCQkJfTsNCgkJfQ0KDQoJCXJldHVybiB7DQoJCQlzdGFydDogcG9zLA0KCQkJZW5kOiBwb3MgKyBzaXplICsgNQ0KCQl9Ow0KCX0NCg0KCS8qKg0KCSAqIEhlbHBlciBmdW5jdGlvbiB0byBmaXQgYSByYWRpYWwgbGluZWFyIHNjYWxlIHdpdGggcG9pbnQgbGFiZWxzDQoJICovDQoJZnVuY3Rpb24gZml0V2l0aFBvaW50TGFiZWxzKHNjYWxlKSB7DQoJCS8qDQoJCSAqIFJpZ2h0LCB0aGlzIGlzIHJlYWxseSBjb25mdXNpbmcgYW5kIHRoZXJlIGlzIGEgbG90IG9mIG1hdGhzIGdvaW5nIG9uIGhlcmUNCgkJICogVGhlIGdpc3Qgb2YgdGhlIHByb2JsZW0gaXMgaGVyZTogaHR0cHM6Ly9naXN0LmdpdGh1Yi5jb20vbm5uaWNrLzY5NmNjOWM1NWY0YjBiZWI4ZmU5DQoJCSAqDQoJCSAqIFJlYWN0aW9uOiBodHRwczovL2RsLmRyb3Bib3h1c2VyY29udGVudC5jb20vdS8zNDYwMTM2My90b29tdWNoc2NpZW5jZS5naWYNCgkJICoNCgkJICogU29sdXRpb246DQoJCSAqDQoJCSAqIFdlIGFzc3VtZSB0aGUgcmFkaXVzIG9mIHRoZSBwb2x5Z29uIGlzIGhhbGYgdGhlIHNpemUgb2YgdGhlIGNhbnZhcyBhdCBmaXJzdA0KCQkgKiBhdCBlYWNoIGluZGV4IHdlIGNoZWNrIGlmIHRoZSB0ZXh0IG92ZXJsYXBzLg0KCQkgKg0KCQkgKiBXaGVyZSBpdCBkb2VzLCB3ZSBzdG9yZSB0aGF0IGFuZ2xlIGFuZCB0aGF0IGluZGV4Lg0KCQkgKg0KCQkgKiBBZnRlciBmaW5kaW5nIHRoZSBsYXJnZXN0IGluZGV4IGFuZCBhbmdsZSB3ZSBjYWxjdWxhdGUgaG93IG11Y2ggd2UgbmVlZCB0byByZW1vdmUNCgkJICogZnJvbSB0aGUgc2hhcGUgcmFkaXVzIHRvIG1vdmUgdGhlIHBvaW50IGlud2FyZHMgYnkgdGhhdCB4Lg0KCQkgKg0KCQkgKiBXZSBhdmVyYWdlIHRoZSBsZWZ0IGFuZCByaWdodCBkaXN0YW5jZXMgdG8gZ2V0IHRoZSBtYXhpbXVtIHNoYXBlIHJhZGl1cyB0aGF0IGNhbiBmaXQgaW4gdGhlIGJveA0KCQkgKiBhbG9uZyB3aXRoIGxhYmVscy4NCgkJICoNCgkJICogT25jZSB3ZSBoYXZlIHRoYXQsIHdlIGNhbiBmaW5kIHRoZSBjZW50cmUgcG9pbnQgZm9yIHRoZSBjaGFydCwgYnkgdGFraW5nIHRoZSB4IHRleHQgcHJvdHJ1c2lvbg0KCQkgKiBvbiBlYWNoIHNpZGUsIHJlbW92aW5nIHRoYXQgZnJvbSB0aGUgc2l6ZSwgaGFsdmluZyBpdCBhbmQgYWRkaW5nIHRoZSBsZWZ0IHggcHJvdHJ1c2lvbiB3aWR0aC4NCgkJICoNCgkJICogVGhpcyB3aWxsIG1lYW4gd2UgaGF2ZSBhIHNoYXBlIGZpdHRlZCB0byB0aGUgY2FudmFzLCBhcyBsYXJnZSBhcyBpdCBjYW4gYmUgd2l0aCB0aGUgbGFiZWxzDQoJCSAqIGFuZCBwb3NpdGlvbiBpdCBpbiB0aGUgbW9zdCBzcGFjZSBlZmZpY2llbnQgbWFubmVyDQoJCSAqDQoJCSAqIGh0dHBzOi8vZGwuZHJvcGJveHVzZXJjb250ZW50LmNvbS91LzM0NjAxMzYzL3llYWhzY2llbmNlLmdpZg0KCQkgKi8NCg0KCQl2YXIgcGxGb250ID0gZ2V0UG9pbnRMYWJlbEZvbnRPcHRpb25zKHNjYWxlKTsNCg0KCQkvLyBHZXQgbWF4aW11bSByYWRpdXMgb2YgdGhlIHBvbHlnb24uIEVpdGhlciBoYWxmIHRoZSBoZWlnaHQgKG1pbnVzIHRoZSB0ZXh0IHdpZHRoKSBvciBoYWxmIHRoZSB3aWR0aC4NCgkJLy8gVXNlIHRoaXMgdG8gY2FsY3VsYXRlIHRoZSBvZmZzZXQgKyBjaGFuZ2UuIC0gTWFrZSBzdXJlIEwvUiBwcm90cnVzaW9uIGlzIGF0IGxlYXN0IDAgdG8gc3RvcCBpc3N1ZXMgd2l0aCBjZW50cmUgcG9pbnRzDQoJCXZhciBsYXJnZXN0UG9zc2libGVSYWRpdXMgPSBNYXRoLm1pbihzY2FsZS5oZWlnaHQgLyAyLCBzY2FsZS53aWR0aCAvIDIpOw0KCQl2YXIgZnVydGhlc3RMaW1pdHMgPSB7DQoJCQlyOiBzY2FsZS53aWR0aCwNCgkJCWw6IDAsDQoJCQl0OiBzY2FsZS5oZWlnaHQsDQoJCQliOiAwDQoJCX07DQoJCXZhciBmdXJ0aGVzdEFuZ2xlcyA9IHt9Ow0KCQl2YXIgaSwgdGV4dFNpemUsIHBvaW50UG9zaXRpb247DQoNCgkJc2NhbGUuY3R4LmZvbnQgPSBwbEZvbnQuZm9udDsNCgkJc2NhbGUuX3BvaW50TGFiZWxTaXplcyA9IFtdOw0KDQoJCXZhciB2YWx1ZUNvdW50ID0gZ2V0VmFsdWVDb3VudChzY2FsZSk7DQoJCWZvciAoaSA9IDA7IGkgPCB2YWx1ZUNvdW50OyBpKyspIHsNCgkJCXBvaW50UG9zaXRpb24gPSBzY2FsZS5nZXRQb2ludFBvc2l0aW9uKGksIGxhcmdlc3RQb3NzaWJsZVJhZGl1cyk7DQoJCQl0ZXh0U2l6ZSA9IG1lYXN1cmVMYWJlbFNpemUoc2NhbGUuY3R4LCBwbEZvbnQuc2l6ZSwgc2NhbGUucG9pbnRMYWJlbHNbaV0gfHwgJycpOw0KCQkJc2NhbGUuX3BvaW50TGFiZWxTaXplc1tpXSA9IHRleHRTaXplOw0KDQoJCQkvLyBBZGQgcXVhcnRlciBjaXJjbGUgdG8gbWFrZSBkZWdyZWUgMCBtZWFuIHRvcCBvZiBjaXJjbGUNCgkJCXZhciBhbmdsZVJhZGlhbnMgPSBzY2FsZS5nZXRJbmRleEFuZ2xlKGkpOw0KCQkJdmFyIGFuZ2xlID0gaGVscGVycy50b0RlZ3JlZXMoYW5nbGVSYWRpYW5zKSAlIDM2MDsNCgkJCXZhciBoTGltaXRzID0gZGV0ZXJtaW5lTGltaXRzKGFuZ2xlLCBwb2ludFBvc2l0aW9uLngsIHRleHRTaXplLncsIDAsIDE4MCk7DQoJCQl2YXIgdkxpbWl0cyA9IGRldGVybWluZUxpbWl0cyhhbmdsZSwgcG9pbnRQb3NpdGlvbi55LCB0ZXh0U2l6ZS5oLCA5MCwgMjcwKTsNCg0KCQkJaWYgKGhMaW1pdHMuc3RhcnQgPCBmdXJ0aGVzdExpbWl0cy5sKSB7DQoJCQkJZnVydGhlc3RMaW1pdHMubCA9IGhMaW1pdHMuc3RhcnQ7DQoJCQkJZnVydGhlc3RBbmdsZXMubCA9IGFuZ2xlUmFkaWFuczsNCgkJCX0NCg0KCQkJaWYgKGhMaW1pdHMuZW5kID4gZnVydGhlc3RMaW1pdHMucikgew0KCQkJCWZ1cnRoZXN0TGltaXRzLnIgPSBoTGltaXRzLmVuZDsNCgkJCQlmdXJ0aGVzdEFuZ2xlcy5yID0gYW5nbGVSYWRpYW5zOw0KCQkJfQ0KDQoJCQlpZiAodkxpbWl0cy5zdGFydCA8IGZ1cnRoZXN0TGltaXRzLnQpIHsNCgkJCQlmdXJ0aGVzdExpbWl0cy50ID0gdkxpbWl0cy5zdGFydDsNCgkJCQlmdXJ0aGVzdEFuZ2xlcy50ID0gYW5nbGVSYWRpYW5zOw0KCQkJfQ0KDQoJCQlpZiAodkxpbWl0cy5lbmQgPiBmdXJ0aGVzdExpbWl0cy5iKSB7DQoJCQkJZnVydGhlc3RMaW1pdHMuYiA9IHZMaW1pdHMuZW5kOw0KCQkJCWZ1cnRoZXN0QW5nbGVzLmIgPSBhbmdsZVJhZGlhbnM7DQoJCQl9DQoJCX0NCg0KCQlzY2FsZS5zZXRSZWR1Y3Rpb25zKGxhcmdlc3RQb3NzaWJsZVJhZGl1cywgZnVydGhlc3RMaW1pdHMsIGZ1cnRoZXN0QW5nbGVzKTsNCgl9DQoNCgkvKioNCgkgKiBIZWxwZXIgZnVuY3Rpb24gdG8gZml0IGEgcmFkaWFsIGxpbmVhciBzY2FsZSB3aXRoIG5vIHBvaW50IGxhYmVscw0KCSAqLw0KCWZ1bmN0aW9uIGZpdChzY2FsZSkgew0KCQl2YXIgbGFyZ2VzdFBvc3NpYmxlUmFkaXVzID0gTWF0aC5taW4oc2NhbGUuaGVpZ2h0IC8gMiwgc2NhbGUud2lkdGggLyAyKTsNCgkJc2NhbGUuZHJhd2luZ0FyZWEgPSBNYXRoLnJvdW5kKGxhcmdlc3RQb3NzaWJsZVJhZGl1cyk7DQoJCXNjYWxlLnNldENlbnRlclBvaW50KDAsIDAsIDAsIDApOw0KCX0NCg0KCWZ1bmN0aW9uIGdldFRleHRBbGlnbkZvckFuZ2xlKGFuZ2xlKSB7DQoJCWlmIChhbmdsZSA9PT0gMCB8fCBhbmdsZSA9PT0gMTgwKSB7DQoJCQlyZXR1cm4gJ2NlbnRlcic7DQoJCX0gZWxzZSBpZiAoYW5nbGUgPCAxODApIHsNCgkJCXJldHVybiAnbGVmdCc7DQoJCX0NCg0KCQlyZXR1cm4gJ3JpZ2h0JzsNCgl9DQoNCglmdW5jdGlvbiBmaWxsVGV4dChjdHgsIHRleHQsIHBvc2l0aW9uLCBmb250U2l6ZSkgew0KCQlpZiAoaGVscGVycy5pc0FycmF5KHRleHQpKSB7DQoJCQl2YXIgeSA9IHBvc2l0aW9uLnk7DQoJCQl2YXIgc3BhY2luZyA9IDEuNSAqIGZvbnRTaXplOw0KDQoJCQlmb3IgKHZhciBpID0gMDsgaSA8IHRleHQubGVuZ3RoOyArK2kpIHsNCgkJCQljdHguZmlsbFRleHQodGV4dFtpXSwgcG9zaXRpb24ueCwgeSk7DQoJCQkJeSArPSBzcGFjaW5nOw0KCQkJfQ0KCQl9IGVsc2Ugew0KCQkJY3R4LmZpbGxUZXh0KHRleHQsIHBvc2l0aW9uLngsIHBvc2l0aW9uLnkpOw0KCQl9DQoJfQ0KDQoJZnVuY3Rpb24gYWRqdXN0UG9pbnRQb3NpdGlvbkZvckxhYmVsSGVpZ2h0KGFuZ2xlLCB0ZXh0U2l6ZSwgcG9zaXRpb24pIHsNCgkJaWYgKGFuZ2xlID09PSA5MCB8fCBhbmdsZSA9PT0gMjcwKSB7DQoJCQlwb3NpdGlvbi55IC09ICh0ZXh0U2l6ZS5oIC8gMik7DQoJCX0gZWxzZSBpZiAoYW5nbGUgPiAyNzAgfHwgYW5nbGUgPCA5MCkgew0KCQkJcG9zaXRpb24ueSAtPSB0ZXh0U2l6ZS5oOw0KCQl9DQoJfQ0KDQoJZnVuY3Rpb24gZHJhd1BvaW50TGFiZWxzKHNjYWxlKSB7DQoJCXZhciBjdHggPSBzY2FsZS5jdHg7DQoJCXZhciB2YWx1ZU9yRGVmYXVsdCA9IGhlbHBlcnMudmFsdWVPckRlZmF1bHQ7DQoJCXZhciBvcHRzID0gc2NhbGUub3B0aW9uczsNCgkJdmFyIGFuZ2xlTGluZU9wdHMgPSBvcHRzLmFuZ2xlTGluZXM7DQoJCXZhciBwb2ludExhYmVsT3B0cyA9IG9wdHMucG9pbnRMYWJlbHM7DQoNCgkJY3R4LmxpbmVXaWR0aCA9IGFuZ2xlTGluZU9wdHMubGluZVdpZHRoOw0KCQljdHguc3Ryb2tlU3R5bGUgPSBhbmdsZUxpbmVPcHRzLmNvbG9yOw0KDQoJCXZhciBvdXRlckRpc3RhbmNlID0gc2NhbGUuZ2V0RGlzdGFuY2VGcm9tQ2VudGVyRm9yVmFsdWUob3B0cy50aWNrcy5yZXZlcnNlID8gc2NhbGUubWluIDogc2NhbGUubWF4KTsNCg0KCQkvLyBQb2ludCBMYWJlbCBGb250DQoJCXZhciBwbEZvbnQgPSBnZXRQb2ludExhYmVsRm9udE9wdGlvbnMoc2NhbGUpOw0KDQoJCWN0eC50ZXh0QmFzZWxpbmUgPSAndG9wJzsNCg0KCQlmb3IgKHZhciBpID0gZ2V0VmFsdWVDb3VudChzY2FsZSkgLSAxOyBpID49IDA7IGktLSkgew0KCQkJaWYgKGFuZ2xlTGluZU9wdHMuZGlzcGxheSkgew0KCQkJCXZhciBvdXRlclBvc2l0aW9uID0gc2NhbGUuZ2V0UG9pbnRQb3NpdGlvbihpLCBvdXRlckRpc3RhbmNlKTsNCgkJCQljdHguYmVnaW5QYXRoKCk7DQoJCQkJY3R4Lm1vdmVUbyhzY2FsZS54Q2VudGVyLCBzY2FsZS55Q2VudGVyKTsNCgkJCQljdHgubGluZVRvKG91dGVyUG9zaXRpb24ueCwgb3V0ZXJQb3NpdGlvbi55KTsNCgkJCQljdHguc3Ryb2tlKCk7DQoJCQkJY3R4LmNsb3NlUGF0aCgpOw0KCQkJfQ0KDQoJCQlpZiAocG9pbnRMYWJlbE9wdHMuZGlzcGxheSkgew0KCQkJCS8vIEV4dHJhIDNweCBvdXQgZm9yIHNvbWUgbGFiZWwgc3BhY2luZw0KCQkJCXZhciBwb2ludExhYmVsUG9zaXRpb24gPSBzY2FsZS5nZXRQb2ludFBvc2l0aW9uKGksIG91dGVyRGlzdGFuY2UgKyA1KTsNCg0KCQkJCS8vIEtlZXAgdGhpcyBpbiBsb29wIHNpbmNlIHdlIG1heSBzdXBwb3J0IGFycmF5IHByb3BlcnRpZXMgaGVyZQ0KCQkJCXZhciBwb2ludExhYmVsRm9udENvbG9yID0gdmFsdWVPckRlZmF1bHQocG9pbnRMYWJlbE9wdHMuZm9udENvbG9yLCBnbG9iYWxEZWZhdWx0cy5kZWZhdWx0Rm9udENvbG9yKTsNCgkJCQljdHguZm9udCA9IHBsRm9udC5mb250Ow0KCQkJCWN0eC5maWxsU3R5bGUgPSBwb2ludExhYmVsRm9udENvbG9yOw0KDQoJCQkJdmFyIGFuZ2xlUmFkaWFucyA9IHNjYWxlLmdldEluZGV4QW5nbGUoaSk7DQoJCQkJdmFyIGFuZ2xlID0gaGVscGVycy50b0RlZ3JlZXMoYW5nbGVSYWRpYW5zKTsNCgkJCQljdHgudGV4dEFsaWduID0gZ2V0VGV4dEFsaWduRm9yQW5nbGUoYW5nbGUpOw0KCQkJCWFkanVzdFBvaW50UG9zaXRpb25Gb3JMYWJlbEhlaWdodChhbmdsZSwgc2NhbGUuX3BvaW50TGFiZWxTaXplc1tpXSwgcG9pbnRMYWJlbFBvc2l0aW9uKTsNCgkJCQlmaWxsVGV4dChjdHgsIHNjYWxlLnBvaW50TGFiZWxzW2ldIHx8ICcnLCBwb2ludExhYmVsUG9zaXRpb24sIHBsRm9udC5zaXplKTsNCgkJCX0NCgkJfQ0KCX0NCg0KCWZ1bmN0aW9uIGRyYXdSYWRpdXNMaW5lKHNjYWxlLCBncmlkTGluZU9wdHMsIHJhZGl1cywgaW5kZXgpIHsNCgkJdmFyIGN0eCA9IHNjYWxlLmN0eDsNCgkJY3R4LnN0cm9rZVN0eWxlID0gaGVscGVycy52YWx1ZUF0SW5kZXhPckRlZmF1bHQoZ3JpZExpbmVPcHRzLmNvbG9yLCBpbmRleCAtIDEpOw0KCQljdHgubGluZVdpZHRoID0gaGVscGVycy52YWx1ZUF0SW5kZXhPckRlZmF1bHQoZ3JpZExpbmVPcHRzLmxpbmVXaWR0aCwgaW5kZXggLSAxKTsNCg0KCQlpZiAoc2NhbGUub3B0aW9ucy5ncmlkTGluZXMuY2lyY3VsYXIpIHsNCgkJCS8vIERyYXcgY2lyY3VsYXIgYXJjcyBiZXR3ZWVuIHRoZSBwb2ludHMNCgkJCWN0eC5iZWdpblBhdGgoKTsNCgkJCWN0eC5hcmMoc2NhbGUueENlbnRlciwgc2NhbGUueUNlbnRlciwgcmFkaXVzLCAwLCBNYXRoLlBJICogMik7DQoJCQljdHguY2xvc2VQYXRoKCk7DQoJCQljdHguc3Ryb2tlKCk7DQoJCX0gZWxzZSB7DQoJCQkvLyBEcmF3IHN0cmFpZ2h0IGxpbmVzIGNvbm5lY3RpbmcgZWFjaCBpbmRleA0KCQkJdmFyIHZhbHVlQ291bnQgPSBnZXRWYWx1ZUNvdW50KHNjYWxlKTsNCg0KCQkJaWYgKHZhbHVlQ291bnQgPT09IDApIHsNCgkJCQlyZXR1cm47DQoJCQl9DQoNCgkJCWN0eC5iZWdpblBhdGgoKTsNCgkJCXZhciBwb2ludFBvc2l0aW9uID0gc2NhbGUuZ2V0UG9pbnRQb3NpdGlvbigwLCByYWRpdXMpOw0KCQkJY3R4Lm1vdmVUbyhwb2ludFBvc2l0aW9uLngsIHBvaW50UG9zaXRpb24ueSk7DQoNCgkJCWZvciAodmFyIGkgPSAxOyBpIDwgdmFsdWVDb3VudDsgaSsrKSB7DQoJCQkJcG9pbnRQb3NpdGlvbiA9IHNjYWxlLmdldFBvaW50UG9zaXRpb24oaSwgcmFkaXVzKTsNCgkJCQljdHgubGluZVRvKHBvaW50UG9zaXRpb24ueCwgcG9pbnRQb3NpdGlvbi55KTsNCgkJCX0NCg0KCQkJY3R4LmNsb3NlUGF0aCgpOw0KCQkJY3R4LnN0cm9rZSgpOw0KCQl9DQoJfQ0KDQoJZnVuY3Rpb24gbnVtYmVyT3JaZXJvKHBhcmFtKSB7DQoJCXJldHVybiBoZWxwZXJzLmlzTnVtYmVyKHBhcmFtKSA/IHBhcmFtIDogMDsNCgl9DQoNCgl2YXIgTGluZWFyUmFkaWFsU2NhbGUgPSBDaGFydC5MaW5lYXJTY2FsZUJhc2UuZXh0ZW5kKHsNCgkJc2V0RGltZW5zaW9uczogZnVuY3Rpb24oKSB7DQoJCQl2YXIgbWUgPSB0aGlzOw0KCQkJdmFyIG9wdHMgPSBtZS5vcHRpb25zOw0KCQkJdmFyIHRpY2tPcHRzID0gb3B0cy50aWNrczsNCgkJCS8vIFNldCB0aGUgdW5jb25zdHJhaW5lZCBkaW1lbnNpb24gYmVmb3JlIGxhYmVsIHJvdGF0aW9uDQoJCQltZS53aWR0aCA9IG1lLm1heFdpZHRoOw0KCQkJbWUuaGVpZ2h0ID0gbWUubWF4SGVpZ2h0Ow0KCQkJbWUueENlbnRlciA9IE1hdGgucm91bmQobWUud2lkdGggLyAyKTsNCgkJCW1lLnlDZW50ZXIgPSBNYXRoLnJvdW5kKG1lLmhlaWdodCAvIDIpOw0KDQoJCQl2YXIgbWluU2l6ZSA9IGhlbHBlcnMubWluKFttZS5oZWlnaHQsIG1lLndpZHRoXSk7DQoJCQl2YXIgdGlja0ZvbnRTaXplID0gaGVscGVycy52YWx1ZU9yRGVmYXVsdCh0aWNrT3B0cy5mb250U2l6ZSwgZ2xvYmFsRGVmYXVsdHMuZGVmYXVsdEZvbnRTaXplKTsNCgkJCW1lLmRyYXdpbmdBcmVhID0gb3B0cy5kaXNwbGF5ID8gKG1pblNpemUgLyAyKSAtICh0aWNrRm9udFNpemUgLyAyICsgdGlja09wdHMuYmFja2Ryb3BQYWRkaW5nWSkgOiAobWluU2l6ZSAvIDIpOw0KCQl9LA0KCQlkZXRlcm1pbmVEYXRhTGltaXRzOiBmdW5jdGlvbigpIHsNCgkJCXZhciBtZSA9IHRoaXM7DQoJCQl2YXIgY2hhcnQgPSBtZS5jaGFydDsNCgkJCXZhciBtaW4gPSBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFk7DQoJCQl2YXIgbWF4ID0gTnVtYmVyLk5FR0FUSVZFX0lORklOSVRZOw0KDQoJCQloZWxwZXJzLmVhY2goY2hhcnQuZGF0YS5kYXRhc2V0cywgZnVuY3Rpb24oZGF0YXNldCwgZGF0YXNldEluZGV4KSB7DQoJCQkJaWYgKGNoYXJ0LmlzRGF0YXNldFZpc2libGUoZGF0YXNldEluZGV4KSkgew0KCQkJCQl2YXIgbWV0YSA9IGNoYXJ0LmdldERhdGFzZXRNZXRhKGRhdGFzZXRJbmRleCk7DQoNCgkJCQkJaGVscGVycy5lYWNoKGRhdGFzZXQuZGF0YSwgZnVuY3Rpb24ocmF3VmFsdWUsIGluZGV4KSB7DQoJCQkJCQl2YXIgdmFsdWUgPSArbWUuZ2V0UmlnaHRWYWx1ZShyYXdWYWx1ZSk7DQoJCQkJCQlpZiAoaXNOYU4odmFsdWUpIHx8IG1ldGEuZGF0YVtpbmRleF0uaGlkZGVuKSB7DQoJCQkJCQkJcmV0dXJuOw0KCQkJCQkJfQ0KDQoJCQkJCQltaW4gPSBNYXRoLm1pbih2YWx1ZSwgbWluKTsNCgkJCQkJCW1heCA9IE1hdGgubWF4KHZhbHVlLCBtYXgpOw0KCQkJCQl9KTsNCgkJCQl9DQoJCQl9KTsNCg0KCQkJbWUubWluID0gKG1pbiA9PT0gTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZID8gMCA6IG1pbik7DQoJCQltZS5tYXggPSAobWF4ID09PSBOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFkgPyAwIDogbWF4KTsNCg0KCQkJLy8gQ29tbW9uIGJhc2UgaW1wbGVtZW50YXRpb24gdG8gaGFuZGxlIHRpY2tzLm1pbiwgdGlja3MubWF4LCB0aWNrcy5iZWdpbkF0WmVybw0KCQkJbWUuaGFuZGxlVGlja1JhbmdlT3B0aW9ucygpOw0KCQl9LA0KCQlnZXRUaWNrTGltaXQ6IGZ1bmN0aW9uKCkgew0KCQkJdmFyIHRpY2tPcHRzID0gdGhpcy5vcHRpb25zLnRpY2tzOw0KCQkJdmFyIHRpY2tGb250U2l6ZSA9IGhlbHBlcnMudmFsdWVPckRlZmF1bHQodGlja09wdHMuZm9udFNpemUsIGdsb2JhbERlZmF1bHRzLmRlZmF1bHRGb250U2l6ZSk7DQoJCQlyZXR1cm4gTWF0aC5taW4odGlja09wdHMubWF4VGlja3NMaW1pdCA/IHRpY2tPcHRzLm1heFRpY2tzTGltaXQgOiAxMSwgTWF0aC5jZWlsKHRoaXMuZHJhd2luZ0FyZWEgLyAoMS41ICogdGlja0ZvbnRTaXplKSkpOw0KCQl9LA0KCQljb252ZXJ0VGlja3NUb0xhYmVsczogZnVuY3Rpb24oKSB7DQoJCQl2YXIgbWUgPSB0aGlzOw0KDQoJCQlDaGFydC5MaW5lYXJTY2FsZUJhc2UucHJvdG90eXBlLmNvbnZlcnRUaWNrc1RvTGFiZWxzLmNhbGwobWUpOw0KDQoJCQkvLyBQb2ludCBsYWJlbHMNCgkJCW1lLnBvaW50TGFiZWxzID0gbWUuY2hhcnQuZGF0YS5sYWJlbHMubWFwKG1lLm9wdGlvbnMucG9pbnRMYWJlbHMuY2FsbGJhY2ssIG1lKTsNCgkJfSwNCgkJZ2V0TGFiZWxGb3JJbmRleDogZnVuY3Rpb24oaW5kZXgsIGRhdGFzZXRJbmRleCkgew0KCQkJcmV0dXJuICt0aGlzLmdldFJpZ2h0VmFsdWUodGhpcy5jaGFydC5kYXRhLmRhdGFzZXRzW2RhdGFzZXRJbmRleF0uZGF0YVtpbmRleF0pOw0KCQl9LA0KCQlmaXQ6IGZ1bmN0aW9uKCkgew0KCQkJaWYgKHRoaXMub3B0aW9ucy5wb2ludExhYmVscy5kaXNwbGF5KSB7DQoJCQkJZml0V2l0aFBvaW50TGFiZWxzKHRoaXMpOw0KCQkJfSBlbHNlIHsNCgkJCQlmaXQodGhpcyk7DQoJCQl9DQoJCX0sDQoJCS8qKg0KCQkgKiBTZXQgcmFkaXVzIHJlZHVjdGlvbnMgYW5kIGRldGVybWluZSBuZXcgcmFkaXVzIGFuZCBjZW50ZXIgcG9pbnQNCgkJICogQHByaXZhdGUNCgkJICovDQoJCXNldFJlZHVjdGlvbnM6IGZ1bmN0aW9uKGxhcmdlc3RQb3NzaWJsZVJhZGl1cywgZnVydGhlc3RMaW1pdHMsIGZ1cnRoZXN0QW5nbGVzKSB7DQoJCQl2YXIgbWUgPSB0aGlzOw0KCQkJdmFyIHJhZGl1c1JlZHVjdGlvbkxlZnQgPSBmdXJ0aGVzdExpbWl0cy5sIC8gTWF0aC5zaW4oZnVydGhlc3RBbmdsZXMubCk7DQoJCQl2YXIgcmFkaXVzUmVkdWN0aW9uUmlnaHQgPSBNYXRoLm1heChmdXJ0aGVzdExpbWl0cy5yIC0gbWUud2lkdGgsIDApIC8gTWF0aC5zaW4oZnVydGhlc3RBbmdsZXMucik7DQoJCQl2YXIgcmFkaXVzUmVkdWN0aW9uVG9wID0gLWZ1cnRoZXN0TGltaXRzLnQgLyBNYXRoLmNvcyhmdXJ0aGVzdEFuZ2xlcy50KTsNCgkJCXZhciByYWRpdXNSZWR1Y3Rpb25Cb3R0b20gPSAtTWF0aC5tYXgoZnVydGhlc3RMaW1pdHMuYiAtIG1lLmhlaWdodCwgMCkgLyBNYXRoLmNvcyhmdXJ0aGVzdEFuZ2xlcy5iKTsNCg0KCQkJcmFkaXVzUmVkdWN0aW9uTGVmdCA9IG51bWJlck9yWmVybyhyYWRpdXNSZWR1Y3Rpb25MZWZ0KTsNCgkJCXJhZGl1c1JlZHVjdGlvblJpZ2h0ID0gbnVtYmVyT3JaZXJvKHJhZGl1c1JlZHVjdGlvblJpZ2h0KTsNCgkJCXJhZGl1c1JlZHVjdGlvblRvcCA9IG51bWJlck9yWmVybyhyYWRpdXNSZWR1Y3Rpb25Ub3ApOw0KCQkJcmFkaXVzUmVkdWN0aW9uQm90dG9tID0gbnVtYmVyT3JaZXJvKHJhZGl1c1JlZHVjdGlvbkJvdHRvbSk7DQoNCgkJCW1lLmRyYXdpbmdBcmVhID0gTWF0aC5taW4oDQoJCQkJTWF0aC5yb3VuZChsYXJnZXN0UG9zc2libGVSYWRpdXMgLSAocmFkaXVzUmVkdWN0aW9uTGVmdCArIHJhZGl1c1JlZHVjdGlvblJpZ2h0KSAvIDIpLA0KCQkJCU1hdGgucm91bmQobGFyZ2VzdFBvc3NpYmxlUmFkaXVzIC0gKHJhZGl1c1JlZHVjdGlvblRvcCArIHJhZGl1c1JlZHVjdGlvbkJvdHRvbSkgLyAyKSk7DQoJCQltZS5zZXRDZW50ZXJQb2ludChyYWRpdXNSZWR1Y3Rpb25MZWZ0LCByYWRpdXNSZWR1Y3Rpb25SaWdodCwgcmFkaXVzUmVkdWN0aW9uVG9wLCByYWRpdXNSZWR1Y3Rpb25Cb3R0b20pOw0KCQl9LA0KCQlzZXRDZW50ZXJQb2ludDogZnVuY3Rpb24obGVmdE1vdmVtZW50LCByaWdodE1vdmVtZW50LCB0b3BNb3ZlbWVudCwgYm90dG9tTW92ZW1lbnQpIHsNCgkJCXZhciBtZSA9IHRoaXM7DQoJCQl2YXIgbWF4UmlnaHQgPSBtZS53aWR0aCAtIHJpZ2h0TW92ZW1lbnQgLSBtZS5kcmF3aW5nQXJlYTsNCgkJCXZhciBtYXhMZWZ0ID0gbGVmdE1vdmVtZW50ICsgbWUuZHJhd2luZ0FyZWE7DQoJCQl2YXIgbWF4VG9wID0gdG9wTW92ZW1lbnQgKyBtZS5kcmF3aW5nQXJlYTsNCgkJCXZhciBtYXhCb3R0b20gPSBtZS5oZWlnaHQgLSBib3R0b21Nb3ZlbWVudCAtIG1lLmRyYXdpbmdBcmVhOw0KDQoJCQltZS54Q2VudGVyID0gTWF0aC5yb3VuZCgoKG1heExlZnQgKyBtYXhSaWdodCkgLyAyKSArIG1lLmxlZnQpOw0KCQkJbWUueUNlbnRlciA9IE1hdGgucm91bmQoKChtYXhUb3AgKyBtYXhCb3R0b20pIC8gMikgKyBtZS50b3ApOw0KCQl9LA0KDQoJCWdldEluZGV4QW5nbGU6IGZ1bmN0aW9uKGluZGV4KSB7DQoJCQl2YXIgYW5nbGVNdWx0aXBsaWVyID0gKE1hdGguUEkgKiAyKSAvIGdldFZhbHVlQ291bnQodGhpcyk7DQoJCQl2YXIgc3RhcnRBbmdsZSA9IHRoaXMuY2hhcnQub3B0aW9ucyAmJiB0aGlzLmNoYXJ0Lm9wdGlvbnMuc3RhcnRBbmdsZSA/DQoJCQkJdGhpcy5jaGFydC5vcHRpb25zLnN0YXJ0QW5nbGUgOg0KCQkJCTA7DQoNCgkJCXZhciBzdGFydEFuZ2xlUmFkaWFucyA9IHN0YXJ0QW5nbGUgKiBNYXRoLlBJICogMiAvIDM2MDsNCg0KCQkJLy8gU3RhcnQgZnJvbSB0aGUgdG9wIGluc3RlYWQgb2YgcmlnaHQsIHNvIHJlbW92ZSBhIHF1YXJ0ZXIgb2YgdGhlIGNpcmNsZQ0KCQkJcmV0dXJuIGluZGV4ICogYW5nbGVNdWx0aXBsaWVyICsgc3RhcnRBbmdsZVJhZGlhbnM7DQoJCX0sDQoJCWdldERpc3RhbmNlRnJvbUNlbnRlckZvclZhbHVlOiBmdW5jdGlvbih2YWx1ZSkgew0KCQkJdmFyIG1lID0gdGhpczsNCg0KCQkJaWYgKHZhbHVlID09PSBudWxsKSB7DQoJCQkJcmV0dXJuIDA7IC8vIG51bGwgYWx3YXlzIGluIGNlbnRlcg0KCQkJfQ0KDQoJCQkvLyBUYWtlIGludG8gYWNjb3VudCBoYWxmIGZvbnQgc2l6ZSArIHRoZSB5UGFkZGluZyBvZiB0aGUgdG9wIHZhbHVlDQoJCQl2YXIgc2NhbGluZ0ZhY3RvciA9IG1lLmRyYXdpbmdBcmVhIC8gKG1lLm1heCAtIG1lLm1pbik7DQoJCQlpZiAobWUub3B0aW9ucy50aWNrcy5yZXZlcnNlKSB7DQoJCQkJcmV0dXJuIChtZS5tYXggLSB2YWx1ZSkgKiBzY2FsaW5nRmFjdG9yOw0KCQkJfQ0KCQkJcmV0dXJuICh2YWx1ZSAtIG1lLm1pbikgKiBzY2FsaW5nRmFjdG9yOw0KCQl9LA0KCQlnZXRQb2ludFBvc2l0aW9uOiBmdW5jdGlvbihpbmRleCwgZGlzdGFuY2VGcm9tQ2VudGVyKSB7DQoJCQl2YXIgbWUgPSB0aGlzOw0KCQkJdmFyIHRoaXNBbmdsZSA9IG1lLmdldEluZGV4QW5nbGUoaW5kZXgpIC0gKE1hdGguUEkgLyAyKTsNCgkJCXJldHVybiB7DQoJCQkJeDogTWF0aC5yb3VuZChNYXRoLmNvcyh0aGlzQW5nbGUpICogZGlzdGFuY2VGcm9tQ2VudGVyKSArIG1lLnhDZW50ZXIsDQoJCQkJeTogTWF0aC5yb3VuZChNYXRoLnNpbih0aGlzQW5nbGUpICogZGlzdGFuY2VGcm9tQ2VudGVyKSArIG1lLnlDZW50ZXINCgkJCX07DQoJCX0sDQoJCWdldFBvaW50UG9zaXRpb25Gb3JWYWx1ZTogZnVuY3Rpb24oaW5kZXgsIHZhbHVlKSB7DQoJCQlyZXR1cm4gdGhpcy5nZXRQb2ludFBvc2l0aW9uKGluZGV4LCB0aGlzLmdldERpc3RhbmNlRnJvbUNlbnRlckZvclZhbHVlKHZhbHVlKSk7DQoJCX0sDQoNCgkJZ2V0QmFzZVBvc2l0aW9uOiBmdW5jdGlvbigpIHsNCgkJCXZhciBtZSA9IHRoaXM7DQoJCQl2YXIgbWluID0gbWUubWluOw0KCQkJdmFyIG1heCA9IG1lLm1heDsNCg0KCQkJcmV0dXJuIG1lLmdldFBvaW50UG9zaXRpb25Gb3JWYWx1ZSgwLA0KCQkJCW1lLmJlZ2luQXRaZXJvID8gMCA6DQoJCQkJbWluIDwgMCAmJiBtYXggPCAwID8gbWF4IDoNCgkJCQltaW4gPiAwICYmIG1heCA+IDAgPyBtaW4gOg0KCQkJCTApOw0KCQl9LA0KDQoJCWRyYXc6IGZ1bmN0aW9uKCkgew0KCQkJdmFyIG1lID0gdGhpczsNCgkJCXZhciBvcHRzID0gbWUub3B0aW9uczsNCgkJCXZhciBncmlkTGluZU9wdHMgPSBvcHRzLmdyaWRMaW5lczsNCgkJCXZhciB0aWNrT3B0cyA9IG9wdHMudGlja3M7DQoJCQl2YXIgdmFsdWVPckRlZmF1bHQgPSBoZWxwZXJzLnZhbHVlT3JEZWZhdWx0Ow0KDQoJCQlpZiAob3B0cy5kaXNwbGF5KSB7DQoJCQkJdmFyIGN0eCA9IG1lLmN0eDsNCgkJCQl2YXIgc3RhcnRBbmdsZSA9IHRoaXMuZ2V0SW5kZXhBbmdsZSgwKTsNCg0KCQkJCS8vIFRpY2sgRm9udA0KCQkJCXZhciB0aWNrRm9udFNpemUgPSB2YWx1ZU9yRGVmYXVsdCh0aWNrT3B0cy5mb250U2l6ZSwgZ2xvYmFsRGVmYXVsdHMuZGVmYXVsdEZvbnRTaXplKTsNCgkJCQl2YXIgdGlja0ZvbnRTdHlsZSA9IHZhbHVlT3JEZWZhdWx0KHRpY2tPcHRzLmZvbnRTdHlsZSwgZ2xvYmFsRGVmYXVsdHMuZGVmYXVsdEZvbnRTdHlsZSk7DQoJCQkJdmFyIHRpY2tGb250RmFtaWx5ID0gdmFsdWVPckRlZmF1bHQodGlja09wdHMuZm9udEZhbWlseSwgZ2xvYmFsRGVmYXVsdHMuZGVmYXVsdEZvbnRGYW1pbHkpOw0KCQkJCXZhciB0aWNrTGFiZWxGb250ID0gaGVscGVycy5mb250U3RyaW5nKHRpY2tGb250U2l6ZSwgdGlja0ZvbnRTdHlsZSwgdGlja0ZvbnRGYW1pbHkpOw0KDQoJCQkJaGVscGVycy5lYWNoKG1lLnRpY2tzLCBmdW5jdGlvbihsYWJlbCwgaW5kZXgpIHsNCgkJCQkJLy8gRG9uJ3QgZHJhdyBhIGNlbnRyZSB2YWx1ZSAoaWYgaXQgaXMgbWluaW11bSkNCgkJCQkJaWYgKGluZGV4ID4gMCB8fCB0aWNrT3B0cy5yZXZlcnNlKSB7DQoJCQkJCQl2YXIgeUNlbnRlck9mZnNldCA9IG1lLmdldERpc3RhbmNlRnJvbUNlbnRlckZvclZhbHVlKG1lLnRpY2tzQXNOdW1iZXJzW2luZGV4XSk7DQoNCgkJCQkJCS8vIERyYXcgY2lyY3VsYXIgbGluZXMgYXJvdW5kIHRoZSBzY2FsZQ0KCQkJCQkJaWYgKGdyaWRMaW5lT3B0cy5kaXNwbGF5ICYmIGluZGV4ICE9PSAwKSB7DQoJCQkJCQkJZHJhd1JhZGl1c0xpbmUobWUsIGdyaWRMaW5lT3B0cywgeUNlbnRlck9mZnNldCwgaW5kZXgpOw0KCQkJCQkJfQ0KDQoJCQkJCQlpZiAodGlja09wdHMuZGlzcGxheSkgew0KCQkJCQkJCXZhciB0aWNrRm9udENvbG9yID0gdmFsdWVPckRlZmF1bHQodGlja09wdHMuZm9udENvbG9yLCBnbG9iYWxEZWZhdWx0cy5kZWZhdWx0Rm9udENvbG9yKTsNCgkJCQkJCQljdHguZm9udCA9IHRpY2tMYWJlbEZvbnQ7DQoNCgkJCQkJCQljdHguc2F2ZSgpOw0KCQkJCQkJCWN0eC50cmFuc2xhdGUobWUueENlbnRlciwgbWUueUNlbnRlcik7DQoJCQkJCQkJY3R4LnJvdGF0ZShzdGFydEFuZ2xlKTsNCg0KCQkJCQkJCWlmICh0aWNrT3B0cy5zaG93TGFiZWxCYWNrZHJvcCkgew0KCQkJCQkJCQl2YXIgbGFiZWxXaWR0aCA9IGN0eC5tZWFzdXJlVGV4dChsYWJlbCkud2lkdGg7DQoJCQkJCQkJCWN0eC5maWxsU3R5bGUgPSB0aWNrT3B0cy5iYWNrZHJvcENvbG9yOw0KCQkJCQkJCQljdHguZmlsbFJlY3QoDQoJCQkJCQkJCQktbGFiZWxXaWR0aCAvIDIgLSB0aWNrT3B0cy5iYWNrZHJvcFBhZGRpbmdYLA0KCQkJCQkJCQkJLXlDZW50ZXJPZmZzZXQgLSB0aWNrRm9udFNpemUgLyAyIC0gdGlja09wdHMuYmFja2Ryb3BQYWRkaW5nWSwNCgkJCQkJCQkJCWxhYmVsV2lkdGggKyB0aWNrT3B0cy5iYWNrZHJvcFBhZGRpbmdYICogMiwNCgkJCQkJCQkJCXRpY2tGb250U2l6ZSArIHRpY2tPcHRzLmJhY2tkcm9wUGFkZGluZ1kgKiAyDQoJCQkJCQkJCSk7DQoJCQkJCQkJfQ0KDQoJCQkJCQkJY3R4LnRleHRBbGlnbiA9ICdjZW50ZXInOw0KCQkJCQkJCWN0eC50ZXh0QmFzZWxpbmUgPSAnbWlkZGxlJzsNCgkJCQkJCQljdHguZmlsbFN0eWxlID0gdGlja0ZvbnRDb2xvcjsNCgkJCQkJCQljdHguZmlsbFRleHQobGFiZWwsIDAsIC15Q2VudGVyT2Zmc2V0KTsNCgkJCQkJCQljdHgucmVzdG9yZSgpOw0KCQkJCQkJfQ0KCQkJCQl9DQoJCQkJfSk7DQoNCgkJCQlpZiAob3B0cy5hbmdsZUxpbmVzLmRpc3BsYXkgfHwgb3B0cy5wb2ludExhYmVscy5kaXNwbGF5KSB7DQoJCQkJCWRyYXdQb2ludExhYmVscyhtZSk7DQoJCQkJfQ0KCQkJfQ0KCQl9DQoJfSk7DQoJQ2hhcnQuc2NhbGVTZXJ2aWNlLnJlZ2lzdGVyU2NhbGVUeXBlKCdyYWRpYWxMaW5lYXInLCBMaW5lYXJSYWRpYWxTY2FsZSwgZGVmYXVsdENvbmZpZyk7DQoNCn07DQoNCn0seyIyNSI6MjUsIjM0IjozNCwiNDUiOjQ1fV0sNTc6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpew0KLyogZ2xvYmFsIHdpbmRvdzogZmFsc2UgKi8NCid1c2Ugc3RyaWN0JzsNCg0KdmFyIG1vbWVudCA9IHJlcXVpcmUoNik7DQptb21lbnQgPSB0eXBlb2YgbW9tZW50ID09PSAnZnVuY3Rpb24nID8gbW9tZW50IDogd2luZG93Lm1vbWVudDsNCg0KdmFyIGRlZmF1bHRzID0gcmVxdWlyZSgyNSk7DQp2YXIgaGVscGVycyA9IHJlcXVpcmUoNDUpOw0KDQovLyBJbnRlZ2VyIGNvbnN0YW50cyBhcmUgZnJvbSB0aGUgRVM2IHNwZWMuDQp2YXIgTUlOX0lOVEVHRVIgPSBOdW1iZXIuTUlOX1NBRkVfSU5URUdFUiB8fCAtOTAwNzE5OTI1NDc0MDk5MTsNCnZhciBNQVhfSU5URUdFUiA9IE51bWJlci5NQVhfU0FGRV9JTlRFR0VSIHx8IDkwMDcxOTkyNTQ3NDA5OTE7DQoNCnZhciBJTlRFUlZBTFMgPSB7DQoJbWlsbGlzZWNvbmQ6IHsNCgkJY29tbW9uOiB0cnVlLA0KCQlzaXplOiAxLA0KCQlzdGVwczogWzEsIDIsIDUsIDEwLCAyMCwgNTAsIDEwMCwgMjUwLCA1MDBdDQoJfSwNCglzZWNvbmQ6IHsNCgkJY29tbW9uOiB0cnVlLA0KCQlzaXplOiAxMDAwLA0KCQlzdGVwczogWzEsIDIsIDUsIDEwLCAzMF0NCgl9LA0KCW1pbnV0ZTogew0KCQljb21tb246IHRydWUsDQoJCXNpemU6IDYwMDAwLA0KCQlzdGVwczogWzEsIDIsIDUsIDEwLCAzMF0NCgl9LA0KCWhvdXI6IHsNCgkJY29tbW9uOiB0cnVlLA0KCQlzaXplOiAzNjAwMDAwLA0KCQlzdGVwczogWzEsIDIsIDMsIDYsIDEyXQ0KCX0sDQoJZGF5OiB7DQoJCWNvbW1vbjogdHJ1ZSwNCgkJc2l6ZTogODY0MDAwMDAsDQoJCXN0ZXBzOiBbMSwgMiwgNV0NCgl9LA0KCXdlZWs6IHsNCgkJY29tbW9uOiBmYWxzZSwNCgkJc2l6ZTogNjA0ODAwMDAwLA0KCQlzdGVwczogWzEsIDIsIDMsIDRdDQoJfSwNCgltb250aDogew0KCQljb21tb246IHRydWUsDQoJCXNpemU6IDIuNjI4ZTksDQoJCXN0ZXBzOiBbMSwgMiwgM10NCgl9LA0KCXF1YXJ0ZXI6IHsNCgkJY29tbW9uOiBmYWxzZSwNCgkJc2l6ZTogNy44ODRlOSwNCgkJc3RlcHM6IFsxLCAyLCAzLCA0XQ0KCX0sDQoJeWVhcjogew0KCQljb21tb246IHRydWUsDQoJCXNpemU6IDMuMTU0ZTEwDQoJfQ0KfTsNCg0KdmFyIFVOSVRTID0gT2JqZWN0LmtleXMoSU5URVJWQUxTKTsNCg0KZnVuY3Rpb24gc29ydGVyKGEsIGIpIHsNCglyZXR1cm4gYSAtIGI7DQp9DQoNCmZ1bmN0aW9uIGFycmF5VW5pcXVlKGl0ZW1zKSB7DQoJdmFyIGhhc2ggPSB7fTsNCgl2YXIgb3V0ID0gW107DQoJdmFyIGksIGlsZW4sIGl0ZW07DQoNCglmb3IgKGkgPSAwLCBpbGVuID0gaXRlbXMubGVuZ3RoOyBpIDwgaWxlbjsgKytpKSB7DQoJCWl0ZW0gPSBpdGVtc1tpXTsNCgkJaWYgKCFoYXNoW2l0ZW1dKSB7DQoJCQloYXNoW2l0ZW1dID0gdHJ1ZTsNCgkJCW91dC5wdXNoKGl0ZW0pOw0KCQl9DQoJfQ0KDQoJcmV0dXJuIG91dDsNCn0NCg0KLyoqDQogKiBSZXR1cm5zIGFuIGFycmF5IG9mIHt0aW1lLCBwb3N9IG9iamVjdHMgdXNlZCB0byBpbnRlcnBvbGF0ZSBhIHNwZWNpZmljIGB0aW1lYCBvciBwb3NpdGlvbg0KICogKGBwb3NgKSBvbiB0aGUgc2NhbGUsIGJ5IHNlYXJjaGluZyBlbnRyaWVzIGJlZm9yZSBhbmQgYWZ0ZXIgdGhlIHJlcXVlc3RlZCB2YWx1ZS4gYHBvc2AgaXMNCiAqIGEgZGVjaW1hbCBiZXR3ZWVuIDAgYW5kIDE6IDAgYmVpbmcgdGhlIHN0YXJ0IG9mIHRoZSBzY2FsZSAobGVmdCBvciB0b3ApIGFuZCAxIHRoZSBvdGhlcg0KICogZXh0cmVtaXR5IChsZWZ0ICsgd2lkdGggb3IgdG9wICsgaGVpZ2h0KS4gTm90ZSB0aGF0IGl0IHdvdWxkIGJlIG1vcmUgb3B0aW1pemVkIHRvIGRpcmVjdGx5DQogKiBzdG9yZSBwcmUtY29tcHV0ZWQgcGl4ZWxzLCBidXQgdGhlIHNjYWxlIGRpbWVuc2lvbnMgYXJlIG5vdCBndWFyYW50ZWVkIGF0IHRoZSB0aW1lIHdlIG5lZWQNCiAqIHRvIGNyZWF0ZSB0aGUgbG9va3VwIHRhYmxlLiBUaGUgdGFibGUgQUxXQVlTIGNvbnRhaW5zIGF0IGxlYXN0IHR3byBpdGVtczogbWluIGFuZCBtYXguDQogKg0KICogQHBhcmFtIHtOdW1iZXJbXX0gdGltZXN0YW1wcyAtIHRpbWVzdGFtcHMgc29ydGVkIGZyb20gbG93ZXN0IHRvIGhpZ2hlc3QuDQogKiBAcGFyYW0ge1N0cmluZ30gZGlzdHJpYnV0aW9uIC0gSWYgJ2xpbmVhcicsIHRpbWVzdGFtcHMgd2lsbCBiZSBzcHJlYWQgbGluZWFybHkgYWxvbmcgdGhlIG1pbg0KICogYW5kIG1heCByYW5nZSwgc28gYmFzaWNhbGx5LCB0aGUgdGFibGUgd2lsbCBjb250YWlucyBvbmx5IHR3byBpdGVtczoge21pbiwgMH0gYW5kIHttYXgsIDF9Lg0KICogSWYgJ3NlcmllcycsIHRpbWVzdGFtcHMgd2lsbCBiZSBwb3NpdGlvbmVkIGF0IHRoZSBzYW1lIGRpc3RhbmNlIGZyb20gZWFjaCBvdGhlci4gSW4gdGhpcw0KICogY2FzZSwgb25seSB0aW1lc3RhbXBzIHRoYXQgYnJlYWsgdGhlIHRpbWUgbGluZWFyaXR5IGFyZSByZWdpc3RlcmVkLCBtZWFuaW5nIHRoYXQgaW4gdGhlDQogKiBiZXN0IGNhc2UsIGFsbCB0aW1lc3RhbXBzIGFyZSBsaW5lYXIsIHRoZSB0YWJsZSBjb250YWlucyBvbmx5IG1pbiBhbmQgbWF4Lg0KICovDQpmdW5jdGlvbiBidWlsZExvb2t1cFRhYmxlKHRpbWVzdGFtcHMsIG1pbiwgbWF4LCBkaXN0cmlidXRpb24pIHsNCglpZiAoZGlzdHJpYnV0aW9uID09PSAnbGluZWFyJyB8fCAhdGltZXN0YW1wcy5sZW5ndGgpIHsNCgkJcmV0dXJuIFsNCgkJCXt0aW1lOiBtaW4sIHBvczogMH0sDQoJCQl7dGltZTogbWF4LCBwb3M6IDF9DQoJCV07DQoJfQ0KDQoJdmFyIHRhYmxlID0gW107DQoJdmFyIGl0ZW1zID0gW21pbl07DQoJdmFyIGksIGlsZW4sIHByZXYsIGN1cnIsIG5leHQ7DQoNCglmb3IgKGkgPSAwLCBpbGVuID0gdGltZXN0YW1wcy5sZW5ndGg7IGkgPCBpbGVuOyArK2kpIHsNCgkJY3VyciA9IHRpbWVzdGFtcHNbaV07DQoJCWlmIChjdXJyID4gbWluICYmIGN1cnIgPCBtYXgpIHsNCgkJCWl0ZW1zLnB1c2goY3Vycik7DQoJCX0NCgl9DQoNCglpdGVtcy5wdXNoKG1heCk7DQoNCglmb3IgKGkgPSAwLCBpbGVuID0gaXRlbXMubGVuZ3RoOyBpIDwgaWxlbjsgKytpKSB7DQoJCW5leHQgPSBpdGVtc1tpICsgMV07DQoJCXByZXYgPSBpdGVtc1tpIC0gMV07DQoJCWN1cnIgPSBpdGVtc1tpXTsNCg0KCQkvLyBvbmx5IGFkZCBwb2ludHMgdGhhdCBicmVha3MgdGhlIHNjYWxlIGxpbmVhcml0eQ0KCQlpZiAocHJldiA9PT0gdW5kZWZpbmVkIHx8IG5leHQgPT09IHVuZGVmaW5lZCB8fCBNYXRoLnJvdW5kKChuZXh0ICsgcHJldikgLyAyKSAhPT0gY3Vycikgew0KCQkJdGFibGUucHVzaCh7dGltZTogY3VyciwgcG9zOiBpIC8gKGlsZW4gLSAxKX0pOw0KCQl9DQoJfQ0KDQoJcmV0dXJuIHRhYmxlOw0KfQ0KDQovLyBAc2VlIGFkYXB0ZWQgZnJvbSBodHRwOi8vd3d3LmFudWpnYWtoYXIuY29tLzIwMTQvMDMvMDEvYmluYXJ5LXNlYXJjaC1pbi1qYXZhc2NyaXB0Lw0KZnVuY3Rpb24gbG9va3VwKHRhYmxlLCBrZXksIHZhbHVlKSB7DQoJdmFyIGxvID0gMDsNCgl2YXIgaGkgPSB0YWJsZS5sZW5ndGggLSAxOw0KCXZhciBtaWQsIGkwLCBpMTsNCg0KCXdoaWxlIChsbyA+PSAwICYmIGxvIDw9IGhpKSB7DQoJCW1pZCA9IChsbyArIGhpKSA+PiAxOw0KCQlpMCA9IHRhYmxlW21pZCAtIDFdIHx8IG51bGw7DQoJCWkxID0gdGFibGVbbWlkXTsNCg0KCQlpZiAoIWkwKSB7DQoJCQkvLyBnaXZlbiB2YWx1ZSBpcyBvdXRzaWRlIHRhYmxlIChiZWZvcmUgZmlyc3QgaXRlbSkNCgkJCXJldHVybiB7bG86IG51bGwsIGhpOiBpMX07DQoJCX0gZWxzZSBpZiAoaTFba2V5XSA8IHZhbHVlKSB7DQoJCQlsbyA9IG1pZCArIDE7DQoJCX0gZWxzZSBpZiAoaTBba2V5XSA+IHZhbHVlKSB7DQoJCQloaSA9IG1pZCAtIDE7DQoJCX0gZWxzZSB7DQoJCQlyZXR1cm4ge2xvOiBpMCwgaGk6IGkxfTsNCgkJfQ0KCX0NCg0KCS8vIGdpdmVuIHZhbHVlIGlzIG91dHNpZGUgdGFibGUgKGFmdGVyIGxhc3QgaXRlbSkNCglyZXR1cm4ge2xvOiBpMSwgaGk6IG51bGx9Ow0KfQ0KDQovKioNCiAqIExpbmVhcmx5IGludGVycG9sYXRlcyB0aGUgZ2l2ZW4gc291cmNlIGB2YWx1ZWAgdXNpbmcgdGhlIHRhYmxlIGl0ZW1zIGBza2V5YCB2YWx1ZXMgYW5kDQogKiByZXR1cm5zIHRoZSBhc3NvY2lhdGVkIGB0a2V5YCB2YWx1ZS4gRm9yIGV4YW1wbGUsIGludGVycG9sYXRlKHRhYmxlLCAndGltZScsIDQyLCAncG9zJykNCiAqIHJldHVybnMgdGhlIHBvc2l0aW9uIGZvciBhIHRpbWVzdGFtcCBlcXVhbCB0byA0Mi4gSWYgdmFsdWUgaXMgb3V0IG9mIGJvdW5kcywgdmFsdWVzIGF0DQogKiBpbmRleCBbMCwgMV0gb3IgW24gLSAxLCBuXSBhcmUgdXNlZCBmb3IgdGhlIGludGVycG9sYXRpb24uDQogKi8NCmZ1bmN0aW9uIGludGVycG9sYXRlKHRhYmxlLCBza2V5LCBzdmFsLCB0a2V5KSB7DQoJdmFyIHJhbmdlID0gbG9va3VwKHRhYmxlLCBza2V5LCBzdmFsKTsNCg0KCS8vIE5vdGU6IHRoZSBsb29rdXAgdGFibGUgQUxXQVlTIGNvbnRhaW5zIGF0IGxlYXN0IDIgaXRlbXMgKG1pbiBhbmQgbWF4KQ0KCXZhciBwcmV2ID0gIXJhbmdlLmxvID8gdGFibGVbMF0gOiAhcmFuZ2UuaGkgPyB0YWJsZVt0YWJsZS5sZW5ndGggLSAyXSA6IHJhbmdlLmxvOw0KCXZhciBuZXh0ID0gIXJhbmdlLmxvID8gdGFibGVbMV0gOiAhcmFuZ2UuaGkgPyB0YWJsZVt0YWJsZS5sZW5ndGggLSAxXSA6IHJhbmdlLmhpOw0KDQoJdmFyIHNwYW4gPSBuZXh0W3NrZXldIC0gcHJldltza2V5XTsNCgl2YXIgcmF0aW8gPSBzcGFuID8gKHN2YWwgLSBwcmV2W3NrZXldKSAvIHNwYW4gOiAwOw0KCXZhciBvZmZzZXQgPSAobmV4dFt0a2V5XSAtIHByZXZbdGtleV0pICogcmF0aW87DQoNCglyZXR1cm4gcHJldlt0a2V5XSArIG9mZnNldDsNCn0NCg0KLyoqDQogKiBDb252ZXJ0IHRoZSBnaXZlbiB2YWx1ZSB0byBhIG1vbWVudCBvYmplY3QgdXNpbmcgdGhlIGdpdmVuIHRpbWUgb3B0aW9ucy4NCiAqIEBzZWUgaHR0cDovL21vbWVudGpzLmNvbS9kb2NzLyMvcGFyc2luZy8NCiAqLw0KZnVuY3Rpb24gbW9tZW50aWZ5KHZhbHVlLCBvcHRpb25zKSB7DQoJdmFyIHBhcnNlciA9IG9wdGlvbnMucGFyc2VyOw0KCXZhciBmb3JtYXQgPSBvcHRpb25zLnBhcnNlciB8fCBvcHRpb25zLmZvcm1hdDsNCg0KCWlmICh0eXBlb2YgcGFyc2VyID09PSAnZnVuY3Rpb24nKSB7DQoJCXJldHVybiBwYXJzZXIodmFsdWUpOw0KCX0NCg0KCWlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnICYmIHR5cGVvZiBmb3JtYXQgPT09ICdzdHJpbmcnKSB7DQoJCXJldHVybiBtb21lbnQodmFsdWUsIGZvcm1hdCk7DQoJfQ0KDQoJaWYgKCEodmFsdWUgaW5zdGFuY2VvZiBtb21lbnQpKSB7DQoJCXZhbHVlID0gbW9tZW50KHZhbHVlKTsNCgl9DQoNCglpZiAodmFsdWUuaXNWYWxpZCgpKSB7DQoJCXJldHVybiB2YWx1ZTsNCgl9DQoNCgkvLyBMYWJlbHMgYXJlIGluIGFuIGluY29tcGF0aWJsZSBtb21lbnQgZm9ybWF0IGFuZCBubyBgcGFyc2VyYCBoYXMgYmVlbiBwcm92aWRlZC4NCgkvLyBUaGUgdXNlciBtaWdodCBzdGlsbCB1c2UgdGhlIGRlcHJlY2F0ZWQgYGZvcm1hdGAgb3B0aW9uIHRvIGNvbnZlcnQgaGlzIGlucHV0cy4NCglpZiAodHlwZW9mIGZvcm1hdCA9PT0gJ2Z1bmN0aW9uJykgew0KCQlyZXR1cm4gZm9ybWF0KHZhbHVlKTsNCgl9DQoNCglyZXR1cm4gdmFsdWU7DQp9DQoNCmZ1bmN0aW9uIHBhcnNlKGlucHV0LCBzY2FsZSkgew0KCWlmIChoZWxwZXJzLmlzTnVsbE9yVW5kZWYoaW5wdXQpKSB7DQoJCXJldHVybiBudWxsOw0KCX0NCg0KCXZhciBvcHRpb25zID0gc2NhbGUub3B0aW9ucy50aW1lOw0KCXZhciB2YWx1ZSA9IG1vbWVudGlmeShzY2FsZS5nZXRSaWdodFZhbHVlKGlucHV0KSwgb3B0aW9ucyk7DQoJaWYgKCF2YWx1ZS5pc1ZhbGlkKCkpIHsNCgkJcmV0dXJuIG51bGw7DQoJfQ0KDQoJaWYgKG9wdGlvbnMucm91bmQpIHsNCgkJdmFsdWUuc3RhcnRPZihvcHRpb25zLnJvdW5kKTsNCgl9DQoNCglyZXR1cm4gdmFsdWUudmFsdWVPZigpOw0KfQ0KDQovKioNCiAqIFJldHVybnMgdGhlIG51bWJlciBvZiB1bml0IHRvIHNraXAgdG8gYmUgYWJsZSB0byBkaXNwbGF5IHVwIHRvIGBjYXBhY2l0eWAgbnVtYmVyIG9mIHRpY2tzDQogKiBpbiBgdW5pdGAgZm9yIHRoZSBnaXZlbiBgbWluYCAvIGBtYXhgIHJhbmdlIGFuZCByZXNwZWN0aW5nIHRoZSBpbnRlcnZhbCBzdGVwcyBjb25zdHJhaW50cy4NCiAqLw0KZnVuY3Rpb24gZGV0ZXJtaW5lU3RlcFNpemUobWluLCBtYXgsIHVuaXQsIGNhcGFjaXR5KSB7DQoJdmFyIHJhbmdlID0gbWF4IC0gbWluOw0KCXZhciBpbnRlcnZhbCA9IElOVEVSVkFMU1t1bml0XTsNCgl2YXIgbWlsbGlzZWNvbmRzID0gaW50ZXJ2YWwuc2l6ZTsNCgl2YXIgc3RlcHMgPSBpbnRlcnZhbC5zdGVwczsNCgl2YXIgaSwgaWxlbiwgZmFjdG9yOw0KDQoJaWYgKCFzdGVwcykgew0KCQlyZXR1cm4gTWF0aC5jZWlsKHJhbmdlIC8gKChjYXBhY2l0eSB8fCAxKSAqIG1pbGxpc2Vjb25kcykpOw0KCX0NCg0KCWZvciAoaSA9IDAsIGlsZW4gPSBzdGVwcy5sZW5ndGg7IGkgPCBpbGVuOyArK2kpIHsNCgkJZmFjdG9yID0gc3RlcHNbaV07DQoJCWlmIChNYXRoLmNlaWwocmFuZ2UgLyAobWlsbGlzZWNvbmRzICogZmFjdG9yKSkgPD0gY2FwYWNpdHkpIHsNCgkJCWJyZWFrOw0KCQl9DQoJfQ0KDQoJcmV0dXJuIGZhY3RvcjsNCn0NCg0KLyoqDQogKiBGaWd1cmVzIG91dCB3aGF0IHVuaXQgcmVzdWx0cyBpbiBhbiBhcHByb3ByaWF0ZSBudW1iZXIgb2YgYXV0by1nZW5lcmF0ZWQgdGlja3MNCiAqLw0KZnVuY3Rpb24gZGV0ZXJtaW5lVW5pdEZvckF1dG9UaWNrcyhtaW5Vbml0LCBtaW4sIG1heCwgY2FwYWNpdHkpIHsNCgl2YXIgaWxlbiA9IFVOSVRTLmxlbmd0aDsNCgl2YXIgaSwgaW50ZXJ2YWwsIGZhY3RvcjsNCg0KCWZvciAoaSA9IFVOSVRTLmluZGV4T2YobWluVW5pdCk7IGkgPCBpbGVuIC0gMTsgKytpKSB7DQoJCWludGVydmFsID0gSU5URVJWQUxTW1VOSVRTW2ldXTsNCgkJZmFjdG9yID0gaW50ZXJ2YWwuc3RlcHMgPyBpbnRlcnZhbC5zdGVwc1tpbnRlcnZhbC5zdGVwcy5sZW5ndGggLSAxXSA6IE1BWF9JTlRFR0VSOw0KDQoJCWlmIChpbnRlcnZhbC5jb21tb24gJiYgTWF0aC5jZWlsKChtYXggLSBtaW4pIC8gKGZhY3RvciAqIGludGVydmFsLnNpemUpKSA8PSBjYXBhY2l0eSkgew0KCQkJcmV0dXJuIFVOSVRTW2ldOw0KCQl9DQoJfQ0KDQoJcmV0dXJuIFVOSVRTW2lsZW4gLSAxXTsNCn0NCg0KLyoqDQogKiBGaWd1cmVzIG91dCB3aGF0IHVuaXQgdG8gZm9ybWF0IGEgc2V0IG9mIHRpY2tzIHdpdGgNCiAqLw0KZnVuY3Rpb24gZGV0ZXJtaW5lVW5pdEZvckZvcm1hdHRpbmcodGlja3MsIG1pblVuaXQsIG1pbiwgbWF4KSB7DQoJdmFyIGR1cmF0aW9uID0gbW9tZW50LmR1cmF0aW9uKG1vbWVudChtYXgpLmRpZmYobW9tZW50KG1pbikpKTsNCgl2YXIgaWxlbiA9IFVOSVRTLmxlbmd0aDsNCgl2YXIgaSwgdW5pdDsNCg0KCWZvciAoaSA9IGlsZW4gLSAxOyBpID49IFVOSVRTLmluZGV4T2YobWluVW5pdCk7IGktLSkgew0KCQl1bml0ID0gVU5JVFNbaV07DQoJCWlmIChJTlRFUlZBTFNbdW5pdF0uY29tbW9uICYmIGR1cmF0aW9uLmFzKHVuaXQpID49IHRpY2tzLmxlbmd0aCkgew0KCQkJcmV0dXJuIHVuaXQ7DQoJCX0NCgl9DQoNCglyZXR1cm4gVU5JVFNbbWluVW5pdCA/IFVOSVRTLmluZGV4T2YobWluVW5pdCkgOiAwXTsNCn0NCg0KZnVuY3Rpb24gZGV0ZXJtaW5lTWFqb3JVbml0KHVuaXQpIHsNCglmb3IgKHZhciBpID0gVU5JVFMuaW5kZXhPZih1bml0KSArIDEsIGlsZW4gPSBVTklUUy5sZW5ndGg7IGkgPCBpbGVuOyArK2kpIHsNCgkJaWYgKElOVEVSVkFMU1tVTklUU1tpXV0uY29tbW9uKSB7DQoJCQlyZXR1cm4gVU5JVFNbaV07DQoJCX0NCgl9DQp9DQoNCi8qKg0KICogR2VuZXJhdGVzIGEgbWF4aW11bSBvZiBgY2FwYWNpdHlgIHRpbWVzdGFtcHMgYmV0d2VlbiBtaW4gYW5kIG1heCwgcm91bmRlZCB0byB0aGUNCiAqIGBtaW5vcmAgdW5pdCwgYWxpZ25lZCBvbiB0aGUgYG1ham9yYCB1bml0IGFuZCB1c2luZyB0aGUgZ2l2ZW4gc2NhbGUgdGltZSBgb3B0aW9uc2AuDQogKiBJbXBvcnRhbnQ6IHRoaXMgbWV0aG9kIGNhbiByZXR1cm4gdGlja3Mgb3V0c2lkZSB0aGUgbWluIGFuZCBtYXggcmFuZ2UsIGl0J3MgdGhlDQogKiByZXNwb25zaWJpbGl0eSBvZiB0aGUgY2FsbGluZyBjb2RlIHRvIGNsYW1wIHZhbHVlcyBpZiBuZWVkZWQuDQogKi8NCmZ1bmN0aW9uIGdlbmVyYXRlKG1pbiwgbWF4LCBjYXBhY2l0eSwgb3B0aW9ucykgew0KCXZhciB0aW1lT3B0cyA9IG9wdGlvbnMudGltZTsNCgl2YXIgbWlub3IgPSB0aW1lT3B0cy51bml0IHx8IGRldGVybWluZVVuaXRGb3JBdXRvVGlja3ModGltZU9wdHMubWluVW5pdCwgbWluLCBtYXgsIGNhcGFjaXR5KTsNCgl2YXIgbWFqb3IgPSBkZXRlcm1pbmVNYWpvclVuaXQobWlub3IpOw0KCXZhciBzdGVwU2l6ZSA9IGhlbHBlcnMudmFsdWVPckRlZmF1bHQodGltZU9wdHMuc3RlcFNpemUsIHRpbWVPcHRzLnVuaXRTdGVwU2l6ZSk7DQoJdmFyIHdlZWtkYXkgPSBtaW5vciA9PT0gJ3dlZWsnID8gdGltZU9wdHMuaXNvV2Vla2RheSA6IGZhbHNlOw0KCXZhciBtYWpvclRpY2tzRW5hYmxlZCA9IG9wdGlvbnMudGlja3MubWFqb3IuZW5hYmxlZDsNCgl2YXIgaW50ZXJ2YWwgPSBJTlRFUlZBTFNbbWlub3JdOw0KCXZhciBmaXJzdCA9IG1vbWVudChtaW4pOw0KCXZhciBsYXN0ID0gbW9tZW50KG1heCk7DQoJdmFyIHRpY2tzID0gW107DQoJdmFyIHRpbWU7DQoNCglpZiAoIXN0ZXBTaXplKSB7DQoJCXN0ZXBTaXplID0gZGV0ZXJtaW5lU3RlcFNpemUobWluLCBtYXgsIG1pbm9yLCBjYXBhY2l0eSk7DQoJfQ0KDQoJLy8gRm9yICd3ZWVrJyB1bml0LCBoYW5kbGUgdGhlIGZpcnN0IGRheSBvZiB3ZWVrIG9wdGlvbg0KCWlmICh3ZWVrZGF5KSB7DQoJCWZpcnN0ID0gZmlyc3QuaXNvV2Vla2RheSh3ZWVrZGF5KTsNCgkJbGFzdCA9IGxhc3QuaXNvV2Vla2RheSh3ZWVrZGF5KTsNCgl9DQoNCgkvLyBBbGlnbiBmaXJzdC9sYXN0IHRpY2tzIG9uIHVuaXQNCglmaXJzdCA9IGZpcnN0LnN0YXJ0T2Yod2Vla2RheSA/ICdkYXknIDogbWlub3IpOw0KCWxhc3QgPSBsYXN0LnN0YXJ0T2Yod2Vla2RheSA/ICdkYXknIDogbWlub3IpOw0KDQoJLy8gTWFrZSBzdXJlIHRoYXQgdGhlIGxhc3QgdGljayBpbmNsdWRlIG1heA0KCWlmIChsYXN0IDwgbWF4KSB7DQoJCWxhc3QuYWRkKDEsIG1pbm9yKTsNCgl9DQoNCgl0aW1lID0gbW9tZW50KGZpcnN0KTsNCg0KCWlmIChtYWpvclRpY2tzRW5hYmxlZCAmJiBtYWpvciAmJiAhd2Vla2RheSAmJiAhdGltZU9wdHMucm91bmQpIHsNCgkJLy8gQWxpZ24gdGhlIGZpcnN0IHRpY2sgb24gdGhlIHByZXZpb3VzIGBtaW5vcmAgdW5pdCBhbGlnbmVkIG9uIHRoZSBgbWFqb3JgIHVuaXQ6DQoJCS8vIHdlIGZpcnN0IGFsaWduZWQgdGltZSBvbiB0aGUgcHJldmlvdXMgYG1ham9yYCB1bml0IHRoZW4gYWRkIHRoZSBudW1iZXIgb2YgZnVsbA0KCQkvLyBzdGVwU2l6ZSB0aGVyZSBpcyBiZXR3ZWVuIGZpcnN0IGFuZCB0aGUgcHJldmlvdXMgbWFqb3IgdGltZS4NCgkJdGltZS5zdGFydE9mKG1ham9yKTsNCgkJdGltZS5hZGQofn4oKGZpcnN0IC0gdGltZSkgLyAoaW50ZXJ2YWwuc2l6ZSAqIHN0ZXBTaXplKSkgKiBzdGVwU2l6ZSwgbWlub3IpOw0KCX0NCg0KCWZvciAoOyB0aW1lIDwgbGFzdDsgdGltZS5hZGQoc3RlcFNpemUsIG1pbm9yKSkgew0KCQl0aWNrcy5wdXNoKCt0aW1lKTsNCgl9DQoNCgl0aWNrcy5wdXNoKCt0aW1lKTsNCg0KCXJldHVybiB0aWNrczsNCn0NCg0KLyoqDQogKiBSZXR1cm5zIHRoZSByaWdodCBhbmQgbGVmdCBvZmZzZXRzIGZyb20gZWRnZXMgaW4gdGhlIGZvcm0gb2Yge2xlZnQsIHJpZ2h0fS4NCiAqIE9mZnNldHMgYXJlIGFkZGVkIHdoZW4gdGhlIGBvZmZzZXRgIG9wdGlvbiBpcyB0cnVlLg0KICovDQpmdW5jdGlvbiBjb21wdXRlT2Zmc2V0cyh0YWJsZSwgdGlja3MsIG1pbiwgbWF4LCBvcHRpb25zKSB7DQoJdmFyIGxlZnQgPSAwOw0KCXZhciByaWdodCA9IDA7DQoJdmFyIHVwcGVyLCBsb3dlcjsNCg0KCWlmIChvcHRpb25zLm9mZnNldCAmJiB0aWNrcy5sZW5ndGgpIHsNCgkJaWYgKCFvcHRpb25zLnRpbWUubWluKSB7DQoJCQl1cHBlciA9IHRpY2tzLmxlbmd0aCA+IDEgPyB0aWNrc1sxXSA6IG1heDsNCgkJCWxvd2VyID0gdGlja3NbMF07DQoJCQlsZWZ0ID0gKA0KCQkJCWludGVycG9sYXRlKHRhYmxlLCAndGltZScsIHVwcGVyLCAncG9zJykgLQ0KCQkJCWludGVycG9sYXRlKHRhYmxlLCAndGltZScsIGxvd2VyLCAncG9zJykNCgkJCSkgLyAyOw0KCQl9DQoJCWlmICghb3B0aW9ucy50aW1lLm1heCkgew0KCQkJdXBwZXIgPSB0aWNrc1t0aWNrcy5sZW5ndGggLSAxXTsNCgkJCWxvd2VyID0gdGlja3MubGVuZ3RoID4gMSA/IHRpY2tzW3RpY2tzLmxlbmd0aCAtIDJdIDogbWluOw0KCQkJcmlnaHQgPSAoDQoJCQkJaW50ZXJwb2xhdGUodGFibGUsICd0aW1lJywgdXBwZXIsICdwb3MnKSAtDQoJCQkJaW50ZXJwb2xhdGUodGFibGUsICd0aW1lJywgbG93ZXIsICdwb3MnKQ0KCQkJKSAvIDI7DQoJCX0NCgl9DQoNCglyZXR1cm4ge2xlZnQ6IGxlZnQsIHJpZ2h0OiByaWdodH07DQp9DQoNCmZ1bmN0aW9uIHRpY2tzRnJvbVRpbWVzdGFtcHModmFsdWVzLCBtYWpvclVuaXQpIHsNCgl2YXIgdGlja3MgPSBbXTsNCgl2YXIgaSwgaWxlbiwgdmFsdWUsIG1ham9yOw0KDQoJZm9yIChpID0gMCwgaWxlbiA9IHZhbHVlcy5sZW5ndGg7IGkgPCBpbGVuOyArK2kpIHsNCgkJdmFsdWUgPSB2YWx1ZXNbaV07DQoJCW1ham9yID0gbWFqb3JVbml0ID8gdmFsdWUgPT09ICttb21lbnQodmFsdWUpLnN0YXJ0T2YobWFqb3JVbml0KSA6IGZhbHNlOw0KDQoJCXRpY2tzLnB1c2goew0KCQkJdmFsdWU6IHZhbHVlLA0KCQkJbWFqb3I6IG1ham9yDQoJCX0pOw0KCX0NCg0KCXJldHVybiB0aWNrczsNCn0NCg0KbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihDaGFydCkgew0KDQoJdmFyIGRlZmF1bHRDb25maWcgPSB7DQoJCXBvc2l0aW9uOiAnYm90dG9tJywNCg0KCQkvKioNCgkJICogRGF0YSBkaXN0cmlidXRpb24gYWxvbmcgdGhlIHNjYWxlOg0KCQkgKiAtICdsaW5lYXInOiBkYXRhIGFyZSBzcHJlYWQgYWNjb3JkaW5nIHRvIHRoZWlyIHRpbWUgKGRpc3RhbmNlcyBjYW4gdmFyeSksDQoJCSAqIC0gJ3Nlcmllcyc6IGRhdGEgYXJlIHNwcmVhZCBhdCB0aGUgc2FtZSBkaXN0YW5jZSBmcm9tIGVhY2ggb3RoZXIuDQoJCSAqIEBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2NoYXJ0anMvQ2hhcnQuanMvcHVsbC80NTA3DQoJCSAqIEBzaW5jZSAyLjcuMA0KCQkgKi8NCgkJZGlzdHJpYnV0aW9uOiAnbGluZWFyJywNCg0KCQkvKioNCgkJICogU2NhbGUgYm91bmRhcnkgc3RyYXRlZ3kgKGJ5cGFzc2VkIGJ5IG1pbi9tYXggdGltZSBvcHRpb25zKQ0KCQkgKiAtIGBkYXRhYDogbWFrZSBzdXJlIGRhdGEgYXJlIGZ1bGx5IHZpc2libGUsIHRpY2tzIG91dHNpZGUgYXJlIHJlbW92ZWQNCgkJICogLSBgdGlja3NgOiBtYWtlIHN1cmUgdGlja3MgYXJlIGZ1bGx5IHZpc2libGUsIGRhdGEgb3V0c2lkZSBhcmUgdHJ1bmNhdGVkDQoJCSAqIEBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2NoYXJ0anMvQ2hhcnQuanMvcHVsbC80NTU2DQoJCSAqIEBzaW5jZSAyLjcuMA0KCQkgKi8NCgkJYm91bmRzOiAnZGF0YScsDQoNCgkJdGltZTogew0KCQkJcGFyc2VyOiBmYWxzZSwgLy8gZmFsc2UgPT0gYSBwYXR0ZXJuIHN0cmluZyBmcm9tIGh0dHA6Ly9tb21lbnRqcy5jb20vZG9jcy8jL3BhcnNpbmcvc3RyaW5nLWZvcm1hdC8gb3IgYSBjdXN0b20gY2FsbGJhY2sgdGhhdCBjb252ZXJ0cyBpdHMgYXJndW1lbnQgdG8gYSBtb21lbnQNCgkJCWZvcm1hdDogZmFsc2UsIC8vIERFUFJFQ0FURUQgZmFsc2UgPT0gZGF0ZSBvYmplY3RzLCBtb21lbnQgb2JqZWN0LCBjYWxsYmFjayBvciBhIHBhdHRlcm4gc3RyaW5nIGZyb20gaHR0cDovL21vbWVudGpzLmNvbS9kb2NzLyMvcGFyc2luZy9zdHJpbmctZm9ybWF0Lw0KCQkJdW5pdDogZmFsc2UsIC8vIGZhbHNlID09IGF1dG9tYXRpYyBvciBvdmVycmlkZSB3aXRoIHdlZWssIG1vbnRoLCB5ZWFyLCBldGMuDQoJCQlyb3VuZDogZmFsc2UsIC8vIG5vbmUsIG9yIG92ZXJyaWRlIHdpdGggd2VlaywgbW9udGgsIHllYXIsIGV0Yy4NCgkJCWRpc3BsYXlGb3JtYXQ6IGZhbHNlLCAvLyBERVBSRUNBVEVEDQoJCQlpc29XZWVrZGF5OiBmYWxzZSwgLy8gb3ZlcnJpZGUgd2VlayBzdGFydCBkYXkgLSBzZWUgaHR0cDovL21vbWVudGpzLmNvbS9kb2NzLyMvZ2V0LXNldC9pc28td2Vla2RheS8NCgkJCW1pblVuaXQ6ICdtaWxsaXNlY29uZCcsDQoNCgkJCS8vIGRlZmF1bHRzIHRvIHVuaXQncyBjb3JyZXNwb25kaW5nIHVuaXRGb3JtYXQgYmVsb3cgb3Igb3ZlcnJpZGUgdXNpbmcgcGF0dGVybiBzdHJpbmcgZnJvbSBodHRwOi8vbW9tZW50anMuY29tL2RvY3MvIy9kaXNwbGF5aW5nL2Zvcm1hdC8NCgkJCWRpc3BsYXlGb3JtYXRzOiB7DQoJCQkJbWlsbGlzZWNvbmQ6ICdoOm1tOnNzLlNTUyBhJywgLy8gMTE6MjA6MDEuMTIzIEFNLA0KCQkJCXNlY29uZDogJ2g6bW06c3MgYScsIC8vIDExOjIwOjAxIEFNDQoJCQkJbWludXRlOiAnaDptbSBhJywgLy8gMTE6MjAgQU0NCgkJCQlob3VyOiAnaEEnLCAvLyA1UE0NCgkJCQlkYXk6ICdNTU0gRCcsIC8vIFNlcCA0DQoJCQkJd2VlazogJ2xsJywgLy8gV2VlayA0Niwgb3IgbWF5YmUgIltXXVdXIC0gWVlZWSIgPw0KCQkJCW1vbnRoOiAnTU1NIFlZWVknLCAvLyBTZXB0IDIwMTUNCgkJCQlxdWFydGVyOiAnW1FdUSAtIFlZWVknLCAvLyBRMw0KCQkJCXllYXI6ICdZWVlZJyAvLyAyMDE1DQoJCQl9LA0KCQl9LA0KCQl0aWNrczogew0KCQkJYXV0b1NraXA6IGZhbHNlLA0KDQoJCQkvKioNCgkJCSAqIFRpY2tzIGdlbmVyYXRpb24gaW5wdXQgdmFsdWVzOg0KCQkJICogLSAnYXV0byc6IGdlbmVyYXRlcyAib3B0aW1hbCIgdGlja3MgYmFzZWQgb24gc2NhbGUgc2l6ZSBhbmQgdGltZSBvcHRpb25zLg0KCQkJICogLSAnZGF0YSc6IGdlbmVyYXRlcyB0aWNrcyBmcm9tIGRhdGEgKGluY2x1ZGluZyBsYWJlbHMgZnJvbSBkYXRhIHt0fHh8eX0gb2JqZWN0cykuDQoJCQkgKiAtICdsYWJlbHMnOiBnZW5lcmF0ZXMgdGlja3MgZnJvbSB1c2VyIGdpdmVuIGBkYXRhLmxhYmVsc2AgdmFsdWVzIE9OTFkuDQoJCQkgKiBAc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9jaGFydGpzL0NoYXJ0LmpzL3B1bGwvNDUwNw0KCQkJICogQHNpbmNlIDIuNy4wDQoJCQkgKi8NCgkJCXNvdXJjZTogJ2F1dG8nLA0KDQoJCQltYWpvcjogew0KCQkJCWVuYWJsZWQ6IGZhbHNlDQoJCQl9DQoJCX0NCgl9Ow0KDQoJdmFyIFRpbWVTY2FsZSA9IENoYXJ0LlNjYWxlLmV4dGVuZCh7DQoJCWluaXRpYWxpemU6IGZ1bmN0aW9uKCkgew0KCQkJaWYgKCFtb21lbnQpIHsNCgkJCQl0aHJvdyBuZXcgRXJyb3IoJ0NoYXJ0LmpzIC0gTW9tZW50LmpzIGNvdWxkIG5vdCBiZSBmb3VuZCEgWW91IG11c3QgaW5jbHVkZSBpdCBiZWZvcmUgQ2hhcnQuanMgdG8gdXNlIHRoZSB0aW1lIHNjYWxlLiBEb3dubG9hZCBhdCBodHRwczovL21vbWVudGpzLmNvbScpOw0KCQkJfQ0KDQoJCQl0aGlzLm1lcmdlVGlja3NPcHRpb25zKCk7DQoNCgkJCUNoYXJ0LlNjYWxlLnByb3RvdHlwZS5pbml0aWFsaXplLmNhbGwodGhpcyk7DQoJCX0sDQoNCgkJdXBkYXRlOiBmdW5jdGlvbigpIHsNCgkJCXZhciBtZSA9IHRoaXM7DQoJCQl2YXIgb3B0aW9ucyA9IG1lLm9wdGlvbnM7DQoNCgkJCS8vIERFUFJFQ0FUSU9OUzogb3V0cHV0IGEgbWVzc2FnZSBvbmx5IG9uZSB0aW1lIHBlciB1cGRhdGUNCgkJCWlmIChvcHRpb25zLnRpbWUgJiYgb3B0aW9ucy50aW1lLmZvcm1hdCkgew0KCQkJCWNvbnNvbGUud2Fybignb3B0aW9ucy50aW1lLmZvcm1hdCBpcyBkZXByZWNhdGVkIGFuZCByZXBsYWNlZCBieSBvcHRpb25zLnRpbWUucGFyc2VyLicpOw0KCQkJfQ0KDQoJCQlyZXR1cm4gQ2hhcnQuU2NhbGUucHJvdG90eXBlLnVwZGF0ZS5hcHBseShtZSwgYXJndW1lbnRzKTsNCgkJfSwNCg0KCQkvKioNCgkJICogQWxsb3dzIGRhdGEgdG8gYmUgcmVmZXJlbmNlZCB2aWEgJ3QnIGF0dHJpYnV0ZQ0KCQkgKi8NCgkJZ2V0UmlnaHRWYWx1ZTogZnVuY3Rpb24ocmF3VmFsdWUpIHsNCgkJCWlmIChyYXdWYWx1ZSAmJiByYXdWYWx1ZS50ICE9PSB1bmRlZmluZWQpIHsNCgkJCQlyYXdWYWx1ZSA9IHJhd1ZhbHVlLnQ7DQoJCQl9DQoJCQlyZXR1cm4gQ2hhcnQuU2NhbGUucHJvdG90eXBlLmdldFJpZ2h0VmFsdWUuY2FsbCh0aGlzLCByYXdWYWx1ZSk7DQoJCX0sDQoNCgkJZGV0ZXJtaW5lRGF0YUxpbWl0czogZnVuY3Rpb24oKSB7DQoJCQl2YXIgbWUgPSB0aGlzOw0KCQkJdmFyIGNoYXJ0ID0gbWUuY2hhcnQ7DQoJCQl2YXIgdGltZU9wdHMgPSBtZS5vcHRpb25zLnRpbWU7DQoJCQl2YXIgbWluID0gTUFYX0lOVEVHRVI7DQoJCQl2YXIgbWF4ID0gTUlOX0lOVEVHRVI7DQoJCQl2YXIgdGltZXN0YW1wcyA9IFtdOw0KCQkJdmFyIGRhdGFzZXRzID0gW107DQoJCQl2YXIgbGFiZWxzID0gW107DQoJCQl2YXIgaSwgaiwgaWxlbiwgamxlbiwgZGF0YSwgdGltZXN0YW1wOw0KDQoJCQkvLyBDb252ZXJ0IGxhYmVscyB0byB0aW1lc3RhbXBzDQoJCQlmb3IgKGkgPSAwLCBpbGVuID0gY2hhcnQuZGF0YS5sYWJlbHMubGVuZ3RoOyBpIDwgaWxlbjsgKytpKSB7DQoJCQkJbGFiZWxzLnB1c2gocGFyc2UoY2hhcnQuZGF0YS5sYWJlbHNbaV0sIG1lKSk7DQoJCQl9DQoNCgkJCS8vIENvbnZlcnQgZGF0YSB0byB0aW1lc3RhbXBzDQoJCQlmb3IgKGkgPSAwLCBpbGVuID0gKGNoYXJ0LmRhdGEuZGF0YXNldHMgfHwgW10pLmxlbmd0aDsgaSA8IGlsZW47ICsraSkgew0KCQkJCWlmIChjaGFydC5pc0RhdGFzZXRWaXNpYmxlKGkpKSB7DQoJCQkJCWRhdGEgPSBjaGFydC5kYXRhLmRhdGFzZXRzW2ldLmRhdGE7DQoNCgkJCQkJLy8gTGV0J3MgY29uc2lkZXIgdGhhdCBhbGwgZGF0YSBoYXZlIHRoZSBzYW1lIGZvcm1hdC4NCgkJCQkJaWYgKGhlbHBlcnMuaXNPYmplY3QoZGF0YVswXSkpIHsNCgkJCQkJCWRhdGFzZXRzW2ldID0gW107DQoNCgkJCQkJCWZvciAoaiA9IDAsIGpsZW4gPSBkYXRhLmxlbmd0aDsgaiA8IGpsZW47ICsraikgew0KCQkJCQkJCXRpbWVzdGFtcCA9IHBhcnNlKGRhdGFbal0sIG1lKTsNCgkJCQkJCQl0aW1lc3RhbXBzLnB1c2godGltZXN0YW1wKTsNCgkJCQkJCQlkYXRhc2V0c1tpXVtqXSA9IHRpbWVzdGFtcDsNCgkJCQkJCX0NCgkJCQkJfSBlbHNlIHsNCgkJCQkJCXRpbWVzdGFtcHMucHVzaC5hcHBseSh0aW1lc3RhbXBzLCBsYWJlbHMpOw0KCQkJCQkJZGF0YXNldHNbaV0gPSBsYWJlbHMuc2xpY2UoMCk7DQoJCQkJCX0NCgkJCQl9IGVsc2Ugew0KCQkJCQlkYXRhc2V0c1tpXSA9IFtdOw0KCQkJCX0NCgkJCX0NCg0KCQkJaWYgKGxhYmVscy5sZW5ndGgpIHsNCgkJCQkvLyBTb3J0IGxhYmVscyAqKmFmdGVyKiogZGF0YSBoYXZlIGJlZW4gY29udmVydGVkDQoJCQkJbGFiZWxzID0gYXJyYXlVbmlxdWUobGFiZWxzKS5zb3J0KHNvcnRlcik7DQoJCQkJbWluID0gTWF0aC5taW4obWluLCBsYWJlbHNbMF0pOw0KCQkJCW1heCA9IE1hdGgubWF4KG1heCwgbGFiZWxzW2xhYmVscy5sZW5ndGggLSAxXSk7DQoJCQl9DQoNCgkJCWlmICh0aW1lc3RhbXBzLmxlbmd0aCkgew0KCQkJCXRpbWVzdGFtcHMgPSBhcnJheVVuaXF1ZSh0aW1lc3RhbXBzKS5zb3J0KHNvcnRlcik7DQoJCQkJbWluID0gTWF0aC5taW4obWluLCB0aW1lc3RhbXBzWzBdKTsNCgkJCQltYXggPSBNYXRoLm1heChtYXgsIHRpbWVzdGFtcHNbdGltZXN0YW1wcy5sZW5ndGggLSAxXSk7DQoJCQl9DQoNCgkJCW1pbiA9IHBhcnNlKHRpbWVPcHRzLm1pbiwgbWUpIHx8IG1pbjsNCgkJCW1heCA9IHBhcnNlKHRpbWVPcHRzLm1heCwgbWUpIHx8IG1heDsNCg0KCQkJLy8gSW4gY2FzZSB0aGVyZSBpcyBubyB2YWxpZCBtaW4vbWF4LCBsZXQncyB1c2UgdG9kYXkgbGltaXRzDQoJCQltaW4gPSBtaW4gPT09IE1BWF9JTlRFR0VSID8gK21vbWVudCgpLnN0YXJ0T2YoJ2RheScpIDogbWluOw0KCQkJbWF4ID0gbWF4ID09PSBNSU5fSU5URUdFUiA/ICttb21lbnQoKS5lbmRPZignZGF5JykgKyAxIDogbWF4Ow0KDQoJCQkvLyBNYWtlIHN1cmUgdGhhdCBtYXggaXMgc3RyaWN0bHkgaGlnaGVyIHRoYW4gbWluIChyZXF1aXJlZCBieSB0aGUgbG9va3VwIHRhYmxlKQ0KCQkJbWUubWluID0gTWF0aC5taW4obWluLCBtYXgpOw0KCQkJbWUubWF4ID0gTWF0aC5tYXgobWluICsgMSwgbWF4KTsNCg0KCQkJLy8gUFJJVkFURQ0KCQkJbWUuX2hvcml6b250YWwgPSBtZS5pc0hvcml6b250YWwoKTsNCgkJCW1lLl90YWJsZSA9IFtdOw0KCQkJbWUuX3RpbWVzdGFtcHMgPSB7DQoJCQkJZGF0YTogdGltZXN0YW1wcywNCgkJCQlkYXRhc2V0czogZGF0YXNldHMsDQoJCQkJbGFiZWxzOiBsYWJlbHMNCgkJCX07DQoJCX0sDQoNCgkJYnVpbGRUaWNrczogZnVuY3Rpb24oKSB7DQoJCQl2YXIgbWUgPSB0aGlzOw0KCQkJdmFyIG1pbiA9IG1lLm1pbjsNCgkJCXZhciBtYXggPSBtZS5tYXg7DQoJCQl2YXIgb3B0aW9ucyA9IG1lLm9wdGlvbnM7DQoJCQl2YXIgdGltZU9wdHMgPSBvcHRpb25zLnRpbWU7DQoJCQl2YXIgdGltZXN0YW1wcyA9IFtdOw0KCQkJdmFyIHRpY2tzID0gW107DQoJCQl2YXIgaSwgaWxlbiwgdGltZXN0YW1wOw0KDQoJCQlzd2l0Y2ggKG9wdGlvbnMudGlja3Muc291cmNlKSB7DQoJCQljYXNlICdkYXRhJzoNCgkJCQl0aW1lc3RhbXBzID0gbWUuX3RpbWVzdGFtcHMuZGF0YTsNCgkJCQlicmVhazsNCgkJCWNhc2UgJ2xhYmVscyc6DQoJCQkJdGltZXN0YW1wcyA9IG1lLl90aW1lc3RhbXBzLmxhYmVsczsNCgkJCQlicmVhazsNCgkJCWNhc2UgJ2F1dG8nOg0KCQkJZGVmYXVsdDoNCgkJCQl0aW1lc3RhbXBzID0gZ2VuZXJhdGUobWluLCBtYXgsIG1lLmdldExhYmVsQ2FwYWNpdHkobWluKSwgb3B0aW9ucyk7DQoJCQl9DQoNCgkJCWlmIChvcHRpb25zLmJvdW5kcyA9PT0gJ3RpY2tzJyAmJiB0aW1lc3RhbXBzLmxlbmd0aCkgew0KCQkJCW1pbiA9IHRpbWVzdGFtcHNbMF07DQoJCQkJbWF4ID0gdGltZXN0YW1wc1t0aW1lc3RhbXBzLmxlbmd0aCAtIDFdOw0KCQkJfQ0KDQoJCQkvLyBFbmZvcmNlIGxpbWl0cyB3aXRoIHVzZXIgbWluL21heCBvcHRpb25zDQoJCQltaW4gPSBwYXJzZSh0aW1lT3B0cy5taW4sIG1lKSB8fCBtaW47DQoJCQltYXggPSBwYXJzZSh0aW1lT3B0cy5tYXgsIG1lKSB8fCBtYXg7DQoNCgkJCS8vIFJlbW92ZSB0aWNrcyBvdXRzaWRlIHRoZSBtaW4vbWF4IHJhbmdlDQoJCQlmb3IgKGkgPSAwLCBpbGVuID0gdGltZXN0YW1wcy5sZW5ndGg7IGkgPCBpbGVuOyArK2kpIHsNCgkJCQl0aW1lc3RhbXAgPSB0aW1lc3RhbXBzW2ldOw0KCQkJCWlmICh0aW1lc3RhbXAgPj0gbWluICYmIHRpbWVzdGFtcCA8PSBtYXgpIHsNCgkJCQkJdGlja3MucHVzaCh0aW1lc3RhbXApOw0KCQkJCX0NCgkJCX0NCg0KCQkJbWUubWluID0gbWluOw0KCQkJbWUubWF4ID0gbWF4Ow0KDQoJCQkvLyBQUklWQVRFDQoJCQltZS5fdW5pdCA9IHRpbWVPcHRzLnVuaXQgfHwgZGV0ZXJtaW5lVW5pdEZvckZvcm1hdHRpbmcodGlja3MsIHRpbWVPcHRzLm1pblVuaXQsIG1lLm1pbiwgbWUubWF4KTsNCgkJCW1lLl9tYWpvclVuaXQgPSBkZXRlcm1pbmVNYWpvclVuaXQobWUuX3VuaXQpOw0KCQkJbWUuX3RhYmxlID0gYnVpbGRMb29rdXBUYWJsZShtZS5fdGltZXN0YW1wcy5kYXRhLCBtaW4sIG1heCwgb3B0aW9ucy5kaXN0cmlidXRpb24pOw0KCQkJbWUuX29mZnNldHMgPSBjb21wdXRlT2Zmc2V0cyhtZS5fdGFibGUsIHRpY2tzLCBtaW4sIG1heCwgb3B0aW9ucyk7DQoNCgkJCXJldHVybiB0aWNrc0Zyb21UaW1lc3RhbXBzKHRpY2tzLCBtZS5fbWFqb3JVbml0KTsNCgkJfSwNCg0KCQlnZXRMYWJlbEZvckluZGV4OiBmdW5jdGlvbihpbmRleCwgZGF0YXNldEluZGV4KSB7DQoJCQl2YXIgbWUgPSB0aGlzOw0KCQkJdmFyIGRhdGEgPSBtZS5jaGFydC5kYXRhOw0KCQkJdmFyIHRpbWVPcHRzID0gbWUub3B0aW9ucy50aW1lOw0KCQkJdmFyIGxhYmVsID0gZGF0YS5sYWJlbHMgJiYgaW5kZXggPCBkYXRhLmxhYmVscy5sZW5ndGggPyBkYXRhLmxhYmVsc1tpbmRleF0gOiAnJzsNCgkJCXZhciB2YWx1ZSA9IGRhdGEuZGF0YXNldHNbZGF0YXNldEluZGV4XS5kYXRhW2luZGV4XTsNCg0KCQkJaWYgKGhlbHBlcnMuaXNPYmplY3QodmFsdWUpKSB7DQoJCQkJbGFiZWwgPSBtZS5nZXRSaWdodFZhbHVlKHZhbHVlKTsNCgkJCX0NCgkJCWlmICh0aW1lT3B0cy50b29sdGlwRm9ybWF0KSB7DQoJCQkJbGFiZWwgPSBtb21lbnRpZnkobGFiZWwsIHRpbWVPcHRzKS5mb3JtYXQodGltZU9wdHMudG9vbHRpcEZvcm1hdCk7DQoJCQl9DQoNCgkJCXJldHVybiBsYWJlbDsNCgkJfSwNCg0KCQkvKioNCgkJICogRnVuY3Rpb24gdG8gZm9ybWF0IGFuIGluZGl2aWR1YWwgdGljayBtYXJrDQoJCSAqIEBwcml2YXRlDQoJCSAqLw0KCQl0aWNrRm9ybWF0RnVuY3Rpb246IGZ1bmN0aW9uKHRpY2ssIGluZGV4LCB0aWNrcywgZm9ybWF0T3ZlcnJpZGUpIHsNCgkJCXZhciBtZSA9IHRoaXM7DQoJCQl2YXIgb3B0aW9ucyA9IG1lLm9wdGlvbnM7DQoJCQl2YXIgdGltZSA9IHRpY2sudmFsdWVPZigpOw0KCQkJdmFyIGZvcm1hdHMgPSBvcHRpb25zLnRpbWUuZGlzcGxheUZvcm1hdHM7DQoJCQl2YXIgbWlub3JGb3JtYXQgPSBmb3JtYXRzW21lLl91bml0XTsNCgkJCXZhciBtYWpvclVuaXQgPSBtZS5fbWFqb3JVbml0Ow0KCQkJdmFyIG1ham9yRm9ybWF0ID0gZm9ybWF0c1ttYWpvclVuaXRdOw0KCQkJdmFyIG1ham9yVGltZSA9IHRpY2suY2xvbmUoKS5zdGFydE9mKG1ham9yVW5pdCkudmFsdWVPZigpOw0KCQkJdmFyIG1ham9yVGlja09wdHMgPSBvcHRpb25zLnRpY2tzLm1ham9yOw0KCQkJdmFyIG1ham9yID0gbWFqb3JUaWNrT3B0cy5lbmFibGVkICYmIG1ham9yVW5pdCAmJiBtYWpvckZvcm1hdCAmJiB0aW1lID09PSBtYWpvclRpbWU7DQoJCQl2YXIgbGFiZWwgPSB0aWNrLmZvcm1hdChmb3JtYXRPdmVycmlkZSA/IGZvcm1hdE92ZXJyaWRlIDogbWFqb3IgPyBtYWpvckZvcm1hdCA6IG1pbm9yRm9ybWF0KTsNCgkJCXZhciB0aWNrT3B0cyA9IG1ham9yID8gbWFqb3JUaWNrT3B0cyA6IG9wdGlvbnMudGlja3MubWlub3I7DQoJCQl2YXIgZm9ybWF0dGVyID0gaGVscGVycy52YWx1ZU9yRGVmYXVsdCh0aWNrT3B0cy5jYWxsYmFjaywgdGlja09wdHMudXNlckNhbGxiYWNrKTsNCg0KCQkJcmV0dXJuIGZvcm1hdHRlciA/IGZvcm1hdHRlcihsYWJlbCwgaW5kZXgsIHRpY2tzKSA6IGxhYmVsOw0KCQl9LA0KDQoJCWNvbnZlcnRUaWNrc1RvTGFiZWxzOiBmdW5jdGlvbih0aWNrcykgew0KCQkJdmFyIGxhYmVscyA9IFtdOw0KCQkJdmFyIGksIGlsZW47DQoNCgkJCWZvciAoaSA9IDAsIGlsZW4gPSB0aWNrcy5sZW5ndGg7IGkgPCBpbGVuOyArK2kpIHsNCgkJCQlsYWJlbHMucHVzaCh0aGlzLnRpY2tGb3JtYXRGdW5jdGlvbihtb21lbnQodGlja3NbaV0udmFsdWUpLCBpLCB0aWNrcykpOw0KCQkJfQ0KDQoJCQlyZXR1cm4gbGFiZWxzOw0KCQl9LA0KDQoJCS8qKg0KCQkgKiBAcHJpdmF0ZQ0KCQkgKi8NCgkJZ2V0UGl4ZWxGb3JPZmZzZXQ6IGZ1bmN0aW9uKHRpbWUpIHsNCgkJCXZhciBtZSA9IHRoaXM7DQoJCQl2YXIgc2l6ZSA9IG1lLl9ob3Jpem9udGFsID8gbWUud2lkdGggOiBtZS5oZWlnaHQ7DQoJCQl2YXIgc3RhcnQgPSBtZS5faG9yaXpvbnRhbCA/IG1lLmxlZnQgOiBtZS50b3A7DQoJCQl2YXIgcG9zID0gaW50ZXJwb2xhdGUobWUuX3RhYmxlLCAndGltZScsIHRpbWUsICdwb3MnKTsNCg0KCQkJcmV0dXJuIHN0YXJ0ICsgc2l6ZSAqIChtZS5fb2Zmc2V0cy5sZWZ0ICsgcG9zKSAvIChtZS5fb2Zmc2V0cy5sZWZ0ICsgMSArIG1lLl9vZmZzZXRzLnJpZ2h0KTsNCgkJfSwNCg0KCQlnZXRQaXhlbEZvclZhbHVlOiBmdW5jdGlvbih2YWx1ZSwgaW5kZXgsIGRhdGFzZXRJbmRleCkgew0KCQkJdmFyIG1lID0gdGhpczsNCgkJCXZhciB0aW1lID0gbnVsbDsNCg0KCQkJaWYgKGluZGV4ICE9PSB1bmRlZmluZWQgJiYgZGF0YXNldEluZGV4ICE9PSB1bmRlZmluZWQpIHsNCgkJCQl0aW1lID0gbWUuX3RpbWVzdGFtcHMuZGF0YXNldHNbZGF0YXNldEluZGV4XVtpbmRleF07DQoJCQl9DQoNCgkJCWlmICh0aW1lID09PSBudWxsKSB7DQoJCQkJdGltZSA9IHBhcnNlKHZhbHVlLCBtZSk7DQoJCQl9DQoNCgkJCWlmICh0aW1lICE9PSBudWxsKSB7DQoJCQkJcmV0dXJuIG1lLmdldFBpeGVsRm9yT2Zmc2V0KHRpbWUpOw0KCQkJfQ0KCQl9LA0KDQoJCWdldFBpeGVsRm9yVGljazogZnVuY3Rpb24oaW5kZXgpIHsNCgkJCXZhciB0aWNrcyA9IHRoaXMuZ2V0VGlja3MoKTsNCgkJCXJldHVybiBpbmRleCA+PSAwICYmIGluZGV4IDwgdGlja3MubGVuZ3RoID8NCgkJCQl0aGlzLmdldFBpeGVsRm9yT2Zmc2V0KHRpY2tzW2luZGV4XS52YWx1ZSkgOg0KCQkJCW51bGw7DQoJCX0sDQoNCgkJZ2V0VmFsdWVGb3JQaXhlbDogZnVuY3Rpb24ocGl4ZWwpIHsNCgkJCXZhciBtZSA9IHRoaXM7DQoJCQl2YXIgc2l6ZSA9IG1lLl9ob3Jpem9udGFsID8gbWUud2lkdGggOiBtZS5oZWlnaHQ7DQoJCQl2YXIgc3RhcnQgPSBtZS5faG9yaXpvbnRhbCA/IG1lLmxlZnQgOiBtZS50b3A7DQoJCQl2YXIgcG9zID0gKHNpemUgPyAocGl4ZWwgLSBzdGFydCkgLyBzaXplIDogMCkgKiAobWUuX29mZnNldHMubGVmdCArIDEgKyBtZS5fb2Zmc2V0cy5sZWZ0KSAtIG1lLl9vZmZzZXRzLnJpZ2h0Ow0KCQkJdmFyIHRpbWUgPSBpbnRlcnBvbGF0ZShtZS5fdGFibGUsICdwb3MnLCBwb3MsICd0aW1lJyk7DQoNCgkJCXJldHVybiBtb21lbnQodGltZSk7DQoJCX0sDQoNCgkJLyoqDQoJCSAqIENydWRlIGFwcHJveGltYXRpb24gb2Ygd2hhdCB0aGUgbGFiZWwgd2lkdGggbWlnaHQgYmUNCgkJICogQHByaXZhdGUNCgkJICovDQoJCWdldExhYmVsV2lkdGg6IGZ1bmN0aW9uKGxhYmVsKSB7DQoJCQl2YXIgbWUgPSB0aGlzOw0KCQkJdmFyIHRpY2tzT3B0cyA9IG1lLm9wdGlvbnMudGlja3M7DQoJCQl2YXIgdGlja0xhYmVsV2lkdGggPSBtZS5jdHgubWVhc3VyZVRleHQobGFiZWwpLndpZHRoOw0KCQkJdmFyIGFuZ2xlID0gaGVscGVycy50b1JhZGlhbnModGlja3NPcHRzLm1heFJvdGF0aW9uKTsNCgkJCXZhciBjb3NSb3RhdGlvbiA9IE1hdGguY29zKGFuZ2xlKTsNCgkJCXZhciBzaW5Sb3RhdGlvbiA9IE1hdGguc2luKGFuZ2xlKTsNCgkJCXZhciB0aWNrRm9udFNpemUgPSBoZWxwZXJzLnZhbHVlT3JEZWZhdWx0KHRpY2tzT3B0cy5mb250U2l6ZSwgZGVmYXVsdHMuZ2xvYmFsLmRlZmF1bHRGb250U2l6ZSk7DQoNCgkJCXJldHVybiAodGlja0xhYmVsV2lkdGggKiBjb3NSb3RhdGlvbikgKyAodGlja0ZvbnRTaXplICogc2luUm90YXRpb24pOw0KCQl9LA0KDQoJCS8qKg0KCQkgKiBAcHJpdmF0ZQ0KCQkgKi8NCgkJZ2V0TGFiZWxDYXBhY2l0eTogZnVuY3Rpb24oZXhhbXBsZVRpbWUpIHsNCgkJCXZhciBtZSA9IHRoaXM7DQoNCgkJCXZhciBmb3JtYXRPdmVycmlkZSA9IG1lLm9wdGlvbnMudGltZS5kaXNwbGF5Rm9ybWF0cy5taWxsaXNlY29uZDsJLy8gUGljayB0aGUgbG9uZ2VzdCBmb3JtYXQgZm9yIGd1ZXN0aW1hdGlvbg0KDQoJCQl2YXIgZXhhbXBsZUxhYmVsID0gbWUudGlja0Zvcm1hdEZ1bmN0aW9uKG1vbWVudChleGFtcGxlVGltZSksIDAsIFtdLCBmb3JtYXRPdmVycmlkZSk7DQoJCQl2YXIgdGlja0xhYmVsV2lkdGggPSBtZS5nZXRMYWJlbFdpZHRoKGV4YW1wbGVMYWJlbCk7DQoJCQl2YXIgaW5uZXJXaWR0aCA9IG1lLmlzSG9yaXpvbnRhbCgpID8gbWUud2lkdGggOiBtZS5oZWlnaHQ7DQoNCgkJCXJldHVybiBNYXRoLmZsb29yKGlubmVyV2lkdGggLyB0aWNrTGFiZWxXaWR0aCk7DQoJCX0NCgl9KTsNCg0KCUNoYXJ0LnNjYWxlU2VydmljZS5yZWdpc3RlclNjYWxlVHlwZSgndGltZScsIFRpbWVTY2FsZSwgZGVmYXVsdENvbmZpZyk7DQp9Ow0KDQp9LHsiMjUiOjI1LCI0NSI6NDUsIjYiOjZ9XX0se30sWzddKSg3KQ0KfSk7';
my $script_cnvs = 'function width(){return window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth||0}function height(){return window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight||0}var canvas=document.getElementById("chartjs");canvas.width=width(),canvas.height=height(),new Chart(canvas,{type:"line",data:{"labels":[';
my $html_mid  = "],datasets:[{label:'1C licenses report',data:[";
my $html_end  = "],fill:!1,borderColor:'rgb(75, 192, 192)',lineTension:.1}]},options:{}});</script></body></html>";
my $lgf = $folder.'1Cv8.lgf';
open($fh, '<:encoding(UTF-8)', $lgf) or die "Could not open file '$lgf' $!";
while (<$fh>){
    $id_start =$1 if(/\_\$Session\$\_\.Start\",(\d+)/);
    $id_finish=$1 if(/\_\$Session\$\_\.Finish\",(\d+)/);
    $id_1cv8c =$1 if(/1CV8C\",(\d+)/);
    $id_1cv8  =$1 if(/1CV8\",(\d+)/);
    $id_webc  =$1 if(/WebClient\",(\d+)/);
    $id_dsgnr =$1 if(/Designer\",(\d+)/);
}
close($fh);
open($fout, '>:encoding(UTF-8)', $folder."result.csv") or die "Could not create file $!";#это - файл с результатом. В каталоге с ЖР
foreach my $lgp(<$folder*.lgp>) {
    $ttl=0;
    %cnt=();
    open(my $fh, '<', $lgp) or die "Can not open file $!";
    read($fh,$_,stat($fh)->size) or die "Could not read file '$lgp' $!";
    close($fh);
    foreach $item(/\{\d{14},\w,\r*\n\{[0-9abcdef]+,[0-9abcdef]+\},\d+,\d+,[$id_1cv8c,$id_1cv8,$id_webc,$id_dsgnr],\d+,[$id_start,$id_finish],/g){
        $cnt{$1}+=1 if ($item=~/\{(\d{10})\d{4},\w,\r*\n\{[0-9abcdef]+,[0-9abcdef]+\},\d+,\d+,[$id_1cv8c,$id_1cv8,$id_webc,$id_dsgnr],\d+,[$id_start],/g);
        $cnt{$1}-=1 if ($item=~/\{(\d{10})\d{4},\w,\r*\n\{[0-9abcdef]+,[0-9abcdef]+\},\d+,\d+,[$id_1cv8c,$id_1cv8,$id_webc,$id_dsgnr],\d+,[$id_finish],/g);
    }
    foreach $k(sort (keys(%cnt))){
        $ttl+=$cnt{$k};
        if ($k=~/(\d{4})(\d{2})(\d{2})(\d{2})/){
            $labels=$labels.'"'."$1.$2.$3 $4:00:00".'",';
            $values=$values."$ttl," if($ttl>0);
            $values=$values."0,"    if($ttl<0);
            print $fout "$1.$2.$3 $4:00:00,$ttl\r\n" if($ttl>0);
            print $fout "$1.$2.$3 $4:00:00,0\r\n"    if($ttl<0);
        }
    }
}
open($fhtml, '>:encoding(UTF-8)', $folder."report.html") or die "Could not create file $!";#это - файл с результатом. В каталоге с ЖР
print $fhtml $html_head.decode_base64($script_base64).$script_cnvs.substr($labels,0,-1).$html_mid.substr($values,0,-1).$html_end